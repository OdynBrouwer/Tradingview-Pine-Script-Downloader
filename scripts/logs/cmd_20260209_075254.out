[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 06:38:45 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 06:38:45 GMT' as: 2026-02-09T06:38:45+00:00
[DEBUG] Exact published date for header: 2026-02-09T06:38:45+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/qgSSrerD-AMT-Institutional-Model-v2/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '// ═══════════════════════════════════════════════════════════════════════════════\n// FABIO VALENTINI — AUCTION MARKET THEORY INSTITUTIONAL INDICATOR v2\n// Pine Script v6 | Modular Architecture | Non-Predictive | Condition-Based\n// ═══════════════════════════════════════════════════════════════════════════════\n//\n// MODEL SUMMARY (Extracted from Valentini Transcript & Research):\n// ───────────────────────────────────────────────────────────────────────────────\n// This is a MODEL, not a strategy. A strategy cages a dynamic entity.\n// The market is an auction — it moves from balance to imbalance and back.\n//\n// STEP 1 — LOCATION:  Are we in balance or imbalance? Only trade OUT of balance.\n// STEP 2 — VALIDATION: Use LVN (Low Volume Nodes) as reaction zones.\n//          Use HVN (High Volume Nodes) as acceptance/consolidation zones.\n// STEP 3 — AGGRESSION: Confirm with large EXECUTED orders (bubbles).\n//\n// BALANCE BOX (Value Area):\n// Valentini: "Market is usually in balance. That is why traders take a\n// streak of stop-losses." The Balance Box is the Value Area (VAH-VAL)\n// where 70% of volume was transacted — the NO-TRADE zone. Only trade\n// when price breaks OUT of this box with confirmed aggression.\n//\n// VOLUME PROFILE METHODOLOGY:\n// HVN/LVN detection uses standard bin-based volume distribution —\n// the same methodology used by ATAS, Sierra Chart, Quantower, and\n// TradingView\'s own Session Volume Profile. Each bar\'s volume is\n// proportionally distributed across the price bins (rows) it spans.\n// Reference: Dalton, J. "Mind Over Markets" (1990); Steidlmayer, J.P.\n// "Markets & Market Logic" (1986); CME Group Market Profile education.\n//\n// LIMITATIONS (TradingView):\n// - No true tick-by-tick order flow / DOM data available\n// - Volume is distributed proportionally across candle range (approximation)\n// - No executed vs limit order differentiation\n// - Volume delta is APPROXIMATED using candle structure\n// - Aggression bubbles use volume spike + delta proxy, NOT true order flow\n// ═══════════════════════════════════════════════════════════════════════════════\n\n//@version=6\nindicator("Valentini AMT Institutional Model v2",\n     shorttitle   = "V-AMT v2",\n     overlay      = true,\n     max_lines_count  = 500,\n     max_labels_count = 500,\n     max_boxes_count  = 200)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// INPUT SETTINGS — Organized by Module\n// ═══════════════════════════════════════════════════════════════════════════════\n\n// ── Global Settings ──\nstring GRP_GLOBAL = "Global Settings"\n\nstring labelMode = input.string("Detailed", "Label Mode",\n     options = ["Short", "Detailed"], group = GRP_GLOBAL,\n     tooltip = "SHORT: Compact 2-3 letter labels (e.g. WH, DL, R, S).\\nDETAILED: Full descriptive labels (e.g. Weekly High, Prev Day Low, 30m Resistance).\\nUse Short for cleaner charts, Detailed when learning the indicator.")\n\nstring labelSizeInput = input.string("Small", "Label Size",\n     options = ["Auto", "Tiny", "Small", "Normal", "Large"],\n     group = GRP_GLOBAL,\n     tooltip = "Controls the text size of ALL labels on the chart.\\nAUTO: TradingView decides based on zoom.\\nTINY: Smallest, best for high-density charts.\\nSMALL: Default, good balance of visibility.\\nNORMAL: Easier to read on larger screens.\\nLARGE: Maximum readability, best for presentations.")\n\nbool isFutures = input.bool(true, "Futures Mode (NQ/ES/YM)",\n     group = GRP_GLOBAL,\n     tooltip = "ON = Futures-optimized volume thresholds and delta proxy.\\nOFF = ETF mode (SPY/QQQ) with higher thresholds to filter dark-pool noise.\\nFutures have concentrated RTH volume making spikes more reliable.\\nETFs include off-exchange prints that inflate volume without directional meaning.")\n\nstring sensitivityInput = input.string("Medium", "Sensitivity Level",\n     options = ["Low", "Medium", "High"],\n     group = GRP_GLOBAL,\n     tooltip = "Controls how aggressively the indicator filters noise across ALL modules.\\nLOW: Strict filtering. Fewer levels, fewer bubbles, only strongest signals. Best for clean charts and experienced traders.\\nMEDIUM: Balanced. Good mix of signal density and quality. Recommended default.\\nHIGH: Sensitive. More levels, more bubbles, catches weaker signals. Best for scalping or learning.\\nAffects: S/R duplicate threshold, volume spike threshold, body ratio filter, confluence proximity, and HVN/LVN thresholds.")\n\n// ── Module A: 30-Min Trend ──\nstring GRP_TREND = "Module A: 30-Min Trend"\n\nbool showTrend = input.bool(true, "Show 30-Min Trend Line",\n     group = GRP_TREND,\n     tooltip = "Displays the 30-minute auction trend as a step-line on your chart.\\nBLUE = Uptrend (Higher-Highs + Higher-Lows on 30-min).\\nRED = Downtrend (Lower-Lows + Lower-Highs on 30-min).\\nGRAY = Neutral / No clear structure.\\nThis is auction-based structure, NOT a moving average crossover.\\nValentini: Trend is only reliable when market is OUT OF BALANCE.")\n\nint trendLookback = input.int(5, "HH/HL Lookback (30-min bars)", minval = 2, maxval = 20,\n     group = GRP_TREND,\n     tooltip = "Number of 30-minute bars used to detect highest-high and lowest-low.\\nLower values (2-3) = faster trend detection, more whipsaws.\\nHigher values (8-15) = slower, smoother trend, fewer false signals.\\nDefault 5 = ~2.5 hours of 30-min structure. Good for NQ/ES intraday.")\n\n// ── Module B: 30-Min Auction S/R ──\nstring GRP_SR = "Module B: 30-Min S/R"\n\nbool showSR = input.bool(true, "Show 30-Min Auction S/R",\n     group = GRP_SR,\n     tooltip = "Draws horizontal support and resistance levels from 30-minute auction structure.\\nThese are structural pivot highs/lows — points where the auction found acceptance or rejection.\\nValentini: These are NOT retail pivots. They represent where large participants transacted.\\nLevels persist across all timeframes.")\n\nint srLeftBars = input.int(3, "Pivot Left Bars (30-min)", minval = 1, maxval = 10,\n     group = GRP_SR,\n     tooltip = "Bars to the LEFT required to confirm a pivot high/low.\\nHigher = more confirmed (stronger) levels but fewer of them.\\nLower = more levels detected but some may be noise.\\nDefault 3 = requires 3 bars of price action before the pivot to confirm it.")\n\nint srRightBars = input.int(3, "Pivot Right Bars (30-min)", minval = 1, maxval = 10,\n     group = GRP_SR,\n     tooltip = "Bars to the RIGHT required to confirm a pivot high/low.\\nThis creates a natural delay — the level is only drawn AFTER confirmation.\\nHigher = more lag but stronger confirmation.\\nLower = faster detection but more false levels.\\nDefault 3 = level confirmed after 1.5 hours of post-pivot price action.")\n\nint srMaxLevels = input.int(6, "Max S/R Levels Displayed", minval = 2, maxval = 12,\n     group = GRP_SR,\n     tooltip = "Maximum number of support and resistance levels shown simultaneously.\\nOldest levels are removed when new ones appear.\\nLower = cleaner chart with only the most recent structure.\\nHigher = more historical context but more visual clutter.\\nDefault 6 = 3 support + 3 resistance is a good balance.")\n\n// ── Module C: Aggression Detection ──\nstring GRP_AGGR = "Module C: Aggression"\n\nbool showAggression = input.bool(true, "Show Aggression Bubbles",\n     group = GRP_AGGR,\n     tooltip = "Plots circles (bubbles) at points of large aggressive volume.\\nValentini: \'In order flow platforms you see bubbles. When there is direction, location, and aggression your ability to READ is 100%.\'\\nBLUE circles below bar = Buyer aggression (bullish volume spike with close near high).\\nRED circles above bar = Seller aggression (bearish volume spike with close near low).\\nCircle SIZE scales with volume intensity: Small/Normal/Large.\\nTradingView LIMITATION: This is a volume-spike proxy, not true order flow.")\n\nfloat futuresMultiplier = input.float(2.0, "Futures Vol Spike Multiplier", minval = 1.0, maxval = 5.0,\n     step = 0.5, group = GRP_AGGR,\n     tooltip = "For FUTURES (NQ/ES/YM): Volume must exceed this multiple of the average to qualify as aggression.\\nLower (1.5-2.0) = more frequent signals, catches smaller spikes.\\nHigher (3.0-5.0) = only extreme volume events, very selective.\\nDefault 2.0 = volume must be 2x the 20-bar average.")\n\nfloat etfMultiplier = input.float(2.5, "ETF Vol Spike Multiplier", minval = 1.0, maxval = 5.0,\n     step = 0.5, group = GRP_AGGR,\n     tooltip = "For ETFs (SPY/QQQ): Volume must exceed this multiple of the average.\\nSet HIGHER than futures because ETF volume includes dark-pool prints,\\nblock trades, and off-exchange activity that inflates bar volume.\\nDefault 2.5 = filters out most noise while catching genuine institutional aggression.")\n\nint aggrVolPeriod = input.int(20, "Vol Average Period", minval = 5, maxval = 50,\n     group = GRP_AGGR,\n     tooltip = "Number of bars used to calculate the volume moving average baseline.\\nThe volume spike threshold = Average Volume x Multiplier.\\nLower (5-10) = adapts faster to recent activity, more reactive.\\nHigher (30-50) = smoother baseline, less reactive to short-term changes.\\nDefault 20 = standard institutional lookback, roughly one trading session on 5-min.")\n\n// ── Module D: Multi-TF Levels ──\nstring GRP_MTF = "Module D: MTF Levels"\n\nbool showWeekly = input.bool(true, "Show Weekly Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous week\'s High, Low, and Close as horizontal lines.\\nWeekly levels represent major structural boundaries where large institutions position.\\nValentini: These are the \'big picture\' auction boundaries.\\nOrange lines by default.")\n\nbool showDaily = input.bool(true, "Show Daily Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous day\'s High, Low, Close, Midpoint, and Fibonacci retracements.\\nDaily levels are the most commonly referenced by institutional desks.\\nThe Midpoint serves as a POC (Point of Control) proxy.\\nAlso draws daily Fibonacci levels (23.6%, 38.2%, 50%, 61.8%, 78.6%).\\nPurple lines by default.")\n\nbool show4H = input.bool(true, "Show 4H Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous 4-hour bar\'s High, Low, and Midpoint.\\nThe 4H range represents the Initial Balance — the first major auction range of the session.\\nValentini: The market moves from balance to imbalance.\\nThe 4H zone shows where the current session\'s balance is forming.\\nCyan lines by default.")\n\nbool showHourly = input.bool(true, "Show Hourly Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous hour\'s High and Low as horizontal lines.\\nHourly levels are tactical execution levels for intraday trading.\\nGray lines by default.")\n\nbool showMAs = input.bool(true, "Show 20/50 MAs",\n     group = GRP_MTF,\n     tooltip = "Draws the Daily 20-period and 50-period Simple Moving Averages.\\nThese are institutional reference levels used by trend-following desks.\\n20 SMA = short-term momentum reference.\\n50 SMA = medium-term trend reference.\\nNon-repainting — uses previous day\'s confirmed values.")\n\nbool showPsychLevels = input.bool(true, "Show Psych Levels",\n     group = GRP_MTF,\n     tooltip = "Draws psychological round number levels as dotted white lines.\\nRound numbers act as natural auction boundaries (e.g. NQ 20000, ES 5500).\\nLarge participants and algorithms cluster orders around round numbers.\\nNQ = 100, ES = 50, YM = 500, SPY = 5, QQQ = 5.")\n\nfloat psychInterval = input.float(100.0, "Psych Level Interval",\n     minval = 10.0, maxval = 1000.0, step = 10.0, group = GRP_MTF,\n     tooltip = "Spacing between psychological round number levels in price units.\\n  NQ = 100 (e.g. 20000, 20100, 20200)\\n  ES = 50 (e.g. 5500, 5550, 5600)\\n  YM = 500 (e.g. 40000, 40500, 41000)\\n  SPY = 5 | QQQ = 5")\n\nbool showWeeklyFibs = input.bool(true, "Show Weekly Fibonacci Levels",\n     group = GRP_MTF,\n     tooltip = "Draws Fibonacci retracement levels from previous week\'s High-Low range.\\nLevels: 23.6%, 38.2%, 50%, 61.8%, 78.6%.\\nLabeled with \'W\' prefix to distinguish from daily fibs.\\nWeekly fibs are significant for swing setups and multi-day holds.")\n\nbool showDailyFibs = input.bool(true, "Show Daily Fibonacci Levels",\n     group = GRP_MTF,\n     tooltip = "Draws Fibonacci retracement levels from previous day\'s High-Low range.\\nLevels: 23.6%, 38.2%, 50%, 61.8%, 78.6%.\\nLabeled with \'D\' prefix to show source timeframe.\\nDaily fibs are the most used institutional retracement reference.")\n\n// ── Module E: Balance / Imbalance ──\nstring GRP_BAL = "Module E: Auction Narrative"\n\nbool showBalance = input.bool(true, "Show Balance/Imbalance State",\n     group = GRP_BAL,\n     tooltip = "Colors the chart background to show the current auction state.\\nYELLOW tint = BALANCE — choppy, ranging. DO NOT TRADE.\\nBLUE tint = IMBALANCE BULLISH — ok to look for longs.\\nRED tint = IMBALANCE BEARISH — ok to look for shorts.\\nValentini: \'Market is usually in balance. That is why traders take a streak of stop-losses.\'")\n\nint balancePeriod = input.int(20, "Balance Detection Period", minval = 5, maxval = 50,\n     group = GRP_BAL,\n     tooltip = "Number of bars for ATR-based balance/imbalance detection.\\nCompares short-term ATR vs long-term ATR to measure range expansion.\\nDefault 20 = reliable for most intraday timeframes.")\n\nfloat balanceThreshold = input.float(0.6, "Balance Threshold (0-1)", minval = 0.1, maxval = 1.0,\n     step = 0.1, group = GRP_BAL,\n     tooltip = "The ratio below which the market is considered IN BALANCE.\\nATR short / ATR long < threshold = BALANCE (stay away).\\nATR short / ATR long >= threshold = IMBALANCE (ok to trade).\\nDefault 0.6 = balanced classification matching Valentini\'s approach.")\n\n// ── Module F: Volume Profile HVN/LVN & Balance Box ──\nstring GRP_VP = "Module F: Volume Profile (HVN/LVN)"\n\nbool showHVN = input.bool(true, "Show High Volume Nodes (HVN)",\n     group = GRP_VP,\n     tooltip = "HVN = price levels where a LARGE amount of volume was transacted.\\nThese are areas of ACCEPTANCE — price tends to consolidate here.\\nHVNs act as strong support/resistance. Price slows down at HVNs.\\nValentini uses HVNs to identify where institutional traders built positions.\\nMethodology: Dalton \'Mind Over Markets\', CME Market Profile education.")\n\nbool showLVN = input.bool(true, "Show Low Volume Nodes (LVN)",\n     group = GRP_VP,\n     tooltip = "LVN = price levels where VERY LITTLE volume was transacted.\\nThese are areas of REJECTION — price moves through them fast.\\nValentini: LVNs are key reaction zones for entries.\\n\'When price comes back into the LVN, check the order flow.\'\\nLVNs are similar to single prints in Market Profile.\\nPrice tends to rip through LVNs on revisit due to low liquidity.")\n\nbool showBalanceBox = input.bool(true, "Show Balance Box (Value Area)",\n     group = GRP_VP,\n     tooltip = "Draws a semi-transparent box showing the VALUE AREA — where 70% of volume was traded.\\nThis is the BALANCE ZONE / NO-TRADE BOX per Valentini\'s model.\\nValentini: \'In balance, 70% of the time, the market stays stuck.\'\\nOnly trade when price breaks OUT of this box with confirmed aggression.\\nTop edge = VAH (Value Area High). Bottom edge = VAL (Value Area Low).\\nPOC (Point of Control) line drawn at highest volume level inside.\\nBased on Steidlmayer\'s Market Profile theory (CME, 1986).")\n\nbool showPOC = input.bool(true, "Show POC Line (Point of Control)",\n     group = GRP_VP,\n     tooltip = "Draws the Point of Control — the single price level with the HIGHEST traded volume.\\nPOC acts as a magnet for price and the strongest S/R from volume profile.\\nValentini: Target the previous balance POC — 70% of the time, price reverses from it.\\nThe POC is the \'fair value\' price where buyers and sellers agreed most.")\n\nint vpLookback = input.int(200, "VP Lookback Bars", minval = 50, maxval = 500,\n     group = GRP_VP,\n     tooltip = "Number of bars used to build the volume profile.\\nThis defines the \'session\' or range for HVN/LVN detection.\\nLower (50-100) = recent micro-structure, good for scalping.\\nHigher (200-500) = broader structure, better for swing context.\\nDefault 200 = covers a full day on 5-min charts (NQ/ES).\\nAdjust based on your chart timeframe.")\n\nint vpRows = input.int(24, "VP Resolution (Rows)", minval = 12, maxval = 48,\n     group = GRP_VP,\n     tooltip = "Number of price bins (rows) in the volume profile histogram.\\nHigher = more detail, more precise HVN/LVN detection, but slower.\\nLower = smoother, fewer but more significant nodes detected.\\nDefault 24 = good balance of precision and performance.\\n12 = fast/coarse, 48 = detailed/slow.")\n\nfloat vaPercent = input.float(70.0, "Value Area %", minval = 50.0, maxval = 90.0,\n     step = 5.0, group = GRP_VP,\n     tooltip = "Percentage of total volume that defines the Value Area (Balance Box).\\n70% is the standard from Steidlmayer\'s Market Profile — one standard\\ndeviation of a normal distribution. Used universally by institutional desks.\\nHigher (80-90%) = wider box, more conservative \'balance\' definition.\\nLower (50-60%) = tighter box, more aggressive imbalance detection.")\n\n// ── Alert Settings ──\nstring GRP_ALERTS = "Alert Configuration"\n\nbool alertBullConfluence = input.bool(true, "Alert: Bull Confluence",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when ALL 3 Valentini conditions align for a LONG:\\n1. Market is in IMBALANCE\\n2. Price is near a SUPPORT level\\n3. BUYER AGGRESSION detected\\nThis is the premium setup from the model.")\n\nbool alertBearConfluence = input.bool(true, "Alert: Bear Confluence",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when ALL 3 Valentini conditions align for a SHORT:\\n1. Market is in IMBALANCE\\n2. Price is near a RESISTANCE level\\n3. SELLER AGGRESSION detected\\nThis is the premium setup from the model.")\n\nbool alertFailedBuyAuction = input.bool(true, "Alert: Failed Buy Auction",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when aggressive BUYERS fail — previous bar had a buy aggression spike\\nbut the current bar closes BELOW the previous bar low.\\nValentini: \'Aggressive buyers created a failed auction — the sellers won.\'")\n\nbool alertFailedSellAuction = input.bool(true, "Alert: Failed Sell Auction",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when aggressive SELLERS fail — previous bar had a sell aggression spike\\nbut the current bar closes ABOVE the previous bar high.\\nKey reversal signal in Valentini\'s model.")\n\nbool alertHugeBuyVol = input.bool(true, "Alert: Huge Buy Volume (5x+)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when buyer aggression is EXTREME — volume exceeds 5x the average\\nwith a bullish candle close. Rare institutional-size events.")\n\nbool alertHugeSellVol = input.bool(true, "Alert: Huge Sell Volume (5x+)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when seller aggression is EXTREME — volume exceeds 5x the average\\nwith a bearish candle close. Rare institutional-size distribution events.")\n\nbool alertBalanceShift = input.bool(false, "Alert: Balance/Imbalance Shift",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when market state CHANGES between balance and imbalance.\\nOFF by default because it fires frequently.")\n\nbool alertTrendChange = input.bool(false, "Alert: 30-Min Trend Change",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when the 30-minute trend direction FLIPS.\\nOFF by default to reduce noise.")\n\nbool alertAnyAggression = input.bool(false, "Alert: Any Aggression (All Sizes)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers on ANY volume spike with directional conviction.\\nMost frequent alert. OFF by default.")\n\nbool alertAtKeyLevel = input.bool(false, "Alert: Price at Key Level",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price is within proximity of any 30-min S/R level.\\nOFF by default because it fires often near levels.")\n\nbool alertPriceExitVA = input.bool(true, "Alert: Price Exits Value Area",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price closes OUTSIDE the Balance Box (Value Area).\\nValentini: This is when to start watching for setups.\\nPrice exiting the Value Area = potential imbalance beginning.\\nCombine with aggression confirmation before entering.")\n\nbool alertPriceAtPOC = input.bool(false, "Alert: Price at POC",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price is near the Point of Control level.\\nPOC is the strongest volume-based level.\\nUseful for mean-reversion setups.\\nOFF by default — enable for POC-based strategies.")\n\n// ── Colors ──\nstring GRP_COLORS = "Colors"\n\ncolor colBullTrend  = input.color(#2196F3, "Bull Trend",       group = GRP_COLORS, tooltip = "Bullish trend line and imbalance background.")\ncolor colBearTrend  = input.color(#F44336, "Bear Trend",       group = GRP_COLORS, tooltip = "Bearish trend line and imbalance background.")\ncolor colBuyAggr    = input.color(#2196F3, "Buyer Aggression",  group = GRP_COLORS, tooltip = "Buyer aggression bubbles.")\ncolor colSellAggr   = input.color(#F44336, "Seller Aggression", group = GRP_COLORS, tooltip = "Seller aggression bubbles.")\ncolor colWeekly     = input.color(#FF9800, "Weekly Level",      group = GRP_COLORS, tooltip = "Weekly H/L/C lines.")\ncolor colDaily      = input.color(#9C27B0, "Daily Level",       group = GRP_COLORS, tooltip = "Daily H/L/C/M and Fibonacci lines.")\ncolor col4H         = input.color(#00BCD4, "4H Level",          group = GRP_COLORS, tooltip = "4H balance zone lines.")\ncolor colHourly     = input.color(#607D8B, "Hourly Level",      group = GRP_COLORS, tooltip = "Hourly H/L lines.")\ncolor colSupport    = input.color(#4CAF50, "Support Level",     group = GRP_COLORS, tooltip = "30-min auction support levels.")\ncolor colResistance = input.color(#FF5722, "Resistance Level",  group = GRP_COLORS, tooltip = "30-min auction resistance levels.")\ncolor colBalance    = input.color(#FFC107, "Balance Zone BG",   group = GRP_COLORS, tooltip = "Background tint when market is in BALANCE.")\ncolor colHVN        = input.color(#FFEB3B, "HVN Level",         group = GRP_COLORS, tooltip = "High Volume Node lines — areas of acceptance/consolidation.")\ncolor colLVN        = input.color(#E040FB, "LVN Level",         group = GRP_COLORS, tooltip = "Low Volume Node lines — areas of rejection/fast movement.")\ncolor colPOC        = input.color(#FF6D00, "POC Line",          group = GRP_COLORS, tooltip = "Point of Control — highest volume price level.")\ncolor colVABox      = input.color(#FFC107, "Balance Box Fill",  group = GRP_COLORS, tooltip = "Value Area (Balance Box) background fill color.")\ncolor colWeeklyFib  = input.color(#FF9800, "Weekly Fib Levels", group = GRP_COLORS, tooltip = "Weekly Fibonacci retracement lines.")\ncolor colDailyFib   = input.color(#9C27B0, "Daily Fib Levels",  group = GRP_COLORS, tooltip = "Daily Fibonacci retracement lines.")\n\n// ── Line Widths ──\nstring GRP_WIDTHS = "Line Widths"\n\nint widWeekly   = input.int(2, "Weekly Level Width",     minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for weekly H/L/C levels.")\nint widDaily    = input.int(2, "Daily Level Width",      minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for daily H/L/C/M levels.")\nint wid4H       = input.int(1, "4H Level Width",         minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for 4-hour levels.")\nint widHourly   = input.int(1, "Hourly Level Width",     minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for hourly levels.")\nint widSR       = input.int(1, "S/R Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for 30-min auction S/R levels.")\nint widMA       = input.int(1, "MA Level Width",         minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for daily 20/50 SMA levels.")\nint widFib      = input.int(1, "Fibonacci Level Width",  minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Line thickness for Fibonacci retracement levels.")\nint widPsych    = input.int(1, "Psych Level Width",      minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Line thickness for psychological round number levels.")\nint widHVN      = input.int(2, "HVN Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for High Volume Node levels.")\nint widLVN      = input.int(1, "LVN Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for Low Volume Node levels.")\nint widPOC      = input.int(3, "POC Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for Point of Control level.")\nint widVABorder = input.int(1, "Balance Box Border Width", minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Border thickness for the Value Area (Balance Box).")\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// GLOBAL COMPUTATIONS — Must execute every bar unconditionally for ta.* consistency\n// ═══════════════════════════════════════════════════════════════════════════════\nfloat globalATR14     = ta.atr(14)\nfloat vpRangeHigh     = ta.highest(high, vpLookback)\nfloat vpRangeLow      = ta.lowest(low, vpLookback)\nint atrShortLen       = int(balancePeriod / 2) < 1 ? 1 : int(balancePeriod / 2)\nfloat atrShort        = ta.atr(atrShortLen)\nfloat atrLong         = ta.atr(balancePeriod)\nfloat volAvg          = ta.sma(volume, aggrVolPeriod)\n\n// ── Sensitivity Mapping ──\nfloat sensBodyRatio   = sensitivityInput == "Low" ? 0.45 : sensitivityInput == "High" ? 0.20 : 0.30\nfloat sensDupeATRMult = sensitivityInput == "Low" ? 0.50 : sensitivityInput == "High" ? 0.15 : 0.30\nfloat sensProxATRMult = sensitivityInput == "Low" ? 0.30 : sensitivityInput == "High" ? 0.70 : 0.50\nfloat sensVolBoost    = sensitivityInput == "Low" ? 0.5  : sensitivityInput == "High" ? -0.3 : 0.0\nfloat sensHVNMult     = sensitivityInput == "Low" ? 1.8  : sensitivityInput == "High" ? 1.2 : 1.5\nfloat sensLVNMult     = sensitivityInput == "Low" ? 0.3  : sensitivityInput == "High" ? 0.6 : 0.5\n\n// ── Label Size Mapping ──\nstring labelSz = switch labelSizeInput\n    "Auto"   => size.auto\n    "Tiny"   => size.tiny\n    "Small"  => size.small\n    "Normal" => size.normal\n    "Large"  => size.large\n    => size.small\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// HELPER FUNCTIONS\n// ═══════════════════════════════════════════════════════════════════════════════\n\nlabelText(string shortTxt, string longTxt) =>\n    labelMode == "Short" ? shortTxt : longTxt\n\ndeltaProxy(float o, float h, float l, float c, float v) =>\n    float barRange = h - l\n    float deltaRatio = barRange > 0 ? (c - l) / barRange - 0.5 : 0.0\n    float delta = deltaRatio * v * 2.0\n    delta\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE A — 30-MINUTE TREND CONTEXT\n// ═══════════════════════════════════════════════════════════════════════════════\n\n[htf30H, htf30L, htf30C, htf30O] = request.security(\n     syminfo.tickerid, "30",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\nfloat htf30HH = request.security(syminfo.tickerid, "30",\n     ta.highest(high, trendLookback)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30LL = request.security(syminfo.tickerid, "30",\n     ta.lowest(low, trendLookback)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30prevHH = request.security(syminfo.tickerid, "30",\n     ta.highest(high, trendLookback)[trendLookback + 1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30prevLL = request.security(syminfo.tickerid, "30",\n     ta.lowest(low, trendLookback)[trendLookback + 1],\n     lookahead = barmerge.lookahead_on)\n\nbool higherHigh = not na(htf30HH) and not na(htf30prevHH) and htf30HH > htf30prevHH\nbool higherLow  = not na(htf30LL) and not na(htf30prevLL) and htf30LL > htf30prevLL\nbool lowerLow   = not na(htf30LL) and not na(htf30prevLL) and htf30LL < htf30prevLL\nbool lowerHigh  = not na(htf30HH) and not na(htf30prevHH) and htf30HH < htf30prevHH\n\nvar int trendState = 0\nif higherHigh and higherLow\n    trendState := 1\nelse if lowerLow and lowerHigh\n    trendState := -1\n\nvar int prevTrendState = 0\nbool trendChanged = trendState != prevTrendState and prevTrendState != 0\nprevTrendState := trendState\n\ncolor trendColor = trendState == 1 ? colBullTrend : trendState == -1 ? colBearTrend : color.gray\n\nplot(showTrend ? htf30C : na, "30-Min Trend Line",\n     color = trendColor, linewidth = 2, style = plot.style_stepline)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE B — 30-MINUTE AUCTION SUPPORT & RESISTANCE\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat htf30PivH = request.security(syminfo.tickerid, "30",\n     ta.pivothigh(high, srLeftBars, srRightBars)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30PivL = request.security(syminfo.tickerid, "30",\n     ta.pivotlow(low, srLeftBars, srRightBars)[1],\n     lookahead = barmerge.lookahead_on)\n\nvar array<float> resistanceLevels = array.new_float()\nvar array<float> supportLevels    = array.new_float()\nvar array<line>  srLines          = array.new_line()\nvar array<label> srLabels         = array.new_label()\n\nfloat dupeThreshold = globalATR14 * sensDupeATRMult\n\nif showSR and not na(htf30PivH)\n    bool duplicate = false\n    if array.size(resistanceLevels) > 0\n        for i = 0 to array.size(resistanceLevels) - 1\n            if math.abs(array.get(resistanceLevels, i) - htf30PivH) < dupeThreshold\n                duplicate := true\n                break\n    if not duplicate\n        array.push(resistanceLevels, htf30PivH)\n        if array.size(resistanceLevels) > srMaxLevels\n            array.shift(resistanceLevels)\n\nif showSR and not na(htf30PivL)\n    bool duplicate = false\n    if array.size(supportLevels) > 0\n        for i = 0 to array.size(supportLevels) - 1\n            if math.abs(array.get(supportLevels, i) - htf30PivL) < dupeThreshold\n                duplicate := true\n                break\n    if not duplicate\n        array.push(supportLevels, htf30PivL)\n        if array.size(supportLevels) > srMaxLevels\n            array.shift(supportLevels)\n\nif showSR and barstate.islast\n    if array.size(srLines) > 0\n        for i = 0 to array.size(srLines) - 1\n            line.delete(array.get(srLines, i))\n    if array.size(srLabels) > 0\n        for i = 0 to array.size(srLabels) - 1\n            label.delete(array.get(srLabels, i))\n    array.clear(srLines)\n    array.clear(srLabels)\n\n    if array.size(resistanceLevels) > 0\n        for i = 0 to array.size(resistanceLevels) - 1\n            float lvl = array.get(resistanceLevels, i)\n            line newLine = line.new(bar_index - 50, lvl, bar_index + 10, lvl,\n                 color = colResistance, style = line.style_dashed, width = widSR,\n                 extend = extend.right)\n            array.push(srLines, newLine)\n            string txt = labelText("R", "30m Resistance")\n            label newLabel = label.new(bar_index + 12, lvl, txt,\n                 color = color.new(colResistance, 80), textcolor = colResistance,\n                 style = label.style_label_left, size = labelSz)\n            array.push(srLabels, newLabel)\n\n    if array.size(supportLevels) > 0\n        for i = 0 to array.size(supportLevels) - 1\n            float lvl = array.get(supportLevels, i)\n            line newLine = line.new(bar_index - 50, lvl, bar_index + 10, lvl,\n                 color = colSupport, style = line.style_dashed, width = widSR,\n                 extend = extend.right)\n            array.push(srLines, newLine)\n            string txt = labelText("S", "30m Support")\n            label newLabel = label.new(bar_index + 12, lvl, txt,\n                 color = color.new(colSupport, 80), textcolor = colSupport,\n                 style = label.style_label_left, size = labelSz)\n            array.push(srLabels, newLabel)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE C — AGGRESSION / LARGE TRADE DETECTION\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat effFutMult = futuresMultiplier + sensVolBoost\nfloat effEtfMult = etfMultiplier + sensVolBoost\nfloat volThreshold = isFutures ? volAvg * effFutMult : volAvg * effEtfMult\n\nfloat currentDelta = deltaProxy(open, high, low, close, volume)\n\nbool volSpike       = volume > volThreshold and not na(volAvg) and volAvg > 0\nfloat candleRange   = high - low\nfloat bodyRatio     = candleRange > 0 ? math.abs(close - open) / candleRange : 0.0\nbool meaningfulBody = bodyRatio > sensBodyRatio\n\nbool buyAggression  = volSpike and close > open and meaningfulBody and showAggression\nbool sellAggression = volSpike and close < open and meaningfulBody and showAggression\n\nfloat volRatio = volAvg > 0 ? volume / volAvg : 0.0\nbool isMediumSpike = volRatio >= 2.0 and volRatio < 3.5\nbool isLargeSpike  = volRatio >= 3.5 and volRatio < 5.0\nbool isHugeSpike   = volRatio >= 5.0\n\nplotshape(buyAggression and isMediumSpike, "Buy Aggr (Med)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 30), size = size.small)\nplotshape(buyAggression and isLargeSpike, "Buy Aggr (Lrg)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 10), size = size.normal)\nplotshape(buyAggression and isHugeSpike, "Buy Aggr (Huge)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 0), size = size.large)\n\nplotshape(sellAggression and isMediumSpike, "Sell Aggr (Med)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 30), size = size.small)\nplotshape(sellAggression and isLargeSpike, "Sell Aggr (Lrg)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 10), size = size.normal)\nplotshape(sellAggression and isHugeSpike, "Sell Aggr (Huge)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 0), size = size.large)\n\nbool failedBuyAuction  = buyAggression[1] and close < low[1]\nbool failedSellAuction = sellAggression[1] and close > high[1]\n\nplotshape(failedBuyAuction and showAggression, "Failed Buy Auction",\n     style = shape.xcross, location = location.abovebar,\n     color = colSellAggr, size = size.small)\nplotshape(failedSellAuction and showAggression, "Failed Sell Auction",\n     style = shape.xcross, location = location.belowbar,\n     color = colBuyAggr, size = size.small)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE D — MULTI-TIMEFRAME INSTITUTIONAL LEVELS\n// ═══════════════════════════════════════════════════════════════════════════════\n\n[wkH, wkL, wkC, wkO] = request.security(syminfo.tickerid, "1W",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[dayH, dayL, dayC, dayO] = request.security(syminfo.tickerid, "1D",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[h4H, h4L, h4C, h4O] = request.security(syminfo.tickerid, "240",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[h1H, h1L, h1C] = request.security(syminfo.tickerid, "60",\n     [high[1], low[1], close[1]],\n     lookahead = barmerge.lookahead_on)\n\nfloat dailyMA20 = request.security(syminfo.tickerid, "1D",\n     ta.sma(close, 20)[1], lookahead = barmerge.lookahead_on)\nfloat dailyMA50 = request.security(syminfo.tickerid, "1D",\n     ta.sma(close, 50)[1], lookahead = barmerge.lookahead_on)\n\nvar array<line>  mtfLines  = array.new_line()\nvar array<label> mtfLabels = array.new_label()\n\ndrawLevel(float price, color col, string shortName, string longName, int wid, string lineStyle) =>\n    if not na(price) and barstate.islast\n        string txt = labelText(shortName, longName)\n        string lstyle = lineStyle == "dashed" ? line.style_dashed : lineStyle == "dotted" ? line.style_dotted : line.style_solid\n        line newLine = line.new(bar_index - 30, price, bar_index + 10, price,\n             color = col, style = lstyle, width = wid,\n             extend = extend.right)\n        array.push(mtfLines, newLine)\n        label newLabel = label.new(bar_index + 14, price,\n             txt + " " + str.tostring(price, format.mintick),\n             color = color.new(col, 85), textcolor = col,\n             style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, newLabel)\n\nif barstate.islast\n    if array.size(mtfLines) > 0\n        for i = 0 to array.size(mtfLines) - 1\n            line.delete(array.get(mtfLines, i))\n    if array.size(mtfLabels) > 0\n        for i = 0 to array.size(mtfLabels) - 1\n            label.delete(array.get(mtfLabels, i))\n    array.clear(mtfLines)\n    array.clear(mtfLabels)\n\nif showWeekly\n    drawLevel(wkH, colWeekly, "WH", "Weekly High", widWeekly, "solid")\n    drawLevel(wkL, colWeekly, "WL", "Weekly Low", widWeekly, "solid")\n    drawLevel(wkC, colWeekly, "WC", "Weekly Close", math.max(1, widWeekly - 1), "solid")\n\nif showDaily\n    drawLevel(dayH, colDaily, "DH", "Prev Day High", widDaily, "solid")\n    drawLevel(dayL, colDaily, "DL", "Prev Day Low", widDaily, "solid")\n    drawLevel(dayC, colDaily, "DC", "Prev Day Close", math.max(1, widDaily - 1), "solid")\n    float dayMid = (dayH + dayL) / 2.0\n    drawLevel(dayMid, color.new(colDaily, 40), "DM", "Daily Midpoint (POC Proxy)", math.max(1, widDaily - 1), "solid")\n\nif show4H\n    drawLevel(h4H, col4H, "4H-H", "4H Balance High", wid4H, "solid")\n    drawLevel(h4L, col4H, "4H-L", "4H Balance Low", wid4H, "solid")\n    float h4Mid = (h4H + h4L) / 2.0\n    drawLevel(h4Mid, color.new(col4H, 40), "4H-M", "4H Balance Mid", wid4H, "solid")\n\nif showHourly\n    drawLevel(h1H, colHourly, "1H-H", "Hourly High", widHourly, "solid")\n    drawLevel(h1L, colHourly, "1H-L", "Hourly Low", widHourly, "solid")\n\nif showMAs\n    drawLevel(dailyMA20, #26A69A, "D20", "Daily 20 SMA", widMA, "solid")\n    drawLevel(dailyMA50, #EF5350, "D50", "Daily 50 SMA", widMA, "solid")\n\nif showPsychLevels and barstate.islast and psychInterval > 0\n    float baseLevel = math.floor(low / psychInterval) * psychInterval\n    int maxPsychLevels = 5\n    for i = -1 to maxPsychLevels\n        float psyLvl = baseLevel + psychInterval * i\n        if psyLvl > low - psychInterval * 2 and psyLvl < high + psychInterval * 2\n            string pTxt = labelText("PSY", "Psych " + str.tostring(psyLvl, "#"))\n            line pLine = line.new(bar_index - 30, psyLvl, bar_index + 10, psyLvl,\n                 color = color.new(color.white, 70), style = line.style_dotted, width = widPsych,\n                 extend = extend.right)\n            array.push(mtfLines, pLine)\n            label pLabel = label.new(bar_index + 14, psyLvl, pTxt,\n                 color = color.new(color.white, 90), textcolor = color.new(color.white, 40),\n                 style = label.style_label_left, size = labelSz)\n            array.push(mtfLabels, pLabel)\n\n// ── Daily Fibonacci Levels (labeled with source TF) ──\nif showDailyFibs and barstate.islast and not na(dayH) and not na(dayL)\n    float dFibSpan = dayH - dayL\n    if dFibSpan > 0\n        float dFib236 = dayH - dFibSpan * 0.236\n        float dFib382 = dayH - dFibSpan * 0.382\n        float dFib500 = dayH - dFibSpan * 0.500\n        float dFib618 = dayH - dFibSpan * 0.618\n        float dFib786 = dayH - dFibSpan * 0.786\n\n        color dFibCol = color.new(colDailyFib, 50)\n        for fibVal in array.from(dFib236, dFib382, dFib500, dFib618, dFib786)\n            line fLine = line.new(bar_index - 20, fibVal, bar_index + 5, fibVal,\n                 color = dFibCol, style = line.style_dotted, width = widFib,\n                 extend = extend.right)\n            array.push(mtfLines, fLine)\n\n        label df236 = label.new(bar_index + 6, dFib236, labelText("DF236", "D Fib 23.6%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df236)\n        label df382 = label.new(bar_index + 6, dFib382, labelText("DF382", "D Fib 38.2%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df382)\n        label df5 = label.new(bar_index + 6, dFib500, labelText("DF50", "D Fib 50%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df5)\n        label df6 = label.new(bar_index + 6, dFib618, labelText("DF618", "D Fib 61.8%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df6)\n        label df786 = label.new(bar_index + 6, dFib786, labelText("DF786", "D Fib 78.6%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df786)\n\n// ── Weekly Fibonacci Levels (labeled with source TF) ──\nif showWeeklyFibs and barstate.islast and not na(wkH) and not na(wkL)\n    float wFibSpan = wkH - wkL\n    if wFibSpan > 0\n        float wFib236 = wkH - wFibSpan * 0.236\n        float wFib382 = wkH - wFibSpan * 0.382\n        float wFib500 = wkH - wFibSpan * 0.500\n        float wFib618 = wkH - wFibSpan * 0.618\n        float wFib786 = wkH - wFibSpan * 0.786\n\n        color wFibCol = color.new(colWeeklyFib, 50)\n        for fibVal in array.from(wFib236, wFib382, wFib500, wFib618, wFib786)\n            line fLine = line.new(bar_index - 30, fibVal, bar_index + 5, fibVal,\n                 color = wFibCol, style = line.style_dashed, width = widFib,\n                 extend = extend.right)\n            array.push(mtfLines, fLine)\n\n        label wf236 = label.new(bar_index + 8, wFib236, labelText("WF236", "W Fib 23.6%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf236)\n        label wf382 = label.new(bar_index + 8, wFib382, labelText("WF382", "W Fib 38.2%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf382)\n        label wf5 = label.new(bar_index + 8, wFib500, labelText("WF50", "W Fib 50%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf5)\n        label wf6 = label.new(bar_index + 8, wFib618, labelText("WF618", "W Fib 61.8%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf6)\n        label wf786 = label.new(bar_index + 8, wFib786, labelText("WF786", "W Fib 78.6%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf786)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE E — AUCTION NARRATIVE OVERLAY (Balance vs Imbalance)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat balanceRatio = atrLong > 0 ? atrShort / atrLong : 0.5\n\nbool isInBalance  = balanceRatio < balanceThreshold\nbool isImbalanced = not isInBalance\n\nvar bool prevBalanceState = true\nbool balanceShifted = isInBalance != prevBalanceState\nprevBalanceState := isInBalance\n\nbgcolor(showBalance and isInBalance ? color.new(colBalance, 92) : na, title = "Balance Zone BG")\nbgcolor(showBalance and isImbalanced and trendState == 1 ? color.new(colBullTrend, 94) : na, title = "Imbalance Bull BG")\nbgcolor(showBalance and isImbalanced and trendState == -1 ? color.new(colBearTrend, 94) : na, title = "Imbalance Bear BG")\n\n// ── Location Validity ──\nfloat nearestResist = na\nfloat nearestSupp   = na\n\nif array.size(resistanceLevels) > 0\n    nearestResist := array.get(resistanceLevels, array.size(resistanceLevels) - 1)\nif array.size(supportLevels) > 0\n    nearestSupp := array.get(supportLevels, array.size(supportLevels) - 1)\n\nbool nearResistance = not na(nearestResist) and math.abs(close - nearestResist) < globalATR14 * sensProxATRMult\nbool nearSupport    = not na(nearestSupp) and math.abs(close - nearestSupp) < globalATR14 * sensProxATRMult\nbool atKeyLevel     = nearResistance or nearSupport\n\n// ── Valentini Confluence Signal ──\nbool bullConfluence = isImbalanced and trendState == 1 and nearSupport and buyAggression\nbool bearConfluence = isImbalanced and trendState == -1 and nearResistance and sellAggression\n\nplotshape(bullConfluence, "Bull Confluence",\n     style = shape.diamond, location = location.belowbar,\n     color = color.new(#00E676, 0), size = size.normal)\nplotshape(bearConfluence, "Bear Confluence",\n     style = shape.diamond, location = location.abovebar,\n     color = color.new(#FF1744, 0), size = size.normal)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE F — VOLUME PROFILE: HVN, LVN, POC, & BALANCE BOX (VALUE AREA)\n// ═══════════════════════════════════════════════════════════════════════════════\n//\n// Methodology: Standard bin-based volume distribution.\n// Each bar\'s volume is proportionally allocated across the price bins\n// (rows) that the bar\'s high-low range spans. This is the same approach\n// used by professional platforms (ATAS, Sierra Chart, Quantower) and\n// TradingView\'s own Session Volume Profile indicator.\n//\n// Academic foundation:\n// - Steidlmayer, J.P. "Markets & Market Logic" (1986) — Market Profile\n// - Dalton, J. "Mind Over Markets" (1990) — Value Area, POC concepts\n// - CME Group Market Profile Handbook — standard 70% Value Area\n//\n// Valentini\'s application:\n// - Balance Box (Value Area) = NO-TRADE ZONE. Skip trades inside.\n// - LVN = reaction zones for entries when price revisits\n// - HVN = acceptance zones, price consolidates here\n// - POC = fair value, strongest S/R, target for mean-reversion\n// ═══════════════════════════════════════════════════════════════════════════════\n\nvar array<line>  vpLines  = array.new_line()\nvar array<label> vpLabels = array.new_label()\nvar array<box>   vpBoxes  = array.new_box()\n\n// Persistent VP output values for alerts (updated on last bar)\nvar float vpVAH = na\nvar float vpVAL = na\nvar float vpPOCprice = na\n\nif barstate.islast and (showHVN or showLVN or showBalanceBox or showPOC)\n    // ── Clean up previous VP drawings ──\n    if array.size(vpLines) > 0\n        for i = 0 to array.size(vpLines) - 1\n            line.delete(array.get(vpLines, i))\n    if array.size(vpLabels) > 0\n        for i = 0 to array.size(vpLabels) - 1\n            label.delete(array.get(vpLabels, i))\n    if array.size(vpBoxes) > 0\n        for i = 0 to array.size(vpBoxes) - 1\n            box.delete(array.get(vpBoxes, i))\n    array.clear(vpLines)\n    array.clear(vpLabels)\n    array.clear(vpBoxes)\n\n    // ── Build Volume Profile ──\n    float rHigh = vpRangeHigh\n    float rLow  = vpRangeLow\n    float binSize = not na(rHigh) and not na(rLow) and rHigh > rLow ? (rHigh - rLow) / vpRows : 0.0\n\n    if binSize > 0\n        // Initialize volume bins\n        array<float> volBins = array.new_float(vpRows, 0.0)\n        float totalVolume = 0.0\n\n        // Distribute volume into bins\n        for i = 0 to vpLookback - 1\n            float barH = high[i]\n            float barL = low[i]\n            float barV = volume[i]\n            if not na(barH) and not na(barL) and not na(barV) and barV > 0\n                int startBin = math.max(0, math.min(vpRows - 1, int(math.floor((barL - rLow) / binSize))))\n                int endBin   = math.max(0, math.min(vpRows - 1, int(math.floor((barH - rLow) / binSize))))\n                if startBin > endBin\n                    int tempBin = startBin\n                    startBin := endBin\n                    endBin   := tempBin\n                int numBins = endBin - startBin + 1\n                float volPerBin = barV / numBins\n                for b = startBin to endBin\n                    array.set(volBins, b, array.get(volBins, b) + volPerBin)\n                totalVolume += barV\n\n        if totalVolume > 0\n            // ── Find POC (bin with highest volume) ──\n            int pocBin = 0\n            float maxBinVol = 0.0\n            for b = 0 to vpRows - 1\n                float bv = array.get(volBins, b)\n                if bv > maxBinVol\n                    maxBinVol := bv\n                    pocBin    := b\n\n            float pocPrice = rLow + (pocBin + 0.5) * binSize\n            vpPOCprice := pocPrice\n\n            // ── Calculate Value Area (expanding from POC) ──\n            float vaTarget = totalVolume * (vaPercent / 100.0)\n            float cumVol   = array.get(volBins, pocBin)\n            int vaLowBin   = pocBin\n            int vaHighBin  = pocBin\n\n            for _iter = 0 to vpRows - 1\n                if cumVol >= vaTarget\n                    break\n                float volAbove = vaHighBin < vpRows - 1 ? array.get(volBins, vaHighBin + 1) : 0.0\n                float volBelow = vaLowBin > 0 ? array.get(volBins, vaLowBin - 1) : 0.0\n                if volAbove == 0.0 and volBelow == 0.0\n                    break\n                if volAbove >= volBelow and vaHighBin < vpRows - 1\n                    vaHighBin += 1\n                    cumVol    += volAbove\n                else if vaLowBin > 0\n                    vaLowBin -= 1\n                    cumVol   += volBelow\n                else if vaHighBin < vpRows - 1\n                    vaHighBin += 1\n                    cumVol    += volAbove\n                else\n                    break\n\n            float vahPrice = rLow + (vaHighBin + 1) * binSize\n            float valPrice = rLow + vaLowBin * binSize\n            vpVAH := vahPrice\n            vpVAL := valPrice\n\n            // ── Draw Balance Box (Value Area) ──\n            if showBalanceBox\n                box vaBox = box.new(bar_index - vpLookback, vahPrice, bar_index + 5, valPrice,\n                     border_color = color.new(colVABox, 50), border_width = widVABorder,\n                     border_style = line.style_dashed,\n                     bgcolor = color.new(colVABox, 93))\n                array.push(vpBoxes, vaBox)\n\n                string vaTopTxt = labelText("VAH", "Value Area High (Skip Above)")\n                label vahLabel = label.new(bar_index + 6, vahPrice, vaTopTxt + " " + str.tostring(vahPrice, format.mintick),\n                     color = color.new(colVABox, 85), textcolor = colVABox,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, vahLabel)\n\n                string vaBotTxt = labelText("VAL", "Value Area Low (Skip Below)")\n                label valLabel = label.new(bar_index + 6, valPrice, vaBotTxt + " " + str.tostring(valPrice, format.mintick),\n                     color = color.new(colVABox, 85), textcolor = colVABox,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, valLabel)\n\n            // ── Draw POC ──\n            if showPOC\n                line pocLine = line.new(bar_index - vpLookback, pocPrice, bar_index + 10, pocPrice,\n                     color = colPOC, style = line.style_solid, width = widPOC,\n                     extend = extend.right)\n                array.push(vpLines, pocLine)\n\n                string pocTxt = labelText("POC", "POC (Fair Value)")\n                label pocLabel = label.new(bar_index + 12, pocPrice, pocTxt + " " + str.tostring(pocPrice, format.mintick),\n                     color = color.new(colPOC, 80), textcolor = colPOC,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, pocLabel)\n\n            // ── Detect and Draw HVN / LVN ──\n            float avgBinVol = totalVolume / vpRows\n            float hvnThresh = avgBinVol * sensHVNMult\n            float lvnThresh = avgBinVol * sensLVNMult\n\n            for b = 0 to vpRows - 1\n                float bv = array.get(volBins, b)\n                float binMid = rLow + (b + 0.5) * binSize\n\n                // Skip the POC bin for HVN (POC is drawn separately)\n                if showHVN and bv > hvnThresh and b != pocBin\n                    line hvnLine = line.new(bar_index - vpLookback, binMid, bar_index + 5, binMid,\n                         color = color.new(colHVN, 30), style = line.style_solid, width = widHVN)\n                    array.push(vpLines, hvnLine)\n                    string hvnTxt = labelText("HVN", "HVN (Acceptance)")\n                    label hvnLabel = label.new(bar_index + 6, binMid, hvnTxt,\n                         color = color.new(colHVN, 85), textcolor = colHVN,\n                         style = label.style_label_left, size = labelSz)\n                    array.push(vpLabels, hvnLabel)\n\n                if showLVN and bv < lvnThresh and bv > 0\n                    line lvnLine = line.new(bar_index - vpLookback, binMid, bar_index + 5, binMid,\n                         color = color.new(colLVN, 30), style = line.style_dashed, width = widLVN)\n                    array.push(vpLines, lvnLine)\n                    string lvnTxt = labelText("LVN", "LVN (Rejection)")\n                    label lvnLabel = label.new(bar_index + 6, binMid, lvnTxt,\n                         color = color.new(colLVN, 85), textcolor = colLVN,\n                         style = label.style_label_left, size = labelSz)\n                    array.push(vpLabels, lvnLabel)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// VP-BASED ALERT CONDITIONS (need to run every bar for alertcondition)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nbool priceAboveVA = not na(vpVAH) and close > vpVAH\nbool priceBelowVA = not na(vpVAL) and close < vpVAL\nbool priceOutsideVA = priceAboveVA or priceBelowVA\nbool priceNearPOC = not na(vpPOCprice) and math.abs(close - vpPOCprice) < globalATR14 * 0.3\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// INFO TABLE\n// ═══════════════════════════════════════════════════════════════════════════════\n\nvar table infoTable = table.new(position.top_right, 2, 8,\n     bgcolor = color.new(color.black, 30),\n     border_width = 1, border_color = color.new(color.white, 70))\n\nif barstate.islast\n    table.cell(infoTable, 0, 0, "V-AMT v2", text_color = color.white, text_size = size.small)\n    table.cell(infoTable, 1, 0,\n         isFutures ? "FUTURES" : "ETF",\n         text_color = isFutures ? color.orange : color.aqua, text_size = size.small)\n\n    table.cell(infoTable, 0, 1, "State:", text_color = color.gray, text_size = size.tiny)\n    table.cell(infoTable, 1, 1,\n         isInBalance ? "BALANCE" : "IMBALANCE",\n         text_color = isInBalance ? colBalance : (trendState == 1 ? colBullTrend : colBearTrend),\n         text_size = size.tiny)\n\n    table.cell(infoTable, 0, 2, "30m Trend:", text_color = color.gray, text_size = size.tiny)\n    string trendTxt = trendState == 1 ? "BULL" : trendState == -1 ? "BEAR" : "NEUTRAL"\n    table.cell(infoTable, 1, 2, trendTxt, text_color = trendColor, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 3, "Volume:", text_color = color.gray, text_size = size.tiny)\n    string volTxt = volRatio >= 3.0 ? "EXTREME" : volRatio >= 2.0 ? "SPIKE" : "Normal"\n    color volTxtCol = volRatio >= 3.0 ? color.red : volRatio >= 2.0 ? color.orange : color.gray\n    table.cell(infoTable, 1, 3, volTxt, text_color = volTxtCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 4, "Delta:", text_color = color.gray, text_size = size.tiny)\n    table.cell(infoTable, 1, 4,\n         currentDelta > 0 ? "BUY +" + str.tostring(math.round(currentDelta)) :\n         "SELL " + str.tostring(math.round(currentDelta)),\n         text_color = currentDelta > 0 ? colBuyAggr : colSellAggr, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 5, "Location:", text_color = color.gray, text_size = size.tiny)\n    string locTxt = priceAboveVA ? "ABOVE VA" : priceBelowVA ? "BELOW VA" : "INSIDE VA"\n    color locCol = priceOutsideVA ? color.lime : colBalance\n    table.cell(infoTable, 1, 5, locTxt, text_color = locCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 6, "Sensitivity:", text_color = color.gray, text_size = size.tiny)\n    color sensCol = sensitivityInput == "Low" ? color.green : sensitivityInput == "High" ? color.red : color.orange\n    table.cell(infoTable, 1, 6, sensitivityInput, text_color = sensCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 7, "Signal:", text_color = color.gray, text_size = size.tiny)\n    string sigTxt = bullConfluence ? "BULL CONFLUENCE" :\n         bearConfluence ? "BEAR CONFLUENCE" :\n         isInBalance ? "Wait - In Balance" :\n         not priceOutsideVA ? "Inside VA - Skip" :\n         atKeyLevel ? "At Key Level" : "Scanning..."\n    color sigCol = bullConfluence ? #00E676 :\n         bearConfluence ? #FF1744 :\n         isInBalance or not priceOutsideVA ? colBalance : color.gray\n    table.cell(infoTable, 1, 7, sigTxt, text_color = sigCol, text_size = size.tiny)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// ALERTS — All configurable via input toggles\n// ═══════════════════════════════════════════════════════════════════════════════\n\nalertcondition(alertBullConfluence and bullConfluence,\n     "Bull Confluence",\n     "V-AMT: BULL CONFLUENCE — Imbalance + Support + Buy Aggression. Premium long setup.")\n\nalertcondition(alertBearConfluence and bearConfluence,\n     "Bear Confluence",\n     "V-AMT: BEAR CONFLUENCE — Imbalance + Resistance + Sell Aggression. Premium short setup.")\n\nalertcondition(alertFailedBuyAuction and failedBuyAuction,\n     "Failed Buy Auction",\n     "V-AMT: Aggressive BUYERS FAILED — price reversed below aggression bar. Potential short.")\n\nalertcondition(alertFailedSellAuction and failedSellAuction,\n     "Failed Sell Auction",\n     "V-AMT: Aggressive SELLERS FAILED — price reversed above aggression bar. Potential long.")\n\nalertcondition(alertHugeBuyVol and buyAggression and isHugeSpike,\n     "Huge Buy Volume",\n     "V-AMT: EXTREME buyer aggression (5x+ volume). Institutional-size buying.")\n\nalertcondition(alertHugeSellVol and sellAggression and isHugeSpike,\n     "Huge Sell Volume",\n     "V-AMT: EXTREME seller aggression (5x+ volume). Institutional-size selling.")\n\nalertcondition(alertBalanceShift and balanceShifted,\n     "Balance/Imbalance Shift",\n     "V-AMT: Market state changed between BALANCE and IMBALANCE.")\n\nalertcondition(alertTrendChange and trendChanged,\n     "30-Min Trend Change",\n     "V-AMT: 30-minute trend direction has FLIPPED.")\n\nalertcondition(alertAnyAggression and (buyAggression or sellAggression),\n     "Any Aggression Detected",\n     "V-AMT: Volume aggression detected (buyer or seller).")\n\nalertcondition(alertAtKeyLevel and atKeyLevel,\n     "Price at Key Level",\n     "V-AMT: Price near a 30-min support or resistance level.")\n\nalertcondition(alertPriceExitVA and priceOutsideVA,\n     "Price Exits Value Area",\n     "V-AMT: Price closed OUTSIDE the Value Area (Balance Box). Watch for setups.")\n\nalertcondition(alertPriceAtPOC and priceNearPOC,\n     "Price at POC",\n     "V-AMT: Price is near the Point of Control. Mean-reversion zone.")'
[CAPTURE 1] '// ═══════════════════════════════════════════════════════════════════════════════\n// FABIO VALENTINI — AUCTION MARKET THEORY INSTITUTIONAL INDICATOR v2\n// Pine Script v6 | Modular Architecture | Non-Predictive | Condition-Based\n// ═══════════════════════════════════════════════════════════════════════════════\n//\n// MODEL SUMMARY (Extracted from Valentini Transcript & Research):\n// ───────────────────────────────────────────────────────────────────────────────\n// This is a MODEL, not a strategy. A strategy cages a dynamic entity.\n// The market is an auction — it moves from balance to imbalance and back.\n//\n// STEP 1 — LOCATION:  Are we in balance or imbalance? Only trade OUT of balance.\n// STEP 2 — VALIDATION: Use LVN (Low Volume Nodes) as reaction zones.\n//          Use HVN (High Volume Nodes) as acceptance/consolidation zones.\n// STEP 3 — AGGRESSION: Confirm with large EXECUTED orders (bubbles).\n//\n// BALANCE BOX (Value Area):\n// Valentini: "Market is usually in balance. That is why traders take a\n// streak of stop-losses." The Balance Box is the Value Area (VAH-VAL)\n// where 70% of volume was transacted — the NO-TRADE zone. Only trade\n// when price breaks OUT of this box with confirmed aggression.\n//\n// VOLUME PROFILE METHODOLOGY:\n// HVN/LVN detection uses standard bin-based volume distribution —\n// the same methodology used by ATAS, Sierra Chart, Quantower, and\n// TradingView\'s own Session Volume Profile. Each bar\'s volume is\n// proportionally distributed across the price bins (rows) it spans.\n// Reference: Dalton, J. "Mind Over Markets" (1990); Steidlmayer, J.P.\n// "Markets & Market Logic" (1986); CME Group Market Profile education.\n//\n// LIMITATIONS (TradingView):\n// - No true tick-by-tick order flow / DOM data available\n// - Volume is distributed proportionally across candle range (approximation)\n// - No executed vs limit order differentiation\n// - Volume delta is APPROXIMATED using candle structure\n// - Aggression bubbles use volume spike + delta proxy, NOT true order flow\n// ═══════════════════════════════════════════════════════════════════════════════\n\n//@version=6\nindicator("Valentini AMT Institutional Model v2",\n     shorttitle   = "V-AMT v2",\n     overlay      = true,\n     max_lines_count  = 500,\n     max_labels_count = 500,\n     max_boxes_count  = 200)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// INPUT SETTINGS — Organized by Module\n// ═══════════════════════════════════════════════════════════════════════════════\n\n// ── Global Settings ──\nstring GRP_GLOBAL = "Global Settings"\n\nstring labelMode = input.string("Detailed", "Label Mode",\n     options = ["Short", "Detailed"], group = GRP_GLOBAL,\n     tooltip = "SHORT: Compact 2-3 letter labels (e.g. WH, DL, R, S).\\nDETAILED: Full descriptive labels (e.g. Weekly High, Prev Day Low, 30m Resistance).\\nUse Short for cleaner charts, Detailed when learning the indicator.")\n\nstring labelSizeInput = input.string("Small", "Label Size",\n     options = ["Auto", "Tiny", "Small", "Normal", "Large"],\n     group = GRP_GLOBAL,\n     tooltip = "Controls the text size of ALL labels on the chart.\\nAUTO: TradingView decides based on zoom.\\nTINY: Smallest, best for high-density charts.\\nSMALL: Default, good balance of visibility.\\nNORMAL: Easier to read on larger screens.\\nLARGE: Maximum readability, best for presentations.")\n\nbool isFutures = input.bool(true, "Futures Mode (NQ/ES/YM)",\n     group = GRP_GLOBAL,\n     tooltip = "ON = Futures-optimized volume thresholds and delta proxy.\\nOFF = ETF mode (SPY/QQQ) with higher thresholds to filter dark-pool noise.\\nFutures have concentrated RTH volume making spikes more reliable.\\nETFs include off-exchange prints that inflate volume without directional meaning.")\n\nstring sensitivityInput = input.string("Medium", "Sensitivity Level",\n     options = ["Low", "Medium", "High"],\n     group = GRP_GLOBAL,\n     tooltip = "Controls how aggressively the indicator filters noise across ALL modules.\\nLOW: Strict filtering. Fewer levels, fewer bubbles, only strongest signals. Best for clean charts and experienced traders.\\nMEDIUM: Balanced. Good mix of signal density and quality. Recommended default.\\nHIGH: Sensitive. More levels, more bubbles, catches weaker signals. Best for scalping or learning.\\nAffects: S/R duplicate threshold, volume spike threshold, body ratio filter, confluence proximity, and HVN/LVN thresholds.")\n\n// ── Module A: 30-Min Trend ──\nstring GRP_TREND = "Module A: 30-Min Trend"\n\nbool showTrend = input.bool(true, "Show 30-Min Trend Line",\n     group = GRP_TREND,\n     tooltip = "Displays the 30-minute auction trend as a step-line on your chart.\\nBLUE = Uptrend (Higher-Highs + Higher-Lows on 30-min).\\nRED = Downtrend (Lower-Lows + Lower-Highs on 30-min).\\nGRAY = Neutral / No clear structure.\\nThis is auction-based structure, NOT a moving average crossover.\\nValentini: Trend is only reliable when market is OUT OF BALANCE.")\n\nint trendLookback = input.int(5, "HH/HL Lookback (30-min bars)", minval = 2, maxval = 20,\n     group = GRP_TREND,\n     tooltip = "Number of 30-minute bars used to detect highest-high and lowest-low.\\nLower values (2-3) = faster trend detection, more whipsaws.\\nHigher values (8-15) = slower, smoother trend, fewer false signals.\\nDefault 5 = ~2.5 hours of 30-min structure. Good for NQ/ES intraday.")\n\n// ── Module B: 30-Min Auction S/R ──\nstring GRP_SR = "Module B: 30-Min S/R"\n\nbool showSR = input.bool(true, "Show 30-Min Auction S/R",\n     group = GRP_SR,\n     tooltip = "Draws horizontal support and resistance levels from 30-minute auction structure.\\nThese are structural pivot highs/lows — points where the auction found acceptance or rejection.\\nValentini: These are NOT retail pivots. They represent where large participants transacted.\\nLevels persist across all timeframes.")\n\nint srLeftBars = input.int(3, "Pivot Left Bars (30-min)", minval = 1, maxval = 10,\n     group = GRP_SR,\n     tooltip = "Bars to the LEFT required to confirm a pivot high/low.\\nHigher = more confirmed (stronger) levels but fewer of them.\\nLower = more levels detected but some may be noise.\\nDefault 3 = requires 3 bars of price action before the pivot to confirm it.")\n\nint srRightBars = input.int(3, "Pivot Right Bars (30-min)", minval = 1, maxval = 10,\n     group = GRP_SR,\n     tooltip = "Bars to the RIGHT required to confirm a pivot high/low.\\nThis creates a natural delay — the level is only drawn AFTER confirmation.\\nHigher = more lag but stronger confirmation.\\nLower = faster detection but more false levels.\\nDefault 3 = level confirmed after 1.5 hours of post-pivot price action.")\n\nint srMaxLevels = input.int(6, "Max S/R Levels Displayed", minval = 2, maxval = 12,\n     group = GRP_SR,\n     tooltip = "Maximum number of support and resistance levels shown simultaneously.\\nOldest levels are removed when new ones appear.\\nLower = cleaner chart with only the most recent structure.\\nHigher = more historical context but more visual clutter.\\nDefault 6 = 3 support + 3 resistance is a good balance.")\n\n// ── Module C: Aggression Detection ──\nstring GRP_AGGR = "Module C: Aggression"\n\nbool showAggression = input.bool(true, "Show Aggression Bubbles",\n     group = GRP_AGGR,\n     tooltip = "Plots circles (bubbles) at points of large aggressive volume.\\nValentini: \'In order flow platforms you see bubbles. When there is direction, location, and aggression your ability to READ is 100%.\'\\nBLUE circles below bar = Buyer aggression (bullish volume spike with close near high).\\nRED circles above bar = Seller aggression (bearish volume spike with close near low).\\nCircle SIZE scales with volume intensity: Small/Normal/Large.\\nTradingView LIMITATION: This is a volume-spike proxy, not true order flow.")\n\nfloat futuresMultiplier = input.float(2.0, "Futures Vol Spike Multiplier", minval = 1.0, maxval = 5.0,\n     step = 0.5, group = GRP_AGGR,\n     tooltip = "For FUTURES (NQ/ES/YM): Volume must exceed this multiple of the average to qualify as aggression.\\nLower (1.5-2.0) = more frequent signals, catches smaller spikes.\\nHigher (3.0-5.0) = only extreme volume events, very selective.\\nDefault 2.0 = volume must be 2x the 20-bar average.")\n\nfloat etfMultiplier = input.float(2.5, "ETF Vol Spike Multiplier", minval = 1.0, maxval = 5.0,\n     step = 0.5, group = GRP_AGGR,\n     tooltip = "For ETFs (SPY/QQQ): Volume must exceed this multiple of the average.\\nSet HIGHER than futures because ETF volume includes dark-pool prints,\\nblock trades, and off-exchange activity that inflates bar volume.\\nDefault 2.5 = filters out most noise while catching genuine institutional aggression.")\n\nint aggrVolPeriod = input.int(20, "Vol Average Period", minval = 5, maxval = 50,\n     group = GRP_AGGR,\n     tooltip = "Number of bars used to calculate the volume moving average baseline.\\nThe volume spike threshold = Average Volume x Multiplier.\\nLower (5-10) = adapts faster to recent activity, more reactive.\\nHigher (30-50) = smoother baseline, less reactive to short-term changes.\\nDefault 20 = standard institutional lookback, roughly one trading session on 5-min.")\n\n// ── Module D: Multi-TF Levels ──\nstring GRP_MTF = "Module D: MTF Levels"\n\nbool showWeekly = input.bool(true, "Show Weekly Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous week\'s High, Low, and Close as horizontal lines.\\nWeekly levels represent major structural boundaries where large institutions position.\\nValentini: These are the \'big picture\' auction boundaries.\\nOrange lines by default.")\n\nbool showDaily = input.bool(true, "Show Daily Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous day\'s High, Low, Close, Midpoint, and Fibonacci retracements.\\nDaily levels are the most commonly referenced by institutional desks.\\nThe Midpoint serves as a POC (Point of Control) proxy.\\nAlso draws daily Fibonacci levels (23.6%, 38.2%, 50%, 61.8%, 78.6%).\\nPurple lines by default.")\n\nbool show4H = input.bool(true, "Show 4H Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous 4-hour bar\'s High, Low, and Midpoint.\\nThe 4H range represents the Initial Balance — the first major auction range of the session.\\nValentini: The market moves from balance to imbalance.\\nThe 4H zone shows where the current session\'s balance is forming.\\nCyan lines by default.")\n\nbool showHourly = input.bool(true, "Show Hourly Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous hour\'s High and Low as horizontal lines.\\nHourly levels are tactical execution levels for intraday trading.\\nGray lines by default.")\n\nbool showMAs = input.bool(true, "Show 20/50 MAs",\n     group = GRP_MTF,\n     tooltip = "Draws the Daily 20-period and 50-period Simple Moving Averages.\\nThese are institutional reference levels used by trend-following desks.\\n20 SMA = short-term momentum reference.\\n50 SMA = medium-term trend reference.\\nNon-repainting — uses previous day\'s confirmed values.")\n\nbool showPsychLevels = input.bool(true, "Show Psych Levels",\n     group = GRP_MTF,\n     tooltip = "Draws psychological round number levels as dotted white lines.\\nRound numbers act as natural auction boundaries (e.g. NQ 20000, ES 5500).\\nLarge participants and algorithms cluster orders around round numbers.\\nNQ = 100, ES = 50, YM = 500, SPY = 5, QQQ = 5.")\n\nfloat psychInterval = input.float(100.0, "Psych Level Interval",\n     minval = 10.0, maxval = 1000.0, step = 10.0, group = GRP_MTF,\n     tooltip = "Spacing between psychological round number levels in price units.\\n  NQ = 100 (e.g. 20000, 20100, 20200)\\n  ES = 50 (e.g. 5500, 5550, 5600)\\n  YM = 500 (e.g. 40000, 40500, 41000)\\n  SPY = 5 | QQQ = 5")\n\nbool showWeeklyFibs = input.bool(true, "Show Weekly Fibonacci Levels",\n     group = GRP_MTF,\n     tooltip = "Draws Fibonacci retracement levels from previous week\'s High-Low range.\\nLevels: 23.6%, 38.2%, 50%, 61.8%, 78.6%.\\nLabeled with \'W\' prefix to distinguish from daily fibs.\\nWeekly fibs are significant for swing setups and multi-day holds.")\n\nbool showDailyFibs = input.bool(true, "Show Daily Fibonacci Levels",\n     group = GRP_MTF,\n     tooltip = "Draws Fibonacci retracement levels from previous day\'s High-Low range.\\nLevels: 23.6%, 38.2%, 50%, 61.8%, 78.6%.\\nLabeled with \'D\' prefix to show source timeframe.\\nDaily fibs are the most used institutional retracement reference.")\n\n// ── Module E: Balance / Imbalance ──\nstring GRP_BAL = "Module E: Auction Narrative"\n\nbool showBalance = input.bool(true, "Show Balance/Imbalance State",\n     group = GRP_BAL,\n     tooltip = "Colors the chart background to show the current auction state.\\nYELLOW tint = BALANCE — choppy, ranging. DO NOT TRADE.\\nBLUE tint = IMBALANCE BULLISH — ok to look for longs.\\nRED tint = IMBALANCE BEARISH — ok to look for shorts.\\nValentini: \'Market is usually in balance. That is why traders take a streak of stop-losses.\'")\n\nint balancePeriod = input.int(20, "Balance Detection Period", minval = 5, maxval = 50,\n     group = GRP_BAL,\n     tooltip = "Number of bars for ATR-based balance/imbalance detection.\\nCompares short-term ATR vs long-term ATR to measure range expansion.\\nDefault 20 = reliable for most intraday timeframes.")\n\nfloat balanceThreshold = input.float(0.6, "Balance Threshold (0-1)", minval = 0.1, maxval = 1.0,\n     step = 0.1, group = GRP_BAL,\n     tooltip = "The ratio below which the market is considered IN BALANCE.\\nATR short / ATR long < threshold = BALANCE (stay away).\\nATR short / ATR long >= threshold = IMBALANCE (ok to trade).\\nDefault 0.6 = balanced classification matching Valentini\'s approach.")\n\n// ── Module F: Volume Profile HVN/LVN & Balance Box ──\nstring GRP_VP = "Module F: Volume Profile (HVN/LVN)"\n\nbool showHVN = input.bool(true, "Show High Volume Nodes (HVN)",\n     group = GRP_VP,\n     tooltip = "HVN = price levels where a LARGE amount of volume was transacted.\\nThese are areas of ACCEPTANCE — price tends to consolidate here.\\nHVNs act as strong support/resistance. Price slows down at HVNs.\\nValentini uses HVNs to identify where institutional traders built positions.\\nMethodology: Dalton \'Mind Over Markets\', CME Market Profile education.")\n\nbool showLVN = input.bool(true, "Show Low Volume Nodes (LVN)",\n     group = GRP_VP,\n     tooltip = "LVN = price levels where VERY LITTLE volume was transacted.\\nThese are areas of REJECTION — price moves through them fast.\\nValentini: LVNs are key reaction zones for entries.\\n\'When price comes back into the LVN, check the order flow.\'\\nLVNs are similar to single prints in Market Profile.\\nPrice tends to rip through LVNs on revisit due to low liquidity.")\n\nbool showBalanceBox = input.bool(true, "Show Balance Box (Value Area)",\n     group = GRP_VP,\n     tooltip = "Draws a semi-transparent box showing the VALUE AREA — where 70% of volume was traded.\\nThis is the BALANCE ZONE / NO-TRADE BOX per Valentini\'s model.\\nValentini: \'In balance, 70% of the time, the market stays stuck.\'\\nOnly trade when price breaks OUT of this box with confirmed aggression.\\nTop edge = VAH (Value Area High). Bottom edge = VAL (Value Area Low).\\nPOC (Point of Control) line drawn at highest volume level inside.\\nBased on Steidlmayer\'s Market Profile theory (CME, 1986).")\n\nbool showPOC = input.bool(true, "Show POC Line (Point of Control)",\n     group = GRP_VP,\n     tooltip = "Draws the Point of Control — the single price level with the HIGHEST traded volume.\\nPOC acts as a magnet for price and the strongest S/R from volume profile.\\nValentini: Target the previous balance POC — 70% of the time, price reverses from it.\\nThe POC is the \'fair value\' price where buyers and sellers agreed most.")\n\nint vpLookback = input.int(200, "VP Lookback Bars", minval = 50, maxval = 500,\n     group = GRP_VP,\n     tooltip = "Number of bars used to build the volume profile.\\nThis defines the \'session\' or range for HVN/LVN detection.\\nLower (50-100) = recent micro-structure, good for scalping.\\nHigher (200-500) = broader structure, better for swing context.\\nDefault 200 = covers a full day on 5-min charts (NQ/ES).\\nAdjust based on your chart timeframe.")\n\nint vpRows = input.int(24, "VP Resolution (Rows)", minval = 12, maxval = 48,\n     group = GRP_VP,\n     tooltip = "Number of price bins (rows) in the volume profile histogram.\\nHigher = more detail, more precise HVN/LVN detection, but slower.\\nLower = smoother, fewer but more significant nodes detected.\\nDefault 24 = good balance of precision and performance.\\n12 = fast/coarse, 48 = detailed/slow.")\n\nfloat vaPercent = input.float(70.0, "Value Area %", minval = 50.0, maxval = 90.0,\n     step = 5.0, group = GRP_VP,\n     tooltip = "Percentage of total volume that defines the Value Area (Balance Box).\\n70% is the standard from Steidlmayer\'s Market Profile — one standard\\ndeviation of a normal distribution. Used universally by institutional desks.\\nHigher (80-90%) = wider box, more conservative \'balance\' definition.\\nLower (50-60%) = tighter box, more aggressive imbalance detection.")\n\n// ── Alert Settings ──\nstring GRP_ALERTS = "Alert Configuration"\n\nbool alertBullConfluence = input.bool(true, "Alert: Bull Confluence",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when ALL 3 Valentini conditions align for a LONG:\\n1. Market is in IMBALANCE\\n2. Price is near a SUPPORT level\\n3. BUYER AGGRESSION detected\\nThis is the premium setup from the model.")\n\nbool alertBearConfluence = input.bool(true, "Alert: Bear Confluence",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when ALL 3 Valentini conditions align for a SHORT:\\n1. Market is in IMBALANCE\\n2. Price is near a RESISTANCE level\\n3. SELLER AGGRESSION detected\\nThis is the premium setup from the model.")\n\nbool alertFailedBuyAuction = input.bool(true, "Alert: Failed Buy Auction",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when aggressive BUYERS fail — previous bar had a buy aggression spike\\nbut the current bar closes BELOW the previous bar low.\\nValentini: \'Aggressive buyers created a failed auction — the sellers won.\'")\n\nbool alertFailedSellAuction = input.bool(true, "Alert: Failed Sell Auction",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when aggressive SELLERS fail — previous bar had a sell aggression spike\\nbut the current bar closes ABOVE the previous bar high.\\nKey reversal signal in Valentini\'s model.")\n\nbool alertHugeBuyVol = input.bool(true, "Alert: Huge Buy Volume (5x+)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when buyer aggression is EXTREME — volume exceeds 5x the average\\nwith a bullish candle close. Rare institutional-size events.")\n\nbool alertHugeSellVol = input.bool(true, "Alert: Huge Sell Volume (5x+)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when seller aggression is EXTREME — volume exceeds 5x the average\\nwith a bearish candle close. Rare institutional-size distribution events.")\n\nbool alertBalanceShift = input.bool(false, "Alert: Balance/Imbalance Shift",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when market state CHANGES between balance and imbalance.\\nOFF by default because it fires frequently.")\n\nbool alertTrendChange = input.bool(false, "Alert: 30-Min Trend Change",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when the 30-minute trend direction FLIPS.\\nOFF by default to reduce noise.")\n\nbool alertAnyAggression = input.bool(false, "Alert: Any Aggression (All Sizes)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers on ANY volume spike with directional conviction.\\nMost frequent alert. OFF by default.")\n\nbool alertAtKeyLevel = input.bool(false, "Alert: Price at Key Level",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price is within proximity of any 30-min S/R level.\\nOFF by default because it fires often near levels.")\n\nbool alertPriceExitVA = input.bool(true, "Alert: Price Exits Value Area",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price closes OUTSIDE the Balance Box (Value Area).\\nValentini: This is when to start watching for setups.\\nPrice exiting the Value Area = potential imbalance beginning.\\nCombine with aggression confirmation before entering.")\n\nbool alertPriceAtPOC = input.bool(false, "Alert: Price at POC",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price is near the Point of Control level.\\nPOC is the strongest volume-based level.\\nUseful for mean-reversion setups.\\nOFF by default — enable for POC-based strategies.")\n\n// ── Colors ──\nstring GRP_COLORS = "Colors"\n\ncolor colBullTrend  = input.color(#2196F3, "Bull Trend",       group = GRP_COLORS, tooltip = "Bullish trend line and imbalance background.")\ncolor colBearTrend  = input.color(#F44336, "Bear Trend",       group = GRP_COLORS, tooltip = "Bearish trend line and imbalance background.")\ncolor colBuyAggr    = input.color(#2196F3, "Buyer Aggression",  group = GRP_COLORS, tooltip = "Buyer aggression bubbles.")\ncolor colSellAggr   = input.color(#F44336, "Seller Aggression", group = GRP_COLORS, tooltip = "Seller aggression bubbles.")\ncolor colWeekly     = input.color(#FF9800, "Weekly Level",      group = GRP_COLORS, tooltip = "Weekly H/L/C lines.")\ncolor colDaily      = input.color(#9C27B0, "Daily Level",       group = GRP_COLORS, tooltip = "Daily H/L/C/M and Fibonacci lines.")\ncolor col4H         = input.color(#00BCD4, "4H Level",          group = GRP_COLORS, tooltip = "4H balance zone lines.")\ncolor colHourly     = input.color(#607D8B, "Hourly Level",      group = GRP_COLORS, tooltip = "Hourly H/L lines.")\ncolor colSupport    = input.color(#4CAF50, "Support Level",     group = GRP_COLORS, tooltip = "30-min auction support levels.")\ncolor colResistance = input.color(#FF5722, "Resistance Level",  group = GRP_COLORS, tooltip = "30-min auction resistance levels.")\ncolor colBalance    = input.color(#FFC107, "Balance Zone BG",   group = GRP_COLORS, tooltip = "Background tint when market is in BALANCE.")\ncolor colHVN        = input.color(#FFEB3B, "HVN Level",         group = GRP_COLORS, tooltip = "High Volume Node lines — areas of acceptance/consolidation.")\ncolor colLVN        = input.color(#E040FB, "LVN Level",         group = GRP_COLORS, tooltip = "Low Volume Node lines — areas of rejection/fast movement.")\ncolor colPOC        = input.color(#FF6D00, "POC Line",          group = GRP_COLORS, tooltip = "Point of Control — highest volume price level.")\ncolor colVABox      = input.color(#FFC107, "Balance Box Fill",  group = GRP_COLORS, tooltip = "Value Area (Balance Box) background fill color.")\ncolor colWeeklyFib  = input.color(#FF9800, "Weekly Fib Levels", group = GRP_COLORS, tooltip = "Weekly Fibonacci retracement lines.")\ncolor colDailyFib   = input.color(#9C27B0, "Daily Fib Levels",  group = GRP_COLORS, tooltip = "Daily Fibonacci retracement lines.")\n\n// ── Line Widths ──\nstring GRP_WIDTHS = "Line Widths"\n\nint widWeekly   = input.int(2, "Weekly Level Width",     minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for weekly H/L/C levels.")\nint widDaily    = input.int(2, "Daily Level Width",      minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for daily H/L/C/M levels.")\nint wid4H       = input.int(1, "4H Level Width",         minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for 4-hour levels.")\nint widHourly   = input.int(1, "Hourly Level Width",     minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for hourly levels.")\nint widSR       = input.int(1, "S/R Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for 30-min auction S/R levels.")\nint widMA       = input.int(1, "MA Level Width",         minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for daily 20/50 SMA levels.")\nint widFib      = input.int(1, "Fibonacci Level Width",  minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Line thickness for Fibonacci retracement levels.")\nint widPsych    = input.int(1, "Psych Level Width",      minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Line thickness for psychological round number levels.")\nint widHVN      = input.int(2, "HVN Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for High Volume Node levels.")\nint widLVN      = input.int(1, "LVN Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for Low Volume Node levels.")\nint widPOC      = input.int(3, "POC Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for Point of Control level.")\nint widVABorder = input.int(1, "Balance Box Border Width", minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Border thickness for the Value Area (Balance Box).")\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// GLOBAL COMPUTATIONS — Must execute every bar unconditionally for ta.* consistency\n// ═══════════════════════════════════════════════════════════════════════════════\nfloat globalATR14     = ta.atr(14)\nfloat vpRangeHigh     = ta.highest(high, vpLookback)\nfloat vpRangeLow      = ta.lowest(low, vpLookback)\nint atrShortLen       = int(balancePeriod / 2) < 1 ? 1 : int(balancePeriod / 2)\nfloat atrShort        = ta.atr(atrShortLen)\nfloat atrLong         = ta.atr(balancePeriod)\nfloat volAvg          = ta.sma(volume, aggrVolPeriod)\n\n// ── Sensitivity Mapping ──\nfloat sensBodyRatio   = sensitivityInput == "Low" ? 0.45 : sensitivityInput == "High" ? 0.20 : 0.30\nfloat sensDupeATRMult = sensitivityInput == "Low" ? 0.50 : sensitivityInput == "High" ? 0.15 : 0.30\nfloat sensProxATRMult = sensitivityInput == "Low" ? 0.30 : sensitivityInput == "High" ? 0.70 : 0.50\nfloat sensVolBoost    = sensitivityInput == "Low" ? 0.5  : sensitivityInput == "High" ? -0.3 : 0.0\nfloat sensHVNMult     = sensitivityInput == "Low" ? 1.8  : sensitivityInput == "High" ? 1.2 : 1.5\nfloat sensLVNMult     = sensitivityInput == "Low" ? 0.3  : sensitivityInput == "High" ? 0.6 : 0.5\n\n// ── Label Size Mapping ──\nstring labelSz = switch labelSizeInput\n    "Auto"   => size.auto\n    "Tiny"   => size.tiny\n    "Small"  => size.small\n    "Normal" => size.normal\n    "Large"  => size.large\n    => size.small\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// HELPER FUNCTIONS\n// ═══════════════════════════════════════════════════════════════════════════════\n\nlabelText(string shortTxt, string longTxt) =>\n    labelMode == "Short" ? shortTxt : longTxt\n\ndeltaProxy(float o, float h, float l, float c, float v) =>\n    float barRange = h - l\n    float deltaRatio = barRange > 0 ? (c - l) / barRange - 0.5 : 0.0\n    float delta = deltaRatio * v * 2.0\n    delta\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE A — 30-MINUTE TREND CONTEXT\n// ═══════════════════════════════════════════════════════════════════════════════\n\n[htf30H, htf30L, htf30C, htf30O] = request.security(\n     syminfo.tickerid, "30",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\nfloat htf30HH = request.security(syminfo.tickerid, "30",\n     ta.highest(high, trendLookback)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30LL = request.security(syminfo.tickerid, "30",\n     ta.lowest(low, trendLookback)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30prevHH = request.security(syminfo.tickerid, "30",\n     ta.highest(high, trendLookback)[trendLookback + 1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30prevLL = request.security(syminfo.tickerid, "30",\n     ta.lowest(low, trendLookback)[trendLookback + 1],\n     lookahead = barmerge.lookahead_on)\n\nbool higherHigh = not na(htf30HH) and not na(htf30prevHH) and htf30HH > htf30prevHH\nbool higherLow  = not na(htf30LL) and not na(htf30prevLL) and htf30LL > htf30prevLL\nbool lowerLow   = not na(htf30LL) and not na(htf30prevLL) and htf30LL < htf30prevLL\nbool lowerHigh  = not na(htf30HH) and not na(htf30prevHH) and htf30HH < htf30prevHH\n\nvar int trendState = 0\nif higherHigh and higherLow\n    trendState := 1\nelse if lowerLow and lowerHigh\n    trendState := -1\n\nvar int prevTrendState = 0\nbool trendChanged = trendState != prevTrendState and prevTrendState != 0\nprevTrendState := trendState\n\ncolor trendColor = trendState == 1 ? colBullTrend : trendState == -1 ? colBearTrend : color.gray\n\nplot(showTrend ? htf30C : na, "30-Min Trend Line",\n     color = trendColor, linewidth = 2, style = plot.style_stepline)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE B — 30-MINUTE AUCTION SUPPORT & RESISTANCE\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat htf30PivH = request.security(syminfo.tickerid, "30",\n     ta.pivothigh(high, srLeftBars, srRightBars)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30PivL = request.security(syminfo.tickerid, "30",\n     ta.pivotlow(low, srLeftBars, srRightBars)[1],\n     lookahead = barmerge.lookahead_on)\n\nvar array<float> resistanceLevels = array.new_float()\nvar array<float> supportLevels    = array.new_float()\nvar array<line>  srLines          = array.new_line()\nvar array<label> srLabels         = array.new_label()\n\nfloat dupeThreshold = globalATR14 * sensDupeATRMult\n\nif showSR and not na(htf30PivH)\n    bool duplicate = false\n    if array.size(resistanceLevels) > 0\n        for i = 0 to array.size(resistanceLevels) - 1\n            if math.abs(array.get(resistanceLevels, i) - htf30PivH) < dupeThreshold\n                duplicate := true\n                break\n    if not duplicate\n        array.push(resistanceLevels, htf30PivH)\n        if array.size(resistanceLevels) > srMaxLevels\n            array.shift(resistanceLevels)\n\nif showSR and not na(htf30PivL)\n    bool duplicate = false\n    if array.size(supportLevels) > 0\n        for i = 0 to array.size(supportLevels) - 1\n            if math.abs(array.get(supportLevels, i) - htf30PivL) < dupeThreshold\n                duplicate := true\n                break\n    if not duplicate\n        array.push(supportLevels, htf30PivL)\n        if array.size(supportLevels) > srMaxLevels\n            array.shift(supportLevels)\n\nif showSR and barstate.islast\n    if array.size(srLines) > 0\n        for i = 0 to array.size(srLines) - 1\n            line.delete(array.get(srLines, i))\n    if array.size(srLabels) > 0\n        for i = 0 to array.size(srLabels) - 1\n            label.delete(array.get(srLabels, i))\n    array.clear(srLines)\n    array.clear(srLabels)\n\n    if array.size(resistanceLevels) > 0\n        for i = 0 to array.size(resistanceLevels) - 1\n            float lvl = array.get(resistanceLevels, i)\n            line newLine = line.new(bar_index - 50, lvl, bar_index + 10, lvl,\n                 color = colResistance, style = line.style_dashed, width = widSR,\n                 extend = extend.right)\n            array.push(srLines, newLine)\n            string txt = labelText("R", "30m Resistance")\n            label newLabel = label.new(bar_index + 12, lvl, txt,\n                 color = color.new(colResistance, 80), textcolor = colResistance,\n                 style = label.style_label_left, size = labelSz)\n            array.push(srLabels, newLabel)\n\n    if array.size(supportLevels) > 0\n        for i = 0 to array.size(supportLevels) - 1\n            float lvl = array.get(supportLevels, i)\n            line newLine = line.new(bar_index - 50, lvl, bar_index + 10, lvl,\n                 color = colSupport, style = line.style_dashed, width = widSR,\n                 extend = extend.right)\n            array.push(srLines, newLine)\n            string txt = labelText("S", "30m Support")\n            label newLabel = label.new(bar_index + 12, lvl, txt,\n                 color = color.new(colSupport, 80), textcolor = colSupport,\n                 style = label.style_label_left, size = labelSz)\n            array.push(srLabels, newLabel)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE C — AGGRESSION / LARGE TRADE DETECTION\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat effFutMult = futuresMultiplier + sensVolBoost\nfloat effEtfMult = etfMultiplier + sensVolBoost\nfloat volThreshold = isFutures ? volAvg * effFutMult : volAvg * effEtfMult\n\nfloat currentDelta = deltaProxy(open, high, low, close, volume)\n\nbool volSpike       = volume > volThreshold and not na(volAvg) and volAvg > 0\nfloat candleRange   = high - low\nfloat bodyRatio     = candleRange > 0 ? math.abs(close - open) / candleRange : 0.0\nbool meaningfulBody = bodyRatio > sensBodyRatio\n\nbool buyAggression  = volSpike and close > open and meaningfulBody and showAggression\nbool sellAggression = volSpike and close < open and meaningfulBody and showAggression\n\nfloat volRatio = volAvg > 0 ? volume / volAvg : 0.0\nbool isMediumSpike = volRatio >= 2.0 and volRatio < 3.5\nbool isLargeSpike  = volRatio >= 3.5 and volRatio < 5.0\nbool isHugeSpike   = volRatio >= 5.0\n\nplotshape(buyAggression and isMediumSpike, "Buy Aggr (Med)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 30), size = size.small)\nplotshape(buyAggression and isLargeSpike, "Buy Aggr (Lrg)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 10), size = size.normal)\nplotshape(buyAggression and isHugeSpike, "Buy Aggr (Huge)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 0), size = size.large)\n\nplotshape(sellAggression and isMediumSpike, "Sell Aggr (Med)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 30), size = size.small)\nplotshape(sellAggression and isLargeSpike, "Sell Aggr (Lrg)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 10), size = size.normal)\nplotshape(sellAggression and isHugeSpike, "Sell Aggr (Huge)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 0), size = size.large)\n\nbool failedBuyAuction  = buyAggression[1] and close < low[1]\nbool failedSellAuction = sellAggression[1] and close > high[1]\n\nplotshape(failedBuyAuction and showAggression, "Failed Buy Auction",\n     style = shape.xcross, location = location.abovebar,\n     color = colSellAggr, size = size.small)\nplotshape(failedSellAuction and showAggression, "Failed Sell Auction",\n     style = shape.xcross, location = location.belowbar,\n     color = colBuyAggr, size = size.small)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE D — MULTI-TIMEFRAME INSTITUTIONAL LEVELS\n// ═══════════════════════════════════════════════════════════════════════════════\n\n[wkH, wkL, wkC, wkO] = request.security(syminfo.tickerid, "1W",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[dayH, dayL, dayC, dayO] = request.security(syminfo.tickerid, "1D",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[h4H, h4L, h4C, h4O] = request.security(syminfo.tickerid, "240",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[h1H, h1L, h1C] = request.security(syminfo.tickerid, "60",\n     [high[1], low[1], close[1]],\n     lookahead = barmerge.lookahead_on)\n\nfloat dailyMA20 = request.security(syminfo.tickerid, "1D",\n     ta.sma(close, 20)[1], lookahead = barmerge.lookahead_on)\nfloat dailyMA50 = request.security(syminfo.tickerid, "1D",\n     ta.sma(close, 50)[1], lookahead = barmerge.lookahead_on)\n\nvar array<line>  mtfLines  = array.new_line()\nvar array<label> mtfLabels = array.new_label()\n\ndrawLevel(float price, color col, string shortName, string longName, int wid, string lineStyle) =>\n    if not na(price) and barstate.islast\n        string txt = labelText(shortName, longName)\n        string lstyle = lineStyle == "dashed" ? line.style_dashed : lineStyle == "dotted" ? line.style_dotted : line.style_solid\n        line newLine = line.new(bar_index - 30, price, bar_index + 10, price,\n             color = col, style = lstyle, width = wid,\n             extend = extend.right)\n        array.push(mtfLines, newLine)\n        label newLabel = label.new(bar_index + 14, price,\n             txt + " " + str.tostring(price, format.mintick),\n             color = color.new(col, 85), textcolor = col,\n             style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, newLabel)\n\nif barstate.islast\n    if array.size(mtfLines) > 0\n        for i = 0 to array.size(mtfLines) - 1\n            line.delete(array.get(mtfLines, i))\n    if array.size(mtfLabels) > 0\n        for i = 0 to array.size(mtfLabels) - 1\n            label.delete(array.get(mtfLabels, i))\n    array.clear(mtfLines)\n    array.clear(mtfLabels)\n\nif showWeekly\n    drawLevel(wkH, colWeekly, "WH", "Weekly High", widWeekly, "solid")\n    drawLevel(wkL, colWeekly, "WL", "Weekly Low", widWeekly, "solid")\n    drawLevel(wkC, colWeekly, "WC", "Weekly Close", math.max(1, widWeekly - 1), "solid")\n\nif showDaily\n    drawLevel(dayH, colDaily, "DH", "Prev Day High", widDaily, "solid")\n    drawLevel(dayL, colDaily, "DL", "Prev Day Low", widDaily, "solid")\n    drawLevel(dayC, colDaily, "DC", "Prev Day Close", math.max(1, widDaily - 1), "solid")\n    float dayMid = (dayH + dayL) / 2.0\n    drawLevel(dayMid, color.new(colDaily, 40), "DM", "Daily Midpoint (POC Proxy)", math.max(1, widDaily - 1), "solid")\n\nif show4H\n    drawLevel(h4H, col4H, "4H-H", "4H Balance High", wid4H, "solid")\n    drawLevel(h4L, col4H, "4H-L", "4H Balance Low", wid4H, "solid")\n    float h4Mid = (h4H + h4L) / 2.0\n    drawLevel(h4Mid, color.new(col4H, 40), "4H-M", "4H Balance Mid", wid4H, "solid")\n\nif showHourly\n    drawLevel(h1H, colHourly, "1H-H", "Hourly High", widHourly, "solid")\n    drawLevel(h1L, colHourly, "1H-L", "Hourly Low", widHourly, "solid")\n\nif showMAs\n    drawLevel(dailyMA20, #26A69A, "D20", "Daily 20 SMA", widMA, "solid")\n    drawLevel(dailyMA50, #EF5350, "D50", "Daily 50 SMA", widMA, "solid")\n\nif showPsychLevels and barstate.islast and psychInterval > 0\n    float baseLevel = math.floor(low / psychInterval) * psychInterval\n    int maxPsychLevels = 5\n    for i = -1 to maxPsychLevels\n        float psyLvl = baseLevel + psychInterval * i\n        if psyLvl > low - psychInterval * 2 and psyLvl < high + psychInterval * 2\n            string pTxt = labelText("PSY", "Psych " + str.tostring(psyLvl, "#"))\n            line pLine = line.new(bar_index - 30, psyLvl, bar_index + 10, psyLvl,\n                 color = color.new(color.white, 70), style = line.style_dotted, width = widPsych,\n                 extend = extend.right)\n            array.push(mtfLines, pLine)\n            label pLabel = label.new(bar_index + 14, psyLvl, pTxt,\n                 color = color.new(color.white, 90), textcolor = color.new(color.white, 40),\n                 style = label.style_label_left, size = labelSz)\n            array.push(mtfLabels, pLabel)\n\n// ── Daily Fibonacci Levels (labeled with source TF) ──\nif showDailyFibs and barstate.islast and not na(dayH) and not na(dayL)\n    float dFibSpan = dayH - dayL\n    if dFibSpan > 0\n        float dFib236 = dayH - dFibSpan * 0.236\n        float dFib382 = dayH - dFibSpan * 0.382\n        float dFib500 = dayH - dFibSpan * 0.500\n        float dFib618 = dayH - dFibSpan * 0.618\n        float dFib786 = dayH - dFibSpan * 0.786\n\n        color dFibCol = color.new(colDailyFib, 50)\n        for fibVal in array.from(dFib236, dFib382, dFib500, dFib618, dFib786)\n            line fLine = line.new(bar_index - 20, fibVal, bar_index + 5, fibVal,\n                 color = dFibCol, style = line.style_dotted, width = widFib,\n                 extend = extend.right)\n            array.push(mtfLines, fLine)\n\n        label df236 = label.new(bar_index + 6, dFib236, labelText("DF236", "D Fib 23.6%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df236)\n        label df382 = label.new(bar_index + 6, dFib382, labelText("DF382", "D Fib 38.2%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df382)\n        label df5 = label.new(bar_index + 6, dFib500, labelText("DF50", "D Fib 50%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df5)\n        label df6 = label.new(bar_index + 6, dFib618, labelText("DF618", "D Fib 61.8%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df6)\n        label df786 = label.new(bar_index + 6, dFib786, labelText("DF786", "D Fib 78.6%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df786)\n\n// ── Weekly Fibonacci Levels (labeled with source TF) ──\nif showWeeklyFibs and barstate.islast and not na(wkH) and not na(wkL)\n    float wFibSpan = wkH - wkL\n    if wFibSpan > 0\n        float wFib236 = wkH - wFibSpan * 0.236\n        float wFib382 = wkH - wFibSpan * 0.382\n        float wFib500 = wkH - wFibSpan * 0.500\n        float wFib618 = wkH - wFibSpan * 0.618\n        float wFib786 = wkH - wFibSpan * 0.786\n\n        color wFibCol = color.new(colWeeklyFib, 50)\n        for fibVal in array.from(wFib236, wFib382, wFib500, wFib618, wFib786)\n            line fLine = line.new(bar_index - 30, fibVal, bar_index + 5, fibVal,\n                 color = wFibCol, style = line.style_dashed, width = widFib,\n                 extend = extend.right)\n            array.push(mtfLines, fLine)\n\n        label wf236 = label.new(bar_index + 8, wFib236, labelText("WF236", "W Fib 23.6%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf236)\n        label wf382 = label.new(bar_index + 8, wFib382, labelText("WF382", "W Fib 38.2%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf382)\n        label wf5 = label.new(bar_index + 8, wFib500, labelText("WF50", "W Fib 50%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf5)\n        label wf6 = label.new(bar_index + 8, wFib618, labelText("WF618", "W Fib 61.8%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf6)\n        label wf786 = label.new(bar_index + 8, wFib786, labelText("WF786", "W Fib 78.6%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf786)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE E — AUCTION NARRATIVE OVERLAY (Balance vs Imbalance)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat balanceRatio = atrLong > 0 ? atrShort / atrLong : 0.5\n\nbool isInBalance  = balanceRatio < balanceThreshold\nbool isImbalanced = not isInBalance\n\nvar bool prevBalanceState = true\nbool balanceShifted = isInBalance != prevBalanceState\nprevBalanceState := isInBalance\n\nbgcolor(showBalance and isInBalance ? color.new(colBalance, 92) : na, title = "Balance Zone BG")\nbgcolor(showBalance and isImbalanced and trendState == 1 ? color.new(colBullTrend, 94) : na, title = "Imbalance Bull BG")\nbgcolor(showBalance and isImbalanced and trendState == -1 ? color.new(colBearTrend, 94) : na, title = "Imbalance Bear BG")\n\n// ── Location Validity ──\nfloat nearestResist = na\nfloat nearestSupp   = na\n\nif array.size(resistanceLevels) > 0\n    nearestResist := array.get(resistanceLevels, array.size(resistanceLevels) - 1)\nif array.size(supportLevels) > 0\n    nearestSupp := array.get(supportLevels, array.size(supportLevels) - 1)\n\nbool nearResistance = not na(nearestResist) and math.abs(close - nearestResist) < globalATR14 * sensProxATRMult\nbool nearSupport    = not na(nearestSupp) and math.abs(close - nearestSupp) < globalATR14 * sensProxATRMult\nbool atKeyLevel     = nearResistance or nearSupport\n\n// ── Valentini Confluence Signal ──\nbool bullConfluence = isImbalanced and trendState == 1 and nearSupport and buyAggression\nbool bearConfluence = isImbalanced and trendState == -1 and nearResistance and sellAggression\n\nplotshape(bullConfluence, "Bull Confluence",\n     style = shape.diamond, location = location.belowbar,\n     color = color.new(#00E676, 0), size = size.normal)\nplotshape(bearConfluence, "Bear Confluence",\n     style = shape.diamond, location = location.abovebar,\n     color = color.new(#FF1744, 0), size = size.normal)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE F — VOLUME PROFILE: HVN, LVN, POC, & BALANCE BOX (VALUE AREA)\n// ═══════════════════════════════════════════════════════════════════════════════\n//\n// Methodology: Standard bin-based volume distribution.\n// Each bar\'s volume is proportionally allocated across the price bins\n// (rows) that the bar\'s high-low range spans. This is the same approach\n// used by professional platforms (ATAS, Sierra Chart, Quantower) and\n// TradingView\'s own Session Volume Profile indicator.\n//\n// Academic foundation:\n// - Steidlmayer, J.P. "Markets & Market Logic" (1986) — Market Profile\n// - Dalton, J. "Mind Over Markets" (1990) — Value Area, POC concepts\n// - CME Group Market Profile Handbook — standard 70% Value Area\n//\n// Valentini\'s application:\n// - Balance Box (Value Area) = NO-TRADE ZONE. Skip trades inside.\n// - LVN = reaction zones for entries when price revisits\n// - HVN = acceptance zones, price consolidates here\n// - POC = fair value, strongest S/R, target for mean-reversion\n// ═══════════════════════════════════════════════════════════════════════════════\n\nvar array<line>  vpLines  = array.new_line()\nvar array<label> vpLabels = array.new_label()\nvar array<box>   vpBoxes  = array.new_box()\n\n// Persistent VP output values for alerts (updated on last bar)\nvar float vpVAH = na\nvar float vpVAL = na\nvar float vpPOCprice = na\n\nif barstate.islast and (showHVN or showLVN or showBalanceBox or showPOC)\n    // ── Clean up previous VP drawings ──\n    if array.size(vpLines) > 0\n        for i = 0 to array.size(vpLines) - 1\n            line.delete(array.get(vpLines, i))\n    if array.size(vpLabels) > 0\n        for i = 0 to array.size(vpLabels) - 1\n            label.delete(array.get(vpLabels, i))\n    if array.size(vpBoxes) > 0\n        for i = 0 to array.size(vpBoxes) - 1\n            box.delete(array.get(vpBoxes, i))\n    array.clear(vpLines)\n    array.clear(vpLabels)\n    array.clear(vpBoxes)\n\n    // ── Build Volume Profile ──\n    float rHigh = vpRangeHigh\n    float rLow  = vpRangeLow\n    float binSize = not na(rHigh) and not na(rLow) and rHigh > rLow ? (rHigh - rLow) / vpRows : 0.0\n\n    if binSize > 0\n        // Initialize volume bins\n        array<float> volBins = array.new_float(vpRows, 0.0)\n        float totalVolume = 0.0\n\n        // Distribute volume into bins\n        for i = 0 to vpLookback - 1\n            float barH = high[i]\n            float barL = low[i]\n            float barV = volume[i]\n            if not na(barH) and not na(barL) and not na(barV) and barV > 0\n                int startBin = math.max(0, math.min(vpRows - 1, int(math.floor((barL - rLow) / binSize))))\n                int endBin   = math.max(0, math.min(vpRows - 1, int(math.floor((barH - rLow) / binSize))))\n                if startBin > endBin\n                    int tempBin = startBin\n                    startBin := endBin\n                    endBin   := tempBin\n                int numBins = endBin - startBin + 1\n                float volPerBin = barV / numBins\n                for b = startBin to endBin\n                    array.set(volBins, b, array.get(volBins, b) + volPerBin)\n                totalVolume += barV\n\n        if totalVolume > 0\n            // ── Find POC (bin with highest volume) ──\n            int pocBin = 0\n            float maxBinVol = 0.0\n            for b = 0 to vpRows - 1\n                float bv = array.get(volBins, b)\n                if bv > maxBinVol\n                    maxBinVol := bv\n                    pocBin    := b\n\n            float pocPrice = rLow + (pocBin + 0.5) * binSize\n            vpPOCprice := pocPrice\n\n            // ── Calculate Value Area (expanding from POC) ──\n            float vaTarget = totalVolume * (vaPercent / 100.0)\n            float cumVol   = array.get(volBins, pocBin)\n            int vaLowBin   = pocBin\n            int vaHighBin  = pocBin\n\n            for _iter = 0 to vpRows - 1\n                if cumVol >= vaTarget\n                    break\n                float volAbove = vaHighBin < vpRows - 1 ? array.get(volBins, vaHighBin + 1) : 0.0\n                float volBelow = vaLowBin > 0 ? array.get(volBins, vaLowBin - 1) : 0.0\n                if volAbove == 0.0 and volBelow == 0.0\n                    break\n                if volAbove >= volBelow and vaHighBin < vpRows - 1\n                    vaHighBin += 1\n                    cumVol    += volAbove\n                else if vaLowBin > 0\n                    vaLowBin -= 1\n                    cumVol   += volBelow\n                else if vaHighBin < vpRows - 1\n                    vaHighBin += 1\n                    cumVol    += volAbove\n                else\n                    break\n\n            float vahPrice = rLow + (vaHighBin + 1) * binSize\n            float valPrice = rLow + vaLowBin * binSize\n            vpVAH := vahPrice\n            vpVAL := valPrice\n\n            // ── Draw Balance Box (Value Area) ──\n            if showBalanceBox\n                box vaBox = box.new(bar_index - vpLookback, vahPrice, bar_index + 5, valPrice,\n                     border_color = color.new(colVABox, 50), border_width = widVABorder,\n                     border_style = line.style_dashed,\n                     bgcolor = color.new(colVABox, 93))\n                array.push(vpBoxes, vaBox)\n\n                string vaTopTxt = labelText("VAH", "Value Area High (Skip Above)")\n                label vahLabel = label.new(bar_index + 6, vahPrice, vaTopTxt + " " + str.tostring(vahPrice, format.mintick),\n                     color = color.new(colVABox, 85), textcolor = colVABox,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, vahLabel)\n\n                string vaBotTxt = labelText("VAL", "Value Area Low (Skip Below)")\n                label valLabel = label.new(bar_index + 6, valPrice, vaBotTxt + " " + str.tostring(valPrice, format.mintick),\n                     color = color.new(colVABox, 85), textcolor = colVABox,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, valLabel)\n\n            // ── Draw POC ──\n            if showPOC\n                line pocLine = line.new(bar_index - vpLookback, pocPrice, bar_index + 10, pocPrice,\n                     color = colPOC, style = line.style_solid, width = widPOC,\n                     extend = extend.right)\n                array.push(vpLines, pocLine)\n\n                string pocTxt = labelText("POC", "POC (Fair Value)")\n                label pocLabel = label.new(bar_index + 12, pocPrice, pocTxt + " " + str.tostring(pocPrice, format.mintick),\n                     color = color.new(colPOC, 80), textcolor = colPOC,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, pocLabel)\n\n            // ── Detect and Draw HVN / LVN ──\n            float avgBinVol = totalVolume / vpRows\n            float hvnThresh = avgBinVol * sensHVNMult\n            float lvnThresh = avgBinVol * sensLVNMult\n\n            for b = 0 to vpRows - 1\n                float bv = array.get(volBins, b)\n                float binMid = rLow + (b + 0.5) * binSize\n\n                // Skip the POC bin for HVN (POC is drawn separately)\n                if showHVN and bv > hvnThresh and b != pocBin\n                    line hvnLine = line.new(bar_index - vpLookback, binMid, bar_index + 5, binMid,\n                         color = color.new(colHVN, 30), style = line.style_solid, width = widHVN)\n                    array.push(vpLines, hvnLine)\n                    string hvnTxt = labelText("HVN", "HVN (Acceptance)")\n                    label hvnLabel = label.new(bar_index + 6, binMid, hvnTxt,\n                         color = color.new(colHVN, 85), textcolor = colHVN,\n                         style = label.style_label_left, size = labelSz)\n                    array.push(vpLabels, hvnLabel)\n\n                if showLVN and bv < lvnThresh and bv > 0\n                    line lvnLine = line.new(bar_index - vpLookback, binMid, bar_index + 5, binMid,\n                         color = color.new(colLVN, 30), style = line.style_dashed, width = widLVN)\n                    array.push(vpLines, lvnLine)\n                    string lvnTxt = labelText("LVN", "LVN (Rejection)")\n                    label lvnLabel = label.new(bar_index + 6, binMid, lvnTxt,\n                         color = color.new(colLVN, 85), textcolor = colLVN,\n                         style = label.style_label_left, size = labelSz)\n                    array.push(vpLabels, lvnLabel)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// VP-BASED ALERT CONDITIONS (need to run every bar for alertcondition)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nbool priceAboveVA = not na(vpVAH) and close > vpVAH\nbool priceBelowVA = not na(vpVAL) and close < vpVAL\nbool priceOutsideVA = priceAboveVA or priceBelowVA\nbool priceNearPOC = not na(vpPOCprice) and math.abs(close - vpPOCprice) < globalATR14 * 0.3\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// INFO TABLE\n// ═══════════════════════════════════════════════════════════════════════════════\n\nvar table infoTable = table.new(position.top_right, 2, 8,\n     bgcolor = color.new(color.black, 30),\n     border_width = 1, border_color = color.new(color.white, 70))\n\nif barstate.islast\n    table.cell(infoTable, 0, 0, "V-AMT v2", text_color = color.white, text_size = size.small)\n    table.cell(infoTable, 1, 0,\n         isFutures ? "FUTURES" : "ETF",\n         text_color = isFutures ? color.orange : color.aqua, text_size = size.small)\n\n    table.cell(infoTable, 0, 1, "State:", text_color = color.gray, text_size = size.tiny)\n    table.cell(infoTable, 1, 1,\n         isInBalance ? "BALANCE" : "IMBALANCE",\n         text_color = isInBalance ? colBalance : (trendState == 1 ? colBullTrend : colBearTrend),\n         text_size = size.tiny)\n\n    table.cell(infoTable, 0, 2, "30m Trend:", text_color = color.gray, text_size = size.tiny)\n    string trendTxt = trendState == 1 ? "BULL" : trendState == -1 ? "BEAR" : "NEUTRAL"\n    table.cell(infoTable, 1, 2, trendTxt, text_color = trendColor, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 3, "Volume:", text_color = color.gray, text_size = size.tiny)\n    string volTxt = volRatio >= 3.0 ? "EXTREME" : volRatio >= 2.0 ? "SPIKE" : "Normal"\n    color volTxtCol = volRatio >= 3.0 ? color.red : volRatio >= 2.0 ? color.orange : color.gray\n    table.cell(infoTable, 1, 3, volTxt, text_color = volTxtCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 4, "Delta:", text_color = color.gray, text_size = size.tiny)\n    table.cell(infoTable, 1, 4,\n         currentDelta > 0 ? "BUY +" + str.tostring(math.round(currentDelta)) :\n         "SELL " + str.tostring(math.round(currentDelta)),\n         text_color = currentDelta > 0 ? colBuyAggr : colSellAggr, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 5, "Location:", text_color = color.gray, text_size = size.tiny)\n    string locTxt = priceAboveVA ? "ABOVE VA" : priceBelowVA ? "BELOW VA" : "INSIDE VA"\n    color locCol = priceOutsideVA ? color.lime : colBalance\n    table.cell(infoTable, 1, 5, locTxt, text_color = locCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 6, "Sensitivity:", text_color = color.gray, text_size = size.tiny)\n    color sensCol = sensitivityInput == "Low" ? color.green : sensitivityInput == "High" ? color.red : color.orange\n    table.cell(infoTable, 1, 6, sensitivityInput, text_color = sensCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 7, "Signal:", text_color = color.gray, text_size = size.tiny)\n    string sigTxt = bullConfluence ? "BULL CONFLUENCE" :\n         bearConfluence ? "BEAR CONFLUENCE" :\n         isInBalance ? "Wait - In Balance" :\n         not priceOutsideVA ? "Inside VA - Skip" :\n         atKeyLevel ? "At Key Level" : "Scanning..."\n    color sigCol = bullConfluence ? #00E676 :\n         bearConfluence ? #FF1744 :\n         isInBalance or not priceOutsideVA ? colBalance : color.gray\n    table.cell(infoTable, 1, 7, sigTxt, text_color = sigCol, text_size = size.tiny)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// ALERTS — All configurable via input toggles\n// ═══════════════════════════════════════════════════════════════════════════════\n\nalertcondition(alertBullConfluence and bullConfluence,\n     "Bull Confluence",\n     "V-AMT: BULL CONFLUENCE — Imbalance + Support + Buy Aggression. Premium long setup.")\n\nalertcondition(alertBearConfluence and bearConfluence,\n     "Bear Confluence",\n     "V-AMT: BEAR CONFLUENCE — Imbalance + Resistance + Sell Aggression. Premium short setup.")\n\nalertcondition(alertFailedBuyAuction and failedBuyAuction,\n     "Failed Buy Auction",\n     "V-AMT: Aggressive BUYERS FAILED — price reversed below aggression bar. Potential short.")\n\nalertcondition(alertFailedSellAuction and failedSellAuction,\n     "Failed Sell Auction",\n     "V-AMT: Aggressive SELLERS FAILED — price reversed above aggression bar. Potential long.")\n\nalertcondition(alertHugeBuyVol and buyAggression and isHugeSpike,\n     "Huge Buy Volume",\n     "V-AMT: EXTREME buyer aggression (5x+ volume). Institutional-size buying.")\n\nalertcondition(alertHugeSellVol and sellAggression and isHugeSpike,\n     "Huge Sell Volume",\n     "V-AMT: EXTREME seller aggression (5x+ volume). Institutional-size selling.")\n\nalertcondition(alertBalanceShift and balanceShifted,\n     "Balance/Imbalance Shift",\n     "V-AMT: Market state changed between BALANCE and IMBALANCE.")\n\nalertcondition(alertTrendChange and trendChanged,\n     "30-Min Trend Change",\n     "V-AMT: 30-minute trend direction has FLIPPED.")\n\nalertcondition(alertAnyAggression and (buyAggression or sellAggression),\n     "Any Aggression Detected",\n     "V-AMT: Volume aggression detected (buyer or seller).")\n\nalertcondition(alertAtKeyLevel and atKeyLevel,\n     "Price at Key Level",\n     "V-AMT: Price near a 30-min support or resistance level.")\n\nalertcondition(alertPriceExitVA and priceOutsideVA,\n     "Price Exits Value Area",\n     "V-AMT: Price closed OUTSIDE the Value Area (Balance Box). Watch for setups.")\n\nalertcondition(alertPriceAtPOC and priceNearPOC,\n     "Price at POC",\n     "V-AMT: Price is near the Point of Control. Mean-reversion zone.")'
[CAPTURE 2] '// ═══════════════════════════════════════════════════════════════════════════════\n// FABIO VALENTINI — AUCTION MARKET THEORY INSTITUTIONAL INDICATOR v2\n// Pine Script v6 | Modular Architecture | Non-Predictive | Condition-Based\n// ═══════════════════════════════════════════════════════════════════════════════\n//\n// MODEL SUMMARY (Extracted from Valentini Transcript & Research):\n// ───────────────────────────────────────────────────────────────────────────────\n// This is a MODEL, not a strategy. A strategy cages a dynamic entity.\n// The market is an auction — it moves from balance to imbalance and back.\n//\n// STEP 1 — LOCATION:  Are we in balance or imbalance? Only trade OUT of balance.\n// STEP 2 — VALIDATION: Use LVN (Low Volume Nodes) as reaction zones.\n//          Use HVN (High Volume Nodes) as acceptance/consolidation zones.\n// STEP 3 — AGGRESSION: Confirm with large EXECUTED orders (bubbles).\n//\n// BALANCE BOX (Value Area):\n// Valentini: "Market is usually in balance. That is why traders take a\n// streak of stop-losses." The Balance Box is the Value Area (VAH-VAL)\n// where 70% of volume was transacted — the NO-TRADE zone. Only trade\n// when price breaks OUT of this box with confirmed aggression.\n//\n// VOLUME PROFILE METHODOLOGY:\n// HVN/LVN detection uses standard bin-based volume distribution —\n// the same methodology used by ATAS, Sierra Chart, Quantower, and\n// TradingView\'s own Session Volume Profile. Each bar\'s volume is\n// proportionally distributed across the price bins (rows) it spans.\n// Reference: Dalton, J. "Mind Over Markets" (1990); Steidlmayer, J.P.\n// "Markets & Market Logic" (1986); CME Group Market Profile education.\n//\n// LIMITATIONS (TradingView):\n// - No true tick-by-tick order flow / DOM data available\n// - Volume is distributed proportionally across candle range (approximation)\n// - No executed vs limit order differentiation\n// - Volume delta is APPROXIMATED using candle structure\n// - Aggression bubbles use volume spike + delta proxy, NOT true order flow\n// ═══════════════════════════════════════════════════════════════════════════════\n\n//@version=6\nindicator("Valentini AMT Institutional Model v2",\n     shorttitle   = "V-AMT v2",\n     overlay      = true,\n     max_lines_count  = 500,\n     max_labels_count = 500,\n     max_boxes_count  = 200)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// INPUT SETTINGS — Organized by Module\n// ═══════════════════════════════════════════════════════════════════════════════\n\n// ── Global Settings ──\nstring GRP_GLOBAL = "Global Settings"\n\nstring labelMode = input.string("Detailed", "Label Mode",\n     options = ["Short", "Detailed"], group = GRP_GLOBAL,\n     tooltip = "SHORT: Compact 2-3 letter labels (e.g. WH, DL, R, S).\\nDETAILED: Full descriptive labels (e.g. Weekly High, Prev Day Low, 30m Resistance).\\nUse Short for cleaner charts, Detailed when learning the indicator.")\n\nstring labelSizeInput = input.string("Small", "Label Size",\n     options = ["Auto", "Tiny", "Small", "Normal", "Large"],\n     group = GRP_GLOBAL,\n     tooltip = "Controls the text size of ALL labels on the chart.\\nAUTO: TradingView decides based on zoom.\\nTINY: Smallest, best for high-density charts.\\nSMALL: Default, good balance of visibility.\\nNORMAL: Easier to read on larger screens.\\nLARGE: Maximum readability, best for presentations.")\n\nbool isFutures = input.bool(true, "Futures Mode (NQ/ES/YM)",\n     group = GRP_GLOBAL,\n     tooltip = "ON = Futures-optimized volume thresholds and delta proxy.\\nOFF = ETF mode (SPY/QQQ) with higher thresholds to filter dark-pool noise.\\nFutures have concentrated RTH volume making spikes more reliable.\\nETFs include off-exchange prints that inflate volume without directional meaning.")\n\nstring sensitivityInput = input.string("Medium", "Sensitivity Level",\n     options = ["Low", "Medium", "High"],\n     group = GRP_GLOBAL,\n     tooltip = "Controls how aggressively the indicator filters noise across ALL modules.\\nLOW: Strict filtering. Fewer levels, fewer bubbles, only strongest signals. Best for clean charts and experienced traders.\\nMEDIUM: Balanced. Good mix of signal density and quality. Recommended default.\\nHIGH: Sensitive. More levels, more bubbles, catches weaker signals. Best for scalping or learning.\\nAffects: S/R duplicate threshold, volume spike threshold, body ratio filter, confluence proximity, and HVN/LVN thresholds.")\n\n// ── Module A: 30-Min Trend ──\nstring GRP_TREND = "Module A: 30-Min Trend"\n\nbool showTrend = input.bool(true, "Show 30-Min Trend Line",\n     group = GRP_TREND,\n     tooltip = "Displays the 30-minute auction trend as a step-line on your chart.\\nBLUE = Uptrend (Higher-Highs + Higher-Lows on 30-min).\\nRED = Downtrend (Lower-Lows + Lower-Highs on 30-min).\\nGRAY = Neutral / No clear structure.\\nThis is auction-based structure, NOT a moving average crossover.\\nValentini: Trend is only reliable when market is OUT OF BALANCE.")\n\nint trendLookback = input.int(5, "HH/HL Lookback (30-min bars)", minval = 2, maxval = 20,\n     group = GRP_TREND,\n     tooltip = "Number of 30-minute bars used to detect highest-high and lowest-low.\\nLower values (2-3) = faster trend detection, more whipsaws.\\nHigher values (8-15) = slower, smoother trend, fewer false signals.\\nDefault 5 = ~2.5 hours of 30-min structure. Good for NQ/ES intraday.")\n\n// ── Module B: 30-Min Auction S/R ──\nstring GRP_SR = "Module B: 30-Min S/R"\n\nbool showSR = input.bool(true, "Show 30-Min Auction S/R",\n     group = GRP_SR,\n     tooltip = "Draws horizontal support and resistance levels from 30-minute auction structure.\\nThese are structural pivot highs/lows — points where the auction found acceptance or rejection.\\nValentini: These are NOT retail pivots. They represent where large participants transacted.\\nLevels persist across all timeframes.")\n\nint srLeftBars = input.int(3, "Pivot Left Bars (30-min)", minval = 1, maxval = 10,\n     group = GRP_SR,\n     tooltip = "Bars to the LEFT required to confirm a pivot high/low.\\nHigher = more confirmed (stronger) levels but fewer of them.\\nLower = more levels detected but some may be noise.\\nDefault 3 = requires 3 bars of price action before the pivot to confirm it.")\n\nint srRightBars = input.int(3, "Pivot Right Bars (30-min)", minval = 1, maxval = 10,\n     group = GRP_SR,\n     tooltip = "Bars to the RIGHT required to confirm a pivot high/low.\\nThis creates a natural delay — the level is only drawn AFTER confirmation.\\nHigher = more lag but stronger confirmation.\\nLower = faster detection but more false levels.\\nDefault 3 = level confirmed after 1.5 hours of post-pivot price action.")\n\nint srMaxLevels = input.int(6, "Max S/R Levels Displayed", minval = 2, maxval = 12,\n     group = GRP_SR,\n     tooltip = "Maximum number of support and resistance levels shown simultaneously.\\nOldest levels are removed when new ones appear.\\nLower = cleaner chart with only the most recent structure.\\nHigher = more historical context but more visual clutter.\\nDefault 6 = 3 support + 3 resistance is a good balance.")\n\n// ── Module C: Aggression Detection ──\nstring GRP_AGGR = "Module C: Aggression"\n\nbool showAggression = input.bool(true, "Show Aggression Bubbles",\n     group = GRP_AGGR,\n     tooltip = "Plots circles (bubbles) at points of large aggressive volume.\\nValentini: \'In order flow platforms you see bubbles. When there is direction, location, and aggression your ability to READ is 100%.\'\\nBLUE circles below bar = Buyer aggression (bullish volume spike with close near high).\\nRED circles above bar = Seller aggression (bearish volume spike with close near low).\\nCircle SIZE scales with volume intensity: Small/Normal/Large.\\nTradingView LIMITATION: This is a volume-spike proxy, not true order flow.")\n\nfloat futuresMultiplier = input.float(2.0, "Futures Vol Spike Multiplier", minval = 1.0, maxval = 5.0,\n     step = 0.5, group = GRP_AGGR,\n     tooltip = "For FUTURES (NQ/ES/YM): Volume must exceed this multiple of the average to qualify as aggression.\\nLower (1.5-2.0) = more frequent signals, catches smaller spikes.\\nHigher (3.0-5.0) = only extreme volume events, very selective.\\nDefault 2.0 = volume must be 2x the 20-bar average.")\n\nfloat etfMultiplier = input.float(2.5, "ETF Vol Spike Multiplier", minval = 1.0, maxval = 5.0,\n     step = 0.5, group = GRP_AGGR,\n     tooltip = "For ETFs (SPY/QQQ): Volume must exceed this multiple of the average.\\nSet HIGHER than futures because ETF volume includes dark-pool prints,\\nblock trades, and off-exchange activity that inflates bar volume.\\nDefault 2.5 = filters out most noise while catching genuine institutional aggression.")\n\nint aggrVolPeriod = input.int(20, "Vol Average Period", minval = 5, maxval = 50,\n     group = GRP_AGGR,\n     tooltip = "Number of bars used to calculate the volume moving average baseline.\\nThe volume spike threshold = Average Volume x Multiplier.\\nLower (5-10) = adapts faster to recent activity, more reactive.\\nHigher (30-50) = smoother baseline, less reactive to short-term changes.\\nDefault 20 = standard institutional lookback, roughly one trading session on 5-min.")\n\n// ── Module D: Multi-TF Levels ──\nstring GRP_MTF = "Module D: MTF Levels"\n\nbool showWeekly = input.bool(true, "Show Weekly Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous week\'s High, Low, and Close as horizontal lines.\\nWeekly levels represent major structural boundaries where large institutions position.\\nValentini: These are the \'big picture\' auction boundaries.\\nOrange lines by default.")\n\nbool showDaily = input.bool(true, "Show Daily Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous day\'s High, Low, Close, Midpoint, and Fibonacci retracements.\\nDaily levels are the most commonly referenced by institutional desks.\\nThe Midpoint serves as a POC (Point of Control) proxy.\\nAlso draws daily Fibonacci levels (23.6%, 38.2%, 50%, 61.8%, 78.6%).\\nPurple lines by default.")\n\nbool show4H = input.bool(true, "Show 4H Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous 4-hour bar\'s High, Low, and Midpoint.\\nThe 4H range represents the Initial Balance — the first major auction range of the session.\\nValentini: The market moves from balance to imbalance.\\nThe 4H zone shows where the current session\'s balance is forming.\\nCyan lines by default.")\n\nbool showHourly = input.bool(true, "Show Hourly Levels",\n     group = GRP_MTF,\n     tooltip = "Draws previous hour\'s High and Low as horizontal lines.\\nHourly levels are tactical execution levels for intraday trading.\\nGray lines by default.")\n\nbool showMAs = input.bool(true, "Show 20/50 MAs",\n     group = GRP_MTF,\n     tooltip = "Draws the Daily 20-period and 50-period Simple Moving Averages.\\nThese are institutional reference levels used by trend-following desks.\\n20 SMA = short-term momentum reference.\\n50 SMA = medium-term trend reference.\\nNon-repainting — uses previous day\'s confirmed values.")\n\nbool showPsychLevels = input.bool(true, "Show Psych Levels",\n     group = GRP_MTF,\n     tooltip = "Draws psychological round number levels as dotted white lines.\\nRound numbers act as natural auction boundaries (e.g. NQ 20000, ES 5500).\\nLarge participants and algorithms cluster orders around round numbers.\\nNQ = 100, ES = 50, YM = 500, SPY = 5, QQQ = 5.")\n\nfloat psychInterval = input.float(100.0, "Psych Level Interval",\n     minval = 10.0, maxval = 1000.0, step = 10.0, group = GRP_MTF,\n     tooltip = "Spacing between psychological round number levels in price units.\\n  NQ = 100 (e.g. 20000, 20100, 20200)\\n  ES = 50 (e.g. 5500, 5550, 5600)\\n  YM = 500 (e.g. 40000, 40500, 41000)\\n  SPY = 5 | QQQ = 5")\n\nbool showWeeklyFibs = input.bool(true, "Show Weekly Fibonacci Levels",\n     group = GRP_MTF,\n     tooltip = "Draws Fibonacci retracement levels from previous week\'s High-Low range.\\nLevels: 23.6%, 38.2%, 50%, 61.8%, 78.6%.\\nLabeled with \'W\' prefix to distinguish from daily fibs.\\nWeekly fibs are significant for swing setups and multi-day holds.")\n\nbool showDailyFibs = input.bool(true, "Show Daily Fibonacci Levels",\n     group = GRP_MTF,\n     tooltip = "Draws Fibonacci retracement levels from previous day\'s High-Low range.\\nLevels: 23.6%, 38.2%, 50%, 61.8%, 78.6%.\\nLabeled with \'D\' prefix to show source timeframe.\\nDaily fibs are the most used institutional retracement reference.")\n\n// ── Module E: Balance / Imbalance ──\nstring GRP_BAL = "Module E: Auction Narrative"\n\nbool showBalance = input.bool(true, "Show Balance/Imbalance State",\n     group = GRP_BAL,\n     tooltip = "Colors the chart background to show the current auction state.\\nYELLOW tint = BALANCE — choppy, ranging. DO NOT TRADE.\\nBLUE tint = IMBALANCE BULLISH — ok to look for longs.\\nRED tint = IMBALANCE BEARISH — ok to look for shorts.\\nValentini: \'Market is usually in balance. That is why traders take a streak of stop-losses.\'")\n\nint balancePeriod = input.int(20, "Balance Detection Period", minval = 5, maxval = 50,\n     group = GRP_BAL,\n     tooltip = "Number of bars for ATR-based balance/imbalance detection.\\nCompares short-term ATR vs long-term ATR to measure range expansion.\\nDefault 20 = reliable for most intraday timeframes.")\n\nfloat balanceThreshold = input.float(0.6, "Balance Threshold (0-1)", minval = 0.1, maxval = 1.0,\n     step = 0.1, group = GRP_BAL,\n     tooltip = "The ratio below which the market is considered IN BALANCE.\\nATR short / ATR long < threshold = BALANCE (stay away).\\nATR short / ATR long >= threshold = IMBALANCE (ok to trade).\\nDefault 0.6 = balanced classification matching Valentini\'s approach.")\n\n// ── Module F: Volume Profile HVN/LVN & Balance Box ──\nstring GRP_VP = "Module F: Volume Profile (HVN/LVN)"\n\nbool showHVN = input.bool(true, "Show High Volume Nodes (HVN)",\n     group = GRP_VP,\n     tooltip = "HVN = price levels where a LARGE amount of volume was transacted.\\nThese are areas of ACCEPTANCE — price tends to consolidate here.\\nHVNs act as strong support/resistance. Price slows down at HVNs.\\nValentini uses HVNs to identify where institutional traders built positions.\\nMethodology: Dalton \'Mind Over Markets\', CME Market Profile education.")\n\nbool showLVN = input.bool(true, "Show Low Volume Nodes (LVN)",\n     group = GRP_VP,\n     tooltip = "LVN = price levels where VERY LITTLE volume was transacted.\\nThese are areas of REJECTION — price moves through them fast.\\nValentini: LVNs are key reaction zones for entries.\\n\'When price comes back into the LVN, check the order flow.\'\\nLVNs are similar to single prints in Market Profile.\\nPrice tends to rip through LVNs on revisit due to low liquidity.")\n\nbool showBalanceBox = input.bool(true, "Show Balance Box (Value Area)",\n     group = GRP_VP,\n     tooltip = "Draws a semi-transparent box showing the VALUE AREA — where 70% of volume was traded.\\nThis is the BALANCE ZONE / NO-TRADE BOX per Valentini\'s model.\\nValentini: \'In balance, 70% of the time, the market stays stuck.\'\\nOnly trade when price breaks OUT of this box with confirmed aggression.\\nTop edge = VAH (Value Area High). Bottom edge = VAL (Value Area Low).\\nPOC (Point of Control) line drawn at highest volume level inside.\\nBased on Steidlmayer\'s Market Profile theory (CME, 1986).")\n\nbool showPOC = input.bool(true, "Show POC Line (Point of Control)",\n     group = GRP_VP,\n     tooltip = "Draws the Point of Control — the single price level with the HIGHEST traded volume.\\nPOC acts as a magnet for price and the strongest S/R from volume profile.\\nValentini: Target the previous balance POC — 70% of the time, price reverses from it.\\nThe POC is the \'fair value\' price where buyers and sellers agreed most.")\n\nint vpLookback = input.int(200, "VP Lookback Bars", minval = 50, maxval = 500,\n     group = GRP_VP,\n     tooltip = "Number of bars used to build the volume profile.\\nThis defines the \'session\' or range for HVN/LVN detection.\\nLower (50-100) = recent micro-structure, good for scalping.\\nHigher (200-500) = broader structure, better for swing context.\\nDefault 200 = covers a full day on 5-min charts (NQ/ES).\\nAdjust based on your chart timeframe.")\n\nint vpRows = input.int(24, "VP Resolution (Rows)", minval = 12, maxval = 48,\n     group = GRP_VP,\n     tooltip = "Number of price bins (rows) in the volume profile histogram.\\nHigher = more detail, more precise HVN/LVN detection, but slower.\\nLower = smoother, fewer but more significant nodes detected.\\nDefault 24 = good balance of precision and performance.\\n12 = fast/coarse, 48 = detailed/slow.")\n\nfloat vaPercent = input.float(70.0, "Value Area %", minval = 50.0, maxval = 90.0,\n     step = 5.0, group = GRP_VP,\n     tooltip = "Percentage of total volume that defines the Value Area (Balance Box).\\n70% is the standard from Steidlmayer\'s Market Profile — one standard\\ndeviation of a normal distribution. Used universally by institutional desks.\\nHigher (80-90%) = wider box, more conservative \'balance\' definition.\\nLower (50-60%) = tighter box, more aggressive imbalance detection.")\n\n// ── Alert Settings ──\nstring GRP_ALERTS = "Alert Configuration"\n\nbool alertBullConfluence = input.bool(true, "Alert: Bull Confluence",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when ALL 3 Valentini conditions align for a LONG:\\n1. Market is in IMBALANCE\\n2. Price is near a SUPPORT level\\n3. BUYER AGGRESSION detected\\nThis is the premium setup from the model.")\n\nbool alertBearConfluence = input.bool(true, "Alert: Bear Confluence",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when ALL 3 Valentini conditions align for a SHORT:\\n1. Market is in IMBALANCE\\n2. Price is near a RESISTANCE level\\n3. SELLER AGGRESSION detected\\nThis is the premium setup from the model.")\n\nbool alertFailedBuyAuction = input.bool(true, "Alert: Failed Buy Auction",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when aggressive BUYERS fail — previous bar had a buy aggression spike\\nbut the current bar closes BELOW the previous bar low.\\nValentini: \'Aggressive buyers created a failed auction — the sellers won.\'")\n\nbool alertFailedSellAuction = input.bool(true, "Alert: Failed Sell Auction",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when aggressive SELLERS fail — previous bar had a sell aggression spike\\nbut the current bar closes ABOVE the previous bar high.\\nKey reversal signal in Valentini\'s model.")\n\nbool alertHugeBuyVol = input.bool(true, "Alert: Huge Buy Volume (5x+)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when buyer aggression is EXTREME — volume exceeds 5x the average\\nwith a bullish candle close. Rare institutional-size events.")\n\nbool alertHugeSellVol = input.bool(true, "Alert: Huge Sell Volume (5x+)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when seller aggression is EXTREME — volume exceeds 5x the average\\nwith a bearish candle close. Rare institutional-size distribution events.")\n\nbool alertBalanceShift = input.bool(false, "Alert: Balance/Imbalance Shift",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when market state CHANGES between balance and imbalance.\\nOFF by default because it fires frequently.")\n\nbool alertTrendChange = input.bool(false, "Alert: 30-Min Trend Change",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when the 30-minute trend direction FLIPS.\\nOFF by default to reduce noise.")\n\nbool alertAnyAggression = input.bool(false, "Alert: Any Aggression (All Sizes)",\n     group = GRP_ALERTS,\n     tooltip = "Triggers on ANY volume spike with directional conviction.\\nMost frequent alert. OFF by default.")\n\nbool alertAtKeyLevel = input.bool(false, "Alert: Price at Key Level",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price is within proximity of any 30-min S/R level.\\nOFF by default because it fires often near levels.")\n\nbool alertPriceExitVA = input.bool(true, "Alert: Price Exits Value Area",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price closes OUTSIDE the Balance Box (Value Area).\\nValentini: This is when to start watching for setups.\\nPrice exiting the Value Area = potential imbalance beginning.\\nCombine with aggression confirmation before entering.")\n\nbool alertPriceAtPOC = input.bool(false, "Alert: Price at POC",\n     group = GRP_ALERTS,\n     tooltip = "Triggers when price is near the Point of Control level.\\nPOC is the strongest volume-based level.\\nUseful for mean-reversion setups.\\nOFF by default — enable for POC-based strategies.")\n\n// ── Colors ──\nstring GRP_COLORS = "Colors"\n\ncolor colBullTrend  = input.color(#2196F3, "Bull Trend",       group = GRP_COLORS, tooltip = "Bullish trend line and imbalance background.")\ncolor colBearTrend  = input.color(#F44336, "Bear Trend",       group = GRP_COLORS, tooltip = "Bearish trend line and imbalance background.")\ncolor colBuyAggr    = input.color(#2196F3, "Buyer Aggression",  group = GRP_COLORS, tooltip = "Buyer aggression bubbles.")\ncolor colSellAggr   = input.color(#F44336, "Seller Aggression", group = GRP_COLORS, tooltip = "Seller aggression bubbles.")\ncolor colWeekly     = input.color(#FF9800, "Weekly Level",      group = GRP_COLORS, tooltip = "Weekly H/L/C lines.")\ncolor colDaily      = input.color(#9C27B0, "Daily Level",       group = GRP_COLORS, tooltip = "Daily H/L/C/M and Fibonacci lines.")\ncolor col4H         = input.color(#00BCD4, "4H Level",          group = GRP_COLORS, tooltip = "4H balance zone lines.")\ncolor colHourly     = input.color(#607D8B, "Hourly Level",      group = GRP_COLORS, tooltip = "Hourly H/L lines.")\ncolor colSupport    = input.color(#4CAF50, "Support Level",     group = GRP_COLORS, tooltip = "30-min auction support levels.")\ncolor colResistance = input.color(#FF5722, "Resistance Level",  group = GRP_COLORS, tooltip = "30-min auction resistance levels.")\ncolor colBalance    = input.color(#FFC107, "Balance Zone BG",   group = GRP_COLORS, tooltip = "Background tint when market is in BALANCE.")\ncolor colHVN        = input.color(#FFEB3B, "HVN Level",         group = GRP_COLORS, tooltip = "High Volume Node lines — areas of acceptance/consolidation.")\ncolor colLVN        = input.color(#E040FB, "LVN Level",         group = GRP_COLORS, tooltip = "Low Volume Node lines — areas of rejection/fast movement.")\ncolor colPOC        = input.color(#FF6D00, "POC Line",          group = GRP_COLORS, tooltip = "Point of Control — highest volume price level.")\ncolor colVABox      = input.color(#FFC107, "Balance Box Fill",  group = GRP_COLORS, tooltip = "Value Area (Balance Box) background fill color.")\ncolor colWeeklyFib  = input.color(#FF9800, "Weekly Fib Levels", group = GRP_COLORS, tooltip = "Weekly Fibonacci retracement lines.")\ncolor colDailyFib   = input.color(#9C27B0, "Daily Fib Levels",  group = GRP_COLORS, tooltip = "Daily Fibonacci retracement lines.")\n\n// ── Line Widths ──\nstring GRP_WIDTHS = "Line Widths"\n\nint widWeekly   = input.int(2, "Weekly Level Width",     minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for weekly H/L/C levels.")\nint widDaily    = input.int(2, "Daily Level Width",      minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for daily H/L/C/M levels.")\nint wid4H       = input.int(1, "4H Level Width",         minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for 4-hour levels.")\nint widHourly   = input.int(1, "Hourly Level Width",     minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for hourly levels.")\nint widSR       = input.int(1, "S/R Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for 30-min auction S/R levels.")\nint widMA       = input.int(1, "MA Level Width",         minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for daily 20/50 SMA levels.")\nint widFib      = input.int(1, "Fibonacci Level Width",  minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Line thickness for Fibonacci retracement levels.")\nint widPsych    = input.int(1, "Psych Level Width",      minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Line thickness for psychological round number levels.")\nint widHVN      = input.int(2, "HVN Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for High Volume Node levels.")\nint widLVN      = input.int(1, "LVN Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for Low Volume Node levels.")\nint widPOC      = input.int(3, "POC Level Width",        minval = 1, maxval = 5, group = GRP_WIDTHS, tooltip = "Line thickness for Point of Control level.")\nint widVABorder = input.int(1, "Balance Box Border Width", minval = 1, maxval = 3, group = GRP_WIDTHS, tooltip = "Border thickness for the Value Area (Balance Box).")\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// GLOBAL COMPUTATIONS — Must execute every bar unconditionally for ta.* consistency\n// ═══════════════════════════════════════════════════════════════════════════════\nfloat globalATR14     = ta.atr(14)\nfloat vpRangeHigh     = ta.highest(high, vpLookback)\nfloat vpRangeLow      = ta.lowest(low, vpLookback)\nint atrShortLen       = int(balancePeriod / 2) < 1 ? 1 : int(balancePeriod / 2)\nfloat atrShort        = ta.atr(atrShortLen)\nfloat atrLong         = ta.atr(balancePeriod)\nfloat volAvg          = ta.sma(volume, aggrVolPeriod)\n\n// ── Sensitivity Mapping ──\nfloat sensBodyRatio   = sensitivityInput == "Low" ? 0.45 : sensitivityInput == "High" ? 0.20 : 0.30\nfloat sensDupeATRMult = sensitivityInput == "Low" ? 0.50 : sensitivityInput == "High" ? 0.15 : 0.30\nfloat sensProxATRMult = sensitivityInput == "Low" ? 0.30 : sensitivityInput == "High" ? 0.70 : 0.50\nfloat sensVolBoost    = sensitivityInput == "Low" ? 0.5  : sensitivityInput == "High" ? -0.3 : 0.0\nfloat sensHVNMult     = sensitivityInput == "Low" ? 1.8  : sensitivityInput == "High" ? 1.2 : 1.5\nfloat sensLVNMult     = sensitivityInput == "Low" ? 0.3  : sensitivityInput == "High" ? 0.6 : 0.5\n\n// ── Label Size Mapping ──\nstring labelSz = switch labelSizeInput\n    "Auto"   => size.auto\n    "Tiny"   => size.tiny\n    "Small"  => size.small\n    "Normal" => size.normal\n    "Large"  => size.large\n    => size.small\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// HELPER FUNCTIONS\n// ═══════════════════════════════════════════════════════════════════════════════\n\nlabelText(string shortTxt, string longTxt) =>\n    labelMode == "Short" ? shortTxt : longTxt\n\ndeltaProxy(float o, float h, float l, float c, float v) =>\n    float barRange = h - l\n    float deltaRatio = barRange > 0 ? (c - l) / barRange - 0.5 : 0.0\n    float delta = deltaRatio * v * 2.0\n    delta\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE A — 30-MINUTE TREND CONTEXT\n// ═══════════════════════════════════════════════════════════════════════════════\n\n[htf30H, htf30L, htf30C, htf30O] = request.security(\n     syminfo.tickerid, "30",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\nfloat htf30HH = request.security(syminfo.tickerid, "30",\n     ta.highest(high, trendLookback)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30LL = request.security(syminfo.tickerid, "30",\n     ta.lowest(low, trendLookback)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30prevHH = request.security(syminfo.tickerid, "30",\n     ta.highest(high, trendLookback)[trendLookback + 1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30prevLL = request.security(syminfo.tickerid, "30",\n     ta.lowest(low, trendLookback)[trendLookback + 1],\n     lookahead = barmerge.lookahead_on)\n\nbool higherHigh = not na(htf30HH) and not na(htf30prevHH) and htf30HH > htf30prevHH\nbool higherLow  = not na(htf30LL) and not na(htf30prevLL) and htf30LL > htf30prevLL\nbool lowerLow   = not na(htf30LL) and not na(htf30prevLL) and htf30LL < htf30prevLL\nbool lowerHigh  = not na(htf30HH) and not na(htf30prevHH) and htf30HH < htf30prevHH\n\nvar int trendState = 0\nif higherHigh and higherLow\n    trendState := 1\nelse if lowerLow and lowerHigh\n    trendState := -1\n\nvar int prevTrendState = 0\nbool trendChanged = trendState != prevTrendState and prevTrendState != 0\nprevTrendState := trendState\n\ncolor trendColor = trendState == 1 ? colBullTrend : trendState == -1 ? colBearTrend : color.gray\n\nplot(showTrend ? htf30C : na, "30-Min Trend Line",\n     color = trendColor, linewidth = 2, style = plot.style_stepline)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE B — 30-MINUTE AUCTION SUPPORT & RESISTANCE\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat htf30PivH = request.security(syminfo.tickerid, "30",\n     ta.pivothigh(high, srLeftBars, srRightBars)[1],\n     lookahead = barmerge.lookahead_on)\nfloat htf30PivL = request.security(syminfo.tickerid, "30",\n     ta.pivotlow(low, srLeftBars, srRightBars)[1],\n     lookahead = barmerge.lookahead_on)\n\nvar array<float> resistanceLevels = array.new_float()\nvar array<float> supportLevels    = array.new_float()\nvar array<line>  srLines          = array.new_line()\nvar array<label> srLabels         = array.new_label()\n\nfloat dupeThreshold = globalATR14 * sensDupeATRMult\n\nif showSR and not na(htf30PivH)\n    bool duplicate = false\n    if array.size(resistanceLevels) > 0\n        for i = 0 to array.size(resistanceLevels) - 1\n            if math.abs(array.get(resistanceLevels, i) - htf30PivH) < dupeThreshold\n                duplicate := true\n                break\n    if not duplicate\n        array.push(resistanceLevels, htf30PivH)\n        if array.size(resistanceLevels) > srMaxLevels\n            array.shift(resistanceLevels)\n\nif showSR and not na(htf30PivL)\n    bool duplicate = false\n    if array.size(supportLevels) > 0\n        for i = 0 to array.size(supportLevels) - 1\n            if math.abs(array.get(supportLevels, i) - htf30PivL) < dupeThreshold\n                duplicate := true\n                break\n    if not duplicate\n        array.push(supportLevels, htf30PivL)\n        if array.size(supportLevels) > srMaxLevels\n            array.shift(supportLevels)\n\nif showSR and barstate.islast\n    if array.size(srLines) > 0\n        for i = 0 to array.size(srLines) - 1\n            line.delete(array.get(srLines, i))\n    if array.size(srLabels) > 0\n        for i = 0 to array.size(srLabels) - 1\n            label.delete(array.get(srLabels, i))\n    array.clear(srLines)\n    array.clear(srLabels)\n\n    if array.size(resistanceLevels) > 0\n        for i = 0 to array.size(resistanceLevels) - 1\n            float lvl = array.get(resistanceLevels, i)\n            line newLine = line.new(bar_index - 50, lvl, bar_index + 10, lvl,\n                 color = colResistance, style = line.style_dashed, width = widSR,\n                 extend = extend.right)\n            array.push(srLines, newLine)\n            string txt = labelText("R", "30m Resistance")\n            label newLabel = label.new(bar_index + 12, lvl, txt,\n                 color = color.new(colResistance, 80), textcolor = colResistance,\n                 style = label.style_label_left, size = labelSz)\n            array.push(srLabels, newLabel)\n\n    if array.size(supportLevels) > 0\n        for i = 0 to array.size(supportLevels) - 1\n            float lvl = array.get(supportLevels, i)\n            line newLine = line.new(bar_index - 50, lvl, bar_index + 10, lvl,\n                 color = colSupport, style = line.style_dashed, width = widSR,\n                 extend = extend.right)\n            array.push(srLines, newLine)\n            string txt = labelText("S", "30m Support")\n            label newLabel = label.new(bar_index + 12, lvl, txt,\n                 color = color.new(colSupport, 80), textcolor = colSupport,\n                 style = label.style_label_left, size = labelSz)\n            array.push(srLabels, newLabel)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE C — AGGRESSION / LARGE TRADE DETECTION\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat effFutMult = futuresMultiplier + sensVolBoost\nfloat effEtfMult = etfMultiplier + sensVolBoost\nfloat volThreshold = isFutures ? volAvg * effFutMult : volAvg * effEtfMult\n\nfloat currentDelta = deltaProxy(open, high, low, close, volume)\n\nbool volSpike       = volume > volThreshold and not na(volAvg) and volAvg > 0\nfloat candleRange   = high - low\nfloat bodyRatio     = candleRange > 0 ? math.abs(close - open) / candleRange : 0.0\nbool meaningfulBody = bodyRatio > sensBodyRatio\n\nbool buyAggression  = volSpike and close > open and meaningfulBody and showAggression\nbool sellAggression = volSpike and close < open and meaningfulBody and showAggression\n\nfloat volRatio = volAvg > 0 ? volume / volAvg : 0.0\nbool isMediumSpike = volRatio >= 2.0 and volRatio < 3.5\nbool isLargeSpike  = volRatio >= 3.5 and volRatio < 5.0\nbool isHugeSpike   = volRatio >= 5.0\n\nplotshape(buyAggression and isMediumSpike, "Buy Aggr (Med)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 30), size = size.small)\nplotshape(buyAggression and isLargeSpike, "Buy Aggr (Lrg)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 10), size = size.normal)\nplotshape(buyAggression and isHugeSpike, "Buy Aggr (Huge)",\n     style = shape.circle, location = location.belowbar,\n     color = color.new(colBuyAggr, 0), size = size.large)\n\nplotshape(sellAggression and isMediumSpike, "Sell Aggr (Med)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 30), size = size.small)\nplotshape(sellAggression and isLargeSpike, "Sell Aggr (Lrg)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 10), size = size.normal)\nplotshape(sellAggression and isHugeSpike, "Sell Aggr (Huge)",\n     style = shape.circle, location = location.abovebar,\n     color = color.new(colSellAggr, 0), size = size.large)\n\nbool failedBuyAuction  = buyAggression[1] and close < low[1]\nbool failedSellAuction = sellAggression[1] and close > high[1]\n\nplotshape(failedBuyAuction and showAggression, "Failed Buy Auction",\n     style = shape.xcross, location = location.abovebar,\n     color = colSellAggr, size = size.small)\nplotshape(failedSellAuction and showAggression, "Failed Sell Auction",\n     style = shape.xcross, location = location.belowbar,\n     color = colBuyAggr, size = size.small)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE D — MULTI-TIMEFRAME INSTITUTIONAL LEVELS\n// ═══════════════════════════════════════════════════════════════════════════════\n\n[wkH, wkL, wkC, wkO] = request.security(syminfo.tickerid, "1W",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[dayH, dayL, dayC, dayO] = request.security(syminfo.tickerid, "1D",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[h4H, h4L, h4C, h4O] = request.security(syminfo.tickerid, "240",\n     [high[1], low[1], close[1], open[1]],\n     lookahead = barmerge.lookahead_on)\n\n[h1H, h1L, h1C] = request.security(syminfo.tickerid, "60",\n     [high[1], low[1], close[1]],\n     lookahead = barmerge.lookahead_on)\n\nfloat dailyMA20 = request.security(syminfo.tickerid, "1D",\n     ta.sma(close, 20)[1], lookahead = barmerge.lookahead_on)\nfloat dailyMA50 = request.security(syminfo.tickerid, "1D",\n     ta.sma(close, 50)[1], lookahead = barmerge.lookahead_on)\n\nvar array<line>  mtfLines  = array.new_line()\nvar array<label> mtfLabels = array.new_label()\n\ndrawLevel(float price, color col, string shortName, string longName, int wid, string lineStyle) =>\n    if not na(price) and barstate.islast\n        string txt = labelText(shortName, longName)\n        string lstyle = lineStyle == "dashed" ? line.style_dashed : lineStyle == "dotted" ? line.style_dotted : line.style_solid\n        line newLine = line.new(bar_index - 30, price, bar_index + 10, price,\n             color = col, style = lstyle, width = wid,\n             extend = extend.right)\n        array.push(mtfLines, newLine)\n        label newLabel = label.new(bar_index + 14, price,\n             txt + " " + str.tostring(price, format.mintick),\n             color = color.new(col, 85), textcolor = col,\n             style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, newLabel)\n\nif barstate.islast\n    if array.size(mtfLines) > 0\n        for i = 0 to array.size(mtfLines) - 1\n            line.delete(array.get(mtfLines, i))\n    if array.size(mtfLabels) > 0\n        for i = 0 to array.size(mtfLabels) - 1\n            label.delete(array.get(mtfLabels, i))\n    array.clear(mtfLines)\n    array.clear(mtfLabels)\n\nif showWeekly\n    drawLevel(wkH, colWeekly, "WH", "Weekly High", widWeekly, "solid")\n    drawLevel(wkL, colWeekly, "WL", "Weekly Low", widWeekly, "solid")\n    drawLevel(wkC, colWeekly, "WC", "Weekly Close", math.max(1, widWeekly - 1), "solid")\n\nif showDaily\n    drawLevel(dayH, colDaily, "DH", "Prev Day High", widDaily, "solid")\n    drawLevel(dayL, colDaily, "DL", "Prev Day Low", widDaily, "solid")\n    drawLevel(dayC, colDaily, "DC", "Prev Day Close", math.max(1, widDaily - 1), "solid")\n    float dayMid = (dayH + dayL) / 2.0\n    drawLevel(dayMid, color.new(colDaily, 40), "DM", "Daily Midpoint (POC Proxy)", math.max(1, widDaily - 1), "solid")\n\nif show4H\n    drawLevel(h4H, col4H, "4H-H", "4H Balance High", wid4H, "solid")\n    drawLevel(h4L, col4H, "4H-L", "4H Balance Low", wid4H, "solid")\n    float h4Mid = (h4H + h4L) / 2.0\n    drawLevel(h4Mid, color.new(col4H, 40), "4H-M", "4H Balance Mid", wid4H, "solid")\n\nif showHourly\n    drawLevel(h1H, colHourly, "1H-H", "Hourly High", widHourly, "solid")\n    drawLevel(h1L, colHourly, "1H-L", "Hourly Low", widHourly, "solid")\n\nif showMAs\n    drawLevel(dailyMA20, #26A69A, "D20", "Daily 20 SMA", widMA, "solid")\n    drawLevel(dailyMA50, #EF5350, "D50", "Daily 50 SMA", widMA, "solid")\n\nif showPsychLevels and barstate.islast and psychInterval > 0\n    float baseLevel = math.floor(low / psychInterval) * psychInterval\n    int maxPsychLevels = 5\n    for i = -1 to maxPsychLevels\n        float psyLvl = baseLevel + psychInterval * i\n        if psyLvl > low - psychInterval * 2 and psyLvl < high + psychInterval * 2\n            string pTxt = labelText("PSY", "Psych " + str.tostring(psyLvl, "#"))\n            line pLine = line.new(bar_index - 30, psyLvl, bar_index + 10, psyLvl,\n                 color = color.new(color.white, 70), style = line.style_dotted, width = widPsych,\n                 extend = extend.right)\n            array.push(mtfLines, pLine)\n            label pLabel = label.new(bar_index + 14, psyLvl, pTxt,\n                 color = color.new(color.white, 90), textcolor = color.new(color.white, 40),\n                 style = label.style_label_left, size = labelSz)\n            array.push(mtfLabels, pLabel)\n\n// ── Daily Fibonacci Levels (labeled with source TF) ──\nif showDailyFibs and barstate.islast and not na(dayH) and not na(dayL)\n    float dFibSpan = dayH - dayL\n    if dFibSpan > 0\n        float dFib236 = dayH - dFibSpan * 0.236\n        float dFib382 = dayH - dFibSpan * 0.382\n        float dFib500 = dayH - dFibSpan * 0.500\n        float dFib618 = dayH - dFibSpan * 0.618\n        float dFib786 = dayH - dFibSpan * 0.786\n\n        color dFibCol = color.new(colDailyFib, 50)\n        for fibVal in array.from(dFib236, dFib382, dFib500, dFib618, dFib786)\n            line fLine = line.new(bar_index - 20, fibVal, bar_index + 5, fibVal,\n                 color = dFibCol, style = line.style_dotted, width = widFib,\n                 extend = extend.right)\n            array.push(mtfLines, fLine)\n\n        label df236 = label.new(bar_index + 6, dFib236, labelText("DF236", "D Fib 23.6%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df236)\n        label df382 = label.new(bar_index + 6, dFib382, labelText("DF382", "D Fib 38.2%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df382)\n        label df5 = label.new(bar_index + 6, dFib500, labelText("DF50", "D Fib 50%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df5)\n        label df6 = label.new(bar_index + 6, dFib618, labelText("DF618", "D Fib 61.8%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df6)\n        label df786 = label.new(bar_index + 6, dFib786, labelText("DF786", "D Fib 78.6%"),\n             color = color.new(dFibCol, 90), textcolor = dFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, df786)\n\n// ── Weekly Fibonacci Levels (labeled with source TF) ──\nif showWeeklyFibs and barstate.islast and not na(wkH) and not na(wkL)\n    float wFibSpan = wkH - wkL\n    if wFibSpan > 0\n        float wFib236 = wkH - wFibSpan * 0.236\n        float wFib382 = wkH - wFibSpan * 0.382\n        float wFib500 = wkH - wFibSpan * 0.500\n        float wFib618 = wkH - wFibSpan * 0.618\n        float wFib786 = wkH - wFibSpan * 0.786\n\n        color wFibCol = color.new(colWeeklyFib, 50)\n        for fibVal in array.from(wFib236, wFib382, wFib500, wFib618, wFib786)\n            line fLine = line.new(bar_index - 30, fibVal, bar_index + 5, fibVal,\n                 color = wFibCol, style = line.style_dashed, width = widFib,\n                 extend = extend.right)\n            array.push(mtfLines, fLine)\n\n        label wf236 = label.new(bar_index + 8, wFib236, labelText("WF236", "W Fib 23.6%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf236)\n        label wf382 = label.new(bar_index + 8, wFib382, labelText("WF382", "W Fib 38.2%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf382)\n        label wf5 = label.new(bar_index + 8, wFib500, labelText("WF50", "W Fib 50%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf5)\n        label wf6 = label.new(bar_index + 8, wFib618, labelText("WF618", "W Fib 61.8%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf6)\n        label wf786 = label.new(bar_index + 8, wFib786, labelText("WF786", "W Fib 78.6%"),\n             color = color.new(wFibCol, 90), textcolor = wFibCol, style = label.style_label_left, size = labelSz)\n        array.push(mtfLabels, wf786)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE E — AUCTION NARRATIVE OVERLAY (Balance vs Imbalance)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nfloat balanceRatio = atrLong > 0 ? atrShort / atrLong : 0.5\n\nbool isInBalance  = balanceRatio < balanceThreshold\nbool isImbalanced = not isInBalance\n\nvar bool prevBalanceState = true\nbool balanceShifted = isInBalance != prevBalanceState\nprevBalanceState := isInBalance\n\nbgcolor(showBalance and isInBalance ? color.new(colBalance, 92) : na, title = "Balance Zone BG")\nbgcolor(showBalance and isImbalanced and trendState == 1 ? color.new(colBullTrend, 94) : na, title = "Imbalance Bull BG")\nbgcolor(showBalance and isImbalanced and trendState == -1 ? color.new(colBearTrend, 94) : na, title = "Imbalance Bear BG")\n\n// ── Location Validity ──\nfloat nearestResist = na\nfloat nearestSupp   = na\n\nif array.size(resistanceLevels) > 0\n    nearestResist := array.get(resistanceLevels, array.size(resistanceLevels) - 1)\nif array.size(supportLevels) > 0\n    nearestSupp := array.get(supportLevels, array.size(supportLevels) - 1)\n\nbool nearResistance = not na(nearestResist) and math.abs(close - nearestResist) < globalATR14 * sensProxATRMult\nbool nearSupport    = not na(nearestSupp) and math.abs(close - nearestSupp) < globalATR14 * sensProxATRMult\nbool atKeyLevel     = nearResistance or nearSupport\n\n// ── Valentini Confluence Signal ──\nbool bullConfluence = isImbalanced and trendState == 1 and nearSupport and buyAggression\nbool bearConfluence = isImbalanced and trendState == -1 and nearResistance and sellAggression\n\nplotshape(bullConfluence, "Bull Confluence",\n     style = shape.diamond, location = location.belowbar,\n     color = color.new(#00E676, 0), size = size.normal)\nplotshape(bearConfluence, "Bear Confluence",\n     style = shape.diamond, location = location.abovebar,\n     color = color.new(#FF1744, 0), size = size.normal)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// MODULE F — VOLUME PROFILE: HVN, LVN, POC, & BALANCE BOX (VALUE AREA)\n// ═══════════════════════════════════════════════════════════════════════════════\n//\n// Methodology: Standard bin-based volume distribution.\n// Each bar\'s volume is proportionally allocated across the price bins\n// (rows) that the bar\'s high-low range spans. This is the same approach\n// used by professional platforms (ATAS, Sierra Chart, Quantower) and\n// TradingView\'s own Session Volume Profile indicator.\n//\n// Academic foundation:\n// - Steidlmayer, J.P. "Markets & Market Logic" (1986) — Market Profile\n// - Dalton, J. "Mind Over Markets" (1990) — Value Area, POC concepts\n// - CME Group Market Profile Handbook — standard 70% Value Area\n//\n// Valentini\'s application:\n// - Balance Box (Value Area) = NO-TRADE ZONE. Skip trades inside.\n// - LVN = reaction zones for entries when price revisits\n// - HVN = acceptance zones, price consolidates here\n// - POC = fair value, strongest S/R, target for mean-reversion\n// ═══════════════════════════════════════════════════════════════════════════════\n\nvar array<line>  vpLines  = array.new_line()\nvar array<label> vpLabels = array.new_label()\nvar array<box>   vpBoxes  = array.new_box()\n\n// Persistent VP output values for alerts (updated on last bar)\nvar float vpVAH = na\nvar float vpVAL = na\nvar float vpPOCprice = na\n\nif barstate.islast and (showHVN or showLVN or showBalanceBox or showPOC)\n    // ── Clean up previous VP drawings ──\n    if array.size(vpLines) > 0\n        for i = 0 to array.size(vpLines) - 1\n            line.delete(array.get(vpLines, i))\n    if array.size(vpLabels) > 0\n        for i = 0 to array.size(vpLabels) - 1\n            label.delete(array.get(vpLabels, i))\n    if array.size(vpBoxes) > 0\n        for i = 0 to array.size(vpBoxes) - 1\n            box.delete(array.get(vpBoxes, i))\n    array.clear(vpLines)\n    array.clear(vpLabels)\n    array.clear(vpBoxes)\n\n    // ── Build Volume Profile ──\n    float rHigh = vpRangeHigh\n    float rLow  = vpRangeLow\n    float binSize = not na(rHigh) and not na(rLow) and rHigh > rLow ? (rHigh - rLow) / vpRows : 0.0\n\n    if binSize > 0\n        // Initialize volume bins\n        array<float> volBins = array.new_float(vpRows, 0.0)\n        float totalVolume = 0.0\n\n        // Distribute volume into bins\n        for i = 0 to vpLookback - 1\n            float barH = high[i]\n            float barL = low[i]\n            float barV = volume[i]\n            if not na(barH) and not na(barL) and not na(barV) and barV > 0\n                int startBin = math.max(0, math.min(vpRows - 1, int(math.floor((barL - rLow) / binSize))))\n                int endBin   = math.max(0, math.min(vpRows - 1, int(math.floor((barH - rLow) / binSize))))\n                if startBin > endBin\n                    int tempBin = startBin\n                    startBin := endBin\n                    endBin   := tempBin\n                int numBins = endBin - startBin + 1\n                float volPerBin = barV / numBins\n                for b = startBin to endBin\n                    array.set(volBins, b, array.get(volBins, b) + volPerBin)\n                totalVolume += barV\n\n        if totalVolume > 0\n            // ── Find POC (bin with highest volume) ──\n            int pocBin = 0\n            float maxBinVol = 0.0\n            for b = 0 to vpRows - 1\n                float bv = array.get(volBins, b)\n                if bv > maxBinVol\n                    maxBinVol := bv\n                    pocBin    := b\n\n            float pocPrice = rLow + (pocBin + 0.5) * binSize\n            vpPOCprice := pocPrice\n\n            // ── Calculate Value Area (expanding from POC) ──\n            float vaTarget = totalVolume * (vaPercent / 100.0)\n            float cumVol   = array.get(volBins, pocBin)\n            int vaLowBin   = pocBin\n            int vaHighBin  = pocBin\n\n            for _iter = 0 to vpRows - 1\n                if cumVol >= vaTarget\n                    break\n                float volAbove = vaHighBin < vpRows - 1 ? array.get(volBins, vaHighBin + 1) : 0.0\n                float volBelow = vaLowBin > 0 ? array.get(volBins, vaLowBin - 1) : 0.0\n                if volAbove == 0.0 and volBelow == 0.0\n                    break\n                if volAbove >= volBelow and vaHighBin < vpRows - 1\n                    vaHighBin += 1\n                    cumVol    += volAbove\n                else if vaLowBin > 0\n                    vaLowBin -= 1\n                    cumVol   += volBelow\n                else if vaHighBin < vpRows - 1\n                    vaHighBin += 1\n                    cumVol    += volAbove\n                else\n                    break\n\n            float vahPrice = rLow + (vaHighBin + 1) * binSize\n            float valPrice = rLow + vaLowBin * binSize\n            vpVAH := vahPrice\n            vpVAL := valPrice\n\n            // ── Draw Balance Box (Value Area) ──\n            if showBalanceBox\n                box vaBox = box.new(bar_index - vpLookback, vahPrice, bar_index + 5, valPrice,\n                     border_color = color.new(colVABox, 50), border_width = widVABorder,\n                     border_style = line.style_dashed,\n                     bgcolor = color.new(colVABox, 93))\n                array.push(vpBoxes, vaBox)\n\n                string vaTopTxt = labelText("VAH", "Value Area High (Skip Above)")\n                label vahLabel = label.new(bar_index + 6, vahPrice, vaTopTxt + " " + str.tostring(vahPrice, format.mintick),\n                     color = color.new(colVABox, 85), textcolor = colVABox,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, vahLabel)\n\n                string vaBotTxt = labelText("VAL", "Value Area Low (Skip Below)")\n                label valLabel = label.new(bar_index + 6, valPrice, vaBotTxt + " " + str.tostring(valPrice, format.mintick),\n                     color = color.new(colVABox, 85), textcolor = colVABox,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, valLabel)\n\n            // ── Draw POC ──\n            if showPOC\n                line pocLine = line.new(bar_index - vpLookback, pocPrice, bar_index + 10, pocPrice,\n                     color = colPOC, style = line.style_solid, width = widPOC,\n                     extend = extend.right)\n                array.push(vpLines, pocLine)\n\n                string pocTxt = labelText("POC", "POC (Fair Value)")\n                label pocLabel = label.new(bar_index + 12, pocPrice, pocTxt + " " + str.tostring(pocPrice, format.mintick),\n                     color = color.new(colPOC, 80), textcolor = colPOC,\n                     style = label.style_label_left, size = labelSz)\n                array.push(vpLabels, pocLabel)\n\n            // ── Detect and Draw HVN / LVN ──\n            float avgBinVol = totalVolume / vpRows\n            float hvnThresh = avgBinVol * sensHVNMult\n            float lvnThresh = avgBinVol * sensLVNMult\n\n            for b = 0 to vpRows - 1\n                float bv = array.get(volBins, b)\n                float binMid = rLow + (b + 0.5) * binSize\n\n                // Skip the POC bin for HVN (POC is drawn separately)\n                if showHVN and bv > hvnThresh and b != pocBin\n                    line hvnLine = line.new(bar_index - vpLookback, binMid, bar_index + 5, binMid,\n                         color = color.new(colHVN, 30), style = line.style_solid, width = widHVN)\n                    array.push(vpLines, hvnLine)\n                    string hvnTxt = labelText("HVN", "HVN (Acceptance)")\n                    label hvnLabel = label.new(bar_index + 6, binMid, hvnTxt,\n                         color = color.new(colHVN, 85), textcolor = colHVN,\n                         style = label.style_label_left, size = labelSz)\n                    array.push(vpLabels, hvnLabel)\n\n                if showLVN and bv < lvnThresh and bv > 0\n                    line lvnLine = line.new(bar_index - vpLookback, binMid, bar_index + 5, binMid,\n                         color = color.new(colLVN, 30), style = line.style_dashed, width = widLVN)\n                    array.push(vpLines, lvnLine)\n                    string lvnTxt = labelText("LVN", "LVN (Rejection)")\n                    label lvnLabel = label.new(bar_index + 6, binMid, lvnTxt,\n                         color = color.new(colLVN, 85), textcolor = colLVN,\n                         style = label.style_label_left, size = labelSz)\n                    array.push(vpLabels, lvnLabel)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// VP-BASED ALERT CONDITIONS (need to run every bar for alertcondition)\n// ═══════════════════════════════════════════════════════════════════════════════\n\nbool priceAboveVA = not na(vpVAH) and close > vpVAH\nbool priceBelowVA = not na(vpVAL) and close < vpVAL\nbool priceOutsideVA = priceAboveVA or priceBelowVA\nbool priceNearPOC = not na(vpPOCprice) and math.abs(close - vpPOCprice) < globalATR14 * 0.3\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// INFO TABLE\n// ═══════════════════════════════════════════════════════════════════════════════\n\nvar table infoTable = table.new(position.top_right, 2, 8,\n     bgcolor = color.new(color.black, 30),\n     border_width = 1, border_color = color.new(color.white, 70))\n\nif barstate.islast\n    table.cell(infoTable, 0, 0, "V-AMT v2", text_color = color.white, text_size = size.small)\n    table.cell(infoTable, 1, 0,\n         isFutures ? "FUTURES" : "ETF",\n         text_color = isFutures ? color.orange : color.aqua, text_size = size.small)\n\n    table.cell(infoTable, 0, 1, "State:", text_color = color.gray, text_size = size.tiny)\n    table.cell(infoTable, 1, 1,\n         isInBalance ? "BALANCE" : "IMBALANCE",\n         text_color = isInBalance ? colBalance : (trendState == 1 ? colBullTrend : colBearTrend),\n         text_size = size.tiny)\n\n    table.cell(infoTable, 0, 2, "30m Trend:", text_color = color.gray, text_size = size.tiny)\n    string trendTxt = trendState == 1 ? "BULL" : trendState == -1 ? "BEAR" : "NEUTRAL"\n    table.cell(infoTable, 1, 2, trendTxt, text_color = trendColor, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 3, "Volume:", text_color = color.gray, text_size = size.tiny)\n    string volTxt = volRatio >= 3.0 ? "EXTREME" : volRatio >= 2.0 ? "SPIKE" : "Normal"\n    color volTxtCol = volRatio >= 3.0 ? color.red : volRatio >= 2.0 ? color.orange : color.gray\n    table.cell(infoTable, 1, 3, volTxt, text_color = volTxtCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 4, "Delta:", text_color = color.gray, text_size = size.tiny)\n    table.cell(infoTable, 1, 4,\n         currentDelta > 0 ? "BUY +" + str.tostring(math.round(currentDelta)) :\n         "SELL " + str.tostring(math.round(currentDelta)),\n         text_color = currentDelta > 0 ? colBuyAggr : colSellAggr, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 5, "Location:", text_color = color.gray, text_size = size.tiny)\n    string locTxt = priceAboveVA ? "ABOVE VA" : priceBelowVA ? "BELOW VA" : "INSIDE VA"\n    color locCol = priceOutsideVA ? color.lime : colBalance\n    table.cell(infoTable, 1, 5, locTxt, text_color = locCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 6, "Sensitivity:", text_color = color.gray, text_size = size.tiny)\n    color sensCol = sensitivityInput == "Low" ? color.green : sensitivityInput == "High" ? color.red : color.orange\n    table.cell(infoTable, 1, 6, sensitivityInput, text_color = sensCol, text_size = size.tiny)\n\n    table.cell(infoTable, 0, 7, "Signal:", text_color = color.gray, text_size = size.tiny)\n    string sigTxt = bullConfluence ? "BULL CONFLUENCE" :\n         bearConfluence ? "BEAR CONFLUENCE" :\n         isInBalance ? "Wait - In Balance" :\n         not priceOutsideVA ? "Inside VA - Skip" :\n         atKeyLevel ? "At Key Level" : "Scanning..."\n    color sigCol = bullConfluence ? #00E676 :\n         bearConfluence ? #FF1744 :\n         isInBalance or not priceOutsideVA ? colBalance : color.gray\n    table.cell(infoTable, 1, 7, sigTxt, text_color = sigCol, text_size = size.tiny)\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// ALERTS — All configurable via input toggles\n// ═══════════════════════════════════════════════════════════════════════════════\n\nalertcondition(alertBullConfluence and bullConfluence,\n     "Bull Confluence",\n     "V-AMT: BULL CONFLUENCE — Imbalance + Support + Buy Aggression. Premium long setup.")\n\nalertcondition(alertBearConfluence and bearConfluence,\n     "Bear Confluence",\n     "V-AMT: BEAR CONFLUENCE — Imbalance + Resistance + Sell Aggression. Premium short setup.")\n\nalertcondition(alertFailedBuyAuction and failedBuyAuction,\n     "Failed Buy Auction",\n     "V-AMT: Aggressive BUYERS FAILED — price reversed below aggression bar. Potential short.")\n\nalertcondition(alertFailedSellAuction and failedSellAuction,\n     "Failed Sell Auction",\n     "V-AMT: Aggressive SELLERS FAILED — price reversed above aggression bar. Potential long.")\n\nalertcondition(alertHugeBuyVol and buyAggression and isHugeSpike,\n     "Huge Buy Volume",\n     "V-AMT: EXTREME buyer aggression (5x+ volume). Institutional-size buying.")\n\nalertcondition(alertHugeSellVol and sellAggression and isHugeSpike,\n     "Huge Sell Volume",\n     "V-AMT: EXTREME seller aggression (5x+ volume). Institutional-size selling.")\n\nalertcondition(alertBalanceShift and balanceShifted,\n     "Balance/Imbalance Shift",\n     "V-AMT: Market state changed between BALANCE and IMBALANCE.")\n\nalertcondition(alertTrendChange and trendChanged,\n     "30-Min Trend Change",\n     "V-AMT: 30-minute trend direction has FLIPPED.")\n\nalertcondition(alertAnyAggression and (buyAggression or sellAggression),\n     "Any Aggression Detected",\n     "V-AMT: Volume aggression detected (buyer or seller).")\n\nalertcondition(alertAtKeyLevel and atKeyLevel,\n     "Price at Key Level",\n     "V-AMT: Price near a 30-min support or resistance level.")\n\nalertcondition(alertPriceExitVA and priceOutsideVA,\n     "Price Exits Value Area",\n     "V-AMT: Price closed OUTSIDE the Value Area (Balance Box). Watch for setups.")\n\nalertcondition(alertPriceAtPOC and priceNearPOC,\n     "Price at POC",\n     "V-AMT: Price is near the Point of Control. Mean-reversion zone.")'
[DEBUG] save_script called: script_id=qgSSrerD title=AMT Institutional Model v2 category=qgSSrerD force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\qgSSrerD_AMT_Institutional_Model_v2.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\qgSSrerD_AMT_Institutional_Model_v2.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 06:36:26 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 06:36:26 GMT' as: 2026-02-09T06:36:26+00:00
[DEBUG] Exact published date for header: 2026-02-09T06:36:26+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/biGUf4YI-MACD-20-Uptrend-Candlestick-Patterns/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
//@version=5indicator("MACD < 20 & Uptrend + Candlestick Patterns", overlay=true)//
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\r\nindicator("MACD < 20 & Uptrend + Candlestick Patterns", overlay=true)\r\n\r\n// ===== Inputs =====\r\nfastLength = input.int(12, "MACD Fast Length")\r\nslowLength = input.int(26, "MACD Slow Length")\r\nsignalLength = input.int(9, "MACD Signal Length")\r\ntrendLength = input.int(50, "Uptrend SMA Length")\r\n\r\n// ===== MACD Calculation =====\r\n[macdLine, signalLine, _] = ta.macd(close, fastLength, slowLength, signalLength)\r\nmacdBelow20 = macdLine < 20\r\n\r\n// ===== Uptrend Definition =====\r\nsmaTrend = ta.sma(close, trendLength)\r\nupTrend = close > smaTrend\r\n\r\n// ===== Candlestick Patterns =====\r\n\r\n// --- Bullish Engulfing ---\r\n// Previous candle bearish, current candle bullish, current body engulfs previous body\r\nbullEngulf = close[1] < open[1] and close > open and close >= open[1] and open <= close[1]\r\n\r\n// --- Morning Star ---\r\n// 3-candle pattern: first candle bearish, second small body, third candle bullish closing > midpoint of first candle\r\nsmallBodyThreshold = 0.3 * (high[1] - low[1])\r\nmiddleCandleSmall = math.abs(close[1] - open[1]) <= smallBodyThreshold\r\nmorningStar = (close[2] < open[2]) and middleCandleSmall and (close > (open[2] + close[2]) / 2)\r\n\r\n// --- Doji ---\r\n// Candle where open and close are very close\r\ndojiCandle = math.abs(close - open) <= 0.1 * (high - low)\r\n\r\n// ===== Combine Conditions =====\r\nsignal = macdBelow20 and upTrend and (bullEngulf or morningStar or dojiCandle)\r\n\r\n// ===== Plot Signals =====\r\nplotshape(signal, title="Buy Signal", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)\r\n\r\n// ===== Optional MACD Plot =====\r\nplot(macdLine, color=color.blue, title="MACD Line")\r\nhline(20, "MACD 20", color=color.red)\r\n'
[CAPTURE 1] '//@version=5\r\nindicator("MACD < 20 & Uptrend + Candlestick Patterns", overlay=true)\r\n\r\n// ===== Inputs =====\r\nfastLength = input.int(12, "MACD Fast Length")\r\nslowLength = input.int(26, "MACD Slow Length")\r\nsignalLength = input.int(9, "MACD Signal Length")\r\ntrendLength = input.int(50, "Uptrend SMA Length")\r\n\r\n// ===== MACD Calculation =====\r\n[macdLine, signalLine, _] = ta.macd(close, fastLength, slowLength, signalLength)\r\nmacdBelow20 = macdLine < 20\r\n\r\n// ===== Uptrend Definition =====\r\nsmaTrend = ta.sma(close, trendLength)\r\nupTrend = close > smaTrend\r\n\r\n// ===== Candlestick Patterns =====\r\n\r\n// --- Bullish Engulfing ---\r\n// Previous candle bearish, current candle bullish, current body engulfs previous body\r\nbullEngulf = close[1] < open[1] and close > open and close >= open[1] and open <= close[1]\r\n\r\n// --- Morning Star ---\r\n// 3-candle pattern: first candle bearish, second small body, third candle bullish closing > midpoint of first candle\r\nsmallBodyThreshold = 0.3 * (high[1] - low[1])\r\nmiddleCandleSmall = math.abs(close[1] - open[1]) <= smallBodyThreshold\r\nmorningStar = (close[2] < open[2]) and middleCandleSmall and (close > (open[2] + close[2]) / 2)\r\n\r\n// --- Doji ---\r\n// Candle where open and close are very close\r\ndojiCandle = math.abs(close - open) <= 0.1 * (high - low)\r\n\r\n// ===== Combine Conditions =====\r\nsignal = macdBelow20 and upTrend and (bullEngulf or morningStar or dojiCandle)\r\n\r\n// ===== Plot Signals =====\r\nplotshape(signal, title="Buy Signal", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)\r\n\r\n// ===== Optional MACD Plot =====\r\nplot(macdLine, color=color.blue, title="MACD Line")\r\nhline(20, "MACD 20", color=color.red)\r\n'
[CAPTURE 2] '//@version=5\r\nindicator("MACD < 20 & Uptrend + Candlestick Patterns", overlay=true)\r\n\r\n// ===== Inputs =====\r\nfastLength = input.int(12, "MACD Fast Length")\r\nslowLength = input.int(26, "MACD Slow Length")\r\nsignalLength = input.int(9, "MACD Signal Length")\r\ntrendLength = input.int(50, "Uptrend SMA Length")\r\n\r\n// ===== MACD Calculation =====\r\n[macdLine, signalLine, _] = ta.macd(close, fastLength, slowLength, signalLength)\r\nmacdBelow20 = macdLine < 20\r\n\r\n// ===== Uptrend Definition =====\r\nsmaTrend = ta.sma(close, trendLength)\r\nupTrend = close > smaTrend\r\n\r\n// ===== Candlestick Patterns =====\r\n\r\n// --- Bullish Engulfing ---\r\n// Previous candle bearish, current candle bullish, current body engulfs previous body\r\nbullEngulf = close[1] < open[1] and close > open and close >= open[1] and open <= close[1]\r\n\r\n// --- Morning Star ---\r\n// 3-candle pattern: first candle bearish, second small body, third candle bullish closing > midpoint of first candle\r\nsmallBodyThreshold = 0.3 * (high[1] - low[1])\r\nmiddleCandleSmall = math.abs(close[1] - open[1]) <= smallBodyThreshold\r\nmorningStar = (close[2] < open[2]) and middleCandleSmall and (close > (open[2] + close[2]) / 2)\r\n\r\n// --- Doji ---\r\n// Candle where open and close are very close\r\ndojiCandle = math.abs(close - open) <= 0.1 * (high - low)\r\n\r\n// ===== Combine Conditions =====\r\nsignal = macdBelow20 and upTrend and (bullEngulf or morningStar or dojiCandle)\r\n\r\n// ===== Plot Signals =====\r\nplotshape(signal, title="Buy Signal", location=location.belowbar, color=color.green, style=shape.triangleup, size=size.small)\r\n\r\n// ===== Optional MACD Plot =====\r\nplot(macdLine, color=color.blue, title="MACD Line")\r\nhline(20, "MACD 20", color=color.red)\r\n'
[DEBUG] save_script called: script_id=biGUf4YI title=MACD < 20 & Uptrend + Candlestick Patterns category=biGUf4YI force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\biGUf4YI_MACD_20_&_Uptrend_+_Candlestick_Patterns.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\biGUf4YI_MACD_20_&_Uptrend_+_Candlestick_Patterns.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 06:09:11 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 06:09:11 GMT' as: 2026-02-09T06:09:11+00:00
[DEBUG] Exact published date for header: 2026-02-09T06:09:11+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/e9HAPhVq-Market-Structure-HH-HL-LH-LL/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © RajashekharRangappa\r\n\r\n//@version=6\r\nindicator("Market Structure HH HL LH LL", overlay = true)\r\n\r\n// Pivot settings\r\nleft = input.int(4, "Left Bars")\r\nright = input.int(4, "Right Bars")\r\nshowInfo = input.bool(true, "Show Information: On/Off")\r\n\r\nph = ta.pivothigh(high, left, right)\r\npl = ta.pivotlow(low, left, right)\r\n\r\nvar float lastHigh = na\r\nvar float lastLow = na\r\n\r\n// When a swing high forms\r\nif not na(ph)\r\n    labelText = ""\r\n    labelColor = color.gray\r\n    \r\n    if na(lastHigh)\r\n        labelText := "SH"\r\n        labelColor := color.gray\r\n    else\r\n        if ph > lastHigh\r\n            labelText := "HH"\r\n            labelColor := color.rgb(0, 230, 119, 50)   // bullish strength\r\n        else\r\n            labelText := "LH"\r\n            labelColor := color.rgb(255, 82, 82, 50)    // bearish strength\r\n    \r\n    label.new(bar_index-right, ph, labelText,\r\n       style=label.style_label_down,\r\n       textcolor=color.white,\r\n       color=labelColor, size=size.tiny)\r\n\r\n    lastHigh := ph\r\n\r\n// When a swing low forms\r\nif not na(pl)\r\n    labelText = ""\r\n    labelColor = color.gray\r\n    \r\n    if na(lastLow)\r\n        labelText := "SL"\r\n        labelColor := color.gray\r\n    else\r\n        if pl > lastLow\r\n            labelText := "HL"\r\n            labelColor := color.rgb(0, 230, 119, 50)   // bullish support\r\n        else\r\n            labelText := "LL"\r\n            labelColor := color.rgb(136, 14, 79, 50) // bearish weakness\r\n    \r\n    label.new(bar_index-right, pl, labelText,\r\n       style=label.style_label_up,\r\n       textcolor=color.white,\r\n       color=labelColor, size=size.tiny)\r\n\r\n    lastLow := pl\r\n\r\nvar table legend = table.new(position.bottom_right, 2, 6, border_width=1)\r\n\r\nif barstate.islast and showInfo\r\n    table.cell(legend, 0, 0, "HH", text_color=color.white, bgcolor=color.green)\r\n    table.cell(legend, 1, 0, "Higher High\\nBull continuation", text_color=color.white, bgcolor=color.green)\r\n\r\n    table.cell(legend, 0, 1, "HL", text_color=color.white, bgcolor=color.green)\r\n    table.cell(legend, 1, 1, "Higher Low\\nBull continuation", text_color=color.white, bgcolor=color.green)\r\n\r\n    table.cell(legend, 0, 2, "LH", text_color=color.white, bgcolor=color.red)\r\n    table.cell(legend, 1, 2, "Lower High\\nBear continuation", text_color=color.white, bgcolor=color.red)\r\n\r\n    table.cell(legend, 0, 3, "LL", text_color=color.white, bgcolor=color.maroon)\r\n    table.cell(legend, 1, 3, "Lower Low\\nBear continuation", text_color=color.white, bgcolor=color.red)\r\n\r\n    table.cell(legend, 0, 4, "Rule", text_color=color.white, bgcolor=color.gray)\r\n    table.cell(legend, 1, 4, "Bull: HL→Long | Bear: LH→Short\\nExit on opposite structure", text_color=color.white, bgcolor=color.gray)\r\n\r\n    table.cell(legend, 0, 5, "SL", text_color=color.white, bgcolor=color.gray)\r\n    table.cell(legend, 1, 5, "PUT → SL above LH\\nCALL → SL below HL",text_color=color.white, bgcolor=color.black)\r\n'
[CAPTURE 1] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © RajashekharRangappa\r\n\r\n//@version=6\r\nindicator("Market Structure HH HL LH LL", overlay = true)\r\n\r\n// Pivot settings\r\nleft = input.int(4, "Left Bars")\r\nright = input.int(4, "Right Bars")\r\nshowInfo = input.bool(true, "Show Information: On/Off")\r\n\r\nph = ta.pivothigh(high, left, right)\r\npl = ta.pivotlow(low, left, right)\r\n\r\nvar float lastHigh = na\r\nvar float lastLow = na\r\n\r\n// When a swing high forms\r\nif not na(ph)\r\n    labelText = ""\r\n    labelColor = color.gray\r\n    \r\n    if na(lastHigh)\r\n        labelText := "SH"\r\n        labelColor := color.gray\r\n    else\r\n        if ph > lastHigh\r\n            labelText := "HH"\r\n            labelColor := color.rgb(0, 230, 119, 50)   // bullish strength\r\n        else\r\n            labelText := "LH"\r\n            labelColor := color.rgb(255, 82, 82, 50)    // bearish strength\r\n    \r\n    label.new(bar_index-right, ph, labelText,\r\n       style=label.style_label_down,\r\n       textcolor=color.white,\r\n       color=labelColor, size=size.tiny)\r\n\r\n    lastHigh := ph\r\n\r\n// When a swing low forms\r\nif not na(pl)\r\n    labelText = ""\r\n    labelColor = color.gray\r\n    \r\n    if na(lastLow)\r\n        labelText := "SL"\r\n        labelColor := color.gray\r\n    else\r\n        if pl > lastLow\r\n            labelText := "HL"\r\n            labelColor := color.rgb(0, 230, 119, 50)   // bullish support\r\n        else\r\n            labelText := "LL"\r\n            labelColor := color.rgb(136, 14, 79, 50) // bearish weakness\r\n    \r\n    label.new(bar_index-right, pl, labelText,\r\n       style=label.style_label_up,\r\n       textcolor=color.white,\r\n       color=labelColor, size=size.tiny)\r\n\r\n    lastLow := pl\r\n\r\nvar table legend = table.new(position.bottom_right, 2, 6, border_width=1)\r\n\r\nif barstate.islast and showInfo\r\n    table.cell(legend, 0, 0, "HH", text_color=color.white, bgcolor=color.green)\r\n    table.cell(legend, 1, 0, "Higher High\\nBull continuation", text_color=color.white, bgcolor=color.green)\r\n\r\n    table.cell(legend, 0, 1, "HL", text_color=color.white, bgcolor=color.green)\r\n    table.cell(legend, 1, 1, "Higher Low\\nBull continuation", text_color=color.white, bgcolor=color.green)\r\n\r\n    table.cell(legend, 0, 2, "LH", text_color=color.white, bgcolor=color.red)\r\n    table.cell(legend, 1, 2, "Lower High\\nBear continuation", text_color=color.white, bgcolor=color.red)\r\n\r\n    table.cell(legend, 0, 3, "LL", text_color=color.white, bgcolor=color.maroon)\r\n    table.cell(legend, 1, 3, "Lower Low\\nBear continuation", text_color=color.white, bgcolor=color.red)\r\n\r\n    table.cell(legend, 0, 4, "Rule", text_color=color.white, bgcolor=color.gray)\r\n    table.cell(legend, 1, 4, "Bull: HL→Long | Bear: LH→Short\\nExit on opposite structure", text_color=color.white, bgcolor=color.gray)\r\n\r\n    table.cell(legend, 0, 5, "SL", text_color=color.white, bgcolor=color.gray)\r\n    table.cell(legend, 1, 5, "PUT → SL above LH\\nCALL → SL below HL",text_color=color.white, bgcolor=color.black)\r\n'
[CAPTURE 2] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © RajashekharRangappa\r\n\r\n//@version=6\r\nindicator("Market Structure HH HL LH LL", overlay = true)\r\n\r\n// Pivot settings\r\nleft = input.int(4, "Left Bars")\r\nright = input.int(4, "Right Bars")\r\nshowInfo = input.bool(true, "Show Information: On/Off")\r\n\r\nph = ta.pivothigh(high, left, right)\r\npl = ta.pivotlow(low, left, right)\r\n\r\nvar float lastHigh = na\r\nvar float lastLow = na\r\n\r\n// When a swing high forms\r\nif not na(ph)\r\n    labelText = ""\r\n    labelColor = color.gray\r\n    \r\n    if na(lastHigh)\r\n        labelText := "SH"\r\n        labelColor := color.gray\r\n    else\r\n        if ph > lastHigh\r\n            labelText := "HH"\r\n            labelColor := color.rgb(0, 230, 119, 50)   // bullish strength\r\n        else\r\n            labelText := "LH"\r\n            labelColor := color.rgb(255, 82, 82, 50)    // bearish strength\r\n    \r\n    label.new(bar_index-right, ph, labelText,\r\n       style=label.style_label_down,\r\n       textcolor=color.white,\r\n       color=labelColor, size=size.tiny)\r\n\r\n    lastHigh := ph\r\n\r\n// When a swing low forms\r\nif not na(pl)\r\n    labelText = ""\r\n    labelColor = color.gray\r\n    \r\n    if na(lastLow)\r\n        labelText := "SL"\r\n        labelColor := color.gray\r\n    else\r\n        if pl > lastLow\r\n            labelText := "HL"\r\n            labelColor := color.rgb(0, 230, 119, 50)   // bullish support\r\n        else\r\n            labelText := "LL"\r\n            labelColor := color.rgb(136, 14, 79, 50) // bearish weakness\r\n    \r\n    label.new(bar_index-right, pl, labelText,\r\n       style=label.style_label_up,\r\n       textcolor=color.white,\r\n       color=labelColor, size=size.tiny)\r\n\r\n    lastLow := pl\r\n\r\nvar table legend = table.new(position.bottom_right, 2, 6, border_width=1)\r\n\r\nif barstate.islast and showInfo\r\n    table.cell(legend, 0, 0, "HH", text_color=color.white, bgcolor=color.green)\r\n    table.cell(legend, 1, 0, "Higher High\\nBull continuation", text_color=color.white, bgcolor=color.green)\r\n\r\n    table.cell(legend, 0, 1, "HL", text_color=color.white, bgcolor=color.green)\r\n    table.cell(legend, 1, 1, "Higher Low\\nBull continuation", text_color=color.white, bgcolor=color.green)\r\n\r\n    table.cell(legend, 0, 2, "LH", text_color=color.white, bgcolor=color.red)\r\n    table.cell(legend, 1, 2, "Lower High\\nBear continuation", text_color=color.white, bgcolor=color.red)\r\n\r\n    table.cell(legend, 0, 3, "LL", text_color=color.white, bgcolor=color.maroon)\r\n    table.cell(legend, 1, 3, "Lower Low\\nBear continuation", text_color=color.white, bgcolor=color.red)\r\n\r\n    table.cell(legend, 0, 4, "Rule", text_color=color.white, bgcolor=color.gray)\r\n    table.cell(legend, 1, 4, "Bull: HL→Long | Bear: LH→Short\\nExit on opposite structure", text_color=color.white, bgcolor=color.gray)\r\n\r\n    table.cell(legend, 0, 5, "SL", text_color=color.white, bgcolor=color.gray)\r\n    table.cell(legend, 1, 5, "PUT → SL above LH\\nCALL → SL below HL",text_color=color.white, bgcolor=color.black)\r\n'
[DEBUG] save_script called: script_id=e9HAPhVq title=Market Structure HH HL LH LL category=e9HAPhVq force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\e9HAPhVq_Market_Structure_HH_HL_LH_LL.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\e9HAPhVq_Market_Structure_HH_HL_LH_LL.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 05:48:27 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 05:48:27 GMT' as: 2026-02-09T05:48:27+00:00
[DEBUG] Exact published date for header: 2026-02-09T05:48:27+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/I7Wh8tGl-KSCP-Dist25/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\r\nindicator("KSCP Dist25 Clean + Readable Table (5/25/75 + ATR)", overlay=false, max_labels_count=50)\r\n\r\n// ===== Inputs =====\r\ntfBase      = input.timeframe("D", "基準TF（Dist/レジーム）")\r\nlen5        = input.int(5,  "SMA短期", minval=1)\r\nlen25       = input.int(25, "SMA中期（基準線）", minval=1)\r\nlen75       = input.int(75, "SMA長期", minval=1)\r\natrLen      = input.int(14, "ATR", minval=1)\r\nslopeLB     = input.int(5,  "SMA25傾き（差分）Lookback", minval=1)\r\n\r\nbuyLo       = input.float(0.0, "押し目ゾーン下限（Dist）", step=0.1)\r\nbuyHi       = input.float(0.6, "押し目ゾーン上限（Dist）", step=0.1)\r\nchaseTh     = input.float(1.0, "追いかけ禁止（Dist >）", step=0.1)\r\nknifeTh     = input.float(-0.3,"落ちナイフ警戒（Dist <）", step=0.1)\r\n\r\nrangeBand   = input.float(0.003, "レンジ判定（SMA25とSMA75の乖離率）", step=0.001)\r\n\r\nshowTable   = input.bool(true, "テーブル表示")\r\ntablePos    = input.string("Top Right", "テーブル位置", options=["Top Right","Top Left","Bottom Right","Bottom Left"])\r\nenableAlerts = input.bool(true, "アラートを有効化")\r\n\r\n// ===== Helpers =====\r\npos =\r\n     tablePos == "Top Right"    ? position.top_right :\r\n     tablePos == "Top Left"     ? position.top_left :\r\n     tablePos == "Bottom Right" ? position.bottom_right :\r\n                                 position.bottom_left\r\n\r\n// ===== Base TF series (security) =====\r\ncBase   = request.security(syminfo.tickerid, tfBase, close)\r\natrBase = request.security(syminfo.tickerid, tfBase, ta.atr(atrLen))\r\nsma5    = request.security(syminfo.tickerid, tfBase, ta.sma(close, len5))\r\nsma25   = request.security(syminfo.tickerid, tfBase, ta.sma(close, len25))\r\nsma75   = request.security(syminfo.tickerid, tfBase, ta.sma(close, len75))\r\nslope25 = request.security(syminfo.tickerid, tfBase, ta.sma(close, len25) - ta.sma(close, len25)[slopeLB])\r\n\r\ndist25  = (cBase - sma25) / atrBase\r\n\r\n// ===== Dist25 text (± / 2 decimals fixed) =====\r\n// -0.00 対策：丸め後の値で符号判定\r\ndist25R   = math.round(dist25 * 100.0) / 100.0\r\ndist25Txt = na(dist25R) ? "na" : (dist25R > 0 ? "+" : "") + str.tostring(dist25R, "0.00")\r\n\r\n// ===== Regime =====\r\npoStrong  = sma5 > sma25 and sma25 > sma75\r\nsep       = math.abs(sma25 - sma75) / sma75\r\nisRange   = sep <= rangeBand\r\nriskOn    = not isRange and (sma25 > sma75) and (slope25 > 0)\r\nriskOff   = not isRange and (sma25 < sma75) and (slope25 < 0)\r\n\r\nregimeTxt = isRange ? "RANGE" : (riskOn ? "RISK-ON" : (riskOff ? "RISK-OFF" : "MIXED"))\r\nregimeCol = isRange ? color.new(color.gray, 0) : (riskOn ? color.new(color.green, 0) : (riskOff ? color.new(color.red, 0) : color.new(color.yellow, 0)))\r\n\r\n// ===== Zones =====\r\ninBuyZone = dist25 >= buyLo and dist25 <= buyHi\r\ninChase   = dist25 > chaseTh\r\ninKnife   = dist25 < knifeTh\r\n\r\nzoneTxt = inBuyZone ? "BUY ZONE" : (inChase ? "CHASE NO" : (inKnife ? "KNIFE" : "NEUTRAL"))\r\nzoneCol = inBuyZone ? color.new(color.green, 40) : (inChase ? color.new(color.red, 40) : (inKnife ? color.new(color.orange, 40) : color.new(color.gray, 70)))\r\n\r\n// ===== Plot (Clean) =====\r\nplot(dist25, "Dist25 = (Close - SMA25) / ATR14", linewidth=2)\r\n\r\nhline(0.0,     "0.0",   linestyle=hline.style_dotted)\r\nhline(chaseTh, "CHASE", linestyle=hline.style_dotted)\r\nhline(knifeTh, "KNIFE", linestyle=hline.style_dotted)\r\n\r\n// Buy-zone fill only（背景多重はしない）\r\npLo = plot(buyLo, "BuyLo", display=display.none)\r\npHi = plot(buyHi, "BuyHi", display=display.none)\r\nfill(pLo, pHi, color=color.new(color.green, 88), title="Buy Zone")\r\n\r\n// ===== Table (Readable 2 x 5) =====\r\nvar table t = table.new(pos, 2, 5)\r\nif showTable and barstate.islast\r\n    baseBg = color.new(color.black, 0)\r\n    txtCol = color.white\r\n\r\n    table.cell(t, 0, 0, "Base TF", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 0, tfBase,   text_color=txtCol, bgcolor=baseBg)\r\n\r\n    table.cell(t, 0, 1, "Regime", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 1, regimeTxt, text_color=txtCol, bgcolor=regimeCol)\r\n\r\n    table.cell(t, 0, 2, "PO 5>25>75", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 2, poStrong ? "YES" : "NO", text_color=txtCol, bgcolor=poStrong ? color.new(color.green, 40) : color.new(color.gray, 70))\r\n\r\n    table.cell(t, 0, 3, "Dist25", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 3, dist25Txt, text_color=txtCol, bgcolor=baseBg)\r\n\r\n    table.cell(t, 0, 4, "Zone", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 4, zoneTxt, text_color=txtCol, bgcolor=zoneCol)\r\n\r\n// ===== Alerts (Optional) =====\r\nenterBuyZone  = inBuyZone and not (dist25[1] >= buyLo and dist25[1] <= buyHi)\r\nenterChase    = inChase and not (dist25[1] > chaseTh)\r\nregimeChange  = regimeTxt != regimeTxt[1]\r\n\r\nalertcondition(enableAlerts and enterBuyZone, "Enter Buy Zone", "Dist25 entered BUY ZONE (0.0~0.6). Pullback long watch.")\r\nalertcondition(enableAlerts and enterChase,   "Enter Chase Zone", "Dist25 > 1.0 (CHASE NO). Avoid new longs / consider trimming or hedging.")\r\nalertcondition(enableAlerts and regimeChange, "Regime Change", "Regime changed on base timeframe.")\r\n'
[CAPTURE 1] '//@version=5\r\nindicator("KSCP Dist25 Clean + Readable Table (5/25/75 + ATR)", overlay=false, max_labels_count=50)\r\n\r\n// ===== Inputs =====\r\ntfBase      = input.timeframe("D", "基準TF（Dist/レジーム）")\r\nlen5        = input.int(5,  "SMA短期", minval=1)\r\nlen25       = input.int(25, "SMA中期（基準線）", minval=1)\r\nlen75       = input.int(75, "SMA長期", minval=1)\r\natrLen      = input.int(14, "ATR", minval=1)\r\nslopeLB     = input.int(5,  "SMA25傾き（差分）Lookback", minval=1)\r\n\r\nbuyLo       = input.float(0.0, "押し目ゾーン下限（Dist）", step=0.1)\r\nbuyHi       = input.float(0.6, "押し目ゾーン上限（Dist）", step=0.1)\r\nchaseTh     = input.float(1.0, "追いかけ禁止（Dist >）", step=0.1)\r\nknifeTh     = input.float(-0.3,"落ちナイフ警戒（Dist <）", step=0.1)\r\n\r\nrangeBand   = input.float(0.003, "レンジ判定（SMA25とSMA75の乖離率）", step=0.001)\r\n\r\nshowTable   = input.bool(true, "テーブル表示")\r\ntablePos    = input.string("Top Right", "テーブル位置", options=["Top Right","Top Left","Bottom Right","Bottom Left"])\r\nenableAlerts = input.bool(true, "アラートを有効化")\r\n\r\n// ===== Helpers =====\r\npos =\r\n     tablePos == "Top Right"    ? position.top_right :\r\n     tablePos == "Top Left"     ? position.top_left :\r\n     tablePos == "Bottom Right" ? position.bottom_right :\r\n                                 position.bottom_left\r\n\r\n// ===== Base TF series (security) =====\r\ncBase   = request.security(syminfo.tickerid, tfBase, close)\r\natrBase = request.security(syminfo.tickerid, tfBase, ta.atr(atrLen))\r\nsma5    = request.security(syminfo.tickerid, tfBase, ta.sma(close, len5))\r\nsma25   = request.security(syminfo.tickerid, tfBase, ta.sma(close, len25))\r\nsma75   = request.security(syminfo.tickerid, tfBase, ta.sma(close, len75))\r\nslope25 = request.security(syminfo.tickerid, tfBase, ta.sma(close, len25) - ta.sma(close, len25)[slopeLB])\r\n\r\ndist25  = (cBase - sma25) / atrBase\r\n\r\n// ===== Dist25 text (± / 2 decimals fixed) =====\r\n// -0.00 対策：丸め後の値で符号判定\r\ndist25R   = math.round(dist25 * 100.0) / 100.0\r\ndist25Txt = na(dist25R) ? "na" : (dist25R > 0 ? "+" : "") + str.tostring(dist25R, "0.00")\r\n\r\n// ===== Regime =====\r\npoStrong  = sma5 > sma25 and sma25 > sma75\r\nsep       = math.abs(sma25 - sma75) / sma75\r\nisRange   = sep <= rangeBand\r\nriskOn    = not isRange and (sma25 > sma75) and (slope25 > 0)\r\nriskOff   = not isRange and (sma25 < sma75) and (slope25 < 0)\r\n\r\nregimeTxt = isRange ? "RANGE" : (riskOn ? "RISK-ON" : (riskOff ? "RISK-OFF" : "MIXED"))\r\nregimeCol = isRange ? color.new(color.gray, 0) : (riskOn ? color.new(color.green, 0) : (riskOff ? color.new(color.red, 0) : color.new(color.yellow, 0)))\r\n\r\n// ===== Zones =====\r\ninBuyZone = dist25 >= buyLo and dist25 <= buyHi\r\ninChase   = dist25 > chaseTh\r\ninKnife   = dist25 < knifeTh\r\n\r\nzoneTxt = inBuyZone ? "BUY ZONE" : (inChase ? "CHASE NO" : (inKnife ? "KNIFE" : "NEUTRAL"))\r\nzoneCol = inBuyZone ? color.new(color.green, 40) : (inChase ? color.new(color.red, 40) : (inKnife ? color.new(color.orange, 40) : color.new(color.gray, 70)))\r\n\r\n// ===== Plot (Clean) =====\r\nplot(dist25, "Dist25 = (Close - SMA25) / ATR14", linewidth=2)\r\n\r\nhline(0.0,     "0.0",   linestyle=hline.style_dotted)\r\nhline(chaseTh, "CHASE", linestyle=hline.style_dotted)\r\nhline(knifeTh, "KNIFE", linestyle=hline.style_dotted)\r\n\r\n// Buy-zone fill only（背景多重はしない）\r\npLo = plot(buyLo, "BuyLo", display=display.none)\r\npHi = plot(buyHi, "BuyHi", display=display.none)\r\nfill(pLo, pHi, color=color.new(color.green, 88), title="Buy Zone")\r\n\r\n// ===== Table (Readable 2 x 5) =====\r\nvar table t = table.new(pos, 2, 5)\r\nif showTable and barstate.islast\r\n    baseBg = color.new(color.black, 0)\r\n    txtCol = color.white\r\n\r\n    table.cell(t, 0, 0, "Base TF", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 0, tfBase,   text_color=txtCol, bgcolor=baseBg)\r\n\r\n    table.cell(t, 0, 1, "Regime", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 1, regimeTxt, text_color=txtCol, bgcolor=regimeCol)\r\n\r\n    table.cell(t, 0, 2, "PO 5>25>75", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 2, poStrong ? "YES" : "NO", text_color=txtCol, bgcolor=poStrong ? color.new(color.green, 40) : color.new(color.gray, 70))\r\n\r\n    table.cell(t, 0, 3, "Dist25", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 3, dist25Txt, text_color=txtCol, bgcolor=baseBg)\r\n\r\n    table.cell(t, 0, 4, "Zone", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 4, zoneTxt, text_color=txtCol, bgcolor=zoneCol)\r\n\r\n// ===== Alerts (Optional) =====\r\nenterBuyZone  = inBuyZone and not (dist25[1] >= buyLo and dist25[1] <= buyHi)\r\nenterChase    = inChase and not (dist25[1] > chaseTh)\r\nregimeChange  = regimeTxt != regimeTxt[1]\r\n\r\nalertcondition(enableAlerts and enterBuyZone, "Enter Buy Zone", "Dist25 entered BUY ZONE (0.0~0.6). Pullback long watch.")\r\nalertcondition(enableAlerts and enterChase,   "Enter Chase Zone", "Dist25 > 1.0 (CHASE NO). Avoid new longs / consider trimming or hedging.")\r\nalertcondition(enableAlerts and regimeChange, "Regime Change", "Regime changed on base timeframe.")\r\n'
[CAPTURE 2] '//@version=5\r\nindicator("KSCP Dist25 Clean + Readable Table (5/25/75 + ATR)", overlay=false, max_labels_count=50)\r\n\r\n// ===== Inputs =====\r\ntfBase      = input.timeframe("D", "基準TF（Dist/レジーム）")\r\nlen5        = input.int(5,  "SMA短期", minval=1)\r\nlen25       = input.int(25, "SMA中期（基準線）", minval=1)\r\nlen75       = input.int(75, "SMA長期", minval=1)\r\natrLen      = input.int(14, "ATR", minval=1)\r\nslopeLB     = input.int(5,  "SMA25傾き（差分）Lookback", minval=1)\r\n\r\nbuyLo       = input.float(0.0, "押し目ゾーン下限（Dist）", step=0.1)\r\nbuyHi       = input.float(0.6, "押し目ゾーン上限（Dist）", step=0.1)\r\nchaseTh     = input.float(1.0, "追いかけ禁止（Dist >）", step=0.1)\r\nknifeTh     = input.float(-0.3,"落ちナイフ警戒（Dist <）", step=0.1)\r\n\r\nrangeBand   = input.float(0.003, "レンジ判定（SMA25とSMA75の乖離率）", step=0.001)\r\n\r\nshowTable   = input.bool(true, "テーブル表示")\r\ntablePos    = input.string("Top Right", "テーブル位置", options=["Top Right","Top Left","Bottom Right","Bottom Left"])\r\nenableAlerts = input.bool(true, "アラートを有効化")\r\n\r\n// ===== Helpers =====\r\npos =\r\n     tablePos == "Top Right"    ? position.top_right :\r\n     tablePos == "Top Left"     ? position.top_left :\r\n     tablePos == "Bottom Right" ? position.bottom_right :\r\n                                 position.bottom_left\r\n\r\n// ===== Base TF series (security) =====\r\ncBase   = request.security(syminfo.tickerid, tfBase, close)\r\natrBase = request.security(syminfo.tickerid, tfBase, ta.atr(atrLen))\r\nsma5    = request.security(syminfo.tickerid, tfBase, ta.sma(close, len5))\r\nsma25   = request.security(syminfo.tickerid, tfBase, ta.sma(close, len25))\r\nsma75   = request.security(syminfo.tickerid, tfBase, ta.sma(close, len75))\r\nslope25 = request.security(syminfo.tickerid, tfBase, ta.sma(close, len25) - ta.sma(close, len25)[slopeLB])\r\n\r\ndist25  = (cBase - sma25) / atrBase\r\n\r\n// ===== Dist25 text (± / 2 decimals fixed) =====\r\n// -0.00 対策：丸め後の値で符号判定\r\ndist25R   = math.round(dist25 * 100.0) / 100.0\r\ndist25Txt = na(dist25R) ? "na" : (dist25R > 0 ? "+" : "") + str.tostring(dist25R, "0.00")\r\n\r\n// ===== Regime =====\r\npoStrong  = sma5 > sma25 and sma25 > sma75\r\nsep       = math.abs(sma25 - sma75) / sma75\r\nisRange   = sep <= rangeBand\r\nriskOn    = not isRange and (sma25 > sma75) and (slope25 > 0)\r\nriskOff   = not isRange and (sma25 < sma75) and (slope25 < 0)\r\n\r\nregimeTxt = isRange ? "RANGE" : (riskOn ? "RISK-ON" : (riskOff ? "RISK-OFF" : "MIXED"))\r\nregimeCol = isRange ? color.new(color.gray, 0) : (riskOn ? color.new(color.green, 0) : (riskOff ? color.new(color.red, 0) : color.new(color.yellow, 0)))\r\n\r\n// ===== Zones =====\r\ninBuyZone = dist25 >= buyLo and dist25 <= buyHi\r\ninChase   = dist25 > chaseTh\r\ninKnife   = dist25 < knifeTh\r\n\r\nzoneTxt = inBuyZone ? "BUY ZONE" : (inChase ? "CHASE NO" : (inKnife ? "KNIFE" : "NEUTRAL"))\r\nzoneCol = inBuyZone ? color.new(color.green, 40) : (inChase ? color.new(color.red, 40) : (inKnife ? color.new(color.orange, 40) : color.new(color.gray, 70)))\r\n\r\n// ===== Plot (Clean) =====\r\nplot(dist25, "Dist25 = (Close - SMA25) / ATR14", linewidth=2)\r\n\r\nhline(0.0,     "0.0",   linestyle=hline.style_dotted)\r\nhline(chaseTh, "CHASE", linestyle=hline.style_dotted)\r\nhline(knifeTh, "KNIFE", linestyle=hline.style_dotted)\r\n\r\n// Buy-zone fill only（背景多重はしない）\r\npLo = plot(buyLo, "BuyLo", display=display.none)\r\npHi = plot(buyHi, "BuyHi", display=display.none)\r\nfill(pLo, pHi, color=color.new(color.green, 88), title="Buy Zone")\r\n\r\n// ===== Table (Readable 2 x 5) =====\r\nvar table t = table.new(pos, 2, 5)\r\nif showTable and barstate.islast\r\n    baseBg = color.new(color.black, 0)\r\n    txtCol = color.white\r\n\r\n    table.cell(t, 0, 0, "Base TF", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 0, tfBase,   text_color=txtCol, bgcolor=baseBg)\r\n\r\n    table.cell(t, 0, 1, "Regime", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 1, regimeTxt, text_color=txtCol, bgcolor=regimeCol)\r\n\r\n    table.cell(t, 0, 2, "PO 5>25>75", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 2, poStrong ? "YES" : "NO", text_color=txtCol, bgcolor=poStrong ? color.new(color.green, 40) : color.new(color.gray, 70))\r\n\r\n    table.cell(t, 0, 3, "Dist25", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 3, dist25Txt, text_color=txtCol, bgcolor=baseBg)\r\n\r\n    table.cell(t, 0, 4, "Zone", text_color=txtCol, bgcolor=baseBg)\r\n    table.cell(t, 1, 4, zoneTxt, text_color=txtCol, bgcolor=zoneCol)\r\n\r\n// ===== Alerts (Optional) =====\r\nenterBuyZone  = inBuyZone and not (dist25[1] >= buyLo and dist25[1] <= buyHi)\r\nenterChase    = inChase and not (dist25[1] > chaseTh)\r\nregimeChange  = regimeTxt != regimeTxt[1]\r\n\r\nalertcondition(enableAlerts and enterBuyZone, "Enter Buy Zone", "Dist25 entered BUY ZONE (0.0~0.6). Pullback long watch.")\r\nalertcondition(enableAlerts and enterChase,   "Enter Chase Zone", "Dist25 > 1.0 (CHASE NO). Avoid new longs / consider trimming or hedging.")\r\nalertcondition(enableAlerts and regimeChange, "Regime Change", "Regime changed on base timeframe.")\r\n'
[DEBUG] save_script called: script_id=I7Wh8tGl title=KSCP Dist25 category=I7Wh8tGl force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\I7Wh8tGl_KSCP_Dist25.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\I7Wh8tGl_KSCP_Dist25.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 05:30:09 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 05:30:09 GMT' as: 2026-02-09T05:30:09+00:00
[DEBUG] Exact published date for header: 2026-02-09T05:30:09+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/YB39NHms-Daily-Range-Risk-Filter-by-nq-rew1nd/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator("Daily Range Risk Filter", overlay=true)\n// ═══════════════════════════════════════════════════════════════════════════════\n// INPUTS\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range calculation mode\nuseAutoRange = input.bool(true, "Use Built-In VXN Calculator", group="Core Settings", tooltip="ON = Automatically calculates expected range at 16:45 NY using NQ close + VXN close\\nOFF = Use manual input below")\nmanualExpectedRange = input.float(300.0, "Manual Expected Range (points)", minval=1.0, group="Core Settings", tooltip="Only used when Built-In Calculator is OFF")\nrangeTolerance = input.float(50.0, "Range Buffer (±points)", minval=0.0, group="Core Settings", tooltip="Your typical ±50 point buffer (e.g., 300 → 250-350 range)")\n// Auto-calculation settings\nvxnSymbol = input.string("VXN", "VXN Symbol", group="Calculator Settings", tooltip="CBOE NASDAQ Volatility Index symbol")\nvolatilityMultiplier = input.float(1.0, "Calibration Multiplier", minval=0.1, maxval=5.0, step=0.1, group="Calculator Settings", tooltip="Adjust if calculated ranges are consistently too high/low\\n1.0 = standard, 1.2 = +20%, 0.8 = -20%")\natrPeriod = input.int(14, "ATR Period (Fallback)", minval=1, group="Calculator Settings", tooltip="Used if VXN data unavailable")\n// Probability thresholds\ngreenThreshold = input.float(40.0, "Green Threshold (% used)", minval=0.0, maxval=100.0, group="Visual Thresholds")\nyellowThreshold = input.float(70.0, "Yellow Threshold (% used)", minval=0.0, maxval=100.0, group="Visual Thresholds")\n// Session analysis\nenableSessions = input.bool(true, "Enable Session Analysis", group="Advanced Features")\nshowSessionLabels = input.bool(true, "Show Session Labels", group="Advanced Features")\n// Empirical bins\nenableBins = input.bool(false, "Enable Empirical Probability Bins", group="Advanced Features")\nshowBinTable = input.bool(false, "Show Bin Table", group="Advanced Features")\n// Alerts\nenableAlerts = input.bool(true, "Enable Alerts", group="Alerts")\nalertThreshold = input.float(20.0, "Alert Threshold (% remaining)", minval=0.0, maxval=100.0, group="Alerts")\n// Label settings\nshowLabel = input.bool(true, "Show Live Label", group="Display")\nlabelSize = input.string("normal", "Label Size", options=["tiny", "small", "normal", "large"], group="Display")\n// Enhanced features\nshowRangeZones = input.bool(true, "Show Range Expansion Zones", group="Enhanced Features", tooltip="Plots horizontal zones showing 25%, 50%, 75% range levels")\nshowMomentum = input.bool(true, "Show Range Momentum", group="Enhanced Features", tooltip="Displays rate of range consumption")\nshowVolRegime = input.bool(true, "Show Volatility Regime", group="Enhanced Features", tooltip="Low/Medium/High volatility classification")\nshowTimeRisk = input.bool(true, "Show Time-of-Day Risk", group="Enhanced Features", tooltip="Risk level based on current session and time")\n// ═══════════════════════════════════════════════════════════════════════════════\n// TIME ZONE & SESSION DETECTION\n// ═══════════════════════════════════════════════════════════════════════════════\n// Get NY time\nnyHour = hour(time, "America/New_York")\nnyMinute = minute(time, "America/New_York")\n// Session boundary: 18:00 NY (futures rollover)\nisNewDay = (nyHour == 18 and nyMinute == 0)\n// Close time for range calculation: 16:45 NY\nisCloseTime = (nyHour == 16 and nyMinute == 45)\n// Session detection\nisAsia = (nyHour >= 18) or (nyHour < 2)\nisLondon = (nyHour >= 2 and nyHour < 8) or (nyHour == 8 and nyMinute < 30)\nisNY = (nyHour == 8 and nyMinute >= 30) or (nyHour > 8 and nyHour < 16)\n// ═══════════════════════════════════════════════════════════════════════════════\n// AUTO RANGE CALCULATION (VXN-BASED CALCULATOR)\n// ═══════════════════════════════════════════════════════════════════════════════\n// This replicates your manual VXN calculator process:\n// 1. At 16:45 NY, capture NQ close and VXN close\n// 2. Calculate expected daily range using volatility formula\n// 3. Apply buffer (±50 points by default)\nvar float calculatedRange = na\nvar float lastClosePrice = na\nvar float lastVXNClose = na\nvar bool rangeCalculatedToday = false\nif useAutoRange\n    // Get VXN data (daily close)\n    vxnClose = request.security(vxnSymbol, "D", close, lookahead=barmerge.lookahead_off)\n    // At 16:45 NY, capture close prices for next day\'s calculation\n    if isCloseTime and not rangeCalculatedToday\n        lastClosePrice := close\n        lastVXNClose := vxnClose\n        rangeCalculatedToday := true\n        // YOUR CALCULATOR FORMULA:\n        // Expected Daily Range = (Price × VXN × 0.01 × √(1/252)) × Adjustment Factor\n        // This converts VXN (annualized implied volatility) to expected daily move\n        if not na(lastVXNClose) and not na(lastClosePrice) and lastVXNClose > 0\n            // Convert VXN to daily volatility\n            // VXN is annual %, so: (VXN / 100) gives decimal, then × √(1/252) for daily\n            dailyVolPct = (lastVXNClose / 100.0) * math.sqrt(1.0 / 252.0)\n            // Expected daily range = price × daily volatility %\n            baseRange = lastClosePrice * dailyVolPct\n            // Apply multiplier for calibration (default 1.0)\n            calculatedRange := baseRange * volatilityMultiplier\n    // Reset flag at new day\n    if isNewDay\n        rangeCalculatedToday := false\n// Fallback ATR calculation (extracted to global scope for consistency)\natrValue = ta.atr(atrPeriod)\nfallbackRange = atrValue * 2.5 * volatilityMultiplier\n// Apply fallback if needed\nif useAutoRange and (na(calculatedRange) or calculatedRange <= 0)\n    calculatedRange := fallbackRange\n// Final expected range (manual or auto)\nexpectedRange = useAutoRange and not na(calculatedRange) ? calculatedRange : manualExpectedRange\n// ═══════════════════════════════════════════════════════════════════════════════\n// DAILY RANGE TRACKING (18:00 NY → 17:00 NY)\n// ═══════════════════════════════════════════════════════════════════════════════\nvar float dayHigh = na\nvar float dayLow = na\nvar int dayStartTime = na\n// Reset at new day\nif isNewDay\n    dayHigh := high\n    dayLow := low\n    dayStartTime := time\nelse if not na(dayHigh)\n    dayHigh := math.max(dayHigh, high)\n    dayLow := math.min(dayLow, low)\nelse\n    // Initialize if starting mid-day\n    dayHigh := high\n    dayLow := low\n// Calculate actual range\nactualRange = dayHigh - dayLow\n// ═══════════════════════════════════════════════════════════════════════════════\n// RANGE COMPLETION & PROBABILITY CALCULATION\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range used percentage\nrangeUsed = (actualRange / expectedRange) * 100\n// Remaining probability (conditional probability)\nremainingProb = 100 - rangeUsed\n// Clamp for display\nremainingProbDisplay = math.max(0, remainingProb)\n// ═══════════════════════════════════════════════════════════════════════════════\n// SESSION-SPECIFIC RANGE TRACKING\n// ═══════════════════════════════════════════════════════════════════════════════\nvar float asiaHigh = na\nvar float asiaLow = na\nvar float londonHigh = na\nvar float londonLow = na\nvar float nyHigh = na\nvar float nyLow = na\nvar bool asiaSessionStarted = false\nvar bool londonSessionStarted = false\nvar bool nySessionStarted = false\nif enableSessions\n    // Track Asia session (resets at 18:00)\n    if isAsia\n        if isNewDay or not asiaSessionStarted\n            asiaHigh := high\n            asiaLow := low\n            asiaSessionStarted := true\n        else\n            asiaHigh := math.max(asiaHigh, high)\n            asiaLow := math.min(asiaLow, low)\n    // Track London session (resets at 02:00)\n    if isLondon\n        if (nyHour == 2 and nyMinute == 0) or not londonSessionStarted\n            londonHigh := high\n            londonLow := low\n            londonSessionStarted := true\n        else\n            londonHigh := math.max(londonHigh, high)\n            londonLow := math.min(londonLow, low)\n    // Track NY session (resets at 08:30)\n    if isNY\n        if (nyHour == 8 and nyMinute == 30) or not nySessionStarted\n            nyHigh := high\n            nyLow := low\n            nySessionStarted := true\n        else\n            nyHigh := math.max(nyHigh, high)\n            nyLow := math.min(nyLow, low)\n    // Reset session flags at new day\n    if isNewDay\n        londonSessionStarted := false\n        nySessionStarted := false\n// Calculate session ranges\nasiaRange = not na(asiaHigh) and not na(asiaLow) ? asiaHigh - asiaLow : 0\nlondonRange = not na(londonHigh) and not na(londonLow) ? londonHigh - londonLow : 0\nnyRange = not na(nyHigh) and not na(nyLow) ? nyHigh - nyLow : 0\n// Session contribution to expected range\nasiaContribution = (asiaRange / expectedRange) * 100\nlondonContribution = (londonRange / expectedRange) * 100\nnyContribution = (nyRange / expectedRange) * 100\n// ═══════════════════════════════════════════════════════════════════════════════\n// EMPIRICAL PROBABILITY BINS\n// ═══════════════════════════════════════════════════════════════════════════════\nvar array<int> binCounts = array.new_int(10, 0)\nvar array<int> binExceeded = array.new_int(10, 0)\nvar int totalDays = 0\nif enableBins\n    // At end of day (17:00 NY), categorize outcome\n    if nyHour == 17 and nyMinute == 0\n        int binIndex = math.floor(rangeUsed / 10)\n        if binIndex > 9\n            binIndex := 9\n        // Increment bin count\n        array.set(binCounts, binIndex, array.get(binCounts, binIndex) + 1)\n        // Track if range was exceeded\n        if rangeUsed > 100\n            array.set(binExceeded, binIndex, array.get(binExceeded, binIndex) + 1)\n        totalDays += 1\n// ═══════════════════════════════════════════════════════════════════════════════\n// BACKGROUND HEATMAP\n// ═══════════════════════════════════════════════════════════════════════════════\nbgColor = rangeUsed < greenThreshold ? color.new(color.green, 92) : rangeUsed < yellowThreshold ? color.new(color.yellow, 92) : color.new(color.red, 92)\nbgcolor(bgColor, title="Range Heatmap")\n// ═══════════════════════════════════════════════════════════════════════════════\n// LIVE INFORMATION LABEL\n// ═══════════════════════════════════════════════════════════════════════════════\n// ═══════════════════════════════════════════════════════════════════════════════\n// ENHANCED FEATURES\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range Momentum (rate of range consumption)\nvar float lastRangeUsed = 0.0\nvar int lastRangeTime = 0\nrangeMomentum = 0.0\nif bar_index > 0 and (time - lastRangeTime) > 0\n    timeDiff = (time - lastRangeTime) / 60000.0\n    if timeDiff > 0\n        rangeMomentum := (rangeUsed - lastRangeUsed) / timeDiff\nlastRangeUsed := rangeUsed\nlastRangeTime := time\nmomentumLabel = rangeMomentum > 0.5 ? "🔥 Fast" : rangeMomentum > 0.2 ? "⚡ Medium" : "🐌 Slow"\n// Volatility Regime Detection (ATR calculations extracted to global scope)\natr14 = ta.atr(14)\navgATR50 = ta.sma(atr14, 50)\nvar string volRegime = "Medium"\nif not na(lastVXNClose)\n    volRegime := lastVXNClose < 15 ? "😴 Low Vol" : lastVXNClose < 25 ? "📊 Normal Vol" : "🌋 High Vol"\nelse\n    volRegime := atr14 < avgATR50 * 0.8 ? "😴 Low Vol" : atr14 < avgATR50 * 1.2 ? "📊 Normal Vol" : "🌋 High Vol"\n// Time-of-Day Risk Assessment\ntimeRisk = "Unknown"\nif isAsia\n    timeRisk := rangeUsed < 20 ? "✅ Low Risk" : rangeUsed < 40 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse if isLondon\n    timeRisk := rangeUsed < 50 ? "✅ Low Risk" : rangeUsed < 70 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse if isNY\n    timeRisk := rangeUsed < 60 ? "✅ Low Risk" : rangeUsed < 80 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse\n    timeRisk := "💤 Off Hours"\n// ═══════════════════════════════════════════════════════════════════════════════\n// LIVE INFORMATION TABLE (FIXED TOP-RIGHT POSITION)\n// ═══════════════════════════════════════════════════════════════════════════════\nif showLabel and barstate.islast\n    var table infoTable = table.new(position.top_right, 2, 20, bgcolor=color.new(color.black, 10), border_width=1, border_color=color.gray)\n    calcMode = useAutoRange ? "Calc" : "Manual"\n    // Determine color based on range state\n    tableColor = rangeUsed < greenThreshold ? color.new(color.green, 10) : rangeUsed < yellowThreshold ? color.new(color.yellow, 10) : color.new(color.red, 10)\n    textColor = rangeUsed < greenThreshold ? color.white : rangeUsed < yellowThreshold ? color.black : color.white\n    // Header\n    table.cell(infoTable, 0, 0, "📊 RANGE RISK", text_color=textColor, bgcolor=tableColor, text_size=size.small)\n    table.merge_cells(infoTable, 0, 0, 1, 0)\n    // Core metrics\n    row = 1\n    table.cell(infoTable, 0, row, "Used:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(rangeUsed, "#.#") + "%", text_color=textColor, bgcolor=tableColor, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Prob:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(remainingProbDisplay, "#.#") + "%", text_color=color.white, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Actual:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(actualRange, "#.#"), text_color=color.white, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Expected:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(expectedRange, "#.#"), text_color=color.white, text_size=size.tiny)\n    row += 1\n    // Calculator details if using auto mode\n    if useAutoRange and not na(lastVXNClose) and not na(lastClosePrice)\n        table.cell(infoTable, 0, row, "VXN:", text_color=color.yellow, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(lastVXNClose, "#.#"), text_color=color.yellow, text_size=size.tiny)\n        row += 1\n    // Session info if enabled\n    if enableSessions and showSessionLabels\n        table.cell(infoTable, 0, row, "Asia:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(asiaContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n        table.cell(infoTable, 0, row, "London:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(londonContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n        table.cell(infoTable, 0, row, "NY:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(nyContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n    // Enhanced features (condensed)\n    if showMomentum\n        table.cell(infoTable, 0, row, "Momentum:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, momentumLabel, text_color=color.white, text_size=size.tiny)\n        row += 1\n    if showVolRegime\n        table.cell(infoTable, 0, row, "Vol:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, volRegime, text_color=color.white, text_size=size.tiny)\n        row += 1\n    if showTimeRisk\n        table.cell(infoTable, 0, row, "Risk:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, timeRisk, text_color=color.white, text_size=size.tiny)\n        row += 1\n// ═══════════════════════════════════════════════════════════════════════════════\n// EMPIRICAL BINS TABLE (OPTIONAL)\n// ═══════════════════════════════════════════════════════════════════════════════\nif enableBins and showBinTable and barstate.islast\n    var table binTable = table.new(position.bottom_right, 4, 11, bgcolor=color.new(color.black, 20), border_width=1, border_color=color.gray)\n    // Headers\n    table.cell(binTable, 0, 0, "Range Used", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 1, 0, "Count", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 2, 0, "Exceeded", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 3, 0, "Respect %", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    // Data rows\n    for i = 0 to 9\n        binLabel = str.tostring(i * 10) + "-" + str.tostring((i + 1) * 10) + "%"\n        binCount = array.get(binCounts, i)\n        binExceed = array.get(binExceeded, i)\n        respectRate = binCount > 0 ? ((binCount - binExceed) / binCount) * 100 : 0\n        table.cell(binTable, 0, i + 1, binLabel, text_color=color.white)\n        table.cell(binTable, 1, i + 1, str.tostring(binCount), text_color=color.white)\n        table.cell(binTable, 2, i + 1, str.tostring(binExceed), text_color=color.white)\n        table.cell(binTable, 3, i + 1, str.tostring(respectRate, "#.#") + "%", text_color=color.white)\n// ═══════════════════════════════════════════════════════════════════════════════\n// VISUAL REFERENCE LINES\n// ═══════════════════════════════════════════════════════════════════════════════\n// ═══════════════════════════════════════════════════════════════════════════════\n// RANGE EXPANSION ZONES (FIXED PRICE LEVELS WITH LABELS)\n// ═══════════════════════════════════════════════════════════════════════════════\n// Store previous day\'s levels to avoid redrawing\nvar float prev25Level = na\nvar float prev50Level = na\nvar float prev75Level = na\nvar float prevTopLevel = na\nvar line line25 = na\nvar line line50 = na\nvar line line75 = na\nvar line lineTop = na\nvar label label25 = na\nvar label label50 = na\nvar label label75 = na\nvar label labelTop = na\nif showRangeZones and not na(dayLow) and not na(expectedRange)\n    // Calculate zone levels\n    level25 = dayLow + (expectedRange * 0.25)\n    level50 = dayLow + (expectedRange * 0.50)\n    level75 = dayLow + (expectedRange * 0.75)\n    levelTop = dayLow + expectedRange\n    // Only redraw if levels changed (new day)\n    if level25 != prev25Level or level50 != prev50Level or level75 != prev75Level or levelTop != prevTopLevel\n        // Delete old lines and labels\n        if not na(line25)\n            line.delete(line25)\n            label.delete(label25)\n        if not na(line50)\n            line.delete(line50)\n            label.delete(label50)\n        if not na(line75)\n            line.delete(line75)\n            label.delete(label75)\n        if not na(lineTop)\n            line.delete(lineTop)\n            label.delete(labelTop)\n        // Create new lines at EXACT price levels\n        line25 := line.new(bar_index - 50, level25, bar_index + 500, level25, extend=extend.right, color=color.new(color.green, 60), width=1, style=line.style_dashed)\n        line50 := line.new(bar_index - 50, level50, bar_index + 500, level50, extend=extend.right, color=color.new(color.yellow, 60), width=1, style=line.style_dashed)\n        line75 := line.new(bar_index - 50, level75, bar_index + 500, level75, extend=extend.right, color=color.new(color.orange, 50), width=2, style=line.style_solid)\n        lineTop := line.new(bar_index - 50, levelTop, bar_index + 500, levelTop, extend=extend.right, color=color.new(color.red, 40), width=2, style=line.style_solid)\n        // Create price labels on the right\n        label25 := label.new(bar_index, level25, "25% (" + str.tostring(level25, "#.##") + ")", style=label.style_none, color=color.new(color.green, 100), textcolor=color.green, size=size.tiny, xloc=xloc.bar_index, yloc=yloc.price)\n        label50 := label.new(bar_index, level50, "50% (" + str.tostring(level50, "#.##") + ")", style=label.style_none, color=color.new(color.yellow, 100), textcolor=color.yellow, size=size.tiny, xloc=xloc.bar_index, yloc=yloc.price)\n        label75 := label.new(bar_index, level75, "75% (" + str.tostring(level75, "#.##") + ")", style=label.style_none, color=color.new(color.orange, 100), textcolor=color.orange, size=size.small, xloc=xloc.bar_index, yloc=yloc.price)\n        labelTop := label.new(bar_index, levelTop, "100% (" + str.tostring(levelTop, "#.##") + ")", style=label.style_none, color=color.new(color.red, 100), textcolor=color.red, size=size.small, xloc=xloc.bar_index, yloc=yloc.price)\n        // Store current levels\n        prev25Level := level25\n        prev50Level := level50\n        prev75Level := level75\n        prevTopLevel := levelTop\n// ═══════════════════════════════════════════════════════════════════════════════\n// ALERTS\n// ═══════════════════════════════════════════════════════════════════════════════\n// Alert when probability drops below threshold\nalertCondition = enableAlerts and remainingProb < alertThreshold and remainingProb[1] >= alertThreshold\nif alertCondition\n    alert("⚠️ High Risk: Only " + str.tostring(remainingProbDisplay, "#.#") + "% probability remaining", alert.freq_once_per_bar)\nalertcondition(alertCondition, title="Low Probability Alert", message="⚠️ Range Risk Alert: Only {{plot_0}}% probability remaining")\n// ═══════════════════════════════════════════════════════════════════════════════\n// PLOTS FOR ALERTCONDITION\n// ═══════════════════════════════════════════════════════════════════════════════\nplot(remainingProbDisplay, "Remaining Probability", display=display.none)\nplot(rangeUsed, "Range Used", display=display.none)\nplot(actualRange, "Actual Range", display=display.none)\n'
[CAPTURE 1] '//@version=6\nindicator("Daily Range Risk Filter", overlay=true)\n// ═══════════════════════════════════════════════════════════════════════════════\n// INPUTS\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range calculation mode\nuseAutoRange = input.bool(true, "Use Built-In VXN Calculator", group="Core Settings", tooltip="ON = Automatically calculates expected range at 16:45 NY using NQ close + VXN close\\nOFF = Use manual input below")\nmanualExpectedRange = input.float(300.0, "Manual Expected Range (points)", minval=1.0, group="Core Settings", tooltip="Only used when Built-In Calculator is OFF")\nrangeTolerance = input.float(50.0, "Range Buffer (±points)", minval=0.0, group="Core Settings", tooltip="Your typical ±50 point buffer (e.g., 300 → 250-350 range)")\n// Auto-calculation settings\nvxnSymbol = input.string("VXN", "VXN Symbol", group="Calculator Settings", tooltip="CBOE NASDAQ Volatility Index symbol")\nvolatilityMultiplier = input.float(1.0, "Calibration Multiplier", minval=0.1, maxval=5.0, step=0.1, group="Calculator Settings", tooltip="Adjust if calculated ranges are consistently too high/low\\n1.0 = standard, 1.2 = +20%, 0.8 = -20%")\natrPeriod = input.int(14, "ATR Period (Fallback)", minval=1, group="Calculator Settings", tooltip="Used if VXN data unavailable")\n// Probability thresholds\ngreenThreshold = input.float(40.0, "Green Threshold (% used)", minval=0.0, maxval=100.0, group="Visual Thresholds")\nyellowThreshold = input.float(70.0, "Yellow Threshold (% used)", minval=0.0, maxval=100.0, group="Visual Thresholds")\n// Session analysis\nenableSessions = input.bool(true, "Enable Session Analysis", group="Advanced Features")\nshowSessionLabels = input.bool(true, "Show Session Labels", group="Advanced Features")\n// Empirical bins\nenableBins = input.bool(false, "Enable Empirical Probability Bins", group="Advanced Features")\nshowBinTable = input.bool(false, "Show Bin Table", group="Advanced Features")\n// Alerts\nenableAlerts = input.bool(true, "Enable Alerts", group="Alerts")\nalertThreshold = input.float(20.0, "Alert Threshold (% remaining)", minval=0.0, maxval=100.0, group="Alerts")\n// Label settings\nshowLabel = input.bool(true, "Show Live Label", group="Display")\nlabelSize = input.string("normal", "Label Size", options=["tiny", "small", "normal", "large"], group="Display")\n// Enhanced features\nshowRangeZones = input.bool(true, "Show Range Expansion Zones", group="Enhanced Features", tooltip="Plots horizontal zones showing 25%, 50%, 75% range levels")\nshowMomentum = input.bool(true, "Show Range Momentum", group="Enhanced Features", tooltip="Displays rate of range consumption")\nshowVolRegime = input.bool(true, "Show Volatility Regime", group="Enhanced Features", tooltip="Low/Medium/High volatility classification")\nshowTimeRisk = input.bool(true, "Show Time-of-Day Risk", group="Enhanced Features", tooltip="Risk level based on current session and time")\n// ═══════════════════════════════════════════════════════════════════════════════\n// TIME ZONE & SESSION DETECTION\n// ═══════════════════════════════════════════════════════════════════════════════\n// Get NY time\nnyHour = hour(time, "America/New_York")\nnyMinute = minute(time, "America/New_York")\n// Session boundary: 18:00 NY (futures rollover)\nisNewDay = (nyHour == 18 and nyMinute == 0)\n// Close time for range calculation: 16:45 NY\nisCloseTime = (nyHour == 16 and nyMinute == 45)\n// Session detection\nisAsia = (nyHour >= 18) or (nyHour < 2)\nisLondon = (nyHour >= 2 and nyHour < 8) or (nyHour == 8 and nyMinute < 30)\nisNY = (nyHour == 8 and nyMinute >= 30) or (nyHour > 8 and nyHour < 16)\n// ═══════════════════════════════════════════════════════════════════════════════\n// AUTO RANGE CALCULATION (VXN-BASED CALCULATOR)\n// ═══════════════════════════════════════════════════════════════════════════════\n// This replicates your manual VXN calculator process:\n// 1. At 16:45 NY, capture NQ close and VXN close\n// 2. Calculate expected daily range using volatility formula\n// 3. Apply buffer (±50 points by default)\nvar float calculatedRange = na\nvar float lastClosePrice = na\nvar float lastVXNClose = na\nvar bool rangeCalculatedToday = false\nif useAutoRange\n    // Get VXN data (daily close)\n    vxnClose = request.security(vxnSymbol, "D", close, lookahead=barmerge.lookahead_off)\n    // At 16:45 NY, capture close prices for next day\'s calculation\n    if isCloseTime and not rangeCalculatedToday\n        lastClosePrice := close\n        lastVXNClose := vxnClose\n        rangeCalculatedToday := true\n        // YOUR CALCULATOR FORMULA:\n        // Expected Daily Range = (Price × VXN × 0.01 × √(1/252)) × Adjustment Factor\n        // This converts VXN (annualized implied volatility) to expected daily move\n        if not na(lastVXNClose) and not na(lastClosePrice) and lastVXNClose > 0\n            // Convert VXN to daily volatility\n            // VXN is annual %, so: (VXN / 100) gives decimal, then × √(1/252) for daily\n            dailyVolPct = (lastVXNClose / 100.0) * math.sqrt(1.0 / 252.0)\n            // Expected daily range = price × daily volatility %\n            baseRange = lastClosePrice * dailyVolPct\n            // Apply multiplier for calibration (default 1.0)\n            calculatedRange := baseRange * volatilityMultiplier\n    // Reset flag at new day\n    if isNewDay\n        rangeCalculatedToday := false\n// Fallback ATR calculation (extracted to global scope for consistency)\natrValue = ta.atr(atrPeriod)\nfallbackRange = atrValue * 2.5 * volatilityMultiplier\n// Apply fallback if needed\nif useAutoRange and (na(calculatedRange) or calculatedRange <= 0)\n    calculatedRange := fallbackRange\n// Final expected range (manual or auto)\nexpectedRange = useAutoRange and not na(calculatedRange) ? calculatedRange : manualExpectedRange\n// ═══════════════════════════════════════════════════════════════════════════════\n// DAILY RANGE TRACKING (18:00 NY → 17:00 NY)\n// ═══════════════════════════════════════════════════════════════════════════════\nvar float dayHigh = na\nvar float dayLow = na\nvar int dayStartTime = na\n// Reset at new day\nif isNewDay\n    dayHigh := high\n    dayLow := low\n    dayStartTime := time\nelse if not na(dayHigh)\n    dayHigh := math.max(dayHigh, high)\n    dayLow := math.min(dayLow, low)\nelse\n    // Initialize if starting mid-day\n    dayHigh := high\n    dayLow := low\n// Calculate actual range\nactualRange = dayHigh - dayLow\n// ═══════════════════════════════════════════════════════════════════════════════\n// RANGE COMPLETION & PROBABILITY CALCULATION\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range used percentage\nrangeUsed = (actualRange / expectedRange) * 100\n// Remaining probability (conditional probability)\nremainingProb = 100 - rangeUsed\n// Clamp for display\nremainingProbDisplay = math.max(0, remainingProb)\n// ═══════════════════════════════════════════════════════════════════════════════\n// SESSION-SPECIFIC RANGE TRACKING\n// ═══════════════════════════════════════════════════════════════════════════════\nvar float asiaHigh = na\nvar float asiaLow = na\nvar float londonHigh = na\nvar float londonLow = na\nvar float nyHigh = na\nvar float nyLow = na\nvar bool asiaSessionStarted = false\nvar bool londonSessionStarted = false\nvar bool nySessionStarted = false\nif enableSessions\n    // Track Asia session (resets at 18:00)\n    if isAsia\n        if isNewDay or not asiaSessionStarted\n            asiaHigh := high\n            asiaLow := low\n            asiaSessionStarted := true\n        else\n            asiaHigh := math.max(asiaHigh, high)\n            asiaLow := math.min(asiaLow, low)\n    // Track London session (resets at 02:00)\n    if isLondon\n        if (nyHour == 2 and nyMinute == 0) or not londonSessionStarted\n            londonHigh := high\n            londonLow := low\n            londonSessionStarted := true\n        else\n            londonHigh := math.max(londonHigh, high)\n            londonLow := math.min(londonLow, low)\n    // Track NY session (resets at 08:30)\n    if isNY\n        if (nyHour == 8 and nyMinute == 30) or not nySessionStarted\n            nyHigh := high\n            nyLow := low\n            nySessionStarted := true\n        else\n            nyHigh := math.max(nyHigh, high)\n            nyLow := math.min(nyLow, low)\n    // Reset session flags at new day\n    if isNewDay\n        londonSessionStarted := false\n        nySessionStarted := false\n// Calculate session ranges\nasiaRange = not na(asiaHigh) and not na(asiaLow) ? asiaHigh - asiaLow : 0\nlondonRange = not na(londonHigh) and not na(londonLow) ? londonHigh - londonLow : 0\nnyRange = not na(nyHigh) and not na(nyLow) ? nyHigh - nyLow : 0\n// Session contribution to expected range\nasiaContribution = (asiaRange / expectedRange) * 100\nlondonContribution = (londonRange / expectedRange) * 100\nnyContribution = (nyRange / expectedRange) * 100\n// ═══════════════════════════════════════════════════════════════════════════════\n// EMPIRICAL PROBABILITY BINS\n// ═══════════════════════════════════════════════════════════════════════════════\nvar array<int> binCounts = array.new_int(10, 0)\nvar array<int> binExceeded = array.new_int(10, 0)\nvar int totalDays = 0\nif enableBins\n    // At end of day (17:00 NY), categorize outcome\n    if nyHour == 17 and nyMinute == 0\n        int binIndex = math.floor(rangeUsed / 10)\n        if binIndex > 9\n            binIndex := 9\n        // Increment bin count\n        array.set(binCounts, binIndex, array.get(binCounts, binIndex) + 1)\n        // Track if range was exceeded\n        if rangeUsed > 100\n            array.set(binExceeded, binIndex, array.get(binExceeded, binIndex) + 1)\n        totalDays += 1\n// ═══════════════════════════════════════════════════════════════════════════════\n// BACKGROUND HEATMAP\n// ═══════════════════════════════════════════════════════════════════════════════\nbgColor = rangeUsed < greenThreshold ? color.new(color.green, 92) : rangeUsed < yellowThreshold ? color.new(color.yellow, 92) : color.new(color.red, 92)\nbgcolor(bgColor, title="Range Heatmap")\n// ═══════════════════════════════════════════════════════════════════════════════\n// LIVE INFORMATION LABEL\n// ═══════════════════════════════════════════════════════════════════════════════\n// ═══════════════════════════════════════════════════════════════════════════════\n// ENHANCED FEATURES\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range Momentum (rate of range consumption)\nvar float lastRangeUsed = 0.0\nvar int lastRangeTime = 0\nrangeMomentum = 0.0\nif bar_index > 0 and (time - lastRangeTime) > 0\n    timeDiff = (time - lastRangeTime) / 60000.0\n    if timeDiff > 0\n        rangeMomentum := (rangeUsed - lastRangeUsed) / timeDiff\nlastRangeUsed := rangeUsed\nlastRangeTime := time\nmomentumLabel = rangeMomentum > 0.5 ? "🔥 Fast" : rangeMomentum > 0.2 ? "⚡ Medium" : "🐌 Slow"\n// Volatility Regime Detection (ATR calculations extracted to global scope)\natr14 = ta.atr(14)\navgATR50 = ta.sma(atr14, 50)\nvar string volRegime = "Medium"\nif not na(lastVXNClose)\n    volRegime := lastVXNClose < 15 ? "😴 Low Vol" : lastVXNClose < 25 ? "📊 Normal Vol" : "🌋 High Vol"\nelse\n    volRegime := atr14 < avgATR50 * 0.8 ? "😴 Low Vol" : atr14 < avgATR50 * 1.2 ? "📊 Normal Vol" : "🌋 High Vol"\n// Time-of-Day Risk Assessment\ntimeRisk = "Unknown"\nif isAsia\n    timeRisk := rangeUsed < 20 ? "✅ Low Risk" : rangeUsed < 40 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse if isLondon\n    timeRisk := rangeUsed < 50 ? "✅ Low Risk" : rangeUsed < 70 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse if isNY\n    timeRisk := rangeUsed < 60 ? "✅ Low Risk" : rangeUsed < 80 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse\n    timeRisk := "💤 Off Hours"\n// ═══════════════════════════════════════════════════════════════════════════════\n// LIVE INFORMATION TABLE (FIXED TOP-RIGHT POSITION)\n// ═══════════════════════════════════════════════════════════════════════════════\nif showLabel and barstate.islast\n    var table infoTable = table.new(position.top_right, 2, 20, bgcolor=color.new(color.black, 10), border_width=1, border_color=color.gray)\n    calcMode = useAutoRange ? "Calc" : "Manual"\n    // Determine color based on range state\n    tableColor = rangeUsed < greenThreshold ? color.new(color.green, 10) : rangeUsed < yellowThreshold ? color.new(color.yellow, 10) : color.new(color.red, 10)\n    textColor = rangeUsed < greenThreshold ? color.white : rangeUsed < yellowThreshold ? color.black : color.white\n    // Header\n    table.cell(infoTable, 0, 0, "📊 RANGE RISK", text_color=textColor, bgcolor=tableColor, text_size=size.small)\n    table.merge_cells(infoTable, 0, 0, 1, 0)\n    // Core metrics\n    row = 1\n    table.cell(infoTable, 0, row, "Used:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(rangeUsed, "#.#") + "%", text_color=textColor, bgcolor=tableColor, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Prob:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(remainingProbDisplay, "#.#") + "%", text_color=color.white, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Actual:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(actualRange, "#.#"), text_color=color.white, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Expected:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(expectedRange, "#.#"), text_color=color.white, text_size=size.tiny)\n    row += 1\n    // Calculator details if using auto mode\n    if useAutoRange and not na(lastVXNClose) and not na(lastClosePrice)\n        table.cell(infoTable, 0, row, "VXN:", text_color=color.yellow, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(lastVXNClose, "#.#"), text_color=color.yellow, text_size=size.tiny)\n        row += 1\n    // Session info if enabled\n    if enableSessions and showSessionLabels\n        table.cell(infoTable, 0, row, "Asia:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(asiaContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n        table.cell(infoTable, 0, row, "London:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(londonContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n        table.cell(infoTable, 0, row, "NY:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(nyContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n    // Enhanced features (condensed)\n    if showMomentum\n        table.cell(infoTable, 0, row, "Momentum:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, momentumLabel, text_color=color.white, text_size=size.tiny)\n        row += 1\n    if showVolRegime\n        table.cell(infoTable, 0, row, "Vol:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, volRegime, text_color=color.white, text_size=size.tiny)\n        row += 1\n    if showTimeRisk\n        table.cell(infoTable, 0, row, "Risk:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, timeRisk, text_color=color.white, text_size=size.tiny)\n        row += 1\n// ═══════════════════════════════════════════════════════════════════════════════\n// EMPIRICAL BINS TABLE (OPTIONAL)\n// ═══════════════════════════════════════════════════════════════════════════════\nif enableBins and showBinTable and barstate.islast\n    var table binTable = table.new(position.bottom_right, 4, 11, bgcolor=color.new(color.black, 20), border_width=1, border_color=color.gray)\n    // Headers\n    table.cell(binTable, 0, 0, "Range Used", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 1, 0, "Count", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 2, 0, "Exceeded", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 3, 0, "Respect %", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    // Data rows\n    for i = 0 to 9\n        binLabel = str.tostring(i * 10) + "-" + str.tostring((i + 1) * 10) + "%"\n        binCount = array.get(binCounts, i)\n        binExceed = array.get(binExceeded, i)\n        respectRate = binCount > 0 ? ((binCount - binExceed) / binCount) * 100 : 0\n        table.cell(binTable, 0, i + 1, binLabel, text_color=color.white)\n        table.cell(binTable, 1, i + 1, str.tostring(binCount), text_color=color.white)\n        table.cell(binTable, 2, i + 1, str.tostring(binExceed), text_color=color.white)\n        table.cell(binTable, 3, i + 1, str.tostring(respectRate, "#.#") + "%", text_color=color.white)\n// ═══════════════════════════════════════════════════════════════════════════════\n// VISUAL REFERENCE LINES\n// ═══════════════════════════════════════════════════════════════════════════════\n// ═══════════════════════════════════════════════════════════════════════════════\n// RANGE EXPANSION ZONES (FIXED PRICE LEVELS WITH LABELS)\n// ═══════════════════════════════════════════════════════════════════════════════\n// Store previous day\'s levels to avoid redrawing\nvar float prev25Level = na\nvar float prev50Level = na\nvar float prev75Level = na\nvar float prevTopLevel = na\nvar line line25 = na\nvar line line50 = na\nvar line line75 = na\nvar line lineTop = na\nvar label label25 = na\nvar label label50 = na\nvar label label75 = na\nvar label labelTop = na\nif showRangeZones and not na(dayLow) and not na(expectedRange)\n    // Calculate zone levels\n    level25 = dayLow + (expectedRange * 0.25)\n    level50 = dayLow + (expectedRange * 0.50)\n    level75 = dayLow + (expectedRange * 0.75)\n    levelTop = dayLow + expectedRange\n    // Only redraw if levels changed (new day)\n    if level25 != prev25Level or level50 != prev50Level or level75 != prev75Level or levelTop != prevTopLevel\n        // Delete old lines and labels\n        if not na(line25)\n            line.delete(line25)\n            label.delete(label25)\n        if not na(line50)\n            line.delete(line50)\n            label.delete(label50)\n        if not na(line75)\n            line.delete(line75)\n            label.delete(label75)\n        if not na(lineTop)\n            line.delete(lineTop)\n            label.delete(labelTop)\n        // Create new lines at EXACT price levels\n        line25 := line.new(bar_index - 50, level25, bar_index + 500, level25, extend=extend.right, color=color.new(color.green, 60), width=1, style=line.style_dashed)\n        line50 := line.new(bar_index - 50, level50, bar_index + 500, level50, extend=extend.right, color=color.new(color.yellow, 60), width=1, style=line.style_dashed)\n        line75 := line.new(bar_index - 50, level75, bar_index + 500, level75, extend=extend.right, color=color.new(color.orange, 50), width=2, style=line.style_solid)\n        lineTop := line.new(bar_index - 50, levelTop, bar_index + 500, levelTop, extend=extend.right, color=color.new(color.red, 40), width=2, style=line.style_solid)\n        // Create price labels on the right\n        label25 := label.new(bar_index, level25, "25% (" + str.tostring(level25, "#.##") + ")", style=label.style_none, color=color.new(color.green, 100), textcolor=color.green, size=size.tiny, xloc=xloc.bar_index, yloc=yloc.price)\n        label50 := label.new(bar_index, level50, "50% (" + str.tostring(level50, "#.##") + ")", style=label.style_none, color=color.new(color.yellow, 100), textcolor=color.yellow, size=size.tiny, xloc=xloc.bar_index, yloc=yloc.price)\n        label75 := label.new(bar_index, level75, "75% (" + str.tostring(level75, "#.##") + ")", style=label.style_none, color=color.new(color.orange, 100), textcolor=color.orange, size=size.small, xloc=xloc.bar_index, yloc=yloc.price)\n        labelTop := label.new(bar_index, levelTop, "100% (" + str.tostring(levelTop, "#.##") + ")", style=label.style_none, color=color.new(color.red, 100), textcolor=color.red, size=size.small, xloc=xloc.bar_index, yloc=yloc.price)\n        // Store current levels\n        prev25Level := level25\n        prev50Level := level50\n        prev75Level := level75\n        prevTopLevel := levelTop\n// ═══════════════════════════════════════════════════════════════════════════════\n// ALERTS\n// ═══════════════════════════════════════════════════════════════════════════════\n// Alert when probability drops below threshold\nalertCondition = enableAlerts and remainingProb < alertThreshold and remainingProb[1] >= alertThreshold\nif alertCondition\n    alert("⚠️ High Risk: Only " + str.tostring(remainingProbDisplay, "#.#") + "% probability remaining", alert.freq_once_per_bar)\nalertcondition(alertCondition, title="Low Probability Alert", message="⚠️ Range Risk Alert: Only {{plot_0}}% probability remaining")\n// ═══════════════════════════════════════════════════════════════════════════════\n// PLOTS FOR ALERTCONDITION\n// ═══════════════════════════════════════════════════════════════════════════════\nplot(remainingProbDisplay, "Remaining Probability", display=display.none)\nplot(rangeUsed, "Range Used", display=display.none)\nplot(actualRange, "Actual Range", display=display.none)\n'
[CAPTURE 2] '//@version=6\nindicator("Daily Range Risk Filter", overlay=true)\n// ═══════════════════════════════════════════════════════════════════════════════\n// INPUTS\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range calculation mode\nuseAutoRange = input.bool(true, "Use Built-In VXN Calculator", group="Core Settings", tooltip="ON = Automatically calculates expected range at 16:45 NY using NQ close + VXN close\\nOFF = Use manual input below")\nmanualExpectedRange = input.float(300.0, "Manual Expected Range (points)", minval=1.0, group="Core Settings", tooltip="Only used when Built-In Calculator is OFF")\nrangeTolerance = input.float(50.0, "Range Buffer (±points)", minval=0.0, group="Core Settings", tooltip="Your typical ±50 point buffer (e.g., 300 → 250-350 range)")\n// Auto-calculation settings\nvxnSymbol = input.string("VXN", "VXN Symbol", group="Calculator Settings", tooltip="CBOE NASDAQ Volatility Index symbol")\nvolatilityMultiplier = input.float(1.0, "Calibration Multiplier", minval=0.1, maxval=5.0, step=0.1, group="Calculator Settings", tooltip="Adjust if calculated ranges are consistently too high/low\\n1.0 = standard, 1.2 = +20%, 0.8 = -20%")\natrPeriod = input.int(14, "ATR Period (Fallback)", minval=1, group="Calculator Settings", tooltip="Used if VXN data unavailable")\n// Probability thresholds\ngreenThreshold = input.float(40.0, "Green Threshold (% used)", minval=0.0, maxval=100.0, group="Visual Thresholds")\nyellowThreshold = input.float(70.0, "Yellow Threshold (% used)", minval=0.0, maxval=100.0, group="Visual Thresholds")\n// Session analysis\nenableSessions = input.bool(true, "Enable Session Analysis", group="Advanced Features")\nshowSessionLabels = input.bool(true, "Show Session Labels", group="Advanced Features")\n// Empirical bins\nenableBins = input.bool(false, "Enable Empirical Probability Bins", group="Advanced Features")\nshowBinTable = input.bool(false, "Show Bin Table", group="Advanced Features")\n// Alerts\nenableAlerts = input.bool(true, "Enable Alerts", group="Alerts")\nalertThreshold = input.float(20.0, "Alert Threshold (% remaining)", minval=0.0, maxval=100.0, group="Alerts")\n// Label settings\nshowLabel = input.bool(true, "Show Live Label", group="Display")\nlabelSize = input.string("normal", "Label Size", options=["tiny", "small", "normal", "large"], group="Display")\n// Enhanced features\nshowRangeZones = input.bool(true, "Show Range Expansion Zones", group="Enhanced Features", tooltip="Plots horizontal zones showing 25%, 50%, 75% range levels")\nshowMomentum = input.bool(true, "Show Range Momentum", group="Enhanced Features", tooltip="Displays rate of range consumption")\nshowVolRegime = input.bool(true, "Show Volatility Regime", group="Enhanced Features", tooltip="Low/Medium/High volatility classification")\nshowTimeRisk = input.bool(true, "Show Time-of-Day Risk", group="Enhanced Features", tooltip="Risk level based on current session and time")\n// ═══════════════════════════════════════════════════════════════════════════════\n// TIME ZONE & SESSION DETECTION\n// ═══════════════════════════════════════════════════════════════════════════════\n// Get NY time\nnyHour = hour(time, "America/New_York")\nnyMinute = minute(time, "America/New_York")\n// Session boundary: 18:00 NY (futures rollover)\nisNewDay = (nyHour == 18 and nyMinute == 0)\n// Close time for range calculation: 16:45 NY\nisCloseTime = (nyHour == 16 and nyMinute == 45)\n// Session detection\nisAsia = (nyHour >= 18) or (nyHour < 2)\nisLondon = (nyHour >= 2 and nyHour < 8) or (nyHour == 8 and nyMinute < 30)\nisNY = (nyHour == 8 and nyMinute >= 30) or (nyHour > 8 and nyHour < 16)\n// ═══════════════════════════════════════════════════════════════════════════════\n// AUTO RANGE CALCULATION (VXN-BASED CALCULATOR)\n// ═══════════════════════════════════════════════════════════════════════════════\n// This replicates your manual VXN calculator process:\n// 1. At 16:45 NY, capture NQ close and VXN close\n// 2. Calculate expected daily range using volatility formula\n// 3. Apply buffer (±50 points by default)\nvar float calculatedRange = na\nvar float lastClosePrice = na\nvar float lastVXNClose = na\nvar bool rangeCalculatedToday = false\nif useAutoRange\n    // Get VXN data (daily close)\n    vxnClose = request.security(vxnSymbol, "D", close, lookahead=barmerge.lookahead_off)\n    // At 16:45 NY, capture close prices for next day\'s calculation\n    if isCloseTime and not rangeCalculatedToday\n        lastClosePrice := close\n        lastVXNClose := vxnClose\n        rangeCalculatedToday := true\n        // YOUR CALCULATOR FORMULA:\n        // Expected Daily Range = (Price × VXN × 0.01 × √(1/252)) × Adjustment Factor\n        // This converts VXN (annualized implied volatility) to expected daily move\n        if not na(lastVXNClose) and not na(lastClosePrice) and lastVXNClose > 0\n            // Convert VXN to daily volatility\n            // VXN is annual %, so: (VXN / 100) gives decimal, then × √(1/252) for daily\n            dailyVolPct = (lastVXNClose / 100.0) * math.sqrt(1.0 / 252.0)\n            // Expected daily range = price × daily volatility %\n            baseRange = lastClosePrice * dailyVolPct\n            // Apply multiplier for calibration (default 1.0)\n            calculatedRange := baseRange * volatilityMultiplier\n    // Reset flag at new day\n    if isNewDay\n        rangeCalculatedToday := false\n// Fallback ATR calculation (extracted to global scope for consistency)\natrValue = ta.atr(atrPeriod)\nfallbackRange = atrValue * 2.5 * volatilityMultiplier\n// Apply fallback if needed\nif useAutoRange and (na(calculatedRange) or calculatedRange <= 0)\n    calculatedRange := fallbackRange\n// Final expected range (manual or auto)\nexpectedRange = useAutoRange and not na(calculatedRange) ? calculatedRange : manualExpectedRange\n// ═══════════════════════════════════════════════════════════════════════════════\n// DAILY RANGE TRACKING (18:00 NY → 17:00 NY)\n// ═══════════════════════════════════════════════════════════════════════════════\nvar float dayHigh = na\nvar float dayLow = na\nvar int dayStartTime = na\n// Reset at new day\nif isNewDay\n    dayHigh := high\n    dayLow := low\n    dayStartTime := time\nelse if not na(dayHigh)\n    dayHigh := math.max(dayHigh, high)\n    dayLow := math.min(dayLow, low)\nelse\n    // Initialize if starting mid-day\n    dayHigh := high\n    dayLow := low\n// Calculate actual range\nactualRange = dayHigh - dayLow\n// ═══════════════════════════════════════════════════════════════════════════════\n// RANGE COMPLETION & PROBABILITY CALCULATION\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range used percentage\nrangeUsed = (actualRange / expectedRange) * 100\n// Remaining probability (conditional probability)\nremainingProb = 100 - rangeUsed\n// Clamp for display\nremainingProbDisplay = math.max(0, remainingProb)\n// ═══════════════════════════════════════════════════════════════════════════════\n// SESSION-SPECIFIC RANGE TRACKING\n// ═══════════════════════════════════════════════════════════════════════════════\nvar float asiaHigh = na\nvar float asiaLow = na\nvar float londonHigh = na\nvar float londonLow = na\nvar float nyHigh = na\nvar float nyLow = na\nvar bool asiaSessionStarted = false\nvar bool londonSessionStarted = false\nvar bool nySessionStarted = false\nif enableSessions\n    // Track Asia session (resets at 18:00)\n    if isAsia\n        if isNewDay or not asiaSessionStarted\n            asiaHigh := high\n            asiaLow := low\n            asiaSessionStarted := true\n        else\n            asiaHigh := math.max(asiaHigh, high)\n            asiaLow := math.min(asiaLow, low)\n    // Track London session (resets at 02:00)\n    if isLondon\n        if (nyHour == 2 and nyMinute == 0) or not londonSessionStarted\n            londonHigh := high\n            londonLow := low\n            londonSessionStarted := true\n        else\n            londonHigh := math.max(londonHigh, high)\n            londonLow := math.min(londonLow, low)\n    // Track NY session (resets at 08:30)\n    if isNY\n        if (nyHour == 8 and nyMinute == 30) or not nySessionStarted\n            nyHigh := high\n            nyLow := low\n            nySessionStarted := true\n        else\n            nyHigh := math.max(nyHigh, high)\n            nyLow := math.min(nyLow, low)\n    // Reset session flags at new day\n    if isNewDay\n        londonSessionStarted := false\n        nySessionStarted := false\n// Calculate session ranges\nasiaRange = not na(asiaHigh) and not na(asiaLow) ? asiaHigh - asiaLow : 0\nlondonRange = not na(londonHigh) and not na(londonLow) ? londonHigh - londonLow : 0\nnyRange = not na(nyHigh) and not na(nyLow) ? nyHigh - nyLow : 0\n// Session contribution to expected range\nasiaContribution = (asiaRange / expectedRange) * 100\nlondonContribution = (londonRange / expectedRange) * 100\nnyContribution = (nyRange / expectedRange) * 100\n// ═══════════════════════════════════════════════════════════════════════════════\n// EMPIRICAL PROBABILITY BINS\n// ═══════════════════════════════════════════════════════════════════════════════\nvar array<int> binCounts = array.new_int(10, 0)\nvar array<int> binExceeded = array.new_int(10, 0)\nvar int totalDays = 0\nif enableBins\n    // At end of day (17:00 NY), categorize outcome\n    if nyHour == 17 and nyMinute == 0\n        int binIndex = math.floor(rangeUsed / 10)\n        if binIndex > 9\n            binIndex := 9\n        // Increment bin count\n        array.set(binCounts, binIndex, array.get(binCounts, binIndex) + 1)\n        // Track if range was exceeded\n        if rangeUsed > 100\n            array.set(binExceeded, binIndex, array.get(binExceeded, binIndex) + 1)\n        totalDays += 1\n// ═══════════════════════════════════════════════════════════════════════════════\n// BACKGROUND HEATMAP\n// ═══════════════════════════════════════════════════════════════════════════════\nbgColor = rangeUsed < greenThreshold ? color.new(color.green, 92) : rangeUsed < yellowThreshold ? color.new(color.yellow, 92) : color.new(color.red, 92)\nbgcolor(bgColor, title="Range Heatmap")\n// ═══════════════════════════════════════════════════════════════════════════════\n// LIVE INFORMATION LABEL\n// ═══════════════════════════════════════════════════════════════════════════════\n// ═══════════════════════════════════════════════════════════════════════════════\n// ENHANCED FEATURES\n// ═══════════════════════════════════════════════════════════════════════════════\n// Range Momentum (rate of range consumption)\nvar float lastRangeUsed = 0.0\nvar int lastRangeTime = 0\nrangeMomentum = 0.0\nif bar_index > 0 and (time - lastRangeTime) > 0\n    timeDiff = (time - lastRangeTime) / 60000.0\n    if timeDiff > 0\n        rangeMomentum := (rangeUsed - lastRangeUsed) / timeDiff\nlastRangeUsed := rangeUsed\nlastRangeTime := time\nmomentumLabel = rangeMomentum > 0.5 ? "🔥 Fast" : rangeMomentum > 0.2 ? "⚡ Medium" : "🐌 Slow"\n// Volatility Regime Detection (ATR calculations extracted to global scope)\natr14 = ta.atr(14)\navgATR50 = ta.sma(atr14, 50)\nvar string volRegime = "Medium"\nif not na(lastVXNClose)\n    volRegime := lastVXNClose < 15 ? "😴 Low Vol" : lastVXNClose < 25 ? "📊 Normal Vol" : "🌋 High Vol"\nelse\n    volRegime := atr14 < avgATR50 * 0.8 ? "😴 Low Vol" : atr14 < avgATR50 * 1.2 ? "📊 Normal Vol" : "🌋 High Vol"\n// Time-of-Day Risk Assessment\ntimeRisk = "Unknown"\nif isAsia\n    timeRisk := rangeUsed < 20 ? "✅ Low Risk" : rangeUsed < 40 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse if isLondon\n    timeRisk := rangeUsed < 50 ? "✅ Low Risk" : rangeUsed < 70 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse if isNY\n    timeRisk := rangeUsed < 60 ? "✅ Low Risk" : rangeUsed < 80 ? "⚠️ Medium Risk" : "🛑 High Risk"\nelse\n    timeRisk := "💤 Off Hours"\n// ═══════════════════════════════════════════════════════════════════════════════\n// LIVE INFORMATION TABLE (FIXED TOP-RIGHT POSITION)\n// ═══════════════════════════════════════════════════════════════════════════════\nif showLabel and barstate.islast\n    var table infoTable = table.new(position.top_right, 2, 20, bgcolor=color.new(color.black, 10), border_width=1, border_color=color.gray)\n    calcMode = useAutoRange ? "Calc" : "Manual"\n    // Determine color based on range state\n    tableColor = rangeUsed < greenThreshold ? color.new(color.green, 10) : rangeUsed < yellowThreshold ? color.new(color.yellow, 10) : color.new(color.red, 10)\n    textColor = rangeUsed < greenThreshold ? color.white : rangeUsed < yellowThreshold ? color.black : color.white\n    // Header\n    table.cell(infoTable, 0, 0, "📊 RANGE RISK", text_color=textColor, bgcolor=tableColor, text_size=size.small)\n    table.merge_cells(infoTable, 0, 0, 1, 0)\n    // Core metrics\n    row = 1\n    table.cell(infoTable, 0, row, "Used:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(rangeUsed, "#.#") + "%", text_color=textColor, bgcolor=tableColor, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Prob:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(remainingProbDisplay, "#.#") + "%", text_color=color.white, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Actual:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(actualRange, "#.#"), text_color=color.white, text_size=size.tiny)\n    row += 1\n    table.cell(infoTable, 0, row, "Expected:", text_color=color.white, text_size=size.tiny)\n    table.cell(infoTable, 1, row, str.tostring(expectedRange, "#.#"), text_color=color.white, text_size=size.tiny)\n    row += 1\n    // Calculator details if using auto mode\n    if useAutoRange and not na(lastVXNClose) and not na(lastClosePrice)\n        table.cell(infoTable, 0, row, "VXN:", text_color=color.yellow, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(lastVXNClose, "#.#"), text_color=color.yellow, text_size=size.tiny)\n        row += 1\n    // Session info if enabled\n    if enableSessions and showSessionLabels\n        table.cell(infoTable, 0, row, "Asia:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(asiaContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n        table.cell(infoTable, 0, row, "London:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(londonContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n        table.cell(infoTable, 0, row, "NY:", text_color=color.gray, text_size=size.tiny)\n        table.cell(infoTable, 1, row, str.tostring(nyContribution, "#.#") + "%", text_color=color.gray, text_size=size.tiny)\n        row += 1\n    // Enhanced features (condensed)\n    if showMomentum\n        table.cell(infoTable, 0, row, "Momentum:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, momentumLabel, text_color=color.white, text_size=size.tiny)\n        row += 1\n    if showVolRegime\n        table.cell(infoTable, 0, row, "Vol:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, volRegime, text_color=color.white, text_size=size.tiny)\n        row += 1\n    if showTimeRisk\n        table.cell(infoTable, 0, row, "Risk:", text_color=color.white, text_size=size.tiny)\n        table.cell(infoTable, 1, row, timeRisk, text_color=color.white, text_size=size.tiny)\n        row += 1\n// ═══════════════════════════════════════════════════════════════════════════════\n// EMPIRICAL BINS TABLE (OPTIONAL)\n// ═══════════════════════════════════════════════════════════════════════════════\nif enableBins and showBinTable and barstate.islast\n    var table binTable = table.new(position.bottom_right, 4, 11, bgcolor=color.new(color.black, 20), border_width=1, border_color=color.gray)\n    // Headers\n    table.cell(binTable, 0, 0, "Range Used", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 1, 0, "Count", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 2, 0, "Exceeded", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    table.cell(binTable, 3, 0, "Respect %", text_color=color.white, bgcolor=color.new(color.gray, 50))\n    // Data rows\n    for i = 0 to 9\n        binLabel = str.tostring(i * 10) + "-" + str.tostring((i + 1) * 10) + "%"\n        binCount = array.get(binCounts, i)\n        binExceed = array.get(binExceeded, i)\n        respectRate = binCount > 0 ? ((binCount - binExceed) / binCount) * 100 : 0\n        table.cell(binTable, 0, i + 1, binLabel, text_color=color.white)\n        table.cell(binTable, 1, i + 1, str.tostring(binCount), text_color=color.white)\n        table.cell(binTable, 2, i + 1, str.tostring(binExceed), text_color=color.white)\n        table.cell(binTable, 3, i + 1, str.tostring(respectRate, "#.#") + "%", text_color=color.white)\n// ═══════════════════════════════════════════════════════════════════════════════\n// VISUAL REFERENCE LINES\n// ═══════════════════════════════════════════════════════════════════════════════\n// ═══════════════════════════════════════════════════════════════════════════════\n// RANGE EXPANSION ZONES (FIXED PRICE LEVELS WITH LABELS)\n// ═══════════════════════════════════════════════════════════════════════════════\n// Store previous day\'s levels to avoid redrawing\nvar float prev25Level = na\nvar float prev50Level = na\nvar float prev75Level = na\nvar float prevTopLevel = na\nvar line line25 = na\nvar line line50 = na\nvar line line75 = na\nvar line lineTop = na\nvar label label25 = na\nvar label label50 = na\nvar label label75 = na\nvar label labelTop = na\nif showRangeZones and not na(dayLow) and not na(expectedRange)\n    // Calculate zone levels\n    level25 = dayLow + (expectedRange * 0.25)\n    level50 = dayLow + (expectedRange * 0.50)\n    level75 = dayLow + (expectedRange * 0.75)\n    levelTop = dayLow + expectedRange\n    // Only redraw if levels changed (new day)\n    if level25 != prev25Level or level50 != prev50Level or level75 != prev75Level or levelTop != prevTopLevel\n        // Delete old lines and labels\n        if not na(line25)\n            line.delete(line25)\n            label.delete(label25)\n        if not na(line50)\n            line.delete(line50)\n            label.delete(label50)\n        if not na(line75)\n            line.delete(line75)\n            label.delete(label75)\n        if not na(lineTop)\n            line.delete(lineTop)\n            label.delete(labelTop)\n        // Create new lines at EXACT price levels\n        line25 := line.new(bar_index - 50, level25, bar_index + 500, level25, extend=extend.right, color=color.new(color.green, 60), width=1, style=line.style_dashed)\n        line50 := line.new(bar_index - 50, level50, bar_index + 500, level50, extend=extend.right, color=color.new(color.yellow, 60), width=1, style=line.style_dashed)\n        line75 := line.new(bar_index - 50, level75, bar_index + 500, level75, extend=extend.right, color=color.new(color.orange, 50), width=2, style=line.style_solid)\n        lineTop := line.new(bar_index - 50, levelTop, bar_index + 500, levelTop, extend=extend.right, color=color.new(color.red, 40), width=2, style=line.style_solid)\n        // Create price labels on the right\n        label25 := label.new(bar_index, level25, "25% (" + str.tostring(level25, "#.##") + ")", style=label.style_none, color=color.new(color.green, 100), textcolor=color.green, size=size.tiny, xloc=xloc.bar_index, yloc=yloc.price)\n        label50 := label.new(bar_index, level50, "50% (" + str.tostring(level50, "#.##") + ")", style=label.style_none, color=color.new(color.yellow, 100), textcolor=color.yellow, size=size.tiny, xloc=xloc.bar_index, yloc=yloc.price)\n        label75 := label.new(bar_index, level75, "75% (" + str.tostring(level75, "#.##") + ")", style=label.style_none, color=color.new(color.orange, 100), textcolor=color.orange, size=size.small, xloc=xloc.bar_index, yloc=yloc.price)\n        labelTop := label.new(bar_index, levelTop, "100% (" + str.tostring(levelTop, "#.##") + ")", style=label.style_none, color=color.new(color.red, 100), textcolor=color.red, size=size.small, xloc=xloc.bar_index, yloc=yloc.price)\n        // Store current levels\n        prev25Level := level25\n        prev50Level := level50\n        prev75Level := level75\n        prevTopLevel := levelTop\n// ═══════════════════════════════════════════════════════════════════════════════\n// ALERTS\n// ═══════════════════════════════════════════════════════════════════════════════\n// Alert when probability drops below threshold\nalertCondition = enableAlerts and remainingProb < alertThreshold and remainingProb[1] >= alertThreshold\nif alertCondition\n    alert("⚠️ High Risk: Only " + str.tostring(remainingProbDisplay, "#.#") + "% probability remaining", alert.freq_once_per_bar)\nalertcondition(alertCondition, title="Low Probability Alert", message="⚠️ Range Risk Alert: Only {{plot_0}}% probability remaining")\n// ═══════════════════════════════════════════════════════════════════════════════\n// PLOTS FOR ALERTCONDITION\n// ═══════════════════════════════════════════════════════════════════════════════\nplot(remainingProbDisplay, "Remaining Probability", display=display.none)\nplot(rangeUsed, "Range Used", display=display.none)\nplot(actualRange, "Actual Range", display=display.none)\n'
[DEBUG] save_script called: script_id=YB39NHms title=Daily Range Risk Filter by nq.rew1nd category=YB39NHms force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\YB39NHms_Daily_Range_Risk_Filter_by_nq.rew1nd.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\YB39NHms_Daily_Range_Risk_Filter_by_nq.rew1nd.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 05:24:24 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 05:24:24 GMT' as: 2026-02-09T05:24:24+00:00
[DEBUG] Exact published date for header: 2026-02-09T05:24:24+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/FBkkkUxy-Asia-Range-London-Breakouts-NY-Range/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator("Asia Range + London Breakouts + NY Range", overlay=true, max_boxes_count=300, max_lines_count=300)\n\n// ───────────────── INPUTS ─────────────────\ntz = input.string("Etc/UTC", "Session Timezone")\n\nasiaSession   = input.session("1900-0300", "Asia Session")\nlondonSession = input.session("0300-0500", "London Breakout Window")\nnySession     = input.session("0830-1600", "New York Session")\n\nshowAsiaBox = input.bool(true, "Show Asia Range")\nshowNYBox   = input.bool(true, "Show NY Range")\nextendAsia  = input.bool(true, "Extend Asia High / Low")\n\nasiaBoxColor = input.color(color.new(color.blue, 85), "Asia Box Color")\nnyBoxColor   = input.color(color.new(color.orange, 85), "NY Box Color")\n\nasiaLineColor = input.color(color.blue, "Asia High / Low Color")\n\n// ───────────────── SESSION FLAGS ─────────────────\ninAsia   = not na(time(timeframe.period, asiaSession, tz))\ninLondon = not na(time(timeframe.period, londonSession, tz))\ninNY     = not na(time(timeframe.period, nySession, tz))\n\n// ───────────────── ASIA RANGE ─────────────────\nvar float asiaHigh = na\nvar float asiaLow  = na\nvar box asiaBox = na\nvar line asiaHighLine = na\nvar line asiaLowLine  = na\n\nif inAsia and not inAsia[1]\n    asiaHigh := high\n    asiaLow  := low\n    if showAsiaBox\n        asiaBox := box.new(bar_index, high, bar_index, low, bgcolor=asiaBoxColor, border_color=asiaLineColor)\n\nif inAsia\n    asiaHigh := math.max(asiaHigh, high)\n    asiaLow  := math.min(asiaLow, low)\n    if showAsiaBox\n        box.set_right(asiaBox, bar_index)\n        box.set_top(asiaBox, asiaHigh)\n        box.set_bottom(asiaBox, asiaLow)\n\nif not inAsia and inAsia[1]\n    asiaHighLine := line.new(bar_index, asiaHigh, bar_index + 1, asiaHigh, color=asiaLineColor)\n    asiaLowLine  := line.new(bar_index, asiaLow,  bar_index + 1, asiaLow,  color=asiaLineColor)\n    if extendAsia\n        line.set_extend(asiaHighLine, extend.right)\n        line.set_extend(asiaLowLine, extend.right)\n\n// ───────────────── LONDON BREAKOUTS ─────────────────\nbreakHigh = inLondon and not na(asiaHigh) and close > asiaHigh and close[1] <= asiaHigh\nbreakLow  = inLondon and not na(asiaLow)  and close < asiaLow  and close[1] >= asiaLow\n\nplotshape(breakHigh, title="London Break Above Asia", style=shape.triangleup,\n     location=location.abovebar, color=color.lime, size=size.small)\n\nplotshape(breakLow, title="London Break Below Asia", style=shape.triangledown,\n     location=location.belowbar, color=color.red, size=size.small)\n\n// Alerts\nalertcondition(breakHigh, title="London Break Above Asia",\n     message="London session breakout ABOVE Asia high")\n\nalertcondition(breakLow, title="London Break Below Asia",\n     message="London session breakout BELOW Asia low")\n\n// ───────────────── NEW YORK RANGE ─────────────────\nvar float nyHigh = na\nvar float nyLow  = na\nvar box nyBox = na\n\nif inNY and not inNY[1]\n    nyHigh := high\n    nyLow  := low\n    if showNYBox\n        nyBox := box.new(bar_index, high, bar_index, low, bgcolor=nyBoxColor, border_color=color.orange)\n\nif inNY\n    nyHigh := math.max(nyHigh, high)\n    nyLow  := math.min(nyLow, low)\n    if showNYBox\n        box.set_right(nyBox, bar_index)\n        box.set_top(nyBox, nyHigh)\n        box.set_bottom(nyBox, nyLow)'
[CAPTURE 1] '//@version=6\nindicator("Asia Range + London Breakouts + NY Range", overlay=true, max_boxes_count=300, max_lines_count=300)\n\n// ───────────────── INPUTS ─────────────────\ntz = input.string("Etc/UTC", "Session Timezone")\n\nasiaSession   = input.session("1900-0300", "Asia Session")\nlondonSession = input.session("0300-0500", "London Breakout Window")\nnySession     = input.session("0830-1600", "New York Session")\n\nshowAsiaBox = input.bool(true, "Show Asia Range")\nshowNYBox   = input.bool(true, "Show NY Range")\nextendAsia  = input.bool(true, "Extend Asia High / Low")\n\nasiaBoxColor = input.color(color.new(color.blue, 85), "Asia Box Color")\nnyBoxColor   = input.color(color.new(color.orange, 85), "NY Box Color")\n\nasiaLineColor = input.color(color.blue, "Asia High / Low Color")\n\n// ───────────────── SESSION FLAGS ─────────────────\ninAsia   = not na(time(timeframe.period, asiaSession, tz))\ninLondon = not na(time(timeframe.period, londonSession, tz))\ninNY     = not na(time(timeframe.period, nySession, tz))\n\n// ───────────────── ASIA RANGE ─────────────────\nvar float asiaHigh = na\nvar float asiaLow  = na\nvar box asiaBox = na\nvar line asiaHighLine = na\nvar line asiaLowLine  = na\n\nif inAsia and not inAsia[1]\n    asiaHigh := high\n    asiaLow  := low\n    if showAsiaBox\n        asiaBox := box.new(bar_index, high, bar_index, low, bgcolor=asiaBoxColor, border_color=asiaLineColor)\n\nif inAsia\n    asiaHigh := math.max(asiaHigh, high)\n    asiaLow  := math.min(asiaLow, low)\n    if showAsiaBox\n        box.set_right(asiaBox, bar_index)\n        box.set_top(asiaBox, asiaHigh)\n        box.set_bottom(asiaBox, asiaLow)\n\nif not inAsia and inAsia[1]\n    asiaHighLine := line.new(bar_index, asiaHigh, bar_index + 1, asiaHigh, color=asiaLineColor)\n    asiaLowLine  := line.new(bar_index, asiaLow,  bar_index + 1, asiaLow,  color=asiaLineColor)\n    if extendAsia\n        line.set_extend(asiaHighLine, extend.right)\n        line.set_extend(asiaLowLine, extend.right)\n\n// ───────────────── LONDON BREAKOUTS ─────────────────\nbreakHigh = inLondon and not na(asiaHigh) and close > asiaHigh and close[1] <= asiaHigh\nbreakLow  = inLondon and not na(asiaLow)  and close < asiaLow  and close[1] >= asiaLow\n\nplotshape(breakHigh, title="London Break Above Asia", style=shape.triangleup,\n     location=location.abovebar, color=color.lime, size=size.small)\n\nplotshape(breakLow, title="London Break Below Asia", style=shape.triangledown,\n     location=location.belowbar, color=color.red, size=size.small)\n\n// Alerts\nalertcondition(breakHigh, title="London Break Above Asia",\n     message="London session breakout ABOVE Asia high")\n\nalertcondition(breakLow, title="London Break Below Asia",\n     message="London session breakout BELOW Asia low")\n\n// ───────────────── NEW YORK RANGE ─────────────────\nvar float nyHigh = na\nvar float nyLow  = na\nvar box nyBox = na\n\nif inNY and not inNY[1]\n    nyHigh := high\n    nyLow  := low\n    if showNYBox\n        nyBox := box.new(bar_index, high, bar_index, low, bgcolor=nyBoxColor, border_color=color.orange)\n\nif inNY\n    nyHigh := math.max(nyHigh, high)\n    nyLow  := math.min(nyLow, low)\n    if showNYBox\n        box.set_right(nyBox, bar_index)\n        box.set_top(nyBox, nyHigh)\n        box.set_bottom(nyBox, nyLow)'
[CAPTURE 2] '//@version=6\nindicator("Asia Range + London Breakouts + NY Range", overlay=true, max_boxes_count=300, max_lines_count=300)\n\n// ───────────────── INPUTS ─────────────────\ntz = input.string("Etc/UTC", "Session Timezone")\n\nasiaSession   = input.session("1900-0300", "Asia Session")\nlondonSession = input.session("0300-0500", "London Breakout Window")\nnySession     = input.session("0830-1600", "New York Session")\n\nshowAsiaBox = input.bool(true, "Show Asia Range")\nshowNYBox   = input.bool(true, "Show NY Range")\nextendAsia  = input.bool(true, "Extend Asia High / Low")\n\nasiaBoxColor = input.color(color.new(color.blue, 85), "Asia Box Color")\nnyBoxColor   = input.color(color.new(color.orange, 85), "NY Box Color")\n\nasiaLineColor = input.color(color.blue, "Asia High / Low Color")\n\n// ───────────────── SESSION FLAGS ─────────────────\ninAsia   = not na(time(timeframe.period, asiaSession, tz))\ninLondon = not na(time(timeframe.period, londonSession, tz))\ninNY     = not na(time(timeframe.period, nySession, tz))\n\n// ───────────────── ASIA RANGE ─────────────────\nvar float asiaHigh = na\nvar float asiaLow  = na\nvar box asiaBox = na\nvar line asiaHighLine = na\nvar line asiaLowLine  = na\n\nif inAsia and not inAsia[1]\n    asiaHigh := high\n    asiaLow  := low\n    if showAsiaBox\n        asiaBox := box.new(bar_index, high, bar_index, low, bgcolor=asiaBoxColor, border_color=asiaLineColor)\n\nif inAsia\n    asiaHigh := math.max(asiaHigh, high)\n    asiaLow  := math.min(asiaLow, low)\n    if showAsiaBox\n        box.set_right(asiaBox, bar_index)\n        box.set_top(asiaBox, asiaHigh)\n        box.set_bottom(asiaBox, asiaLow)\n\nif not inAsia and inAsia[1]\n    asiaHighLine := line.new(bar_index, asiaHigh, bar_index + 1, asiaHigh, color=asiaLineColor)\n    asiaLowLine  := line.new(bar_index, asiaLow,  bar_index + 1, asiaLow,  color=asiaLineColor)\n    if extendAsia\n        line.set_extend(asiaHighLine, extend.right)\n        line.set_extend(asiaLowLine, extend.right)\n\n// ───────────────── LONDON BREAKOUTS ─────────────────\nbreakHigh = inLondon and not na(asiaHigh) and close > asiaHigh and close[1] <= asiaHigh\nbreakLow  = inLondon and not na(asiaLow)  and close < asiaLow  and close[1] >= asiaLow\n\nplotshape(breakHigh, title="London Break Above Asia", style=shape.triangleup,\n     location=location.abovebar, color=color.lime, size=size.small)\n\nplotshape(breakLow, title="London Break Below Asia", style=shape.triangledown,\n     location=location.belowbar, color=color.red, size=size.small)\n\n// Alerts\nalertcondition(breakHigh, title="London Break Above Asia",\n     message="London session breakout ABOVE Asia high")\n\nalertcondition(breakLow, title="London Break Below Asia",\n     message="London session breakout BELOW Asia low")\n\n// ───────────────── NEW YORK RANGE ─────────────────\nvar float nyHigh = na\nvar float nyLow  = na\nvar box nyBox = na\n\nif inNY and not inNY[1]\n    nyHigh := high\n    nyLow  := low\n    if showNYBox\n        nyBox := box.new(bar_index, high, bar_index, low, bgcolor=nyBoxColor, border_color=color.orange)\n\nif inNY\n    nyHigh := math.max(nyHigh, high)\n    nyLow  := math.min(nyLow, low)\n    if showNYBox\n        box.set_right(nyBox, bar_index)\n        box.set_top(nyBox, nyHigh)\n        box.set_bottom(nyBox, nyLow)'
[DEBUG] save_script called: script_id=FBkkkUxy title=Asia Range + London Breakouts + NY Range category=FBkkkUxy force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\FBkkkUxy_Asia_Range_+_London_Breakouts_+_NY_Range.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\FBkkkUxy_Asia_Range_+_London_Breakouts_+_NY_Range.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 05:23:29 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 05:23:29 GMT' as: 2026-02-09T05:23:29+00:00
[DEBUG] Exact published date for header: 2026-02-09T05:23:29+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/PNS8tTkY-Target-Radar/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\r\nindicator("Target Radar", overlay=true, max_labels_count=120, max_lines_count=120, max_boxes_count=30)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// INPUTS\r\n//──────────────────────────────────────────────────────────────────────────────\r\ngrpFcst = "━━ Forecast Engine ━━"\r\nh        = input.int(3, "Forecast Horizon", minval=1, maxval=10, group=grpFcst)\r\nlookback = input.int(100, "Z-Score Lookback", minval=20, maxval=200, group=grpFcst)\r\nwTrend   = input.float(0.30, "Weight: Trend", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwMom     = input.float(0.30, "Weight: Momentum", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwVol     = input.float(0.20, "Weight: Volatility (penalty)", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwVpr     = input.float(0.20, "Weight: Volume Pressure", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nretScale = input.float(1.0, "Return Scale", minval=0.1, maxval=5.0, step=0.1, group=grpFcst)\r\n\r\ngrpUnc = "━━ Uncertainty Band ━━"\r\ntargetCov   = input.float(0.80, "Target Coverage", minval=0.50, maxval=0.99, step=0.01, group=grpUnc)\r\nresLookback = input.int(200, "Residual Lookback", minval=50, maxval=500, group=grpUnc)\r\nminHW       = input.float(0.005, "Min Half-Width (return)", minval=0.0001, maxval=0.05, step=0.001, group=grpUnc)\r\nuncertTh    = input.float(0.08, "Uncertainty Spike", minval=0.01, maxval=0.20, step=0.01, group=grpUnc)\r\ndirEps      = input.float(0.001, "Direction epsilon", minval=0.0, maxval=0.01, step=0.0005, group=grpUnc)\r\n\r\ngrpSig = "━━ Signal Mode ━━"\r\nsigMode  = input.string("Breakout", "Mode", options=["Trend Pullback","Breakout","Mean Reversion","EMA Cross"], group=grpSig)\r\nminScore = input.float(0.65, "Min Signal Score", minval=0.0, maxval=1.0, step=0.05, group=grpSig)\r\n\r\ngrpFilt = "━━ Signal Filters (ACCURACY) ━━"\r\nuseConfGate   = input.bool(true, "Require Forecast Alignment", group=grpFilt)\r\nuseUncertGate = input.bool(true, "Block High Uncertainty", group=grpFilt)\r\nuseRegimeGate = input.bool(true, "Match Regime to Mode", group=grpFilt)\r\nadxLen        = input.int(14, "ADX Length", minval=5, maxval=50, group=grpFilt)\r\ntrendTh       = input.float(25.0, "Trend Threshold", minval=10, maxval=50, group=grpFilt)\r\nchopLen       = input.int(14, "Choppiness Length", minval=5, maxval=50, group=grpFilt)\r\nchaosTh       = input.float(62.0, "Chaos Threshold", minval=40, maxval=80, group=grpFilt)\r\n\r\ngrpPool = "━━ Support/Resistance Pools ━━"\r\nshowPools  = input.bool(true, "Show S/R Levels", group=grpPool)\r\npivotLen   = input.int(5, "Pivot Length", minval=2, maxval=15, group=grpPool)\r\nmergeATR   = input.float(0.5, "Merge Distance (ATR)", minval=0.1, maxval=2.0, step=0.1, group=grpPool)\r\nmaxPools   = input.int(8, "Max Levels", minval=3, maxval=15, group=grpPool)\r\npoolExtend = input.int(60, "Line Length (bars)", minval=20, maxval=200, group=grpPool)\r\nshowTarget = input.bool(true, "Show Target", group=grpPool)\r\ntargetMin  = input.float(0.40, "Min Target Score", minval=0.0, maxval=1.0, step=0.05, group=grpPool)\r\n\r\ngrpVis = "━━ Display ━━"\r\nshowBands = input.bool(true, "Projection Bands", group=grpVis)\r\nshowBox   = input.bool(true, "Forward Box", group=grpVis)\r\nshowDash  = input.bool(true, "Dashboard", group=grpVis)\r\ndashSize  = input.string("Normal", "Dashboard Size", options=["Small","Normal","Large"], group=grpVis)\r\nshowAura  = input.bool(false, "Candle Coloring (OFF by default)", group=grpVis)\r\n\r\ngrpCal = "━━ Calibration ━━"\r\ncalibLen = input.int(100, "Coverage Window", minval=30, maxval=300, group=grpCal)\r\nsigWin   = input.int(50,  "Signal Window", minval=20, maxval=200, group=grpCal)\r\n\r\nbool isLast = bar_index == last_bar_index\r\n\r\n// Compute table text sizes (NO `size` type keyword)\r\ntxtSize     = dashSize == "Small" ? size.tiny : dashSize == "Large" ? size.normal : size.small\r\ntxtSizeTiny = dashSize == "Large" ? size.small : size.tiny\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// COLORS\r\n//──────────────────────────────────────────────────────────────────────────────\r\ncolor C_SUPPORT = color.rgb(33, 150, 243)   // Blue\r\ncolor C_RESIST  = color.rgb(255, 152, 0)    // Orange\r\ncolor C_LONG    = color.rgb(76, 175, 80)    // Green\r\ncolor C_SHORT   = color.rgb(244, 67, 54)    // Red\r\ncolor C_WARN    = color.rgb(255, 152, 0)\r\ncolor C_CYAN    = color.rgb(0, 188, 212)\r\ncolor C_MAG     = color.rgb(233, 30, 99)\r\ncolor C_DIMTXT  = color.rgb(150, 150, 150)\r\ncolor C_BG1     = color.rgb(26, 26, 26)\r\ncolor C_BG2     = color.rgb(34, 34, 34)\r\ncolor C_HDR     = color.rgb(30, 136, 229)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// HELPERS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nf_div(float x, float y) =>\r\n    math.abs(y) < 1e-10 ? 0.0 : x / y\r\n\r\nf_z(float x, int len) =>\r\n    float m = ta.sma(x, len)\r\n    float sd = ta.stdev(x, len)\r\n    (x - m) / math.max(sd, 1e-10)\r\n\r\nf_bound(float x) =>\r\n    x / (1.0 + math.abs(x))\r\n\r\nf_rollsum(float x, int len) =>\r\n    float c = ta.cum(nz(x))\r\n    bar_index >= len ? (c - c[len]) : na\r\n\r\nf_log10(float x) =>\r\n    math.log(x) / math.log(10.0)\r\n\r\nf_tr() =>\r\n    float pc = nz(close[1], close)\r\n    float a = high - low\r\n    float b = math.abs(high - pc)\r\n    float c = math.abs(low - pc)\r\n    math.max(a, math.max(b, c))\r\n\r\nf_chop(int len) =>\r\n    float trSum = f_rollsum(f_tr(), len)\r\n    float rng = ta.highest(high, len) - ta.lowest(low, len)\r\n    float ratio = f_div(trSum, math.max(rng, 1e-10))\r\n    100.0 * f_div(f_log10(ratio), f_log10(len))\r\n\r\nf_zMult(float cov) =>\r\n    cov <= 0.60 ? 0.25 :\r\n     cov <= 0.68 ? 1.00 :\r\n     cov <= 0.80 ? 1.28 :\r\n     cov <= 0.90 ? 1.64 :\r\n     cov <= 0.95 ? 1.96 : 2.33\r\n\r\nf_prob(float z) =>\r\n    1.0 / (1.0 + z * z)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// FORECAST ENGINE\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat emaF = ta.ema(close, 10)\r\nfloat emaS = ta.ema(close, 20)\r\nfloat trendZ = f_z(f_div(emaF - emaS, math.max(emaS, 1e-10)), lookback)\r\n\r\nfloat rsi = ta.rsi(close, 14)\r\nfloat momZ = f_z(rsi - 50.0, lookback)\r\n\r\nfloat atr = ta.atr(14)\r\nfloat atrPct = f_div(atr, close)\r\nfloat volZ = f_z(atrPct, lookback)\r\n\r\nfloat upV = volume * (close > close[1] ? 1.0 : 0.0)\r\nfloat dnV = volume * (close < close[1] ? 1.0 : 0.0)\r\nfloat vpr = f_div(ta.sma(upV, 20), math.max(ta.sma(dnV, 20), 1e-10))\r\nfloat vprZ = f_z(math.log(math.max(vpr, 1e-10)), lookback)\r\n\r\nfloat wSum = math.max(wTrend + wMom + wVol + wVpr, 1e-10)\r\nfloat rawScore = (wTrend/wSum)*trendZ + (wMom/wSum)*momZ - (wVol/wSum)*volZ + (wVpr/wSum)*vprZ\r\nfloat fcstRet = f_bound(rawScore) * atrPct * retScale\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// ADAPTIVE UNCERTAINTY\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat realRet = bar_index >= h ? math.log(f_div(close, close[h])) : na\r\nfloat predRet = bar_index >= h ? fcstRet[h] : na\r\nfloat resid = (bar_index >= h and not na(realRet) and not na(predRet)) ? math.abs(realRet - predRet) : na\r\n\r\nfloat resMu = ta.sma(resid, resLookback)\r\nfloat resSd = ta.stdev(resid, resLookback)\r\nfloat zM = f_zMult(targetCov)\r\n\r\nfloat hwRaw = (not na(resMu) and not na(resSd)) ? (resMu + zM * resSd) : na\r\nfloat hw = not na(hwRaw) ? math.max(hwRaw, minHW) : na\r\n\r\nfloat loR = not na(hw) ? fcstRet - hw : na\r\nfloat hiR = not na(hw) ? fcstRet + hw : na\r\n\r\nbool isBull = fcstRet > dirEps\r\nbool isBear = fcstRet < -dirEps\r\nbool isUncert = not na(hw) and hw >= uncertTh\r\n\r\nint confCode = na(hw) ? 9 : isBull ? 2 : isBear ? -2 : 0\r\nstring confStr = confCode == 9 ? "WARMUP" : confCode == 2 ? "BULLISH" : confCode == -2 ? "BEARISH" : "NEUTRAL"\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// REGIME\r\n//──────────────────────────────────────────────────────────────────────────────\r\n[diP, diM, adx] = ta.dmi(adxLen, adxLen)\r\nfloat chop = f_chop(chopLen)\r\nstring regime = (not na(adx) and adx > trendTh) ? "TREND" : (chop > chaosTh ? "CHAOS" : "RANGE")\r\n\r\nbool regimeOK = true\r\nif useRegimeGate\r\n    if regime == "CHAOS"\r\n        regimeOK := false\r\n    else if regime == "TREND"\r\n        regimeOK := sigMode != "Mean Reversion"\r\n    else\r\n        regimeOK := sigMode == "Mean Reversion" or sigMode == "EMA Cross"\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// BASE SIGNALS + SCORING\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat ema20 = ta.ema(close, 20)\r\nfloat ema50 = ta.ema(close, 50)\r\n\r\nbool tpL = (ema20 > ema50) and ta.crossover(rsi, 30) and close > ema20\r\nbool tpS = (ema20 < ema50) and ta.crossunder(rsi, 70) and close < ema20\r\n\r\nfloat hi20 = ta.highest(high, 20)[1]\r\nfloat lo20 = ta.lowest(low, 20)[1]\r\nbool volOK = volume > ta.sma(volume, 20) * 1.3\r\nbool boL = ta.crossover(close, hi20) and volOK\r\nbool boS = ta.crossunder(close, lo20) and volOK\r\n\r\nfloat bb = ta.sma(close, 20)\r\nfloat sd = ta.stdev(close, 20)\r\nfloat zP = f_div(close - bb, math.max(sd, 1e-10))\r\nbool mrL = ta.crossover(zP, -2.0)\r\nbool mrS = ta.crossunder(zP, 2.0)\r\n\r\nfloat e9  = ta.ema(close, 9)\r\nfloat e21 = ta.ema(close, 21)\r\nbool xL = ta.crossover(e9, e21)\r\nbool xS = ta.crossunder(e9, e21)\r\n\r\nbool baseL = sigMode == "Trend Pullback" ? tpL : sigMode == "Breakout" ? boL : sigMode == "Mean Reversion" ? mrL : xL\r\nbool baseS = sigMode == "Trend Pullback" ? tpS : sigMode == "Breakout" ? boS : sigMode == "Mean Reversion" ? mrS : xS\r\n\r\nfloat scoreL = 0.0\r\nfloat scoreS = 0.0\r\nif baseL\r\n    scoreL := 0.40 + (useConfGate ? (isBull ? 0.25 : 0.0) : 0.10) + (useUncertGate ? (not isUncert ? 0.15 : 0.0) : 0.10) + (useRegimeGate ? (regimeOK ? 0.20 : 0.0) : 0.10)\r\nif baseS\r\n    scoreS := 0.40 + (useConfGate ? (isBear ? 0.25 : 0.0) : 0.10) + (useUncertGate ? (not isUncert ? 0.15 : 0.0) : 0.10) + (useRegimeGate ? (regimeOK ? 0.20 : 0.0) : 0.10)\r\n\r\nbool confGateL = useConfGate ? isBull : true\r\nbool confGateS = useConfGate ? isBear : true\r\nbool uncGate   = useUncertGate ? not isUncert : true\r\nbool regGate   = useRegimeGate ? regimeOK : true\r\n\r\nbool sigL = baseL and confGateL and uncGate and regGate and scoreL >= minScore\r\nbool sigS = baseS and confGateS and uncGate and regGate and scoreS >= minScore\r\nfloat finalScore = sigL ? scoreL : sigS ? scoreS : 0.0\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// SUPPORT / RESISTANCE POOLS (finite lines)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar float[] lvls  = array.new_float()\r\nvar int[]   strs  = array.new_int()\r\nvar int[]   sides = array.new_int()\r\nvar line[]  lns   = array.new_line()\r\n\r\nfloat mDist = atr * mergeATR\r\nfloat ph = ta.pivothigh(high, pivotLen, pivotLen)\r\nfloat pl = ta.pivotlow(low, pivotLen, pivotLen)\r\n\r\naddPool(float lvl, int side) =>\r\n    int n = array.size(lvls)\r\n    int best = -1\r\n    float bestD = 1e10\r\n\r\n    if n > 0\r\n        for i = 0 to n - 1\r\n            if array.get(sides, i) == side\r\n                float d = math.abs(array.get(lvls, i) - lvl)\r\n                if d < bestD\r\n                    bestD := d\r\n                    best := i\r\n\r\n    if best != -1 and bestD <= mDist\r\n        array.set(lvls, best, array.get(lvls, best) * 0.8 + lvl * 0.2)\r\n        array.set(strs, best, array.get(strs, best) + 1)\r\n    else\r\n        array.push(lvls, lvl)\r\n        array.push(strs, 1)\r\n        array.push(sides, side)\r\n        array.push(lns, line.new(bar_index, lvl, bar_index, lvl, extend=extend.none, style=line.style_solid, width=1))\r\n\r\n    while array.size(lvls) > maxPools\r\n        line.delete(array.shift(lns))\r\n        array.shift(lvls)\r\n        array.shift(strs)\r\n        array.shift(sides)\r\n\r\n    true\r\n\r\nif showPools\r\n    if not na(ph)\r\n        addPool(ph, +1)\r\n    if not na(pl)\r\n        addPool(pl, -1)\r\n\r\nif showPools and array.size(lvls) > 0\r\n    for i = 0 to array.size(lvls) - 1\r\n        float lvl = array.get(lvls, i)\r\n        int str   = array.get(strs, i)\r\n        int side  = array.get(sides, i)\r\n        line ln   = array.get(lns, i)\r\n\r\n        int w = str >= 5 ? 3 : str >= 3 ? 2 : 1\r\n        int transp = str >= 4 ? 25 : str >= 2 ? 40 : 55\r\n        color c = side == -1 ? color.new(C_SUPPORT, transp) : color.new(C_RESIST, transp)\r\n\r\n        int x1 = bar_index - poolExtend\r\n        int x2 = bar_index + 2\r\n\r\n        line.set_x1(ln, x1)\r\n        line.set_x2(ln, x2)\r\n        line.set_y1(ln, lvl)\r\n        line.set_y2(ln, lvl)\r\n        line.set_width(ln, w)\r\n        line.set_color(ln, c)\r\n        line.set_style(ln, str >= 3 ? line.style_solid : line.style_dotted)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// TARGETING (offset label)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar line  tgtLine = na\r\nvar label tgtLbl  = na\r\n\r\nfloat tgtLvl   = na\r\nfloat tgtScore = na\r\nint   tgtStr   = 0\r\nbool  tgtInside = false\r\n\r\nif showTarget and array.size(lvls) > 0 and not na(hw)\r\n    float bestD = 1e10\r\n    int bestI = -1\r\n    for i = 0 to array.size(lvls) - 1\r\n        float lvl = array.get(lvls, i)\r\n        bool dirOK = fcstRet >= 0 ? lvl > close : lvl < close\r\n        if dirOK\r\n            float d = math.abs(lvl - close)\r\n            if d < bestD\r\n                bestD := d\r\n                bestI := i\r\n\r\n    if bestI != -1\r\n        tgtLvl := array.get(lvls, bestI)\r\n        tgtStr := array.get(strs, bestI)\r\n        float projHi = close * math.exp(nz(hiR, 0))\r\n        float projLo = close * math.exp(nz(loR, 0))\r\n        tgtInside := tgtLvl <= projHi and tgtLvl >= projLo\r\n        float distRet = math.log(f_div(tgtLvl, close))\r\n        float z = f_div(distRet - fcstRet, math.max(hw, 1e-10))\r\n        tgtScore := f_prob(z) * (tgtInside ? 1.0 : 0.65) * math.min(float(tgtStr) / 3.0, 1.0)\r\n\r\nif showTarget and isLast and not na(tgtLvl) and not na(tgtScore) and tgtScore >= targetMin\r\n    if not na(tgtLine)\r\n        line.delete(tgtLine)\r\n    if not na(tgtLbl)\r\n        label.delete(tgtLbl)\r\n\r\n    color tgtCol = tgtInside ? color.new(C_LONG, 20) : color.new(C_WARN, 20)\r\n    tgtLine := line.new(bar_index, tgtLvl, bar_index + h, tgtLvl, color=tgtCol, width=2, style=line.style_dashed)\r\n    string tgtTxt = (tgtInside ? "● IN" : "○ OUT") + " | " + str.tostring(tgtScore * 100, "#") + "% | ×" + str.tostring(tgtStr)\r\n    tgtLbl := label.new(bar_index + h + 3, tgtLvl, tgtTxt, style=label.style_label_left, color=tgtCol, textcolor=color.white, size=size.small)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// PROJECTION BANDS + BOX\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat pMid = close * math.exp(fcstRet)\r\nfloat pHi  = (showBands and not na(hiR)) ? close * math.exp(hiR) : na\r\nfloat pLo  = (showBands and not na(loR)) ? close * math.exp(loR) : na\r\n\r\nplot(showBands ? pMid : na, "Forecast", color=color.new(color.white, 55), linewidth=1)\r\np1 = plot(pHi, "Upper", color=color.new(color.aqua, 65), linewidth=1)\r\np2 = plot(pLo, "Lower", color=color.new(color.aqua, 65), linewidth=1)\r\nfill(p1, p2, color=showBands ? color.new(color.aqua, 92) : na)\r\n\r\nvar box fwdBox = na\r\nif showBox and isLast and not na(pHi) and not na(pLo)\r\n    if na(fwdBox)\r\n        fwdBox := box.new(bar_index, pHi, bar_index + h, pLo, bgcolor=color.new(color.gray, 94), border_color=color.new(color.white, 80))\r\n    else\r\n        box.set_lefttop(fwdBox, bar_index, pHi)\r\n        box.set_rightbottom(fwdBox, bar_index + h, pLo)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// SIGNAL MARKERS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nplotshape(sigL, "Long", style=shape.triangleup,   location=location.belowbar, color=color.new(C_LONG, 0),  size=size.normal, text="▲", textcolor=color.white)\r\nplotshape(sigS, "Short", style=shape.triangledown, location=location.abovebar, color=color.new(C_SHORT, 0), size=size.normal, text="▼", textcolor=color.white)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// CANDLE AURA (cyan/magenta, not green/red)\r\n//──────────────────────────────────────────────────────────────────────────────\r\ncolor aura = na\r\nif showAura\r\n    aura := isUncert ? color.new(C_WARN, 75) : (confCode == 2 ? color.new(C_CYAN, 75) : (confCode == -2 ? color.new(C_MAG, 75) : na))\r\nbarcolor(aura)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// CALIBRATION\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat hwPast = bar_index >= h ? hw[h] : na\r\nfloat tot = (not na(resid) and not na(hwPast)) ? 1.0 : 0.0\r\nfloat hit = (not na(resid) and not na(hwPast) and resid <= hwPast) ? 1.0 : 0.0\r\n\r\nfloat sumT = f_rollsum(tot, calibLen)\r\nfloat sumH = f_rollsum(hit, calibLen)\r\nfloat achCov = f_div(sumH, math.max(sumT, 1e-10))\r\n\r\nfloat sigSer = (sigL or sigS) ? 1.0 : 0.0\r\nfloat sigCnt = f_rollsum(sigSer, sigWin)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// DASHBOARD (single display)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar table dash = table.new(position.top_right, 2, 12, bgcolor=color.new(C_BG1, 0), border_width=1, border_color=color.new(color.gray, 40))\r\n\r\nif showDash and isLast\r\n    color hdrBg = confCode == 2 ? color.new(C_LONG, 60) : confCode == -2 ? color.new(C_SHORT, 60) : color.new(C_HDR, 70)\r\n\r\n    table.cell(dash, 0, 0, "  CCG FIREWALL • PRO CLEAN  ", text_color=color.white, bgcolor=hdrBg, text_size=txtSize)\r\n    table.cell(dash, 1, 0, confStr, text_color=color.white, bgcolor=hdrBg, text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 1, "Regime", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 1, regime,  text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    color fcCol = fcstRet > 0 ? C_LONG : fcstRet < 0 ? C_SHORT : C_DIMTXT\r\n    table.cell(dash, 0, 2, "Forecast", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 2, str.tostring(fcstRet * 100, "#.00") + "%", text_color=fcCol, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 3, "Uncertainty (HalfW)", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 3, na(hw) ? "—" : str.tostring(hw * 100, "#.00") + "%", text_color=isUncert ? C_WARN : color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 4, "Achieved Coverage", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 4, na(achCov) ? "—" : str.tostring(achCov * 100, "#.0") + "%", text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 5, "Signals (" + str.tostring(sigWin) + ")", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 5, na(sigCnt) ? "—" : str.tostring(sigCnt, "#"), text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 6, "Target Level", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 6, na(tgtLvl) ? "—" : str.tostring(tgtLvl, format.mintick), text_color=tgtInside ? C_LONG : C_WARN, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 7, "Target Score", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 7, na(tgtScore) ? "—" : str.tostring(tgtScore * 100, "#") + "%", text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 8, "S/R Legend", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 8, "🔵 Support | 🟠 Resistance", text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 9, "Pool Strength", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 9, "Width/opacity = touches", text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 10, "Gates", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 10, (useConfGate ? "Conf " : "") + (useUncertGate ? "Uncert " : "") + (useRegimeGate ? "Regime" : ""), text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 11, "Signal Score", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 11, str.tostring(finalScore, "#.00") + " / " + str.tostring(minScore, "#.00"), text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// ALERTS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nalertcondition(sigL, "CCG Long", "🟢 CCG LONG | {{ticker}} @ {{close}}")\r\nalertcondition(sigS, "CCG Short", "🔴 CCG SHORT | {{ticker}} @ {{close}}")\r\nalertcondition(isUncert, "High Uncertainty", "⚠️ UNCERTAINTY | {{ticker}}")\r\n'
[CAPTURE 1] '//@version=5\r\nindicator("Target Radar", overlay=true, max_labels_count=120, max_lines_count=120, max_boxes_count=30)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// INPUTS\r\n//──────────────────────────────────────────────────────────────────────────────\r\ngrpFcst = "━━ Forecast Engine ━━"\r\nh        = input.int(3, "Forecast Horizon", minval=1, maxval=10, group=grpFcst)\r\nlookback = input.int(100, "Z-Score Lookback", minval=20, maxval=200, group=grpFcst)\r\nwTrend   = input.float(0.30, "Weight: Trend", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwMom     = input.float(0.30, "Weight: Momentum", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwVol     = input.float(0.20, "Weight: Volatility (penalty)", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwVpr     = input.float(0.20, "Weight: Volume Pressure", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nretScale = input.float(1.0, "Return Scale", minval=0.1, maxval=5.0, step=0.1, group=grpFcst)\r\n\r\ngrpUnc = "━━ Uncertainty Band ━━"\r\ntargetCov   = input.float(0.80, "Target Coverage", minval=0.50, maxval=0.99, step=0.01, group=grpUnc)\r\nresLookback = input.int(200, "Residual Lookback", minval=50, maxval=500, group=grpUnc)\r\nminHW       = input.float(0.005, "Min Half-Width (return)", minval=0.0001, maxval=0.05, step=0.001, group=grpUnc)\r\nuncertTh    = input.float(0.08, "Uncertainty Spike", minval=0.01, maxval=0.20, step=0.01, group=grpUnc)\r\ndirEps      = input.float(0.001, "Direction epsilon", minval=0.0, maxval=0.01, step=0.0005, group=grpUnc)\r\n\r\ngrpSig = "━━ Signal Mode ━━"\r\nsigMode  = input.string("Breakout", "Mode", options=["Trend Pullback","Breakout","Mean Reversion","EMA Cross"], group=grpSig)\r\nminScore = input.float(0.65, "Min Signal Score", minval=0.0, maxval=1.0, step=0.05, group=grpSig)\r\n\r\ngrpFilt = "━━ Signal Filters (ACCURACY) ━━"\r\nuseConfGate   = input.bool(true, "Require Forecast Alignment", group=grpFilt)\r\nuseUncertGate = input.bool(true, "Block High Uncertainty", group=grpFilt)\r\nuseRegimeGate = input.bool(true, "Match Regime to Mode", group=grpFilt)\r\nadxLen        = input.int(14, "ADX Length", minval=5, maxval=50, group=grpFilt)\r\ntrendTh       = input.float(25.0, "Trend Threshold", minval=10, maxval=50, group=grpFilt)\r\nchopLen       = input.int(14, "Choppiness Length", minval=5, maxval=50, group=grpFilt)\r\nchaosTh       = input.float(62.0, "Chaos Threshold", minval=40, maxval=80, group=grpFilt)\r\n\r\ngrpPool = "━━ Support/Resistance Pools ━━"\r\nshowPools  = input.bool(true, "Show S/R Levels", group=grpPool)\r\npivotLen   = input.int(5, "Pivot Length", minval=2, maxval=15, group=grpPool)\r\nmergeATR   = input.float(0.5, "Merge Distance (ATR)", minval=0.1, maxval=2.0, step=0.1, group=grpPool)\r\nmaxPools   = input.int(8, "Max Levels", minval=3, maxval=15, group=grpPool)\r\npoolExtend = input.int(60, "Line Length (bars)", minval=20, maxval=200, group=grpPool)\r\nshowTarget = input.bool(true, "Show Target", group=grpPool)\r\ntargetMin  = input.float(0.40, "Min Target Score", minval=0.0, maxval=1.0, step=0.05, group=grpPool)\r\n\r\ngrpVis = "━━ Display ━━"\r\nshowBands = input.bool(true, "Projection Bands", group=grpVis)\r\nshowBox   = input.bool(true, "Forward Box", group=grpVis)\r\nshowDash  = input.bool(true, "Dashboard", group=grpVis)\r\ndashSize  = input.string("Normal", "Dashboard Size", options=["Small","Normal","Large"], group=grpVis)\r\nshowAura  = input.bool(false, "Candle Coloring (OFF by default)", group=grpVis)\r\n\r\ngrpCal = "━━ Calibration ━━"\r\ncalibLen = input.int(100, "Coverage Window", minval=30, maxval=300, group=grpCal)\r\nsigWin   = input.int(50,  "Signal Window", minval=20, maxval=200, group=grpCal)\r\n\r\nbool isLast = bar_index == last_bar_index\r\n\r\n// Compute table text sizes (NO `size` type keyword)\r\ntxtSize     = dashSize == "Small" ? size.tiny : dashSize == "Large" ? size.normal : size.small\r\ntxtSizeTiny = dashSize == "Large" ? size.small : size.tiny\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// COLORS\r\n//──────────────────────────────────────────────────────────────────────────────\r\ncolor C_SUPPORT = color.rgb(33, 150, 243)   // Blue\r\ncolor C_RESIST  = color.rgb(255, 152, 0)    // Orange\r\ncolor C_LONG    = color.rgb(76, 175, 80)    // Green\r\ncolor C_SHORT   = color.rgb(244, 67, 54)    // Red\r\ncolor C_WARN    = color.rgb(255, 152, 0)\r\ncolor C_CYAN    = color.rgb(0, 188, 212)\r\ncolor C_MAG     = color.rgb(233, 30, 99)\r\ncolor C_DIMTXT  = color.rgb(150, 150, 150)\r\ncolor C_BG1     = color.rgb(26, 26, 26)\r\ncolor C_BG2     = color.rgb(34, 34, 34)\r\ncolor C_HDR     = color.rgb(30, 136, 229)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// HELPERS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nf_div(float x, float y) =>\r\n    math.abs(y) < 1e-10 ? 0.0 : x / y\r\n\r\nf_z(float x, int len) =>\r\n    float m = ta.sma(x, len)\r\n    float sd = ta.stdev(x, len)\r\n    (x - m) / math.max(sd, 1e-10)\r\n\r\nf_bound(float x) =>\r\n    x / (1.0 + math.abs(x))\r\n\r\nf_rollsum(float x, int len) =>\r\n    float c = ta.cum(nz(x))\r\n    bar_index >= len ? (c - c[len]) : na\r\n\r\nf_log10(float x) =>\r\n    math.log(x) / math.log(10.0)\r\n\r\nf_tr() =>\r\n    float pc = nz(close[1], close)\r\n    float a = high - low\r\n    float b = math.abs(high - pc)\r\n    float c = math.abs(low - pc)\r\n    math.max(a, math.max(b, c))\r\n\r\nf_chop(int len) =>\r\n    float trSum = f_rollsum(f_tr(), len)\r\n    float rng = ta.highest(high, len) - ta.lowest(low, len)\r\n    float ratio = f_div(trSum, math.max(rng, 1e-10))\r\n    100.0 * f_div(f_log10(ratio), f_log10(len))\r\n\r\nf_zMult(float cov) =>\r\n    cov <= 0.60 ? 0.25 :\r\n     cov <= 0.68 ? 1.00 :\r\n     cov <= 0.80 ? 1.28 :\r\n     cov <= 0.90 ? 1.64 :\r\n     cov <= 0.95 ? 1.96 : 2.33\r\n\r\nf_prob(float z) =>\r\n    1.0 / (1.0 + z * z)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// FORECAST ENGINE\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat emaF = ta.ema(close, 10)\r\nfloat emaS = ta.ema(close, 20)\r\nfloat trendZ = f_z(f_div(emaF - emaS, math.max(emaS, 1e-10)), lookback)\r\n\r\nfloat rsi = ta.rsi(close, 14)\r\nfloat momZ = f_z(rsi - 50.0, lookback)\r\n\r\nfloat atr = ta.atr(14)\r\nfloat atrPct = f_div(atr, close)\r\nfloat volZ = f_z(atrPct, lookback)\r\n\r\nfloat upV = volume * (close > close[1] ? 1.0 : 0.0)\r\nfloat dnV = volume * (close < close[1] ? 1.0 : 0.0)\r\nfloat vpr = f_div(ta.sma(upV, 20), math.max(ta.sma(dnV, 20), 1e-10))\r\nfloat vprZ = f_z(math.log(math.max(vpr, 1e-10)), lookback)\r\n\r\nfloat wSum = math.max(wTrend + wMom + wVol + wVpr, 1e-10)\r\nfloat rawScore = (wTrend/wSum)*trendZ + (wMom/wSum)*momZ - (wVol/wSum)*volZ + (wVpr/wSum)*vprZ\r\nfloat fcstRet = f_bound(rawScore) * atrPct * retScale\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// ADAPTIVE UNCERTAINTY\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat realRet = bar_index >= h ? math.log(f_div(close, close[h])) : na\r\nfloat predRet = bar_index >= h ? fcstRet[h] : na\r\nfloat resid = (bar_index >= h and not na(realRet) and not na(predRet)) ? math.abs(realRet - predRet) : na\r\n\r\nfloat resMu = ta.sma(resid, resLookback)\r\nfloat resSd = ta.stdev(resid, resLookback)\r\nfloat zM = f_zMult(targetCov)\r\n\r\nfloat hwRaw = (not na(resMu) and not na(resSd)) ? (resMu + zM * resSd) : na\r\nfloat hw = not na(hwRaw) ? math.max(hwRaw, minHW) : na\r\n\r\nfloat loR = not na(hw) ? fcstRet - hw : na\r\nfloat hiR = not na(hw) ? fcstRet + hw : na\r\n\r\nbool isBull = fcstRet > dirEps\r\nbool isBear = fcstRet < -dirEps\r\nbool isUncert = not na(hw) and hw >= uncertTh\r\n\r\nint confCode = na(hw) ? 9 : isBull ? 2 : isBear ? -2 : 0\r\nstring confStr = confCode == 9 ? "WARMUP" : confCode == 2 ? "BULLISH" : confCode == -2 ? "BEARISH" : "NEUTRAL"\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// REGIME\r\n//──────────────────────────────────────────────────────────────────────────────\r\n[diP, diM, adx] = ta.dmi(adxLen, adxLen)\r\nfloat chop = f_chop(chopLen)\r\nstring regime = (not na(adx) and adx > trendTh) ? "TREND" : (chop > chaosTh ? "CHAOS" : "RANGE")\r\n\r\nbool regimeOK = true\r\nif useRegimeGate\r\n    if regime == "CHAOS"\r\n        regimeOK := false\r\n    else if regime == "TREND"\r\n        regimeOK := sigMode != "Mean Reversion"\r\n    else\r\n        regimeOK := sigMode == "Mean Reversion" or sigMode == "EMA Cross"\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// BASE SIGNALS + SCORING\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat ema20 = ta.ema(close, 20)\r\nfloat ema50 = ta.ema(close, 50)\r\n\r\nbool tpL = (ema20 > ema50) and ta.crossover(rsi, 30) and close > ema20\r\nbool tpS = (ema20 < ema50) and ta.crossunder(rsi, 70) and close < ema20\r\n\r\nfloat hi20 = ta.highest(high, 20)[1]\r\nfloat lo20 = ta.lowest(low, 20)[1]\r\nbool volOK = volume > ta.sma(volume, 20) * 1.3\r\nbool boL = ta.crossover(close, hi20) and volOK\r\nbool boS = ta.crossunder(close, lo20) and volOK\r\n\r\nfloat bb = ta.sma(close, 20)\r\nfloat sd = ta.stdev(close, 20)\r\nfloat zP = f_div(close - bb, math.max(sd, 1e-10))\r\nbool mrL = ta.crossover(zP, -2.0)\r\nbool mrS = ta.crossunder(zP, 2.0)\r\n\r\nfloat e9  = ta.ema(close, 9)\r\nfloat e21 = ta.ema(close, 21)\r\nbool xL = ta.crossover(e9, e21)\r\nbool xS = ta.crossunder(e9, e21)\r\n\r\nbool baseL = sigMode == "Trend Pullback" ? tpL : sigMode == "Breakout" ? boL : sigMode == "Mean Reversion" ? mrL : xL\r\nbool baseS = sigMode == "Trend Pullback" ? tpS : sigMode == "Breakout" ? boS : sigMode == "Mean Reversion" ? mrS : xS\r\n\r\nfloat scoreL = 0.0\r\nfloat scoreS = 0.0\r\nif baseL\r\n    scoreL := 0.40 + (useConfGate ? (isBull ? 0.25 : 0.0) : 0.10) + (useUncertGate ? (not isUncert ? 0.15 : 0.0) : 0.10) + (useRegimeGate ? (regimeOK ? 0.20 : 0.0) : 0.10)\r\nif baseS\r\n    scoreS := 0.40 + (useConfGate ? (isBear ? 0.25 : 0.0) : 0.10) + (useUncertGate ? (not isUncert ? 0.15 : 0.0) : 0.10) + (useRegimeGate ? (regimeOK ? 0.20 : 0.0) : 0.10)\r\n\r\nbool confGateL = useConfGate ? isBull : true\r\nbool confGateS = useConfGate ? isBear : true\r\nbool uncGate   = useUncertGate ? not isUncert : true\r\nbool regGate   = useRegimeGate ? regimeOK : true\r\n\r\nbool sigL = baseL and confGateL and uncGate and regGate and scoreL >= minScore\r\nbool sigS = baseS and confGateS and uncGate and regGate and scoreS >= minScore\r\nfloat finalScore = sigL ? scoreL : sigS ? scoreS : 0.0\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// SUPPORT / RESISTANCE POOLS (finite lines)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar float[] lvls  = array.new_float()\r\nvar int[]   strs  = array.new_int()\r\nvar int[]   sides = array.new_int()\r\nvar line[]  lns   = array.new_line()\r\n\r\nfloat mDist = atr * mergeATR\r\nfloat ph = ta.pivothigh(high, pivotLen, pivotLen)\r\nfloat pl = ta.pivotlow(low, pivotLen, pivotLen)\r\n\r\naddPool(float lvl, int side) =>\r\n    int n = array.size(lvls)\r\n    int best = -1\r\n    float bestD = 1e10\r\n\r\n    if n > 0\r\n        for i = 0 to n - 1\r\n            if array.get(sides, i) == side\r\n                float d = math.abs(array.get(lvls, i) - lvl)\r\n                if d < bestD\r\n                    bestD := d\r\n                    best := i\r\n\r\n    if best != -1 and bestD <= mDist\r\n        array.set(lvls, best, array.get(lvls, best) * 0.8 + lvl * 0.2)\r\n        array.set(strs, best, array.get(strs, best) + 1)\r\n    else\r\n        array.push(lvls, lvl)\r\n        array.push(strs, 1)\r\n        array.push(sides, side)\r\n        array.push(lns, line.new(bar_index, lvl, bar_index, lvl, extend=extend.none, style=line.style_solid, width=1))\r\n\r\n    while array.size(lvls) > maxPools\r\n        line.delete(array.shift(lns))\r\n        array.shift(lvls)\r\n        array.shift(strs)\r\n        array.shift(sides)\r\n\r\n    true\r\n\r\nif showPools\r\n    if not na(ph)\r\n        addPool(ph, +1)\r\n    if not na(pl)\r\n        addPool(pl, -1)\r\n\r\nif showPools and array.size(lvls) > 0\r\n    for i = 0 to array.size(lvls) - 1\r\n        float lvl = array.get(lvls, i)\r\n        int str   = array.get(strs, i)\r\n        int side  = array.get(sides, i)\r\n        line ln   = array.get(lns, i)\r\n\r\n        int w = str >= 5 ? 3 : str >= 3 ? 2 : 1\r\n        int transp = str >= 4 ? 25 : str >= 2 ? 40 : 55\r\n        color c = side == -1 ? color.new(C_SUPPORT, transp) : color.new(C_RESIST, transp)\r\n\r\n        int x1 = bar_index - poolExtend\r\n        int x2 = bar_index + 2\r\n\r\n        line.set_x1(ln, x1)\r\n        line.set_x2(ln, x2)\r\n        line.set_y1(ln, lvl)\r\n        line.set_y2(ln, lvl)\r\n        line.set_width(ln, w)\r\n        line.set_color(ln, c)\r\n        line.set_style(ln, str >= 3 ? line.style_solid : line.style_dotted)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// TARGETING (offset label)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar line  tgtLine = na\r\nvar label tgtLbl  = na\r\n\r\nfloat tgtLvl   = na\r\nfloat tgtScore = na\r\nint   tgtStr   = 0\r\nbool  tgtInside = false\r\n\r\nif showTarget and array.size(lvls) > 0 and not na(hw)\r\n    float bestD = 1e10\r\n    int bestI = -1\r\n    for i = 0 to array.size(lvls) - 1\r\n        float lvl = array.get(lvls, i)\r\n        bool dirOK = fcstRet >= 0 ? lvl > close : lvl < close\r\n        if dirOK\r\n            float d = math.abs(lvl - close)\r\n            if d < bestD\r\n                bestD := d\r\n                bestI := i\r\n\r\n    if bestI != -1\r\n        tgtLvl := array.get(lvls, bestI)\r\n        tgtStr := array.get(strs, bestI)\r\n        float projHi = close * math.exp(nz(hiR, 0))\r\n        float projLo = close * math.exp(nz(loR, 0))\r\n        tgtInside := tgtLvl <= projHi and tgtLvl >= projLo\r\n        float distRet = math.log(f_div(tgtLvl, close))\r\n        float z = f_div(distRet - fcstRet, math.max(hw, 1e-10))\r\n        tgtScore := f_prob(z) * (tgtInside ? 1.0 : 0.65) * math.min(float(tgtStr) / 3.0, 1.0)\r\n\r\nif showTarget and isLast and not na(tgtLvl) and not na(tgtScore) and tgtScore >= targetMin\r\n    if not na(tgtLine)\r\n        line.delete(tgtLine)\r\n    if not na(tgtLbl)\r\n        label.delete(tgtLbl)\r\n\r\n    color tgtCol = tgtInside ? color.new(C_LONG, 20) : color.new(C_WARN, 20)\r\n    tgtLine := line.new(bar_index, tgtLvl, bar_index + h, tgtLvl, color=tgtCol, width=2, style=line.style_dashed)\r\n    string tgtTxt = (tgtInside ? "● IN" : "○ OUT") + " | " + str.tostring(tgtScore * 100, "#") + "% | ×" + str.tostring(tgtStr)\r\n    tgtLbl := label.new(bar_index + h + 3, tgtLvl, tgtTxt, style=label.style_label_left, color=tgtCol, textcolor=color.white, size=size.small)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// PROJECTION BANDS + BOX\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat pMid = close * math.exp(fcstRet)\r\nfloat pHi  = (showBands and not na(hiR)) ? close * math.exp(hiR) : na\r\nfloat pLo  = (showBands and not na(loR)) ? close * math.exp(loR) : na\r\n\r\nplot(showBands ? pMid : na, "Forecast", color=color.new(color.white, 55), linewidth=1)\r\np1 = plot(pHi, "Upper", color=color.new(color.aqua, 65), linewidth=1)\r\np2 = plot(pLo, "Lower", color=color.new(color.aqua, 65), linewidth=1)\r\nfill(p1, p2, color=showBands ? color.new(color.aqua, 92) : na)\r\n\r\nvar box fwdBox = na\r\nif showBox and isLast and not na(pHi) and not na(pLo)\r\n    if na(fwdBox)\r\n        fwdBox := box.new(bar_index, pHi, bar_index + h, pLo, bgcolor=color.new(color.gray, 94), border_color=color.new(color.white, 80))\r\n    else\r\n        box.set_lefttop(fwdBox, bar_index, pHi)\r\n        box.set_rightbottom(fwdBox, bar_index + h, pLo)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// SIGNAL MARKERS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nplotshape(sigL, "Long", style=shape.triangleup,   location=location.belowbar, color=color.new(C_LONG, 0),  size=size.normal, text="▲", textcolor=color.white)\r\nplotshape(sigS, "Short", style=shape.triangledown, location=location.abovebar, color=color.new(C_SHORT, 0), size=size.normal, text="▼", textcolor=color.white)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// CANDLE AURA (cyan/magenta, not green/red)\r\n//──────────────────────────────────────────────────────────────────────────────\r\ncolor aura = na\r\nif showAura\r\n    aura := isUncert ? color.new(C_WARN, 75) : (confCode == 2 ? color.new(C_CYAN, 75) : (confCode == -2 ? color.new(C_MAG, 75) : na))\r\nbarcolor(aura)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// CALIBRATION\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat hwPast = bar_index >= h ? hw[h] : na\r\nfloat tot = (not na(resid) and not na(hwPast)) ? 1.0 : 0.0\r\nfloat hit = (not na(resid) and not na(hwPast) and resid <= hwPast) ? 1.0 : 0.0\r\n\r\nfloat sumT = f_rollsum(tot, calibLen)\r\nfloat sumH = f_rollsum(hit, calibLen)\r\nfloat achCov = f_div(sumH, math.max(sumT, 1e-10))\r\n\r\nfloat sigSer = (sigL or sigS) ? 1.0 : 0.0\r\nfloat sigCnt = f_rollsum(sigSer, sigWin)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// DASHBOARD (single display)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar table dash = table.new(position.top_right, 2, 12, bgcolor=color.new(C_BG1, 0), border_width=1, border_color=color.new(color.gray, 40))\r\n\r\nif showDash and isLast\r\n    color hdrBg = confCode == 2 ? color.new(C_LONG, 60) : confCode == -2 ? color.new(C_SHORT, 60) : color.new(C_HDR, 70)\r\n\r\n    table.cell(dash, 0, 0, "  CCG FIREWALL • PRO CLEAN  ", text_color=color.white, bgcolor=hdrBg, text_size=txtSize)\r\n    table.cell(dash, 1, 0, confStr, text_color=color.white, bgcolor=hdrBg, text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 1, "Regime", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 1, regime,  text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    color fcCol = fcstRet > 0 ? C_LONG : fcstRet < 0 ? C_SHORT : C_DIMTXT\r\n    table.cell(dash, 0, 2, "Forecast", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 2, str.tostring(fcstRet * 100, "#.00") + "%", text_color=fcCol, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 3, "Uncertainty (HalfW)", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 3, na(hw) ? "—" : str.tostring(hw * 100, "#.00") + "%", text_color=isUncert ? C_WARN : color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 4, "Achieved Coverage", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 4, na(achCov) ? "—" : str.tostring(achCov * 100, "#.0") + "%", text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 5, "Signals (" + str.tostring(sigWin) + ")", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 5, na(sigCnt) ? "—" : str.tostring(sigCnt, "#"), text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 6, "Target Level", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 6, na(tgtLvl) ? "—" : str.tostring(tgtLvl, format.mintick), text_color=tgtInside ? C_LONG : C_WARN, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 7, "Target Score", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 7, na(tgtScore) ? "—" : str.tostring(tgtScore * 100, "#") + "%", text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 8, "S/R Legend", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 8, "🔵 Support | 🟠 Resistance", text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 9, "Pool Strength", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 9, "Width/opacity = touches", text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 10, "Gates", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 10, (useConfGate ? "Conf " : "") + (useUncertGate ? "Uncert " : "") + (useRegimeGate ? "Regime" : ""), text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 11, "Signal Score", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 11, str.tostring(finalScore, "#.00") + " / " + str.tostring(minScore, "#.00"), text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// ALERTS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nalertcondition(sigL, "CCG Long", "🟢 CCG LONG | {{ticker}} @ {{close}}")\r\nalertcondition(sigS, "CCG Short", "🔴 CCG SHORT | {{ticker}} @ {{close}}")\r\nalertcondition(isUncert, "High Uncertainty", "⚠️ UNCERTAINTY | {{ticker}}")\r\n'
[CAPTURE 2] '//@version=5\r\nindicator("Target Radar", overlay=true, max_labels_count=120, max_lines_count=120, max_boxes_count=30)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// INPUTS\r\n//──────────────────────────────────────────────────────────────────────────────\r\ngrpFcst = "━━ Forecast Engine ━━"\r\nh        = input.int(3, "Forecast Horizon", minval=1, maxval=10, group=grpFcst)\r\nlookback = input.int(100, "Z-Score Lookback", minval=20, maxval=200, group=grpFcst)\r\nwTrend   = input.float(0.30, "Weight: Trend", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwMom     = input.float(0.30, "Weight: Momentum", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwVol     = input.float(0.20, "Weight: Volatility (penalty)", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nwVpr     = input.float(0.20, "Weight: Volume Pressure", minval=0, maxval=1, step=0.05, group=grpFcst)\r\nretScale = input.float(1.0, "Return Scale", minval=0.1, maxval=5.0, step=0.1, group=grpFcst)\r\n\r\ngrpUnc = "━━ Uncertainty Band ━━"\r\ntargetCov   = input.float(0.80, "Target Coverage", minval=0.50, maxval=0.99, step=0.01, group=grpUnc)\r\nresLookback = input.int(200, "Residual Lookback", minval=50, maxval=500, group=grpUnc)\r\nminHW       = input.float(0.005, "Min Half-Width (return)", minval=0.0001, maxval=0.05, step=0.001, group=grpUnc)\r\nuncertTh    = input.float(0.08, "Uncertainty Spike", minval=0.01, maxval=0.20, step=0.01, group=grpUnc)\r\ndirEps      = input.float(0.001, "Direction epsilon", minval=0.0, maxval=0.01, step=0.0005, group=grpUnc)\r\n\r\ngrpSig = "━━ Signal Mode ━━"\r\nsigMode  = input.string("Breakout", "Mode", options=["Trend Pullback","Breakout","Mean Reversion","EMA Cross"], group=grpSig)\r\nminScore = input.float(0.65, "Min Signal Score", minval=0.0, maxval=1.0, step=0.05, group=grpSig)\r\n\r\ngrpFilt = "━━ Signal Filters (ACCURACY) ━━"\r\nuseConfGate   = input.bool(true, "Require Forecast Alignment", group=grpFilt)\r\nuseUncertGate = input.bool(true, "Block High Uncertainty", group=grpFilt)\r\nuseRegimeGate = input.bool(true, "Match Regime to Mode", group=grpFilt)\r\nadxLen        = input.int(14, "ADX Length", minval=5, maxval=50, group=grpFilt)\r\ntrendTh       = input.float(25.0, "Trend Threshold", minval=10, maxval=50, group=grpFilt)\r\nchopLen       = input.int(14, "Choppiness Length", minval=5, maxval=50, group=grpFilt)\r\nchaosTh       = input.float(62.0, "Chaos Threshold", minval=40, maxval=80, group=grpFilt)\r\n\r\ngrpPool = "━━ Support/Resistance Pools ━━"\r\nshowPools  = input.bool(true, "Show S/R Levels", group=grpPool)\r\npivotLen   = input.int(5, "Pivot Length", minval=2, maxval=15, group=grpPool)\r\nmergeATR   = input.float(0.5, "Merge Distance (ATR)", minval=0.1, maxval=2.0, step=0.1, group=grpPool)\r\nmaxPools   = input.int(8, "Max Levels", minval=3, maxval=15, group=grpPool)\r\npoolExtend = input.int(60, "Line Length (bars)", minval=20, maxval=200, group=grpPool)\r\nshowTarget = input.bool(true, "Show Target", group=grpPool)\r\ntargetMin  = input.float(0.40, "Min Target Score", minval=0.0, maxval=1.0, step=0.05, group=grpPool)\r\n\r\ngrpVis = "━━ Display ━━"\r\nshowBands = input.bool(true, "Projection Bands", group=grpVis)\r\nshowBox   = input.bool(true, "Forward Box", group=grpVis)\r\nshowDash  = input.bool(true, "Dashboard", group=grpVis)\r\ndashSize  = input.string("Normal", "Dashboard Size", options=["Small","Normal","Large"], group=grpVis)\r\nshowAura  = input.bool(false, "Candle Coloring (OFF by default)", group=grpVis)\r\n\r\ngrpCal = "━━ Calibration ━━"\r\ncalibLen = input.int(100, "Coverage Window", minval=30, maxval=300, group=grpCal)\r\nsigWin   = input.int(50,  "Signal Window", minval=20, maxval=200, group=grpCal)\r\n\r\nbool isLast = bar_index == last_bar_index\r\n\r\n// Compute table text sizes (NO `size` type keyword)\r\ntxtSize     = dashSize == "Small" ? size.tiny : dashSize == "Large" ? size.normal : size.small\r\ntxtSizeTiny = dashSize == "Large" ? size.small : size.tiny\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// COLORS\r\n//──────────────────────────────────────────────────────────────────────────────\r\ncolor C_SUPPORT = color.rgb(33, 150, 243)   // Blue\r\ncolor C_RESIST  = color.rgb(255, 152, 0)    // Orange\r\ncolor C_LONG    = color.rgb(76, 175, 80)    // Green\r\ncolor C_SHORT   = color.rgb(244, 67, 54)    // Red\r\ncolor C_WARN    = color.rgb(255, 152, 0)\r\ncolor C_CYAN    = color.rgb(0, 188, 212)\r\ncolor C_MAG     = color.rgb(233, 30, 99)\r\ncolor C_DIMTXT  = color.rgb(150, 150, 150)\r\ncolor C_BG1     = color.rgb(26, 26, 26)\r\ncolor C_BG2     = color.rgb(34, 34, 34)\r\ncolor C_HDR     = color.rgb(30, 136, 229)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// HELPERS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nf_div(float x, float y) =>\r\n    math.abs(y) < 1e-10 ? 0.0 : x / y\r\n\r\nf_z(float x, int len) =>\r\n    float m = ta.sma(x, len)\r\n    float sd = ta.stdev(x, len)\r\n    (x - m) / math.max(sd, 1e-10)\r\n\r\nf_bound(float x) =>\r\n    x / (1.0 + math.abs(x))\r\n\r\nf_rollsum(float x, int len) =>\r\n    float c = ta.cum(nz(x))\r\n    bar_index >= len ? (c - c[len]) : na\r\n\r\nf_log10(float x) =>\r\n    math.log(x) / math.log(10.0)\r\n\r\nf_tr() =>\r\n    float pc = nz(close[1], close)\r\n    float a = high - low\r\n    float b = math.abs(high - pc)\r\n    float c = math.abs(low - pc)\r\n    math.max(a, math.max(b, c))\r\n\r\nf_chop(int len) =>\r\n    float trSum = f_rollsum(f_tr(), len)\r\n    float rng = ta.highest(high, len) - ta.lowest(low, len)\r\n    float ratio = f_div(trSum, math.max(rng, 1e-10))\r\n    100.0 * f_div(f_log10(ratio), f_log10(len))\r\n\r\nf_zMult(float cov) =>\r\n    cov <= 0.60 ? 0.25 :\r\n     cov <= 0.68 ? 1.00 :\r\n     cov <= 0.80 ? 1.28 :\r\n     cov <= 0.90 ? 1.64 :\r\n     cov <= 0.95 ? 1.96 : 2.33\r\n\r\nf_prob(float z) =>\r\n    1.0 / (1.0 + z * z)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// FORECAST ENGINE\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat emaF = ta.ema(close, 10)\r\nfloat emaS = ta.ema(close, 20)\r\nfloat trendZ = f_z(f_div(emaF - emaS, math.max(emaS, 1e-10)), lookback)\r\n\r\nfloat rsi = ta.rsi(close, 14)\r\nfloat momZ = f_z(rsi - 50.0, lookback)\r\n\r\nfloat atr = ta.atr(14)\r\nfloat atrPct = f_div(atr, close)\r\nfloat volZ = f_z(atrPct, lookback)\r\n\r\nfloat upV = volume * (close > close[1] ? 1.0 : 0.0)\r\nfloat dnV = volume * (close < close[1] ? 1.0 : 0.0)\r\nfloat vpr = f_div(ta.sma(upV, 20), math.max(ta.sma(dnV, 20), 1e-10))\r\nfloat vprZ = f_z(math.log(math.max(vpr, 1e-10)), lookback)\r\n\r\nfloat wSum = math.max(wTrend + wMom + wVol + wVpr, 1e-10)\r\nfloat rawScore = (wTrend/wSum)*trendZ + (wMom/wSum)*momZ - (wVol/wSum)*volZ + (wVpr/wSum)*vprZ\r\nfloat fcstRet = f_bound(rawScore) * atrPct * retScale\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// ADAPTIVE UNCERTAINTY\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat realRet = bar_index >= h ? math.log(f_div(close, close[h])) : na\r\nfloat predRet = bar_index >= h ? fcstRet[h] : na\r\nfloat resid = (bar_index >= h and not na(realRet) and not na(predRet)) ? math.abs(realRet - predRet) : na\r\n\r\nfloat resMu = ta.sma(resid, resLookback)\r\nfloat resSd = ta.stdev(resid, resLookback)\r\nfloat zM = f_zMult(targetCov)\r\n\r\nfloat hwRaw = (not na(resMu) and not na(resSd)) ? (resMu + zM * resSd) : na\r\nfloat hw = not na(hwRaw) ? math.max(hwRaw, minHW) : na\r\n\r\nfloat loR = not na(hw) ? fcstRet - hw : na\r\nfloat hiR = not na(hw) ? fcstRet + hw : na\r\n\r\nbool isBull = fcstRet > dirEps\r\nbool isBear = fcstRet < -dirEps\r\nbool isUncert = not na(hw) and hw >= uncertTh\r\n\r\nint confCode = na(hw) ? 9 : isBull ? 2 : isBear ? -2 : 0\r\nstring confStr = confCode == 9 ? "WARMUP" : confCode == 2 ? "BULLISH" : confCode == -2 ? "BEARISH" : "NEUTRAL"\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// REGIME\r\n//──────────────────────────────────────────────────────────────────────────────\r\n[diP, diM, adx] = ta.dmi(adxLen, adxLen)\r\nfloat chop = f_chop(chopLen)\r\nstring regime = (not na(adx) and adx > trendTh) ? "TREND" : (chop > chaosTh ? "CHAOS" : "RANGE")\r\n\r\nbool regimeOK = true\r\nif useRegimeGate\r\n    if regime == "CHAOS"\r\n        regimeOK := false\r\n    else if regime == "TREND"\r\n        regimeOK := sigMode != "Mean Reversion"\r\n    else\r\n        regimeOK := sigMode == "Mean Reversion" or sigMode == "EMA Cross"\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// BASE SIGNALS + SCORING\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat ema20 = ta.ema(close, 20)\r\nfloat ema50 = ta.ema(close, 50)\r\n\r\nbool tpL = (ema20 > ema50) and ta.crossover(rsi, 30) and close > ema20\r\nbool tpS = (ema20 < ema50) and ta.crossunder(rsi, 70) and close < ema20\r\n\r\nfloat hi20 = ta.highest(high, 20)[1]\r\nfloat lo20 = ta.lowest(low, 20)[1]\r\nbool volOK = volume > ta.sma(volume, 20) * 1.3\r\nbool boL = ta.crossover(close, hi20) and volOK\r\nbool boS = ta.crossunder(close, lo20) and volOK\r\n\r\nfloat bb = ta.sma(close, 20)\r\nfloat sd = ta.stdev(close, 20)\r\nfloat zP = f_div(close - bb, math.max(sd, 1e-10))\r\nbool mrL = ta.crossover(zP, -2.0)\r\nbool mrS = ta.crossunder(zP, 2.0)\r\n\r\nfloat e9  = ta.ema(close, 9)\r\nfloat e21 = ta.ema(close, 21)\r\nbool xL = ta.crossover(e9, e21)\r\nbool xS = ta.crossunder(e9, e21)\r\n\r\nbool baseL = sigMode == "Trend Pullback" ? tpL : sigMode == "Breakout" ? boL : sigMode == "Mean Reversion" ? mrL : xL\r\nbool baseS = sigMode == "Trend Pullback" ? tpS : sigMode == "Breakout" ? boS : sigMode == "Mean Reversion" ? mrS : xS\r\n\r\nfloat scoreL = 0.0\r\nfloat scoreS = 0.0\r\nif baseL\r\n    scoreL := 0.40 + (useConfGate ? (isBull ? 0.25 : 0.0) : 0.10) + (useUncertGate ? (not isUncert ? 0.15 : 0.0) : 0.10) + (useRegimeGate ? (regimeOK ? 0.20 : 0.0) : 0.10)\r\nif baseS\r\n    scoreS := 0.40 + (useConfGate ? (isBear ? 0.25 : 0.0) : 0.10) + (useUncertGate ? (not isUncert ? 0.15 : 0.0) : 0.10) + (useRegimeGate ? (regimeOK ? 0.20 : 0.0) : 0.10)\r\n\r\nbool confGateL = useConfGate ? isBull : true\r\nbool confGateS = useConfGate ? isBear : true\r\nbool uncGate   = useUncertGate ? not isUncert : true\r\nbool regGate   = useRegimeGate ? regimeOK : true\r\n\r\nbool sigL = baseL and confGateL and uncGate and regGate and scoreL >= minScore\r\nbool sigS = baseS and confGateS and uncGate and regGate and scoreS >= minScore\r\nfloat finalScore = sigL ? scoreL : sigS ? scoreS : 0.0\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// SUPPORT / RESISTANCE POOLS (finite lines)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar float[] lvls  = array.new_float()\r\nvar int[]   strs  = array.new_int()\r\nvar int[]   sides = array.new_int()\r\nvar line[]  lns   = array.new_line()\r\n\r\nfloat mDist = atr * mergeATR\r\nfloat ph = ta.pivothigh(high, pivotLen, pivotLen)\r\nfloat pl = ta.pivotlow(low, pivotLen, pivotLen)\r\n\r\naddPool(float lvl, int side) =>\r\n    int n = array.size(lvls)\r\n    int best = -1\r\n    float bestD = 1e10\r\n\r\n    if n > 0\r\n        for i = 0 to n - 1\r\n            if array.get(sides, i) == side\r\n                float d = math.abs(array.get(lvls, i) - lvl)\r\n                if d < bestD\r\n                    bestD := d\r\n                    best := i\r\n\r\n    if best != -1 and bestD <= mDist\r\n        array.set(lvls, best, array.get(lvls, best) * 0.8 + lvl * 0.2)\r\n        array.set(strs, best, array.get(strs, best) + 1)\r\n    else\r\n        array.push(lvls, lvl)\r\n        array.push(strs, 1)\r\n        array.push(sides, side)\r\n        array.push(lns, line.new(bar_index, lvl, bar_index, lvl, extend=extend.none, style=line.style_solid, width=1))\r\n\r\n    while array.size(lvls) > maxPools\r\n        line.delete(array.shift(lns))\r\n        array.shift(lvls)\r\n        array.shift(strs)\r\n        array.shift(sides)\r\n\r\n    true\r\n\r\nif showPools\r\n    if not na(ph)\r\n        addPool(ph, +1)\r\n    if not na(pl)\r\n        addPool(pl, -1)\r\n\r\nif showPools and array.size(lvls) > 0\r\n    for i = 0 to array.size(lvls) - 1\r\n        float lvl = array.get(lvls, i)\r\n        int str   = array.get(strs, i)\r\n        int side  = array.get(sides, i)\r\n        line ln   = array.get(lns, i)\r\n\r\n        int w = str >= 5 ? 3 : str >= 3 ? 2 : 1\r\n        int transp = str >= 4 ? 25 : str >= 2 ? 40 : 55\r\n        color c = side == -1 ? color.new(C_SUPPORT, transp) : color.new(C_RESIST, transp)\r\n\r\n        int x1 = bar_index - poolExtend\r\n        int x2 = bar_index + 2\r\n\r\n        line.set_x1(ln, x1)\r\n        line.set_x2(ln, x2)\r\n        line.set_y1(ln, lvl)\r\n        line.set_y2(ln, lvl)\r\n        line.set_width(ln, w)\r\n        line.set_color(ln, c)\r\n        line.set_style(ln, str >= 3 ? line.style_solid : line.style_dotted)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// TARGETING (offset label)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar line  tgtLine = na\r\nvar label tgtLbl  = na\r\n\r\nfloat tgtLvl   = na\r\nfloat tgtScore = na\r\nint   tgtStr   = 0\r\nbool  tgtInside = false\r\n\r\nif showTarget and array.size(lvls) > 0 and not na(hw)\r\n    float bestD = 1e10\r\n    int bestI = -1\r\n    for i = 0 to array.size(lvls) - 1\r\n        float lvl = array.get(lvls, i)\r\n        bool dirOK = fcstRet >= 0 ? lvl > close : lvl < close\r\n        if dirOK\r\n            float d = math.abs(lvl - close)\r\n            if d < bestD\r\n                bestD := d\r\n                bestI := i\r\n\r\n    if bestI != -1\r\n        tgtLvl := array.get(lvls, bestI)\r\n        tgtStr := array.get(strs, bestI)\r\n        float projHi = close * math.exp(nz(hiR, 0))\r\n        float projLo = close * math.exp(nz(loR, 0))\r\n        tgtInside := tgtLvl <= projHi and tgtLvl >= projLo\r\n        float distRet = math.log(f_div(tgtLvl, close))\r\n        float z = f_div(distRet - fcstRet, math.max(hw, 1e-10))\r\n        tgtScore := f_prob(z) * (tgtInside ? 1.0 : 0.65) * math.min(float(tgtStr) / 3.0, 1.0)\r\n\r\nif showTarget and isLast and not na(tgtLvl) and not na(tgtScore) and tgtScore >= targetMin\r\n    if not na(tgtLine)\r\n        line.delete(tgtLine)\r\n    if not na(tgtLbl)\r\n        label.delete(tgtLbl)\r\n\r\n    color tgtCol = tgtInside ? color.new(C_LONG, 20) : color.new(C_WARN, 20)\r\n    tgtLine := line.new(bar_index, tgtLvl, bar_index + h, tgtLvl, color=tgtCol, width=2, style=line.style_dashed)\r\n    string tgtTxt = (tgtInside ? "● IN" : "○ OUT") + " | " + str.tostring(tgtScore * 100, "#") + "% | ×" + str.tostring(tgtStr)\r\n    tgtLbl := label.new(bar_index + h + 3, tgtLvl, tgtTxt, style=label.style_label_left, color=tgtCol, textcolor=color.white, size=size.small)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// PROJECTION BANDS + BOX\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat pMid = close * math.exp(fcstRet)\r\nfloat pHi  = (showBands and not na(hiR)) ? close * math.exp(hiR) : na\r\nfloat pLo  = (showBands and not na(loR)) ? close * math.exp(loR) : na\r\n\r\nplot(showBands ? pMid : na, "Forecast", color=color.new(color.white, 55), linewidth=1)\r\np1 = plot(pHi, "Upper", color=color.new(color.aqua, 65), linewidth=1)\r\np2 = plot(pLo, "Lower", color=color.new(color.aqua, 65), linewidth=1)\r\nfill(p1, p2, color=showBands ? color.new(color.aqua, 92) : na)\r\n\r\nvar box fwdBox = na\r\nif showBox and isLast and not na(pHi) and not na(pLo)\r\n    if na(fwdBox)\r\n        fwdBox := box.new(bar_index, pHi, bar_index + h, pLo, bgcolor=color.new(color.gray, 94), border_color=color.new(color.white, 80))\r\n    else\r\n        box.set_lefttop(fwdBox, bar_index, pHi)\r\n        box.set_rightbottom(fwdBox, bar_index + h, pLo)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// SIGNAL MARKERS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nplotshape(sigL, "Long", style=shape.triangleup,   location=location.belowbar, color=color.new(C_LONG, 0),  size=size.normal, text="▲", textcolor=color.white)\r\nplotshape(sigS, "Short", style=shape.triangledown, location=location.abovebar, color=color.new(C_SHORT, 0), size=size.normal, text="▼", textcolor=color.white)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// CANDLE AURA (cyan/magenta, not green/red)\r\n//──────────────────────────────────────────────────────────────────────────────\r\ncolor aura = na\r\nif showAura\r\n    aura := isUncert ? color.new(C_WARN, 75) : (confCode == 2 ? color.new(C_CYAN, 75) : (confCode == -2 ? color.new(C_MAG, 75) : na))\r\nbarcolor(aura)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// CALIBRATION\r\n//──────────────────────────────────────────────────────────────────────────────\r\nfloat hwPast = bar_index >= h ? hw[h] : na\r\nfloat tot = (not na(resid) and not na(hwPast)) ? 1.0 : 0.0\r\nfloat hit = (not na(resid) and not na(hwPast) and resid <= hwPast) ? 1.0 : 0.0\r\n\r\nfloat sumT = f_rollsum(tot, calibLen)\r\nfloat sumH = f_rollsum(hit, calibLen)\r\nfloat achCov = f_div(sumH, math.max(sumT, 1e-10))\r\n\r\nfloat sigSer = (sigL or sigS) ? 1.0 : 0.0\r\nfloat sigCnt = f_rollsum(sigSer, sigWin)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// DASHBOARD (single display)\r\n//──────────────────────────────────────────────────────────────────────────────\r\nvar table dash = table.new(position.top_right, 2, 12, bgcolor=color.new(C_BG1, 0), border_width=1, border_color=color.new(color.gray, 40))\r\n\r\nif showDash and isLast\r\n    color hdrBg = confCode == 2 ? color.new(C_LONG, 60) : confCode == -2 ? color.new(C_SHORT, 60) : color.new(C_HDR, 70)\r\n\r\n    table.cell(dash, 0, 0, "  CCG FIREWALL • PRO CLEAN  ", text_color=color.white, bgcolor=hdrBg, text_size=txtSize)\r\n    table.cell(dash, 1, 0, confStr, text_color=color.white, bgcolor=hdrBg, text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 1, "Regime", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 1, regime,  text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    color fcCol = fcstRet > 0 ? C_LONG : fcstRet < 0 ? C_SHORT : C_DIMTXT\r\n    table.cell(dash, 0, 2, "Forecast", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 2, str.tostring(fcstRet * 100, "#.00") + "%", text_color=fcCol, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 3, "Uncertainty (HalfW)", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 3, na(hw) ? "—" : str.tostring(hw * 100, "#.00") + "%", text_color=isUncert ? C_WARN : color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 4, "Achieved Coverage", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 4, na(achCov) ? "—" : str.tostring(achCov * 100, "#.0") + "%", text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 5, "Signals (" + str.tostring(sigWin) + ")", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 5, na(sigCnt) ? "—" : str.tostring(sigCnt, "#"), text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 6, "Target Level", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 6, na(tgtLvl) ? "—" : str.tostring(tgtLvl, format.mintick), text_color=tgtInside ? C_LONG : C_WARN, bgcolor=color.new(C_BG1, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 7, "Target Score", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSize)\r\n    table.cell(dash, 1, 7, na(tgtScore) ? "—" : str.tostring(tgtScore * 100, "#") + "%", text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSize, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 8, "S/R Legend", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 8, "🔵 Support | 🟠 Resistance", text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 9, "Pool Strength", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 9, "Width/opacity = touches", text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 10, "Gates", text_color=C_DIMTXT, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 10, (useConfGate ? "Conf " : "") + (useUncertGate ? "Uncert " : "") + (useRegimeGate ? "Regime" : ""), text_color=color.white, bgcolor=color.new(C_BG1, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n    table.cell(dash, 0, 11, "Signal Score", text_color=C_DIMTXT, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny)\r\n    table.cell(dash, 1, 11, str.tostring(finalScore, "#.00") + " / " + str.tostring(minScore, "#.00"), text_color=color.white, bgcolor=color.new(C_BG2, 0), text_size=txtSizeTiny, text_halign=text.align_right)\r\n\r\n//──────────────────────────────────────────────────────────────────────────────\r\n// ALERTS\r\n//──────────────────────────────────────────────────────────────────────────────\r\nalertcondition(sigL, "CCG Long", "🟢 CCG LONG | {{ticker}} @ {{close}}")\r\nalertcondition(sigS, "CCG Short", "🔴 CCG SHORT | {{ticker}} @ {{close}}")\r\nalertcondition(isUncert, "High Uncertainty", "⚠️ UNCERTAINTY | {{ticker}}")\r\n'
[DEBUG] save_script called: script_id=PNS8tTkY title=Target Radar category=PNS8tTkY force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\PNS8tTkY_Target_Radar.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\PNS8tTkY_Target_Radar.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 04:53:46 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 04:53:46 GMT' as: 2026-02-09T04:53:46+00:00
[DEBUG] Exact published date for header: 2026-02-09T04:53:46+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/OeT4X3ux-Strat-Numbers-Daily-Weekly-and-Monthly-Levels-plus-50-Rule/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\nindicator(title="Julio Table", shorttitle="STRAT+SMC", overlay=true, max_labels_count=500)\r\n\r\n// ==========================================\r\n// --- GLOBAL FUNCTIONS ---\r\n// ==========================================\r\nf_strat(o, h, l, c, ph, pl) =>\r\n    inside  = h <= ph and l >= pl\r\n    outside = h > ph and l < pl\r\n    bullish = c > o\r\n    bearish = c < o\r\n    inside ? 1 : outside ? 3 : bullish ? 2 : bearish ? -2 : 0\r\n\r\nf_stratColor(v) =>\r\n    v == 1 ? color.yellow : v == 2 ? color.green : v == -2 ? color.red : v == 3 ? color.purple : color.gray\r\n\r\nf_stratText(v) =>\r\n    v == 1 ? "1" : v == 2 ? "2U" : v == -2 ? "2D" : v == 3 ? "3" : ""\r\n\r\ngetLineStyle(style) =>\r\n    switch style\r\n        "Dashed" => line.style_dashed\r\n        "Dotted" => line.style_dotted\r\n        => line.style_solid\r\n\r\n// --- ROBUST ES/NQ CALCULATION LOGIC ---\r\nf_calc_custom_range(symbol) =>\r\n    // Request 1-minute data for precision on specific time anchors\r\n    [h, l, c] = request.security(symbol, "1", [high, low, close], lookahead=barmerge.lookahead_on)\r\n    \r\n    var float hiAfterMidnight = na\r\n    var float loBefore830     = na\r\n    var float priceAt830      = na\r\n    \r\n    // Time Definitions (Forced to New York Time)\r\n    is_midnight    = hour(time, "America/New_York") == 0 and minute(time, "America/New_York") == 0\r\n    in_window      = time(timeframe.period, "0000-0830", "America/New_York")\r\n    is_830_window  = hour(time, "America/New_York") == 8 and minute(time, "America/New_York") == 30\r\n\r\n    // Reset and track High/Low from Midnight to 08:30\r\n    if is_midnight\r\n        hiAfterMidnight := h\r\n        loBefore830     := l\r\n    else if not na(in_window)\r\n        hiAfterMidnight := math.max(h, nz(hiAfterMidnight, h))\r\n        loBefore830     := math.min(l, nz(loBefore830, l))\r\n    \r\n    // Capture anchor price at exactly 08:30 and persist it\r\n    if is_830_window\r\n        priceAt830 := c\r\n\r\n    // Perform calculation only if priceAt830 is found to avoid NaN\r\n    float customPct = not na(priceAt830) and priceAt830 != 0 ? ((hiAfterMidnight - loBefore830) / priceAt830) * 100 : na\r\n    [customPct, priceAt830]\r\n\r\n// ==========================================\r\n// --- INPUTS ---\r\n// ==========================================\r\ngroupPM      = "Pre-Market Colors & Styles"\r\nPMH_col      = input.color(color.yellow, "Pre-Market High", group=groupPM)\r\nPML_col      = input.color(color.red, "Pre-Market Low", group=groupPM)\r\nPM_style     = input.string("Solid", "Pre-Market Style", options=["Solid", "Dashed", "Dotted"], group=groupPM)\r\nPM_width     = input.int(2, "PM Line Width", minval=1, group=groupPM)\r\n\r\ngroupMS      = "Market Structure (BOS/CHoCH)"\r\nmsLen        = input.int(5, "Swing Strength", minval=2, group=groupMS)\r\nbosCol       = input.color(color.gray, "BOS Color", group=groupMS)\r\nchochCol     = input.color(color.white, "CHoCH Color", group=groupMS)\r\n\r\ngroupD       = "Daily Colors & Styles"\r\nD_col        = input.color(color.orange, "Daily H/L", group=groupD)\r\nDO_col       = input.color(color.white, "Daily Open", group=groupD)\r\nD_style      = input.string("Solid", "Daily Style", options=["Solid", "Dashed", "Dotted"], group=groupD)\r\n\r\ngroupW       = "Weekly Colors & Styles"\r\nW_col        = input.color(color.blue, "Weekly H/L", group=groupW)\r\nWO_col       = input.color(color.white, "Weekly Open", group=groupW)\r\nW_style      = input.string("Solid", "Weekly Style", options=["Solid", "Dashed", "Dotted"], group=groupW)\r\n\r\ngroupM       = "Monthly Colors & Styles"\r\nM_col        = input.color(color.fuchsia, "Monthly H/L", group=groupM)\r\nMO_col       = input.color(color.white, "Monthly Open", group=groupM)\r\nM_style      = input.string("Solid", "Monthly Style", options=["Solid", "Dashed", "Dotted"], group=groupM)\r\n\r\ngroupMid     = "Midpoint (50%) Bearish Logic"\r\nMidStyle     = input.string("Dashed", "Default 50% Style", options=["Solid", "Dashed", "Dotted"], group=groupMid)\r\nMidBelowC    = input.color(color.red, "50% Color (If Price Below)", group=groupMid)\r\nMidBelowS    = input.string("Dotted", "50% Style (If Price Below)", options=["Solid", "Dashed", "Dotted"], group=groupMid)\r\n\r\n// ==========================================\r\n// --- PRE-MARKET LOGIC ---\r\n// ==========================================\r\nvar float autoPMH = na\r\nvar float autoPML = na\r\nin_premarket = not na(time(timeframe.period, "0400-0930", "America/New_York"))\r\nis_new_day   = ta.change(time("D")) != 0\r\n\r\nif in_premarket\r\n    if is_new_day or na(autoPMH)\r\n        autoPMH := high\r\n        autoPML := low\r\n    else\r\n        autoPMH := math.max(high, autoPMH)\r\n        autoPML := math.min(low, autoPML)\r\n\r\n// ==========================================\r\n// --- LEVEL CALCULATIONS ---\r\n// ==========================================\r\n[yO, yH, yL]     = request.security(syminfo.tickerid, "D", [open, high[1], low[1]])\r\n[pwO, pwH, pwL]  = request.security(syminfo.tickerid, "W", [open, high[1], low[1]])\r\n[pmO, pmH, pmL]  = request.security(syminfo.tickerid, "M", [open, high[1], low[1]])\r\n[pqO, pqH, pqL]  = request.security(syminfo.tickerid, "3M", [open, high[1], low[1]])\r\n\r\nyMid = (yH + yL) / 2\r\nwMid = (pwH + pwL) / 2\r\nmMid = (pmH + pmL) / 2\r\nqMid = (pqH + pqL) / 2\r\n\r\n// Applying custom 8:30 Correlation Logic\r\n[esPct, esC] = f_calc_custom_range("CME_MINI:ES1!")\r\n[nqPct, nqC] = f_calc_custom_range("CME_MINI:NQ1!")\r\ntAtr         = request.security(syminfo.tickerid, "D", ta.atr(14))\r\n\r\n// ==========================================\r\n// --- DRAWING ENGINE ---\r\n// ==========================================\r\nmanageLevel(bool show, float val, color col, string txt, string style, int width) =>\r\n    var line l = na, var label lbl = na\r\n    if show and barstate.islast and not na(val)\r\n        line.delete(l), label.delete(lbl)\r\n        l := line.new(bar_index[1], val, bar_index, val, color=col, width=width, style=getLineStyle(style), extend=extend.both)\r\n        lbl := label.new(bar_index + 15, val, txt, color=col, textcolor=color.black, style=label.style_label_center, size=size.small)\r\n\r\nmanageLevel(true, autoPMH, PMH_col, "PMH", PM_style, PM_width)\r\nmanageLevel(true, autoPML, PML_col, "PML", PM_style, PM_width)\r\nmanageLevel(true, yH, D_col, "PDH", D_style, 1)\r\nmanageLevel(true, yL, D_col, "PDL", D_style, 1)\r\nmanageLevel(true, yO, DO_col, "D OPEN", "Solid", 1)\r\nmanageLevel(true, yMid, close < yMid ? MidBelowC : D_col, "D 50%", close < yMid ? MidBelowS : MidStyle, 1)\r\nmanageLevel(true, pwH, W_col, "PWH", W_style, 1)\r\nmanageLevel(true, pwL, W_col, "PWL", W_style, 1)\r\nmanageLevel(true, pwO, WO_col, "W OPEN", "Solid", 1)\r\nmanageLevel(true, wMid, close < wMid ? MidBelowC : W_col, "W 50%", close < wMid ? MidBelowS : MidStyle, 1)\r\nmanageLevel(true, pmH, M_col, "PMH", M_style, 1)\r\nmanageLevel(true, pmL, M_col, "PML", M_style, 1)\r\nmanageLevel(true, pmO, MO_col, "M OPEN", "Solid", 1)\r\nmanageLevel(true, mMid, close < mMid ? MidBelowC : M_col, "M 50%", close < mMid ? MidBelowS : MidStyle, 1)\r\n\r\n// ==========================================\r\n// --- MARKET STRUCTURE ---\r\n// ==========================================\r\nvar float mHiH = na, var float mLoL = na\r\nvar int mHiIdx = na, var int mLoIdx = na\r\nvar bool mIsBull = true\r\npH = ta.pivothigh(msLen, msLen), pL = ta.pivotlow(msLen, msLen)\r\nif not na(pH)\r\n    mHiH := pH, mHiIdx := bar_index[msLen]\r\nif not na(pL)\r\n    mLoL := pL, mLoIdx := bar_index[msLen]\r\n\r\nif ta.crossover(close, mHiH)\r\n    color c = mIsBull ? bosCol : chochCol\r\n    line.new(mHiIdx, mHiH, bar_index, mHiH, color=c, style=line.style_dotted)\r\n    label.new(bar_index, mHiH, mIsBull ? "BOS" : "CHoCH", color=color.new(c,100), textcolor=c, style=label.style_none, size=size.small)\r\n    mHiH := na, mIsBull := true\r\nif ta.crossunder(close, mLoL)\r\n    color c = not mIsBull ? bosCol : chochCol\r\n    line.new(mLoIdx, mLoL, bar_index, mLoL, color=c, style=line.style_dotted)\r\n    label.new(bar_index, mLoL, not mIsBull ? "BOS" : "CHoCH", color=color.new(c,100), textcolor=c, style=label.style_none, size=size.small, yloc=yloc.belowbar)\r\n    mLoL := na, mIsBull := false\r\n\r\n/// ==========================================\r\n// --- TABLE ENGINE ---\r\n// ==========================================\r\nf_getRowData(tf) =>\r\n    request.security(syminfo.tickerid, tf, [f_strat(open, high, low, close, high[1], low[1]), f_strat(open[1], high[1], low[1], close[1], high[2], low[2]), f_strat(open[2], high[2], low[2], close[2], high[3], low[3]), f_strat(open[3], high[3], low[3], close[3], high[4], low[4])])\r\n\r\nif barstate.islast\r\n    st = table.new(position.top_right, 6, 8, bgcolor=color.rgb(5, 5, 5), border_width=1, border_color=color.rgb(40, 40, 40))\r\n    headers = array.from("TF", "P3", "P2", "P1", "Now", "50%")\r\n    for i = 0 to 5\r\n        table.cell(st, i, 0, array.get(headers, i), text_color=color.white, text_size=size.small)\r\n\r\n    // FIXED LINE 184: Properly closed string and parenthesis\r\n    tfs  = array.from("D", "W", "M", "3M")\r\n    mids = array.from(yMid, wMid, mMid, qMid)\r\n    \r\n    // Logic to populate the table rows\r\n    for r = 0 to 3\r\n        curr_tf = array.get(tfs, r)\r\n        [s0, s1, s2, s3] = f_getRowData(curr_tf)\r\n        table.cell(st, 0, r+1, curr_tf == "3M" ? "Q" : curr_tf, text_color=color.white)\r\n        table.cell(st, 1, r+1, f_stratText(s3), text_color=f_stratColor(s3))\r\n        table.cell(st, 2, r+1, f_stratText(s2), text_color=f_stratColor(s2))\r\n        table.cell(st, 3, r+1, f_stratText(s1), text_color=f_stratColor(s1))\r\n        table.cell(st, 4, r+1, f_stratText(s0), text_color=f_stratColor(s0))\r\n        table.cell(st, 5, r+1, "●", text_color=(close >= array.get(mids, r) ? color.green : color.red))\r\n\r\n    // ES/NQ % & ATR Footer\r\n    esText = not na(esPct) ? str.tostring(esPct, "#.###") + "%" : "N/A"\r\n    nqText = not na(nqPct) ? str.tostring(nqPct, "#.###") + "%" : "N/A"\r\n    esCol  = not na(esPct) and esPct >= 0.9 ? color.green : color.red\r\n    nqCol  = not na(nqPct) and nqPct >= 0.9 ? color.green : color.red\r\n    \r\n    table.cell(st, 0, 5, "ES %", text_color=color.white)\r\n    table.cell(st, 1, 5, esText, text_color=esCol)\r\n    table.cell(st, 2, 5, "NQ %", text_color=color.white)\r\n    table.cell(st, 3, 5, nqText, text_color=nqCol)\r\n    table.cell(st, 4, 5, "ATR", text_color=color.white)\r\n    table.cell(st, 5, 5, str.tostring(tAtr, "#.##"), text_color=color.white)\r\n\r\n// ==========================================\r\n// --- CANDLE STRAT NUMBERS & COLORS ---\r\n// ==========================================\r\nbarcolor(f_stratColor(f_strat(open, high, low, close, high[1], low[1])))\r\nif barstate.islast\r\n    for i = 0 to 3\r\n        val = f_strat(open[i], high[i], low[i], close[i], high[i+1], low[i+1])\r\n        label.new(bar_index - i, low[i], f_stratText(val), yloc=yloc.belowbar, color=color.new(color.white, 100), textcolor=f_stratColor(val), style=label.style_none, size=size.normal)'
[CAPTURE 1] '//@version=6\r\nindicator(title="Julio Table", shorttitle="STRAT+SMC", overlay=true, max_labels_count=500)\r\n\r\n// ==========================================\r\n// --- GLOBAL FUNCTIONS ---\r\n// ==========================================\r\nf_strat(o, h, l, c, ph, pl) =>\r\n    inside  = h <= ph and l >= pl\r\n    outside = h > ph and l < pl\r\n    bullish = c > o\r\n    bearish = c < o\r\n    inside ? 1 : outside ? 3 : bullish ? 2 : bearish ? -2 : 0\r\n\r\nf_stratColor(v) =>\r\n    v == 1 ? color.yellow : v == 2 ? color.green : v == -2 ? color.red : v == 3 ? color.purple : color.gray\r\n\r\nf_stratText(v) =>\r\n    v == 1 ? "1" : v == 2 ? "2U" : v == -2 ? "2D" : v == 3 ? "3" : ""\r\n\r\ngetLineStyle(style) =>\r\n    switch style\r\n        "Dashed" => line.style_dashed\r\n        "Dotted" => line.style_dotted\r\n        => line.style_solid\r\n\r\n// --- ROBUST ES/NQ CALCULATION LOGIC ---\r\nf_calc_custom_range(symbol) =>\r\n    // Request 1-minute data for precision on specific time anchors\r\n    [h, l, c] = request.security(symbol, "1", [high, low, close], lookahead=barmerge.lookahead_on)\r\n    \r\n    var float hiAfterMidnight = na\r\n    var float loBefore830     = na\r\n    var float priceAt830      = na\r\n    \r\n    // Time Definitions (Forced to New York Time)\r\n    is_midnight    = hour(time, "America/New_York") == 0 and minute(time, "America/New_York") == 0\r\n    in_window      = time(timeframe.period, "0000-0830", "America/New_York")\r\n    is_830_window  = hour(time, "America/New_York") == 8 and minute(time, "America/New_York") == 30\r\n\r\n    // Reset and track High/Low from Midnight to 08:30\r\n    if is_midnight\r\n        hiAfterMidnight := h\r\n        loBefore830     := l\r\n    else if not na(in_window)\r\n        hiAfterMidnight := math.max(h, nz(hiAfterMidnight, h))\r\n        loBefore830     := math.min(l, nz(loBefore830, l))\r\n    \r\n    // Capture anchor price at exactly 08:30 and persist it\r\n    if is_830_window\r\n        priceAt830 := c\r\n\r\n    // Perform calculation only if priceAt830 is found to avoid NaN\r\n    float customPct = not na(priceAt830) and priceAt830 != 0 ? ((hiAfterMidnight - loBefore830) / priceAt830) * 100 : na\r\n    [customPct, priceAt830]\r\n\r\n// ==========================================\r\n// --- INPUTS ---\r\n// ==========================================\r\ngroupPM      = "Pre-Market Colors & Styles"\r\nPMH_col      = input.color(color.yellow, "Pre-Market High", group=groupPM)\r\nPML_col      = input.color(color.red, "Pre-Market Low", group=groupPM)\r\nPM_style     = input.string("Solid", "Pre-Market Style", options=["Solid", "Dashed", "Dotted"], group=groupPM)\r\nPM_width     = input.int(2, "PM Line Width", minval=1, group=groupPM)\r\n\r\ngroupMS      = "Market Structure (BOS/CHoCH)"\r\nmsLen        = input.int(5, "Swing Strength", minval=2, group=groupMS)\r\nbosCol       = input.color(color.gray, "BOS Color", group=groupMS)\r\nchochCol     = input.color(color.white, "CHoCH Color", group=groupMS)\r\n\r\ngroupD       = "Daily Colors & Styles"\r\nD_col        = input.color(color.orange, "Daily H/L", group=groupD)\r\nDO_col       = input.color(color.white, "Daily Open", group=groupD)\r\nD_style      = input.string("Solid", "Daily Style", options=["Solid", "Dashed", "Dotted"], group=groupD)\r\n\r\ngroupW       = "Weekly Colors & Styles"\r\nW_col        = input.color(color.blue, "Weekly H/L", group=groupW)\r\nWO_col       = input.color(color.white, "Weekly Open", group=groupW)\r\nW_style      = input.string("Solid", "Weekly Style", options=["Solid", "Dashed", "Dotted"], group=groupW)\r\n\r\ngroupM       = "Monthly Colors & Styles"\r\nM_col        = input.color(color.fuchsia, "Monthly H/L", group=groupM)\r\nMO_col       = input.color(color.white, "Monthly Open", group=groupM)\r\nM_style      = input.string("Solid", "Monthly Style", options=["Solid", "Dashed", "Dotted"], group=groupM)\r\n\r\ngroupMid     = "Midpoint (50%) Bearish Logic"\r\nMidStyle     = input.string("Dashed", "Default 50% Style", options=["Solid", "Dashed", "Dotted"], group=groupMid)\r\nMidBelowC    = input.color(color.red, "50% Color (If Price Below)", group=groupMid)\r\nMidBelowS    = input.string("Dotted", "50% Style (If Price Below)", options=["Solid", "Dashed", "Dotted"], group=groupMid)\r\n\r\n// ==========================================\r\n// --- PRE-MARKET LOGIC ---\r\n// ==========================================\r\nvar float autoPMH = na\r\nvar float autoPML = na\r\nin_premarket = not na(time(timeframe.period, "0400-0930", "America/New_York"))\r\nis_new_day   = ta.change(time("D")) != 0\r\n\r\nif in_premarket\r\n    if is_new_day or na(autoPMH)\r\n        autoPMH := high\r\n        autoPML := low\r\n    else\r\n        autoPMH := math.max(high, autoPMH)\r\n        autoPML := math.min(low, autoPML)\r\n\r\n// ==========================================\r\n// --- LEVEL CALCULATIONS ---\r\n// ==========================================\r\n[yO, yH, yL]     = request.security(syminfo.tickerid, "D", [open, high[1], low[1]])\r\n[pwO, pwH, pwL]  = request.security(syminfo.tickerid, "W", [open, high[1], low[1]])\r\n[pmO, pmH, pmL]  = request.security(syminfo.tickerid, "M", [open, high[1], low[1]])\r\n[pqO, pqH, pqL]  = request.security(syminfo.tickerid, "3M", [open, high[1], low[1]])\r\n\r\nyMid = (yH + yL) / 2\r\nwMid = (pwH + pwL) / 2\r\nmMid = (pmH + pmL) / 2\r\nqMid = (pqH + pqL) / 2\r\n\r\n// Applying custom 8:30 Correlation Logic\r\n[esPct, esC] = f_calc_custom_range("CME_MINI:ES1!")\r\n[nqPct, nqC] = f_calc_custom_range("CME_MINI:NQ1!")\r\ntAtr         = request.security(syminfo.tickerid, "D", ta.atr(14))\r\n\r\n// ==========================================\r\n// --- DRAWING ENGINE ---\r\n// ==========================================\r\nmanageLevel(bool show, float val, color col, string txt, string style, int width) =>\r\n    var line l = na, var label lbl = na\r\n    if show and barstate.islast and not na(val)\r\n        line.delete(l), label.delete(lbl)\r\n        l := line.new(bar_index[1], val, bar_index, val, color=col, width=width, style=getLineStyle(style), extend=extend.both)\r\n        lbl := label.new(bar_index + 15, val, txt, color=col, textcolor=color.black, style=label.style_label_center, size=size.small)\r\n\r\nmanageLevel(true, autoPMH, PMH_col, "PMH", PM_style, PM_width)\r\nmanageLevel(true, autoPML, PML_col, "PML", PM_style, PM_width)\r\nmanageLevel(true, yH, D_col, "PDH", D_style, 1)\r\nmanageLevel(true, yL, D_col, "PDL", D_style, 1)\r\nmanageLevel(true, yO, DO_col, "D OPEN", "Solid", 1)\r\nmanageLevel(true, yMid, close < yMid ? MidBelowC : D_col, "D 50%", close < yMid ? MidBelowS : MidStyle, 1)\r\nmanageLevel(true, pwH, W_col, "PWH", W_style, 1)\r\nmanageLevel(true, pwL, W_col, "PWL", W_style, 1)\r\nmanageLevel(true, pwO, WO_col, "W OPEN", "Solid", 1)\r\nmanageLevel(true, wMid, close < wMid ? MidBelowC : W_col, "W 50%", close < wMid ? MidBelowS : MidStyle, 1)\r\nmanageLevel(true, pmH, M_col, "PMH", M_style, 1)\r\nmanageLevel(true, pmL, M_col, "PML", M_style, 1)\r\nmanageLevel(true, pmO, MO_col, "M OPEN", "Solid", 1)\r\nmanageLevel(true, mMid, close < mMid ? MidBelowC : M_col, "M 50%", close < mMid ? MidBelowS : MidStyle, 1)\r\n\r\n// ==========================================\r\n// --- MARKET STRUCTURE ---\r\n// ==========================================\r\nvar float mHiH = na, var float mLoL = na\r\nvar int mHiIdx = na, var int mLoIdx = na\r\nvar bool mIsBull = true\r\npH = ta.pivothigh(msLen, msLen), pL = ta.pivotlow(msLen, msLen)\r\nif not na(pH)\r\n    mHiH := pH, mHiIdx := bar_index[msLen]\r\nif not na(pL)\r\n    mLoL := pL, mLoIdx := bar_index[msLen]\r\n\r\nif ta.crossover(close, mHiH)\r\n    color c = mIsBull ? bosCol : chochCol\r\n    line.new(mHiIdx, mHiH, bar_index, mHiH, color=c, style=line.style_dotted)\r\n    label.new(bar_index, mHiH, mIsBull ? "BOS" : "CHoCH", color=color.new(c,100), textcolor=c, style=label.style_none, size=size.small)\r\n    mHiH := na, mIsBull := true\r\nif ta.crossunder(close, mLoL)\r\n    color c = not mIsBull ? bosCol : chochCol\r\n    line.new(mLoIdx, mLoL, bar_index, mLoL, color=c, style=line.style_dotted)\r\n    label.new(bar_index, mLoL, not mIsBull ? "BOS" : "CHoCH", color=color.new(c,100), textcolor=c, style=label.style_none, size=size.small, yloc=yloc.belowbar)\r\n    mLoL := na, mIsBull := false\r\n\r\n/// ==========================================\r\n// --- TABLE ENGINE ---\r\n// ==========================================\r\nf_getRowData(tf) =>\r\n    request.security(syminfo.tickerid, tf, [f_strat(open, high, low, close, high[1], low[1]), f_strat(open[1], high[1], low[1], close[1], high[2], low[2]), f_strat(open[2], high[2], low[2], close[2], high[3], low[3]), f_strat(open[3], high[3], low[3], close[3], high[4], low[4])])\r\n\r\nif barstate.islast\r\n    st = table.new(position.top_right, 6, 8, bgcolor=color.rgb(5, 5, 5), border_width=1, border_color=color.rgb(40, 40, 40))\r\n    headers = array.from("TF", "P3", "P2", "P1", "Now", "50%")\r\n    for i = 0 to 5\r\n        table.cell(st, i, 0, array.get(headers, i), text_color=color.white, text_size=size.small)\r\n\r\n    // FIXED LINE 184: Properly closed string and parenthesis\r\n    tfs  = array.from("D", "W", "M", "3M")\r\n    mids = array.from(yMid, wMid, mMid, qMid)\r\n    \r\n    // Logic to populate the table rows\r\n    for r = 0 to 3\r\n        curr_tf = array.get(tfs, r)\r\n        [s0, s1, s2, s3] = f_getRowData(curr_tf)\r\n        table.cell(st, 0, r+1, curr_tf == "3M" ? "Q" : curr_tf, text_color=color.white)\r\n        table.cell(st, 1, r+1, f_stratText(s3), text_color=f_stratColor(s3))\r\n        table.cell(st, 2, r+1, f_stratText(s2), text_color=f_stratColor(s2))\r\n        table.cell(st, 3, r+1, f_stratText(s1), text_color=f_stratColor(s1))\r\n        table.cell(st, 4, r+1, f_stratText(s0), text_color=f_stratColor(s0))\r\n        table.cell(st, 5, r+1, "●", text_color=(close >= array.get(mids, r) ? color.green : color.red))\r\n\r\n    // ES/NQ % & ATR Footer\r\n    esText = not na(esPct) ? str.tostring(esPct, "#.###") + "%" : "N/A"\r\n    nqText = not na(nqPct) ? str.tostring(nqPct, "#.###") + "%" : "N/A"\r\n    esCol  = not na(esPct) and esPct >= 0.9 ? color.green : color.red\r\n    nqCol  = not na(nqPct) and nqPct >= 0.9 ? color.green : color.red\r\n    \r\n    table.cell(st, 0, 5, "ES %", text_color=color.white)\r\n    table.cell(st, 1, 5, esText, text_color=esCol)\r\n    table.cell(st, 2, 5, "NQ %", text_color=color.white)\r\n    table.cell(st, 3, 5, nqText, text_color=nqCol)\r\n    table.cell(st, 4, 5, "ATR", text_color=color.white)\r\n    table.cell(st, 5, 5, str.tostring(tAtr, "#.##"), text_color=color.white)\r\n\r\n// ==========================================\r\n// --- CANDLE STRAT NUMBERS & COLORS ---\r\n// ==========================================\r\nbarcolor(f_stratColor(f_strat(open, high, low, close, high[1], low[1])))\r\nif barstate.islast\r\n    for i = 0 to 3\r\n        val = f_strat(open[i], high[i], low[i], close[i], high[i+1], low[i+1])\r\n        label.new(bar_index - i, low[i], f_stratText(val), yloc=yloc.belowbar, color=color.new(color.white, 100), textcolor=f_stratColor(val), style=label.style_none, size=size.normal)'
[CAPTURE 2] '//@version=6\r\nindicator(title="Julio Table", shorttitle="STRAT+SMC", overlay=true, max_labels_count=500)\r\n\r\n// ==========================================\r\n// --- GLOBAL FUNCTIONS ---\r\n// ==========================================\r\nf_strat(o, h, l, c, ph, pl) =>\r\n    inside  = h <= ph and l >= pl\r\n    outside = h > ph and l < pl\r\n    bullish = c > o\r\n    bearish = c < o\r\n    inside ? 1 : outside ? 3 : bullish ? 2 : bearish ? -2 : 0\r\n\r\nf_stratColor(v) =>\r\n    v == 1 ? color.yellow : v == 2 ? color.green : v == -2 ? color.red : v == 3 ? color.purple : color.gray\r\n\r\nf_stratText(v) =>\r\n    v == 1 ? "1" : v == 2 ? "2U" : v == -2 ? "2D" : v == 3 ? "3" : ""\r\n\r\ngetLineStyle(style) =>\r\n    switch style\r\n        "Dashed" => line.style_dashed\r\n        "Dotted" => line.style_dotted\r\n        => line.style_solid\r\n\r\n// --- ROBUST ES/NQ CALCULATION LOGIC ---\r\nf_calc_custom_range(symbol) =>\r\n    // Request 1-minute data for precision on specific time anchors\r\n    [h, l, c] = request.security(symbol, "1", [high, low, close], lookahead=barmerge.lookahead_on)\r\n    \r\n    var float hiAfterMidnight = na\r\n    var float loBefore830     = na\r\n    var float priceAt830      = na\r\n    \r\n    // Time Definitions (Forced to New York Time)\r\n    is_midnight    = hour(time, "America/New_York") == 0 and minute(time, "America/New_York") == 0\r\n    in_window      = time(timeframe.period, "0000-0830", "America/New_York")\r\n    is_830_window  = hour(time, "America/New_York") == 8 and minute(time, "America/New_York") == 30\r\n\r\n    // Reset and track High/Low from Midnight to 08:30\r\n    if is_midnight\r\n        hiAfterMidnight := h\r\n        loBefore830     := l\r\n    else if not na(in_window)\r\n        hiAfterMidnight := math.max(h, nz(hiAfterMidnight, h))\r\n        loBefore830     := math.min(l, nz(loBefore830, l))\r\n    \r\n    // Capture anchor price at exactly 08:30 and persist it\r\n    if is_830_window\r\n        priceAt830 := c\r\n\r\n    // Perform calculation only if priceAt830 is found to avoid NaN\r\n    float customPct = not na(priceAt830) and priceAt830 != 0 ? ((hiAfterMidnight - loBefore830) / priceAt830) * 100 : na\r\n    [customPct, priceAt830]\r\n\r\n// ==========================================\r\n// --- INPUTS ---\r\n// ==========================================\r\ngroupPM      = "Pre-Market Colors & Styles"\r\nPMH_col      = input.color(color.yellow, "Pre-Market High", group=groupPM)\r\nPML_col      = input.color(color.red, "Pre-Market Low", group=groupPM)\r\nPM_style     = input.string("Solid", "Pre-Market Style", options=["Solid", "Dashed", "Dotted"], group=groupPM)\r\nPM_width     = input.int(2, "PM Line Width", minval=1, group=groupPM)\r\n\r\ngroupMS      = "Market Structure (BOS/CHoCH)"\r\nmsLen        = input.int(5, "Swing Strength", minval=2, group=groupMS)\r\nbosCol       = input.color(color.gray, "BOS Color", group=groupMS)\r\nchochCol     = input.color(color.white, "CHoCH Color", group=groupMS)\r\n\r\ngroupD       = "Daily Colors & Styles"\r\nD_col        = input.color(color.orange, "Daily H/L", group=groupD)\r\nDO_col       = input.color(color.white, "Daily Open", group=groupD)\r\nD_style      = input.string("Solid", "Daily Style", options=["Solid", "Dashed", "Dotted"], group=groupD)\r\n\r\ngroupW       = "Weekly Colors & Styles"\r\nW_col        = input.color(color.blue, "Weekly H/L", group=groupW)\r\nWO_col       = input.color(color.white, "Weekly Open", group=groupW)\r\nW_style      = input.string("Solid", "Weekly Style", options=["Solid", "Dashed", "Dotted"], group=groupW)\r\n\r\ngroupM       = "Monthly Colors & Styles"\r\nM_col        = input.color(color.fuchsia, "Monthly H/L", group=groupM)\r\nMO_col       = input.color(color.white, "Monthly Open", group=groupM)\r\nM_style      = input.string("Solid", "Monthly Style", options=["Solid", "Dashed", "Dotted"], group=groupM)\r\n\r\ngroupMid     = "Midpoint (50%) Bearish Logic"\r\nMidStyle     = input.string("Dashed", "Default 50% Style", options=["Solid", "Dashed", "Dotted"], group=groupMid)\r\nMidBelowC    = input.color(color.red, "50% Color (If Price Below)", group=groupMid)\r\nMidBelowS    = input.string("Dotted", "50% Style (If Price Below)", options=["Solid", "Dashed", "Dotted"], group=groupMid)\r\n\r\n// ==========================================\r\n// --- PRE-MARKET LOGIC ---\r\n// ==========================================\r\nvar float autoPMH = na\r\nvar float autoPML = na\r\nin_premarket = not na(time(timeframe.period, "0400-0930", "America/New_York"))\r\nis_new_day   = ta.change(time("D")) != 0\r\n\r\nif in_premarket\r\n    if is_new_day or na(autoPMH)\r\n        autoPMH := high\r\n        autoPML := low\r\n    else\r\n        autoPMH := math.max(high, autoPMH)\r\n        autoPML := math.min(low, autoPML)\r\n\r\n// ==========================================\r\n// --- LEVEL CALCULATIONS ---\r\n// ==========================================\r\n[yO, yH, yL]     = request.security(syminfo.tickerid, "D", [open, high[1], low[1]])\r\n[pwO, pwH, pwL]  = request.security(syminfo.tickerid, "W", [open, high[1], low[1]])\r\n[pmO, pmH, pmL]  = request.security(syminfo.tickerid, "M", [open, high[1], low[1]])\r\n[pqO, pqH, pqL]  = request.security(syminfo.tickerid, "3M", [open, high[1], low[1]])\r\n\r\nyMid = (yH + yL) / 2\r\nwMid = (pwH + pwL) / 2\r\nmMid = (pmH + pmL) / 2\r\nqMid = (pqH + pqL) / 2\r\n\r\n// Applying custom 8:30 Correlation Logic\r\n[esPct, esC] = f_calc_custom_range("CME_MINI:ES1!")\r\n[nqPct, nqC] = f_calc_custom_range("CME_MINI:NQ1!")\r\ntAtr         = request.security(syminfo.tickerid, "D", ta.atr(14))\r\n\r\n// ==========================================\r\n// --- DRAWING ENGINE ---\r\n// ==========================================\r\nmanageLevel(bool show, float val, color col, string txt, string style, int width) =>\r\n    var line l = na, var label lbl = na\r\n    if show and barstate.islast and not na(val)\r\n        line.delete(l), label.delete(lbl)\r\n        l := line.new(bar_index[1], val, bar_index, val, color=col, width=width, style=getLineStyle(style), extend=extend.both)\r\n        lbl := label.new(bar_index + 15, val, txt, color=col, textcolor=color.black, style=label.style_label_center, size=size.small)\r\n\r\nmanageLevel(true, autoPMH, PMH_col, "PMH", PM_style, PM_width)\r\nmanageLevel(true, autoPML, PML_col, "PML", PM_style, PM_width)\r\nmanageLevel(true, yH, D_col, "PDH", D_style, 1)\r\nmanageLevel(true, yL, D_col, "PDL", D_style, 1)\r\nmanageLevel(true, yO, DO_col, "D OPEN", "Solid", 1)\r\nmanageLevel(true, yMid, close < yMid ? MidBelowC : D_col, "D 50%", close < yMid ? MidBelowS : MidStyle, 1)\r\nmanageLevel(true, pwH, W_col, "PWH", W_style, 1)\r\nmanageLevel(true, pwL, W_col, "PWL", W_style, 1)\r\nmanageLevel(true, pwO, WO_col, "W OPEN", "Solid", 1)\r\nmanageLevel(true, wMid, close < wMid ? MidBelowC : W_col, "W 50%", close < wMid ? MidBelowS : MidStyle, 1)\r\nmanageLevel(true, pmH, M_col, "PMH", M_style, 1)\r\nmanageLevel(true, pmL, M_col, "PML", M_style, 1)\r\nmanageLevel(true, pmO, MO_col, "M OPEN", "Solid", 1)\r\nmanageLevel(true, mMid, close < mMid ? MidBelowC : M_col, "M 50%", close < mMid ? MidBelowS : MidStyle, 1)\r\n\r\n// ==========================================\r\n// --- MARKET STRUCTURE ---\r\n// ==========================================\r\nvar float mHiH = na, var float mLoL = na\r\nvar int mHiIdx = na, var int mLoIdx = na\r\nvar bool mIsBull = true\r\npH = ta.pivothigh(msLen, msLen), pL = ta.pivotlow(msLen, msLen)\r\nif not na(pH)\r\n    mHiH := pH, mHiIdx := bar_index[msLen]\r\nif not na(pL)\r\n    mLoL := pL, mLoIdx := bar_index[msLen]\r\n\r\nif ta.crossover(close, mHiH)\r\n    color c = mIsBull ? bosCol : chochCol\r\n    line.new(mHiIdx, mHiH, bar_index, mHiH, color=c, style=line.style_dotted)\r\n    label.new(bar_index, mHiH, mIsBull ? "BOS" : "CHoCH", color=color.new(c,100), textcolor=c, style=label.style_none, size=size.small)\r\n    mHiH := na, mIsBull := true\r\nif ta.crossunder(close, mLoL)\r\n    color c = not mIsBull ? bosCol : chochCol\r\n    line.new(mLoIdx, mLoL, bar_index, mLoL, color=c, style=line.style_dotted)\r\n    label.new(bar_index, mLoL, not mIsBull ? "BOS" : "CHoCH", color=color.new(c,100), textcolor=c, style=label.style_none, size=size.small, yloc=yloc.belowbar)\r\n    mLoL := na, mIsBull := false\r\n\r\n/// ==========================================\r\n// --- TABLE ENGINE ---\r\n// ==========================================\r\nf_getRowData(tf) =>\r\n    request.security(syminfo.tickerid, tf, [f_strat(open, high, low, close, high[1], low[1]), f_strat(open[1], high[1], low[1], close[1], high[2], low[2]), f_strat(open[2], high[2], low[2], close[2], high[3], low[3]), f_strat(open[3], high[3], low[3], close[3], high[4], low[4])])\r\n\r\nif barstate.islast\r\n    st = table.new(position.top_right, 6, 8, bgcolor=color.rgb(5, 5, 5), border_width=1, border_color=color.rgb(40, 40, 40))\r\n    headers = array.from("TF", "P3", "P2", "P1", "Now", "50%")\r\n    for i = 0 to 5\r\n        table.cell(st, i, 0, array.get(headers, i), text_color=color.white, text_size=size.small)\r\n\r\n    // FIXED LINE 184: Properly closed string and parenthesis\r\n    tfs  = array.from("D", "W", "M", "3M")\r\n    mids = array.from(yMid, wMid, mMid, qMid)\r\n    \r\n    // Logic to populate the table rows\r\n    for r = 0 to 3\r\n        curr_tf = array.get(tfs, r)\r\n        [s0, s1, s2, s3] = f_getRowData(curr_tf)\r\n        table.cell(st, 0, r+1, curr_tf == "3M" ? "Q" : curr_tf, text_color=color.white)\r\n        table.cell(st, 1, r+1, f_stratText(s3), text_color=f_stratColor(s3))\r\n        table.cell(st, 2, r+1, f_stratText(s2), text_color=f_stratColor(s2))\r\n        table.cell(st, 3, r+1, f_stratText(s1), text_color=f_stratColor(s1))\r\n        table.cell(st, 4, r+1, f_stratText(s0), text_color=f_stratColor(s0))\r\n        table.cell(st, 5, r+1, "●", text_color=(close >= array.get(mids, r) ? color.green : color.red))\r\n\r\n    // ES/NQ % & ATR Footer\r\n    esText = not na(esPct) ? str.tostring(esPct, "#.###") + "%" : "N/A"\r\n    nqText = not na(nqPct) ? str.tostring(nqPct, "#.###") + "%" : "N/A"\r\n    esCol  = not na(esPct) and esPct >= 0.9 ? color.green : color.red\r\n    nqCol  = not na(nqPct) and nqPct >= 0.9 ? color.green : color.red\r\n    \r\n    table.cell(st, 0, 5, "ES %", text_color=color.white)\r\n    table.cell(st, 1, 5, esText, text_color=esCol)\r\n    table.cell(st, 2, 5, "NQ %", text_color=color.white)\r\n    table.cell(st, 3, 5, nqText, text_color=nqCol)\r\n    table.cell(st, 4, 5, "ATR", text_color=color.white)\r\n    table.cell(st, 5, 5, str.tostring(tAtr, "#.##"), text_color=color.white)\r\n\r\n// ==========================================\r\n// --- CANDLE STRAT NUMBERS & COLORS ---\r\n// ==========================================\r\nbarcolor(f_stratColor(f_strat(open, high, low, close, high[1], low[1])))\r\nif barstate.islast\r\n    for i = 0 to 3\r\n        val = f_strat(open[i], high[i], low[i], close[i], high[i+1], low[i+1])\r\n        label.new(bar_index - i, low[i], f_stratText(val), yloc=yloc.belowbar, color=color.new(color.white, 100), textcolor=f_stratColor(val), style=label.style_none, size=size.normal)'
[DEBUG] save_script called: script_id=OeT4X3ux title=Strat Numbers Daily Weekly and Monthly Levels plus 50% Rule category=OeT4X3ux force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\OeT4X3ux_Strat_Numbers_Daily_Weekly_and_Monthly_Levels_plus_50%_Rule.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\OeT4X3ux_Strat_Numbers_Daily_Weekly_and_Monthly_Levels_plus_50%_Rule.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 04:49:00 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 04:49:00 GMT' as: 2026-02-09T04:49:00+00:00
[DEBUG] Exact published date for header: 2026-02-09T04:49:00+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/FzuGS5N3-Ema200-Fractals-Dynamic-ORB-Zone/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\nindicator("Ema200 Fractals + Dynamic ORB Zone", overlay=true, max_labels_count=500)\r\n\r\n//──────────────────────────\r\n// 1. INPUTS: EMA 200\r\n//──────────────────────────\r\nG_EMA = "Trend Settings"\r\nema200_len = input.int(200, "EMA 200 Length", group=G_EMA)\r\nema200_col = input.color(color.new(color.red, 0), "EMA 200 Color", group=G_EMA)\r\n\r\n//──────────────────────────\r\n// 2. INPUTS: ORB (Opening Range Breakout)\r\n//──────────────────────────\r\nG_ORB      = "ORB Settings"\r\nshow_orb   = input.bool(true, "Show ORB Levels", group=G_ORB)\r\norb_time   = input.string("0930-0935", "ORB Time Session", group=G_ORB)\r\n\r\n// Color Inputs\r\norb_high_c = input.color(color.new(color.blue, 0), "ORB Top Line Color", group=G_ORB)\r\norb_low_c  = input.color(color.new(color.white, 0), "ORB Bottom Line Color", group=G_ORB)\r\n\r\nG_ORB_FILL = "ORB Highlight Settings"\r\norb_fill_neutral = input.color(color.new(#800080, 75), "Neutral Fill (Purple 25% Opacity)", group=G_ORB_FILL)\r\norb_fill_bull    = input.color(color.new(color.green, 75), "Bullish Fill (Green 25% Opacity)", group=G_ORB_FILL)\r\n\r\n//──────────────────────────\r\n// 3. ORB CALCULATION & DYNAMIC HIGHLIGHT\r\n//──────────────────────────\r\nvar float orb_high = na\r\nvar float orb_low  = na\r\nvar box orb_box    = na\r\nvar bool is_bullish = false\r\n\r\nis_new_day = ta.change(time("D")) != 0\r\nin_orb_session = not na(time(timeframe.period, orb_time, "America/New_York"))\r\n\r\nif is_new_day\r\n    orb_high := na\r\n    orb_low  := na\r\n    is_bullish := false\r\n\r\nif in_orb_session\r\n    orb_high := na(orb_high) ? high : math.max(high, orb_high)\r\n    orb_low  := na(orb_low) ? low : math.min(low, orb_low)\r\n\r\n// Check for Bullish breakout to flip color\r\nif not in_orb_session and close > orb_high\r\n    is_bullish := true\r\n\r\n// Logic to create and manage the dynamic box\r\nif in_orb_session or not na(orb_high)\r\n    color current_fill = is_bullish ? orb_fill_bull : orb_fill_neutral\r\n    \r\n    if is_new_day or na(orb_box)\r\n        orb_box := box.new(left=bar_index, top=orb_high, right=bar_index, bottom=orb_low, \r\n                           border_color=color.new(color.white, 100), bgcolor=current_fill)\r\n    else\r\n        box.set_top(orb_box, orb_high)\r\n        box.set_bottom(orb_box, orb_low)\r\n        box.set_right(orb_box, bar_index)\r\n        box.set_bgcolor(orb_box, current_fill)\r\n\r\n// Reset box on new day\r\nif is_new_day\r\n    orb_box := na\r\n\r\n// Plotting the lines (Top line is Blue)\r\nplot(show_orb ? orb_high : na, "ORB High", color=orb_high_c, style=plot.style_linebr, linewidth=2)\r\nplot(show_orb ? orb_low : na, "ORB Low", color=orb_low_c, style=plot.style_linebr, linewidth=2)\r\n\r\n//──────────────────────────\r\n// 4. EMA 200 & FRACTALS\r\n//──────────────────────────\r\nema200_val = ta.ema(close, ema200_len)\r\nplot(ema200_val, color=ema200_col, linewidth=2, title="EMA 200 Filter")\r\n\r\nbool is_up_fractal = high[2] > high[1] and high[2] > high[0] and high[2] > high[3] and high[2] > high[4]\r\nbool is_dn_fractal = low[2] < low[1] and low[2] < low[0] and low[2] < low[3] and low[2] < low[4]\r\n\r\nbool up_fractal_filtered = is_up_fractal and high[2] > ema200_val[2]\r\nbool dn_fractal_filtered = is_dn_fractal and low[2] < ema200_val[2]\r\n\r\nplotshape(up_fractal_filtered, style=shape.diamond, location=location.abovebar, color=color.green, size=size.tiny, offset=-2)\r\nplotshape(dn_fractal_filtered, style=shape.diamond, location=location.belowbar, color=color.red, size=size.tiny, offset=-2)'
[CAPTURE 1] '//@version=6\r\nindicator("Ema200 Fractals + Dynamic ORB Zone", overlay=true, max_labels_count=500)\r\n\r\n//──────────────────────────\r\n// 1. INPUTS: EMA 200\r\n//──────────────────────────\r\nG_EMA = "Trend Settings"\r\nema200_len = input.int(200, "EMA 200 Length", group=G_EMA)\r\nema200_col = input.color(color.new(color.red, 0), "EMA 200 Color", group=G_EMA)\r\n\r\n//──────────────────────────\r\n// 2. INPUTS: ORB (Opening Range Breakout)\r\n//──────────────────────────\r\nG_ORB      = "ORB Settings"\r\nshow_orb   = input.bool(true, "Show ORB Levels", group=G_ORB)\r\norb_time   = input.string("0930-0935", "ORB Time Session", group=G_ORB)\r\n\r\n// Color Inputs\r\norb_high_c = input.color(color.new(color.blue, 0), "ORB Top Line Color", group=G_ORB)\r\norb_low_c  = input.color(color.new(color.white, 0), "ORB Bottom Line Color", group=G_ORB)\r\n\r\nG_ORB_FILL = "ORB Highlight Settings"\r\norb_fill_neutral = input.color(color.new(#800080, 75), "Neutral Fill (Purple 25% Opacity)", group=G_ORB_FILL)\r\norb_fill_bull    = input.color(color.new(color.green, 75), "Bullish Fill (Green 25% Opacity)", group=G_ORB_FILL)\r\n\r\n//──────────────────────────\r\n// 3. ORB CALCULATION & DYNAMIC HIGHLIGHT\r\n//──────────────────────────\r\nvar float orb_high = na\r\nvar float orb_low  = na\r\nvar box orb_box    = na\r\nvar bool is_bullish = false\r\n\r\nis_new_day = ta.change(time("D")) != 0\r\nin_orb_session = not na(time(timeframe.period, orb_time, "America/New_York"))\r\n\r\nif is_new_day\r\n    orb_high := na\r\n    orb_low  := na\r\n    is_bullish := false\r\n\r\nif in_orb_session\r\n    orb_high := na(orb_high) ? high : math.max(high, orb_high)\r\n    orb_low  := na(orb_low) ? low : math.min(low, orb_low)\r\n\r\n// Check for Bullish breakout to flip color\r\nif not in_orb_session and close > orb_high\r\n    is_bullish := true\r\n\r\n// Logic to create and manage the dynamic box\r\nif in_orb_session or not na(orb_high)\r\n    color current_fill = is_bullish ? orb_fill_bull : orb_fill_neutral\r\n    \r\n    if is_new_day or na(orb_box)\r\n        orb_box := box.new(left=bar_index, top=orb_high, right=bar_index, bottom=orb_low, \r\n                           border_color=color.new(color.white, 100), bgcolor=current_fill)\r\n    else\r\n        box.set_top(orb_box, orb_high)\r\n        box.set_bottom(orb_box, orb_low)\r\n        box.set_right(orb_box, bar_index)\r\n        box.set_bgcolor(orb_box, current_fill)\r\n\r\n// Reset box on new day\r\nif is_new_day\r\n    orb_box := na\r\n\r\n// Plotting the lines (Top line is Blue)\r\nplot(show_orb ? orb_high : na, "ORB High", color=orb_high_c, style=plot.style_linebr, linewidth=2)\r\nplot(show_orb ? orb_low : na, "ORB Low", color=orb_low_c, style=plot.style_linebr, linewidth=2)\r\n\r\n//──────────────────────────\r\n// 4. EMA 200 & FRACTALS\r\n//──────────────────────────\r\nema200_val = ta.ema(close, ema200_len)\r\nplot(ema200_val, color=ema200_col, linewidth=2, title="EMA 200 Filter")\r\n\r\nbool is_up_fractal = high[2] > high[1] and high[2] > high[0] and high[2] > high[3] and high[2] > high[4]\r\nbool is_dn_fractal = low[2] < low[1] and low[2] < low[0] and low[2] < low[3] and low[2] < low[4]\r\n\r\nbool up_fractal_filtered = is_up_fractal and high[2] > ema200_val[2]\r\nbool dn_fractal_filtered = is_dn_fractal and low[2] < ema200_val[2]\r\n\r\nplotshape(up_fractal_filtered, style=shape.diamond, location=location.abovebar, color=color.green, size=size.tiny, offset=-2)\r\nplotshape(dn_fractal_filtered, style=shape.diamond, location=location.belowbar, color=color.red, size=size.tiny, offset=-2)'
[CAPTURE 2] '//@version=6\r\nindicator("Ema200 Fractals + Dynamic ORB Zone", overlay=true, max_labels_count=500)\r\n\r\n//──────────────────────────\r\n// 1. INPUTS: EMA 200\r\n//──────────────────────────\r\nG_EMA = "Trend Settings"\r\nema200_len = input.int(200, "EMA 200 Length", group=G_EMA)\r\nema200_col = input.color(color.new(color.red, 0), "EMA 200 Color", group=G_EMA)\r\n\r\n//──────────────────────────\r\n// 2. INPUTS: ORB (Opening Range Breakout)\r\n//──────────────────────────\r\nG_ORB      = "ORB Settings"\r\nshow_orb   = input.bool(true, "Show ORB Levels", group=G_ORB)\r\norb_time   = input.string("0930-0935", "ORB Time Session", group=G_ORB)\r\n\r\n// Color Inputs\r\norb_high_c = input.color(color.new(color.blue, 0), "ORB Top Line Color", group=G_ORB)\r\norb_low_c  = input.color(color.new(color.white, 0), "ORB Bottom Line Color", group=G_ORB)\r\n\r\nG_ORB_FILL = "ORB Highlight Settings"\r\norb_fill_neutral = input.color(color.new(#800080, 75), "Neutral Fill (Purple 25% Opacity)", group=G_ORB_FILL)\r\norb_fill_bull    = input.color(color.new(color.green, 75), "Bullish Fill (Green 25% Opacity)", group=G_ORB_FILL)\r\n\r\n//──────────────────────────\r\n// 3. ORB CALCULATION & DYNAMIC HIGHLIGHT\r\n//──────────────────────────\r\nvar float orb_high = na\r\nvar float orb_low  = na\r\nvar box orb_box    = na\r\nvar bool is_bullish = false\r\n\r\nis_new_day = ta.change(time("D")) != 0\r\nin_orb_session = not na(time(timeframe.period, orb_time, "America/New_York"))\r\n\r\nif is_new_day\r\n    orb_high := na\r\n    orb_low  := na\r\n    is_bullish := false\r\n\r\nif in_orb_session\r\n    orb_high := na(orb_high) ? high : math.max(high, orb_high)\r\n    orb_low  := na(orb_low) ? low : math.min(low, orb_low)\r\n\r\n// Check for Bullish breakout to flip color\r\nif not in_orb_session and close > orb_high\r\n    is_bullish := true\r\n\r\n// Logic to create and manage the dynamic box\r\nif in_orb_session or not na(orb_high)\r\n    color current_fill = is_bullish ? orb_fill_bull : orb_fill_neutral\r\n    \r\n    if is_new_day or na(orb_box)\r\n        orb_box := box.new(left=bar_index, top=orb_high, right=bar_index, bottom=orb_low, \r\n                           border_color=color.new(color.white, 100), bgcolor=current_fill)\r\n    else\r\n        box.set_top(orb_box, orb_high)\r\n        box.set_bottom(orb_box, orb_low)\r\n        box.set_right(orb_box, bar_index)\r\n        box.set_bgcolor(orb_box, current_fill)\r\n\r\n// Reset box on new day\r\nif is_new_day\r\n    orb_box := na\r\n\r\n// Plotting the lines (Top line is Blue)\r\nplot(show_orb ? orb_high : na, "ORB High", color=orb_high_c, style=plot.style_linebr, linewidth=2)\r\nplot(show_orb ? orb_low : na, "ORB Low", color=orb_low_c, style=plot.style_linebr, linewidth=2)\r\n\r\n//──────────────────────────\r\n// 4. EMA 200 & FRACTALS\r\n//──────────────────────────\r\nema200_val = ta.ema(close, ema200_len)\r\nplot(ema200_val, color=ema200_col, linewidth=2, title="EMA 200 Filter")\r\n\r\nbool is_up_fractal = high[2] > high[1] and high[2] > high[0] and high[2] > high[3] and high[2] > high[4]\r\nbool is_dn_fractal = low[2] < low[1] and low[2] < low[0] and low[2] < low[3] and low[2] < low[4]\r\n\r\nbool up_fractal_filtered = is_up_fractal and high[2] > ema200_val[2]\r\nbool dn_fractal_filtered = is_dn_fractal and low[2] < ema200_val[2]\r\n\r\nplotshape(up_fractal_filtered, style=shape.diamond, location=location.abovebar, color=color.green, size=size.tiny, offset=-2)\r\nplotshape(dn_fractal_filtered, style=shape.diamond, location=location.belowbar, color=color.red, size=size.tiny, offset=-2)'
[DEBUG] save_script called: script_id=FzuGS5N3 title=Ema200 Fractals + Dynamic ORB Zone category=FzuGS5N3 force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\FzuGS5N3_Ema200_Fractals_+_Dynamic_ORB_Zone.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\FzuGS5N3_Ema200_Fractals_+_Dynamic_ORB_Zone.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 04:34:02 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 04:34:02 GMT' as: 2026-02-09T04:34:02+00:00
[DEBUG] Exact published date for header: 2026-02-09T04:34:02+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/mQaM6RQ0-Option-Tracker/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\r\nindicator("Option % Tracker", overlay=true)\r\n\r\n// ============================================\r\n// SETTINGS\r\n// ============================================\r\nentryHour = input.int(9, "Entry Hour", minval=0, maxval=23)\r\nentryMinute = input.int(15, "Entry Minute", minval=0, maxval=59)\r\nalertThreshold = input.float(25, "Alert % Threshold", minval=1, step=5)\r\n\r\n// ============================================\r\n// AUTO-CAPTURE 9:15 ENTRY\r\n// ============================================\r\nvar float entryPrice = na\r\n\r\nisEntryCandle = hour == entryHour and minute == entryMinute\r\n\r\n// Capture entry\r\nif isEntryCandle\r\n    entryPrice := close\r\n\r\n// ============================================\r\n// CALCULATE % CHANGE\r\n// ============================================\r\nchangeFromEntry = close - entryPrice\r\nchangePercent = (changeFromEntry / entryPrice) * 100\r\n\r\nisUp = changePercent > 0\r\nisDown = changePercent < 0\r\n\r\n// ============================================\r\n// PLOT LEVELS\r\n// ============================================\r\nplot(entryPrice, "Entry", color=color.white, linewidth=2, style=plot.style_linebr)\r\n\r\n// +% levels (spike)\r\nplot(entryPrice * (1 + alertThreshold/100), "+L1", color=color.new(color.red, 50), linewidth=1, style=plot.style_linebr)\r\nplot(entryPrice * (1 + alertThreshold*2/100), "+L2", color=color.new(color.red, 0), linewidth=2, style=plot.style_linebr)\r\n\r\n// -% levels (decay)\r\nplot(entryPrice * (1 - alertThreshold/100), "-L1", color=color.new(color.green, 50), linewidth=1, style=plot.style_linebr)\r\nplot(entryPrice * (1 - alertThreshold*2/100), "-L2", color=color.new(color.green, 0), linewidth=2, style=plot.style_linebr)\r\n\r\n// ============================================\r\n// LABEL ON EVERY CANDLE SHOWING %\r\n// ============================================\r\n// Show % label on each candle after entry\r\nshowLabel = not na(entryPrice) and bar_index > 0\r\n\r\n// Create label with % change\r\nif showLabel and barstate.islast == false and bar_index % 3 == 0  // Every 3rd candle to avoid clutter\r\n    labelColor = isUp ? color.red : color.green\r\n    labelText = str.tostring(changePercent, "#.#") + "%"\r\n    label.new(bar_index, high, labelText, color=color.new(labelColor, 70), textcolor=labelColor, size=size.tiny, style=label.style_label_down)\r\n\r\n// Always show on last candle\r\nif barstate.islast and not na(entryPrice)\r\n    labelColor = isUp ? color.red : color.green\r\n    labelText = str.tostring(changePercent, "#.#") + "%"\r\n    label.new(bar_index, high, labelText, color=labelColor, textcolor=color.white, size=size.normal, style=label.style_label_down)\r\n\r\n// ============================================\r\n// ENTRY MARKER\r\n// ============================================\r\nplotshape(isEntryCandle, "9:15 Entry", location=location.belowbar, color=color.yellow, style=shape.triangleup, size=size.small, text="9:15")\r\n\r\n// ============================================\r\n// INFO TABLE\r\n// ============================================\r\nvar table infoTable = table.new(position.top_right, 2, 5, bgcolor=color.new(color.black, 70), border_width=1)\r\n\r\nif barstate.islast and not na(entryPrice)\r\n    pctColor = isUp ? color.red : color.green\r\n    \r\n    table.cell(infoTable, 0, 0, "9:15 ENTRY", text_color=color.yellow, text_size=size.small)\r\n    table.cell(infoTable, 1, 0, str.tostring(entryPrice, "#.##"), text_color=color.white, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 1, "CURRENT", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 1, str.tostring(close, "#.##"), text_color=color.white, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 2, "CHANGE", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 2, str.tostring(changeFromEntry, "#.##"), text_color=pctColor, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 3, "CHANGE %", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 3, str.tostring(changePercent, "#.##") + "%", text_color=pctColor, text_size=size.normal)\r\n    \r\n    status = changePercent >= alertThreshold ? "âš ï¸\x8f SPIKE!" : changePercent <= -alertThreshold ? "âœ… DECAY" : "NORMAL"\r\n    statColor = changePercent >= alertThreshold ? color.red : changePercent <= -alertThreshold ? color.green : color.gray\r\n    table.cell(infoTable, 0, 4, "STATUS", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 4, status, text_color=statColor, text_size=size.small)\r\n\r\n// ============================================\r\n// BACKGROUND COLOR\r\n// ============================================\r\nbgColor = changePercent >= alertThreshold*2 ? color.new(color.red, 80) : changePercent >= alertThreshold ? color.new(color.red, 90) : changePercent <= -alertThreshold*2 ? color.new(color.green, 80) : changePercent <= -alertThreshold ? color.new(color.green, 90) : na\r\nbgcolor(bgColor)\r\n\r\n// ============================================\r\n// ALERTS\r\n// ============================================\r\nspikeAlert = changePercent >= alertThreshold and changePercent[1] < alertThreshold\r\ndecayAlert = changePercent <= -alertThreshold and changePercent[1] > -alertThreshold\r\n\r\nalertcondition(spikeAlert, "Spike Alert", "âš ï¸\x8f Option SPIKED above threshold!")\r\nalertcondition(decayAlert, "Decay Alert", "âœ… Option DECAYED below threshold!")\r\n\r\n'
[CAPTURE 1] '//@version=5\r\nindicator("Option % Tracker", overlay=true)\r\n\r\n// ============================================\r\n// SETTINGS\r\n// ============================================\r\nentryHour = input.int(9, "Entry Hour", minval=0, maxval=23)\r\nentryMinute = input.int(15, "Entry Minute", minval=0, maxval=59)\r\nalertThreshold = input.float(25, "Alert % Threshold", minval=1, step=5)\r\n\r\n// ============================================\r\n// AUTO-CAPTURE 9:15 ENTRY\r\n// ============================================\r\nvar float entryPrice = na\r\n\r\nisEntryCandle = hour == entryHour and minute == entryMinute\r\n\r\n// Capture entry\r\nif isEntryCandle\r\n    entryPrice := close\r\n\r\n// ============================================\r\n// CALCULATE % CHANGE\r\n// ============================================\r\nchangeFromEntry = close - entryPrice\r\nchangePercent = (changeFromEntry / entryPrice) * 100\r\n\r\nisUp = changePercent > 0\r\nisDown = changePercent < 0\r\n\r\n// ============================================\r\n// PLOT LEVELS\r\n// ============================================\r\nplot(entryPrice, "Entry", color=color.white, linewidth=2, style=plot.style_linebr)\r\n\r\n// +% levels (spike)\r\nplot(entryPrice * (1 + alertThreshold/100), "+L1", color=color.new(color.red, 50), linewidth=1, style=plot.style_linebr)\r\nplot(entryPrice * (1 + alertThreshold*2/100), "+L2", color=color.new(color.red, 0), linewidth=2, style=plot.style_linebr)\r\n\r\n// -% levels (decay)\r\nplot(entryPrice * (1 - alertThreshold/100), "-L1", color=color.new(color.green, 50), linewidth=1, style=plot.style_linebr)\r\nplot(entryPrice * (1 - alertThreshold*2/100), "-L2", color=color.new(color.green, 0), linewidth=2, style=plot.style_linebr)\r\n\r\n// ============================================\r\n// LABEL ON EVERY CANDLE SHOWING %\r\n// ============================================\r\n// Show % label on each candle after entry\r\nshowLabel = not na(entryPrice) and bar_index > 0\r\n\r\n// Create label with % change\r\nif showLabel and barstate.islast == false and bar_index % 3 == 0  // Every 3rd candle to avoid clutter\r\n    labelColor = isUp ? color.red : color.green\r\n    labelText = str.tostring(changePercent, "#.#") + "%"\r\n    label.new(bar_index, high, labelText, color=color.new(labelColor, 70), textcolor=labelColor, size=size.tiny, style=label.style_label_down)\r\n\r\n// Always show on last candle\r\nif barstate.islast and not na(entryPrice)\r\n    labelColor = isUp ? color.red : color.green\r\n    labelText = str.tostring(changePercent, "#.#") + "%"\r\n    label.new(bar_index, high, labelText, color=labelColor, textcolor=color.white, size=size.normal, style=label.style_label_down)\r\n\r\n// ============================================\r\n// ENTRY MARKER\r\n// ============================================\r\nplotshape(isEntryCandle, "9:15 Entry", location=location.belowbar, color=color.yellow, style=shape.triangleup, size=size.small, text="9:15")\r\n\r\n// ============================================\r\n// INFO TABLE\r\n// ============================================\r\nvar table infoTable = table.new(position.top_right, 2, 5, bgcolor=color.new(color.black, 70), border_width=1)\r\n\r\nif barstate.islast and not na(entryPrice)\r\n    pctColor = isUp ? color.red : color.green\r\n    \r\n    table.cell(infoTable, 0, 0, "9:15 ENTRY", text_color=color.yellow, text_size=size.small)\r\n    table.cell(infoTable, 1, 0, str.tostring(entryPrice, "#.##"), text_color=color.white, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 1, "CURRENT", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 1, str.tostring(close, "#.##"), text_color=color.white, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 2, "CHANGE", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 2, str.tostring(changeFromEntry, "#.##"), text_color=pctColor, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 3, "CHANGE %", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 3, str.tostring(changePercent, "#.##") + "%", text_color=pctColor, text_size=size.normal)\r\n    \r\n    status = changePercent >= alertThreshold ? "âš ï¸\x8f SPIKE!" : changePercent <= -alertThreshold ? "âœ… DECAY" : "NORMAL"\r\n    statColor = changePercent >= alertThreshold ? color.red : changePercent <= -alertThreshold ? color.green : color.gray\r\n    table.cell(infoTable, 0, 4, "STATUS", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 4, status, text_color=statColor, text_size=size.small)\r\n\r\n// ============================================\r\n// BACKGROUND COLOR\r\n// ============================================\r\nbgColor = changePercent >= alertThreshold*2 ? color.new(color.red, 80) : changePercent >= alertThreshold ? color.new(color.red, 90) : changePercent <= -alertThreshold*2 ? color.new(color.green, 80) : changePercent <= -alertThreshold ? color.new(color.green, 90) : na\r\nbgcolor(bgColor)\r\n\r\n// ============================================\r\n// ALERTS\r\n// ============================================\r\nspikeAlert = changePercent >= alertThreshold and changePercent[1] < alertThreshold\r\ndecayAlert = changePercent <= -alertThreshold and changePercent[1] > -alertThreshold\r\n\r\nalertcondition(spikeAlert, "Spike Alert", "âš ï¸\x8f Option SPIKED above threshold!")\r\nalertcondition(decayAlert, "Decay Alert", "âœ… Option DECAYED below threshold!")\r\n\r\n'
[CAPTURE 2] '//@version=5\r\nindicator("Option % Tracker", overlay=true)\r\n\r\n// ============================================\r\n// SETTINGS\r\n// ============================================\r\nentryHour = input.int(9, "Entry Hour", minval=0, maxval=23)\r\nentryMinute = input.int(15, "Entry Minute", minval=0, maxval=59)\r\nalertThreshold = input.float(25, "Alert % Threshold", minval=1, step=5)\r\n\r\n// ============================================\r\n// AUTO-CAPTURE 9:15 ENTRY\r\n// ============================================\r\nvar float entryPrice = na\r\n\r\nisEntryCandle = hour == entryHour and minute == entryMinute\r\n\r\n// Capture entry\r\nif isEntryCandle\r\n    entryPrice := close\r\n\r\n// ============================================\r\n// CALCULATE % CHANGE\r\n// ============================================\r\nchangeFromEntry = close - entryPrice\r\nchangePercent = (changeFromEntry / entryPrice) * 100\r\n\r\nisUp = changePercent > 0\r\nisDown = changePercent < 0\r\n\r\n// ============================================\r\n// PLOT LEVELS\r\n// ============================================\r\nplot(entryPrice, "Entry", color=color.white, linewidth=2, style=plot.style_linebr)\r\n\r\n// +% levels (spike)\r\nplot(entryPrice * (1 + alertThreshold/100), "+L1", color=color.new(color.red, 50), linewidth=1, style=plot.style_linebr)\r\nplot(entryPrice * (1 + alertThreshold*2/100), "+L2", color=color.new(color.red, 0), linewidth=2, style=plot.style_linebr)\r\n\r\n// -% levels (decay)\r\nplot(entryPrice * (1 - alertThreshold/100), "-L1", color=color.new(color.green, 50), linewidth=1, style=plot.style_linebr)\r\nplot(entryPrice * (1 - alertThreshold*2/100), "-L2", color=color.new(color.green, 0), linewidth=2, style=plot.style_linebr)\r\n\r\n// ============================================\r\n// LABEL ON EVERY CANDLE SHOWING %\r\n// ============================================\r\n// Show % label on each candle after entry\r\nshowLabel = not na(entryPrice) and bar_index > 0\r\n\r\n// Create label with % change\r\nif showLabel and barstate.islast == false and bar_index % 3 == 0  // Every 3rd candle to avoid clutter\r\n    labelColor = isUp ? color.red : color.green\r\n    labelText = str.tostring(changePercent, "#.#") + "%"\r\n    label.new(bar_index, high, labelText, color=color.new(labelColor, 70), textcolor=labelColor, size=size.tiny, style=label.style_label_down)\r\n\r\n// Always show on last candle\r\nif barstate.islast and not na(entryPrice)\r\n    labelColor = isUp ? color.red : color.green\r\n    labelText = str.tostring(changePercent, "#.#") + "%"\r\n    label.new(bar_index, high, labelText, color=labelColor, textcolor=color.white, size=size.normal, style=label.style_label_down)\r\n\r\n// ============================================\r\n// ENTRY MARKER\r\n// ============================================\r\nplotshape(isEntryCandle, "9:15 Entry", location=location.belowbar, color=color.yellow, style=shape.triangleup, size=size.small, text="9:15")\r\n\r\n// ============================================\r\n// INFO TABLE\r\n// ============================================\r\nvar table infoTable = table.new(position.top_right, 2, 5, bgcolor=color.new(color.black, 70), border_width=1)\r\n\r\nif barstate.islast and not na(entryPrice)\r\n    pctColor = isUp ? color.red : color.green\r\n    \r\n    table.cell(infoTable, 0, 0, "9:15 ENTRY", text_color=color.yellow, text_size=size.small)\r\n    table.cell(infoTable, 1, 0, str.tostring(entryPrice, "#.##"), text_color=color.white, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 1, "CURRENT", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 1, str.tostring(close, "#.##"), text_color=color.white, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 2, "CHANGE", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 2, str.tostring(changeFromEntry, "#.##"), text_color=pctColor, text_size=size.small)\r\n    \r\n    table.cell(infoTable, 0, 3, "CHANGE %", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 3, str.tostring(changePercent, "#.##") + "%", text_color=pctColor, text_size=size.normal)\r\n    \r\n    status = changePercent >= alertThreshold ? "âš ï¸\x8f SPIKE!" : changePercent <= -alertThreshold ? "âœ… DECAY" : "NORMAL"\r\n    statColor = changePercent >= alertThreshold ? color.red : changePercent <= -alertThreshold ? color.green : color.gray\r\n    table.cell(infoTable, 0, 4, "STATUS", text_color=color.white, text_size=size.small)\r\n    table.cell(infoTable, 1, 4, status, text_color=statColor, text_size=size.small)\r\n\r\n// ============================================\r\n// BACKGROUND COLOR\r\n// ============================================\r\nbgColor = changePercent >= alertThreshold*2 ? color.new(color.red, 80) : changePercent >= alertThreshold ? color.new(color.red, 90) : changePercent <= -alertThreshold*2 ? color.new(color.green, 80) : changePercent <= -alertThreshold ? color.new(color.green, 90) : na\r\nbgcolor(bgColor)\r\n\r\n// ============================================\r\n// ALERTS\r\n// ============================================\r\nspikeAlert = changePercent >= alertThreshold and changePercent[1] < alertThreshold\r\ndecayAlert = changePercent <= -alertThreshold and changePercent[1] > -alertThreshold\r\n\r\nalertcondition(spikeAlert, "Spike Alert", "âš ï¸\x8f Option SPIKED above threshold!")\r\nalertcondition(decayAlert, "Decay Alert", "âœ… Option DECAYED below threshold!")\r\n\r\n'
[DEBUG] save_script called: script_id=mQaM6RQ0 title=Option % Tracker category=mQaM6RQ0 force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\mQaM6RQ0_Option_%_Tracker.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\mQaM6RQ0_Option_%_Tracker.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 04:32:57 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 04:32:57 GMT' as: 2026-02-09T04:32:57+00:00
[DEBUG] Exact published date for header: 2026-02-09T04:32:57+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/yP9VsTfe/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
//@version=6indicator(title="BB(기본/사용자) & 이평선(20,60,120) 통합", overlay=true)// --- 1. 기본 볼린저 밴드 (20, 2, 종가) ---// 중단선(20이평)
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator(title="BB(기본/사용자) & 이평선(20,60,120) 통합", overlay=true)\n\n// --- 1. 기본 볼린저 밴드 (20, 2, 종가) ---\n// 중단선(20이평)은 아래 이평선 코드와 중복되므로 밴드 라인만 표시합니다.\n[basis1, upper1, lower1] = ta.bb(close, 20, 2)\nplot(upper1, "기본 BB 상단(20,2)", color=color.new(color.blue, 0), linewidth=1)\nplot(lower1, "기본 BB 하단(20,2)", color=color.new(color.blue, 0), linewidth=1)\nfill(plot(upper1), plot(lower1), color=color.new(color.blue, 96), title="기본 BB 배경")\n\n// --- 2. 사용자 볼린저 밴드 (4, 4, 시가) ---\n// 입력값(input)을 통해 차트 설정에서 언제든 수정을 용이하게 만들었습니다.\nu_src = input.source(open, "사용자 BB 소스")\nu_len = input.int(4, "사용자 BB 기간")\nu_mult = input.float(4.0, "사용자 BB 승수")\n\n[basis2, upper2, lower2] = ta.bb(u_src, u_len, u_mult)\nplot(upper2, "사용자 BB 상단(4,4)", color=color.new(color.red, 0), linewidth=1, style=plot.style_line)\nplot(lower2, "사용자 BB 하단(4,4)", color=color.new(color.red, 0), linewidth=1, style=plot.style_line)\nfill(plot(upper2), plot(lower2), color=color.new(color.red, 96), title="사용자 BB 배경")\n\n// --- 3. 이동평균선 (20, 60, 120) ---\nma20  = ta.sma(close, 20)\nma60  = ta.sma(close, 60)\nma120 = ta.sma(close, 120)\n\nplot(ma20,  "이평선 20",  color=color.green,  linewidth=2)\nplot(ma60,  "이평선 60",  color=color.orange, linewidth=2)\nplot(ma120, "이평선 120", color=color.purple, linewidth=2)'
[CAPTURE 1] '//@version=6\nindicator(title="BB(기본/사용자) & 이평선(20,60,120) 통합", overlay=true)\n\n// --- 1. 기본 볼린저 밴드 (20, 2, 종가) ---\n// 중단선(20이평)은 아래 이평선 코드와 중복되므로 밴드 라인만 표시합니다.\n[basis1, upper1, lower1] = ta.bb(close, 20, 2)\nplot(upper1, "기본 BB 상단(20,2)", color=color.new(color.blue, 0), linewidth=1)\nplot(lower1, "기본 BB 하단(20,2)", color=color.new(color.blue, 0), linewidth=1)\nfill(plot(upper1), plot(lower1), color=color.new(color.blue, 96), title="기본 BB 배경")\n\n// --- 2. 사용자 볼린저 밴드 (4, 4, 시가) ---\n// 입력값(input)을 통해 차트 설정에서 언제든 수정을 용이하게 만들었습니다.\nu_src = input.source(open, "사용자 BB 소스")\nu_len = input.int(4, "사용자 BB 기간")\nu_mult = input.float(4.0, "사용자 BB 승수")\n\n[basis2, upper2, lower2] = ta.bb(u_src, u_len, u_mult)\nplot(upper2, "사용자 BB 상단(4,4)", color=color.new(color.red, 0), linewidth=1, style=plot.style_line)\nplot(lower2, "사용자 BB 하단(4,4)", color=color.new(color.red, 0), linewidth=1, style=plot.style_line)\nfill(plot(upper2), plot(lower2), color=color.new(color.red, 96), title="사용자 BB 배경")\n\n// --- 3. 이동평균선 (20, 60, 120) ---\nma20  = ta.sma(close, 20)\nma60  = ta.sma(close, 60)\nma120 = ta.sma(close, 120)\n\nplot(ma20,  "이평선 20",  color=color.green,  linewidth=2)\nplot(ma60,  "이평선 60",  color=color.orange, linewidth=2)\nplot(ma120, "이평선 120", color=color.purple, linewidth=2)'
[CAPTURE 2] '//@version=6\nindicator(title="BB(기본/사용자) & 이평선(20,60,120) 통합", overlay=true)\n\n// --- 1. 기본 볼린저 밴드 (20, 2, 종가) ---\n// 중단선(20이평)은 아래 이평선 코드와 중복되므로 밴드 라인만 표시합니다.\n[basis1, upper1, lower1] = ta.bb(close, 20, 2)\nplot(upper1, "기본 BB 상단(20,2)", color=color.new(color.blue, 0), linewidth=1)\nplot(lower1, "기본 BB 하단(20,2)", color=color.new(color.blue, 0), linewidth=1)\nfill(plot(upper1), plot(lower1), color=color.new(color.blue, 96), title="기본 BB 배경")\n\n// --- 2. 사용자 볼린저 밴드 (4, 4, 시가) ---\n// 입력값(input)을 통해 차트 설정에서 언제든 수정을 용이하게 만들었습니다.\nu_src = input.source(open, "사용자 BB 소스")\nu_len = input.int(4, "사용자 BB 기간")\nu_mult = input.float(4.0, "사용자 BB 승수")\n\n[basis2, upper2, lower2] = ta.bb(u_src, u_len, u_mult)\nplot(upper2, "사용자 BB 상단(4,4)", color=color.new(color.red, 0), linewidth=1, style=plot.style_line)\nplot(lower2, "사용자 BB 하단(4,4)", color=color.new(color.red, 0), linewidth=1, style=plot.style_line)\nfill(plot(upper2), plot(lower2), color=color.new(color.red, 96), title="사용자 BB 배경")\n\n// --- 3. 이동평균선 (20, 60, 120) ---\nma20  = ta.sma(close, 20)\nma60  = ta.sma(close, 60)\nma120 = ta.sma(close, 120)\n\nplot(ma20,  "이평선 20",  color=color.green,  linewidth=2)\nplot(ma60,  "이평선 60",  color=color.orange, linewidth=2)\nplot(ma120, "이평선 120", color=color.purple, linewidth=2)'
[DEBUG] save_script called: script_id=yP9VsTfe title=Double BB and Three EMA category=yP9VsTfe force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\yP9VsTfe_Double_BB_and_Three_EMA.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\yP9VsTfe_Double_BB_and_Three_EMA.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 03:55:18 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 03:55:18 GMT' as: 2026-02-09T03:55:18+00:00
[DEBUG] Exact published date for header: 2026-02-09T03:55:18+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/PQBNt8DJ-Auto-Lensed-MACD-Z-Score-v8-2/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\nindicator("Auto-Lensed MACD + Z-Score v8.2", shorttitle="AL_MACD_v8", overlay=false, max_bars_back = 1000)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 1. Inputs\r\n// -----------------------------------------------------------------------------\r\ngroup_waves  = "Wave Settings (The Lens)"\r\nint leftLen  = input.int(10, "Pivot Left Bars", minval=1, group=group_waves)\r\nint rightLen = input.int(10, "Pivot Right Bars", minval=1, group=group_waves)\r\n\r\ngroup_macd   = "MACD Settings"\r\nfloat len_mult = input.float(1.0, "Length Multiplier", step=0.1, tooltip="Scales the auto-calculated lengths (e.g., 1.2 makes it slower/smoother).", group=group_macd)\r\n\r\ngroup_zscore = "Z-Score Settings"\r\nint z_len      = input.int(14, "Z-Score Length", minval=1, group=group_zscore)\r\nfloat z_thresh = input.float(2.0, "Extremity Threshold", step=0.1, group=group_zscore)\r\n\r\ngroup_div    = "Divergence Noise Control"\r\nint signal_cooldown = input.int(15, "Signal Cooldown (Bars)", minval=1, group=group_div)\r\nfloat min_slope     = input.float(0.001, "Min MACD Slope", step=0.001, group=group_div)\r\nbool show_bg        = input.bool(true, "Show BG Highlights", group=group_div)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 2. Adaptive Lens & MACD Calculation\r\n// -----------------------------------------------------------------------------\r\nvar array<int> wave_lengths = array.new<int>()\r\nvar int last_p_idx = 0\r\n\r\nph_p = ta.pivothigh(high, leftLen, rightLen)\r\npl_p = ta.pivotlow(low, leftLen, rightLen)\r\n\r\nif not na(ph_p) or not na(pl_p)\r\n    if last_p_idx != 0\r\n        array.push(wave_lengths, bar_index - rightLen - last_p_idx)\r\n    last_p_idx := bar_index - rightLen\r\n    if array.size(wave_lengths) > 50\r\n        array.shift(wave_lengths)\r\n\r\nfloat avg_len = (array.size(wave_lengths) > 0 ? array.avg(wave_lengths) : 26.0) * len_mult\r\n\r\ndynamic_ema(src, len) =>\r\n    float alpha = 2.0 / (math.max(1, len) + 1.0)\r\n    var float ema_val = na\r\n    ema_val := na(ema_val[1]) ? src : src * alpha + ema_val[1] * (1.0 - alpha)\r\n    ema_val\r\n\r\nfloat d_slow = math.max(2, avg_len)\r\nfloat d_fast = math.max(1, avg_len * 0.5)\r\nfloat d_sig  = math.max(1, avg_len * 0.25)\r\n\r\nmacd_raw   = dynamic_ema(close, d_fast) - dynamic_ema(close, d_slow)\r\nsig_raw    = dynamic_ema(macd_raw, d_sig)\r\nhist_raw   = macd_raw - sig_raw\r\n\r\n// -----------------------------------------------------------------------------\r\n// 3. Scaling & Z-Score\r\n// -----------------------------------------------------------------------------\r\nfloat z_price = (close - ta.sma(close, z_len)) / ta.stdev(close, z_len)\r\nfloat m_stdev = ta.stdev(macd_raw, z_len)\r\nfloat z_macd   = macd_raw / (m_stdev == 0 ? 1 : m_stdev)\r\nfloat z_signal = sig_raw / (m_stdev == 0 ? 1 : m_stdev)\r\nfloat z_hist   = z_macd - z_signal\r\n\r\n// -----------------------------------------------------------------------------\r\n// 4. Divergence Logic\r\n// -----------------------------------------------------------------------------\r\nm_ph = ta.pivothigh(macd_raw, 5, 5)\r\nm_pl = ta.pivotlow(macd_raw, 5, 5)\r\n\r\nvar float prev_m_ph = na, var float prev_p_ph = na\r\nvar float prev_m_pl = na, var float prev_p_pl = na\r\nvar int last_bull_idx = 0\r\nvar int last_bear_idx = 0\r\n\r\nbool r_bull = false, bool r_bear = false\r\n\r\nif not na(m_pl)\r\n    float curr_p_low = low[5]\r\n    bool slope_ok = math.abs(m_pl - prev_m_pl) > min_slope\r\n    bool cooldown_ok = (bar_index - last_bull_idx) > signal_cooldown\r\n    if not na(prev_m_pl) and cooldown_ok and slope_ok\r\n        if curr_p_low < prev_p_pl and m_pl > prev_m_pl\r\n            r_bull := true\r\n            last_bull_idx := bar_index\r\n    prev_m_pl := m_pl, prev_p_pl := curr_p_low\r\n\r\nif not na(m_ph)\r\n    float curr_p_high = high[5]\r\n    bool slope_ok = math.abs(m_ph - prev_m_ph) > min_slope\r\n    bool cooldown_ok = (bar_index - last_bear_idx) > signal_cooldown\r\n    if not na(prev_m_ph) and cooldown_ok and slope_ok\r\n        if curr_p_high > prev_p_ph and m_ph < prev_m_ph\r\n            r_bear := true\r\n            last_bear_idx := bar_index\r\n    prev_m_ph := m_ph, prev_p_ph := curr_p_high\r\n\r\n// -----------------------------------------------------------------------------\r\n// 5. Visuals\r\n// -----------------------------------------------------------------------------\r\nhline(z_thresh, "Upper Band", color=color.new(#00FFCC, 40), linestyle=hline.style_dashed)\r\nhline(-z_thresh, "Lower Band", color=color.new(#FF00FF, 40), linestyle=hline.style_dashed)\r\nhline(0, "Zero Line", color=color.new(color.gray, 50))\r\n\r\ncolor h_col = z_hist >= 0 ? (z_price > z_thresh ? #00FFCC : #26A69A) : (z_price < -z_thresh ? #FF00FF : #EF5350)\r\nplot(z_hist, "Z-Histogram", style=plot.style_columns, color=h_col)\r\nplot(z_macd, "Z-MACD", color=#2962FF, linewidth=2)\r\nplot(z_signal, "Z-Signal", color=#FF6D00)\r\nplot(z_price, "Price Z-Score", color=color.new(color.purple, 50), linewidth=1)\r\n\r\nplotshape(r_bull, "R_Bull", shape.triangleup, location.bottom, #00FF00, offset=-5, size=size.small, text="R")\r\nplotshape(r_bear, "R_Bear", shape.triangledown, location.top, #FF0000, offset=-5, size=size.small, text="R")\r\nbgcolor(show_bg and r_bull ? color.new(#00FF00, 92) : na, offset=-5)\r\nbgcolor(show_bg and r_bear ? color.new(#FF0000, 92) : na, offset=-5)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 6. Timeframe Recommendation Logic & Dashboard\r\n// -----------------------------------------------------------------------------\r\nstring rec_pivot = ""\r\nif timeframe.isseconds or (timeframe.isintraday and timeframe.multiplier <= 5)\r\n    rec_pivot := "10-15"\r\nelse if timeframe.isintraday and timeframe.multiplier <= 60\r\n    rec_pivot := "5-10"\r\nelse\r\n    rec_pivot := "3-5"\r\n\r\nif barstate.islast\r\n    var table dash = table.new(position.top_right, 2, 5, bgcolor=color.new(#1e222d, 20), border_width=1, border_color=#363c4e)\r\n    table.cell(dash, 0, 0, "Lens Speed", text_color=color.white, text_size=size.small)\r\n    table.cell(dash, 1, 0, str.tostring(math.round(avg_len, 1)), text_color=color.white, text_size=size.small)\r\n    table.cell(dash, 0, 1, "Price Z-Score", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 1, str.tostring(math.round(z_price, 2)), text_color=(math.abs(z_price) > z_thresh ? #FF00FF : color.white), text_size=size.small)\r\n    table.cell(dash, 0, 2, "Rec Pivot", text_color=#00FFFF, text_size=size.small)\r\n    table.cell(dash, 1, 2, rec_pivot, text_color=#00FFFF, text_size=size.small)\r\n    table.cell(dash, 0, 3, "Fast Len", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 3, str.tostring(math.round(d_fast, 1)), text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 0, 4, "Slow Len", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 4, str.tostring(math.round(d_slow, 1)), text_color=color.gray, text_size=size.small)'
[CAPTURE 1] '//@version=6\r\nindicator("Auto-Lensed MACD + Z-Score v8.2", shorttitle="AL_MACD_v8", overlay=false, max_bars_back = 1000)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 1. Inputs\r\n// -----------------------------------------------------------------------------\r\ngroup_waves  = "Wave Settings (The Lens)"\r\nint leftLen  = input.int(10, "Pivot Left Bars", minval=1, group=group_waves)\r\nint rightLen = input.int(10, "Pivot Right Bars", minval=1, group=group_waves)\r\n\r\ngroup_macd   = "MACD Settings"\r\nfloat len_mult = input.float(1.0, "Length Multiplier", step=0.1, tooltip="Scales the auto-calculated lengths (e.g., 1.2 makes it slower/smoother).", group=group_macd)\r\n\r\ngroup_zscore = "Z-Score Settings"\r\nint z_len      = input.int(14, "Z-Score Length", minval=1, group=group_zscore)\r\nfloat z_thresh = input.float(2.0, "Extremity Threshold", step=0.1, group=group_zscore)\r\n\r\ngroup_div    = "Divergence Noise Control"\r\nint signal_cooldown = input.int(15, "Signal Cooldown (Bars)", minval=1, group=group_div)\r\nfloat min_slope     = input.float(0.001, "Min MACD Slope", step=0.001, group=group_div)\r\nbool show_bg        = input.bool(true, "Show BG Highlights", group=group_div)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 2. Adaptive Lens & MACD Calculation\r\n// -----------------------------------------------------------------------------\r\nvar array<int> wave_lengths = array.new<int>()\r\nvar int last_p_idx = 0\r\n\r\nph_p = ta.pivothigh(high, leftLen, rightLen)\r\npl_p = ta.pivotlow(low, leftLen, rightLen)\r\n\r\nif not na(ph_p) or not na(pl_p)\r\n    if last_p_idx != 0\r\n        array.push(wave_lengths, bar_index - rightLen - last_p_idx)\r\n    last_p_idx := bar_index - rightLen\r\n    if array.size(wave_lengths) > 50\r\n        array.shift(wave_lengths)\r\n\r\nfloat avg_len = (array.size(wave_lengths) > 0 ? array.avg(wave_lengths) : 26.0) * len_mult\r\n\r\ndynamic_ema(src, len) =>\r\n    float alpha = 2.0 / (math.max(1, len) + 1.0)\r\n    var float ema_val = na\r\n    ema_val := na(ema_val[1]) ? src : src * alpha + ema_val[1] * (1.0 - alpha)\r\n    ema_val\r\n\r\nfloat d_slow = math.max(2, avg_len)\r\nfloat d_fast = math.max(1, avg_len * 0.5)\r\nfloat d_sig  = math.max(1, avg_len * 0.25)\r\n\r\nmacd_raw   = dynamic_ema(close, d_fast) - dynamic_ema(close, d_slow)\r\nsig_raw    = dynamic_ema(macd_raw, d_sig)\r\nhist_raw   = macd_raw - sig_raw\r\n\r\n// -----------------------------------------------------------------------------\r\n// 3. Scaling & Z-Score\r\n// -----------------------------------------------------------------------------\r\nfloat z_price = (close - ta.sma(close, z_len)) / ta.stdev(close, z_len)\r\nfloat m_stdev = ta.stdev(macd_raw, z_len)\r\nfloat z_macd   = macd_raw / (m_stdev == 0 ? 1 : m_stdev)\r\nfloat z_signal = sig_raw / (m_stdev == 0 ? 1 : m_stdev)\r\nfloat z_hist   = z_macd - z_signal\r\n\r\n// -----------------------------------------------------------------------------\r\n// 4. Divergence Logic\r\n// -----------------------------------------------------------------------------\r\nm_ph = ta.pivothigh(macd_raw, 5, 5)\r\nm_pl = ta.pivotlow(macd_raw, 5, 5)\r\n\r\nvar float prev_m_ph = na, var float prev_p_ph = na\r\nvar float prev_m_pl = na, var float prev_p_pl = na\r\nvar int last_bull_idx = 0\r\nvar int last_bear_idx = 0\r\n\r\nbool r_bull = false, bool r_bear = false\r\n\r\nif not na(m_pl)\r\n    float curr_p_low = low[5]\r\n    bool slope_ok = math.abs(m_pl - prev_m_pl) > min_slope\r\n    bool cooldown_ok = (bar_index - last_bull_idx) > signal_cooldown\r\n    if not na(prev_m_pl) and cooldown_ok and slope_ok\r\n        if curr_p_low < prev_p_pl and m_pl > prev_m_pl\r\n            r_bull := true\r\n            last_bull_idx := bar_index\r\n    prev_m_pl := m_pl, prev_p_pl := curr_p_low\r\n\r\nif not na(m_ph)\r\n    float curr_p_high = high[5]\r\n    bool slope_ok = math.abs(m_ph - prev_m_ph) > min_slope\r\n    bool cooldown_ok = (bar_index - last_bear_idx) > signal_cooldown\r\n    if not na(prev_m_ph) and cooldown_ok and slope_ok\r\n        if curr_p_high > prev_p_ph and m_ph < prev_m_ph\r\n            r_bear := true\r\n            last_bear_idx := bar_index\r\n    prev_m_ph := m_ph, prev_p_ph := curr_p_high\r\n\r\n// -----------------------------------------------------------------------------\r\n// 5. Visuals\r\n// -----------------------------------------------------------------------------\r\nhline(z_thresh, "Upper Band", color=color.new(#00FFCC, 40), linestyle=hline.style_dashed)\r\nhline(-z_thresh, "Lower Band", color=color.new(#FF00FF, 40), linestyle=hline.style_dashed)\r\nhline(0, "Zero Line", color=color.new(color.gray, 50))\r\n\r\ncolor h_col = z_hist >= 0 ? (z_price > z_thresh ? #00FFCC : #26A69A) : (z_price < -z_thresh ? #FF00FF : #EF5350)\r\nplot(z_hist, "Z-Histogram", style=plot.style_columns, color=h_col)\r\nplot(z_macd, "Z-MACD", color=#2962FF, linewidth=2)\r\nplot(z_signal, "Z-Signal", color=#FF6D00)\r\nplot(z_price, "Price Z-Score", color=color.new(color.purple, 50), linewidth=1)\r\n\r\nplotshape(r_bull, "R_Bull", shape.triangleup, location.bottom, #00FF00, offset=-5, size=size.small, text="R")\r\nplotshape(r_bear, "R_Bear", shape.triangledown, location.top, #FF0000, offset=-5, size=size.small, text="R")\r\nbgcolor(show_bg and r_bull ? color.new(#00FF00, 92) : na, offset=-5)\r\nbgcolor(show_bg and r_bear ? color.new(#FF0000, 92) : na, offset=-5)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 6. Timeframe Recommendation Logic & Dashboard\r\n// -----------------------------------------------------------------------------\r\nstring rec_pivot = ""\r\nif timeframe.isseconds or (timeframe.isintraday and timeframe.multiplier <= 5)\r\n    rec_pivot := "10-15"\r\nelse if timeframe.isintraday and timeframe.multiplier <= 60\r\n    rec_pivot := "5-10"\r\nelse\r\n    rec_pivot := "3-5"\r\n\r\nif barstate.islast\r\n    var table dash = table.new(position.top_right, 2, 5, bgcolor=color.new(#1e222d, 20), border_width=1, border_color=#363c4e)\r\n    table.cell(dash, 0, 0, "Lens Speed", text_color=color.white, text_size=size.small)\r\n    table.cell(dash, 1, 0, str.tostring(math.round(avg_len, 1)), text_color=color.white, text_size=size.small)\r\n    table.cell(dash, 0, 1, "Price Z-Score", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 1, str.tostring(math.round(z_price, 2)), text_color=(math.abs(z_price) > z_thresh ? #FF00FF : color.white), text_size=size.small)\r\n    table.cell(dash, 0, 2, "Rec Pivot", text_color=#00FFFF, text_size=size.small)\r\n    table.cell(dash, 1, 2, rec_pivot, text_color=#00FFFF, text_size=size.small)\r\n    table.cell(dash, 0, 3, "Fast Len", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 3, str.tostring(math.round(d_fast, 1)), text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 0, 4, "Slow Len", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 4, str.tostring(math.round(d_slow, 1)), text_color=color.gray, text_size=size.small)'
[CAPTURE 2] '//@version=6\r\nindicator("Auto-Lensed MACD + Z-Score v8.2", shorttitle="AL_MACD_v8", overlay=false, max_bars_back = 1000)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 1. Inputs\r\n// -----------------------------------------------------------------------------\r\ngroup_waves  = "Wave Settings (The Lens)"\r\nint leftLen  = input.int(10, "Pivot Left Bars", minval=1, group=group_waves)\r\nint rightLen = input.int(10, "Pivot Right Bars", minval=1, group=group_waves)\r\n\r\ngroup_macd   = "MACD Settings"\r\nfloat len_mult = input.float(1.0, "Length Multiplier", step=0.1, tooltip="Scales the auto-calculated lengths (e.g., 1.2 makes it slower/smoother).", group=group_macd)\r\n\r\ngroup_zscore = "Z-Score Settings"\r\nint z_len      = input.int(14, "Z-Score Length", minval=1, group=group_zscore)\r\nfloat z_thresh = input.float(2.0, "Extremity Threshold", step=0.1, group=group_zscore)\r\n\r\ngroup_div    = "Divergence Noise Control"\r\nint signal_cooldown = input.int(15, "Signal Cooldown (Bars)", minval=1, group=group_div)\r\nfloat min_slope     = input.float(0.001, "Min MACD Slope", step=0.001, group=group_div)\r\nbool show_bg        = input.bool(true, "Show BG Highlights", group=group_div)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 2. Adaptive Lens & MACD Calculation\r\n// -----------------------------------------------------------------------------\r\nvar array<int> wave_lengths = array.new<int>()\r\nvar int last_p_idx = 0\r\n\r\nph_p = ta.pivothigh(high, leftLen, rightLen)\r\npl_p = ta.pivotlow(low, leftLen, rightLen)\r\n\r\nif not na(ph_p) or not na(pl_p)\r\n    if last_p_idx != 0\r\n        array.push(wave_lengths, bar_index - rightLen - last_p_idx)\r\n    last_p_idx := bar_index - rightLen\r\n    if array.size(wave_lengths) > 50\r\n        array.shift(wave_lengths)\r\n\r\nfloat avg_len = (array.size(wave_lengths) > 0 ? array.avg(wave_lengths) : 26.0) * len_mult\r\n\r\ndynamic_ema(src, len) =>\r\n    float alpha = 2.0 / (math.max(1, len) + 1.0)\r\n    var float ema_val = na\r\n    ema_val := na(ema_val[1]) ? src : src * alpha + ema_val[1] * (1.0 - alpha)\r\n    ema_val\r\n\r\nfloat d_slow = math.max(2, avg_len)\r\nfloat d_fast = math.max(1, avg_len * 0.5)\r\nfloat d_sig  = math.max(1, avg_len * 0.25)\r\n\r\nmacd_raw   = dynamic_ema(close, d_fast) - dynamic_ema(close, d_slow)\r\nsig_raw    = dynamic_ema(macd_raw, d_sig)\r\nhist_raw   = macd_raw - sig_raw\r\n\r\n// -----------------------------------------------------------------------------\r\n// 3. Scaling & Z-Score\r\n// -----------------------------------------------------------------------------\r\nfloat z_price = (close - ta.sma(close, z_len)) / ta.stdev(close, z_len)\r\nfloat m_stdev = ta.stdev(macd_raw, z_len)\r\nfloat z_macd   = macd_raw / (m_stdev == 0 ? 1 : m_stdev)\r\nfloat z_signal = sig_raw / (m_stdev == 0 ? 1 : m_stdev)\r\nfloat z_hist   = z_macd - z_signal\r\n\r\n// -----------------------------------------------------------------------------\r\n// 4. Divergence Logic\r\n// -----------------------------------------------------------------------------\r\nm_ph = ta.pivothigh(macd_raw, 5, 5)\r\nm_pl = ta.pivotlow(macd_raw, 5, 5)\r\n\r\nvar float prev_m_ph = na, var float prev_p_ph = na\r\nvar float prev_m_pl = na, var float prev_p_pl = na\r\nvar int last_bull_idx = 0\r\nvar int last_bear_idx = 0\r\n\r\nbool r_bull = false, bool r_bear = false\r\n\r\nif not na(m_pl)\r\n    float curr_p_low = low[5]\r\n    bool slope_ok = math.abs(m_pl - prev_m_pl) > min_slope\r\n    bool cooldown_ok = (bar_index - last_bull_idx) > signal_cooldown\r\n    if not na(prev_m_pl) and cooldown_ok and slope_ok\r\n        if curr_p_low < prev_p_pl and m_pl > prev_m_pl\r\n            r_bull := true\r\n            last_bull_idx := bar_index\r\n    prev_m_pl := m_pl, prev_p_pl := curr_p_low\r\n\r\nif not na(m_ph)\r\n    float curr_p_high = high[5]\r\n    bool slope_ok = math.abs(m_ph - prev_m_ph) > min_slope\r\n    bool cooldown_ok = (bar_index - last_bear_idx) > signal_cooldown\r\n    if not na(prev_m_ph) and cooldown_ok and slope_ok\r\n        if curr_p_high > prev_p_ph and m_ph < prev_m_ph\r\n            r_bear := true\r\n            last_bear_idx := bar_index\r\n    prev_m_ph := m_ph, prev_p_ph := curr_p_high\r\n\r\n// -----------------------------------------------------------------------------\r\n// 5. Visuals\r\n// -----------------------------------------------------------------------------\r\nhline(z_thresh, "Upper Band", color=color.new(#00FFCC, 40), linestyle=hline.style_dashed)\r\nhline(-z_thresh, "Lower Band", color=color.new(#FF00FF, 40), linestyle=hline.style_dashed)\r\nhline(0, "Zero Line", color=color.new(color.gray, 50))\r\n\r\ncolor h_col = z_hist >= 0 ? (z_price > z_thresh ? #00FFCC : #26A69A) : (z_price < -z_thresh ? #FF00FF : #EF5350)\r\nplot(z_hist, "Z-Histogram", style=plot.style_columns, color=h_col)\r\nplot(z_macd, "Z-MACD", color=#2962FF, linewidth=2)\r\nplot(z_signal, "Z-Signal", color=#FF6D00)\r\nplot(z_price, "Price Z-Score", color=color.new(color.purple, 50), linewidth=1)\r\n\r\nplotshape(r_bull, "R_Bull", shape.triangleup, location.bottom, #00FF00, offset=-5, size=size.small, text="R")\r\nplotshape(r_bear, "R_Bear", shape.triangledown, location.top, #FF0000, offset=-5, size=size.small, text="R")\r\nbgcolor(show_bg and r_bull ? color.new(#00FF00, 92) : na, offset=-5)\r\nbgcolor(show_bg and r_bear ? color.new(#FF0000, 92) : na, offset=-5)\r\n\r\n// -----------------------------------------------------------------------------\r\n// 6. Timeframe Recommendation Logic & Dashboard\r\n// -----------------------------------------------------------------------------\r\nstring rec_pivot = ""\r\nif timeframe.isseconds or (timeframe.isintraday and timeframe.multiplier <= 5)\r\n    rec_pivot := "10-15"\r\nelse if timeframe.isintraday and timeframe.multiplier <= 60\r\n    rec_pivot := "5-10"\r\nelse\r\n    rec_pivot := "3-5"\r\n\r\nif barstate.islast\r\n    var table dash = table.new(position.top_right, 2, 5, bgcolor=color.new(#1e222d, 20), border_width=1, border_color=#363c4e)\r\n    table.cell(dash, 0, 0, "Lens Speed", text_color=color.white, text_size=size.small)\r\n    table.cell(dash, 1, 0, str.tostring(math.round(avg_len, 1)), text_color=color.white, text_size=size.small)\r\n    table.cell(dash, 0, 1, "Price Z-Score", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 1, str.tostring(math.round(z_price, 2)), text_color=(math.abs(z_price) > z_thresh ? #FF00FF : color.white), text_size=size.small)\r\n    table.cell(dash, 0, 2, "Rec Pivot", text_color=#00FFFF, text_size=size.small)\r\n    table.cell(dash, 1, 2, rec_pivot, text_color=#00FFFF, text_size=size.small)\r\n    table.cell(dash, 0, 3, "Fast Len", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 3, str.tostring(math.round(d_fast, 1)), text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 0, 4, "Slow Len", text_color=color.gray, text_size=size.small)\r\n    table.cell(dash, 1, 4, str.tostring(math.round(d_slow, 1)), text_color=color.gray, text_size=size.small)'
[DEBUG] save_script called: script_id=PQBNt8DJ title=Auto-Lensed MACD + Z-Score v8.2 category=PQBNt8DJ force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\PQBNt8DJ_Auto-Lensed_MACD_+_Z-Score_v8.2.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\PQBNt8DJ_Auto-Lensed_MACD_+_Z-Score_v8.2.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 03:41:23 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 03:41:23 GMT' as: 2026-02-09T03:41:23+00:00
[DEBUG] Exact published date for header: 2026-02-09T03:41:23+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/vZ62NKZ7-Dual-Super-Trend-Indicator/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
//@version=6indicator("Dual Super Trend Indicator", o
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator("Dual Super Trend Indicator", overlay=true)\n\n// ===== INPUTS =====\natrLen1 = input.int(10, "ATR Length TF1")\nfactor1 = input.float(3.0, "Factor TF1")\n\natrLen2 = input.int(10, "ATR Length TF2")\nfactor2 = input.float(3.0, "Factor TF2")\n\ntf1 = input.timeframe("15", "Lower TF")\ntf2 = input.timeframe("60", "Higher TF")\n\n// ===== SUPER TREND FUNCTION =====\nf_st(_factor, _len) =>\n    [st, dir] = ta.supertrend(_factor, _len)\n    dir\n\n// ===== GET CONFIRMED MTF DIRECTIONS =====\ndir1 = request.security(syminfo.tickerid, tf1, f_st(factor1, atrLen1), barmerge.gaps_off, barmerge.lookahead_off)\ndir2 = request.security(syminfo.tickerid, tf2, f_st(factor2, atrLen2), barmerge.gaps_off, barmerge.lookahead_off)\n\n// ===== CURRENT TREND =====\n// Supertrend dir = -1 → Bullish (Long)\n// Supertrend dir =  1 → Bearish (Short)\nint currTrend = 0\nif dir1 == -1 and dir2 == -1\n    currTrend := 1\nelse if dir1 == 1 and dir2 == 1\n    currTrend := -1\nelse\n    currTrend := 0\n\n// ===== STATE =====\nvar int trendState = 0\n\n// ===== SIGNALS ONLY ON TRUE FLIP =====\nlongSignal  = currTrend == 1  and trendState != 1\nshortSignal = currTrend == -1 and trendState != -1\n\n// ===== UPDATE STATE AFTER BAR CLOSE =====\nif barstate.isconfirmed\n    if currTrend != 0\n        trendState := currTrend\n\n// ===== PLOT SIGNALS =====\nplotshape(longSignal,  title="Long",  style=shape.triangleup,   location=location.belowbar, color=color.green, size=size.small, text="LONG")\nplotshape(shortSignal, title="Short", style=shape.triangledown, location=location.abovebar, color=color.red,   size=size.small, text="SHORT")\n\n// ===== ALERTS =====\nalertcondition(longSignal,  title="Dual ST LONG",  message="Dual Super Trend Indicator flipped to LONG")\nalertcondition(shortSignal, title="Dual ST SHORT", message="Dual Super Trend Indicator flipped to SHORT")\n'
[CAPTURE 1] '//@version=6\nindicator("Dual Super Trend Indicator", overlay=true)\n\n// ===== INPUTS =====\natrLen1 = input.int(10, "ATR Length TF1")\nfactor1 = input.float(3.0, "Factor TF1")\n\natrLen2 = input.int(10, "ATR Length TF2")\nfactor2 = input.float(3.0, "Factor TF2")\n\ntf1 = input.timeframe("15", "Lower TF")\ntf2 = input.timeframe("60", "Higher TF")\n\n// ===== SUPER TREND FUNCTION =====\nf_st(_factor, _len) =>\n    [st, dir] = ta.supertrend(_factor, _len)\n    dir\n\n// ===== GET CONFIRMED MTF DIRECTIONS =====\ndir1 = request.security(syminfo.tickerid, tf1, f_st(factor1, atrLen1), barmerge.gaps_off, barmerge.lookahead_off)\ndir2 = request.security(syminfo.tickerid, tf2, f_st(factor2, atrLen2), barmerge.gaps_off, barmerge.lookahead_off)\n\n// ===== CURRENT TREND =====\n// Supertrend dir = -1 → Bullish (Long)\n// Supertrend dir =  1 → Bearish (Short)\nint currTrend = 0\nif dir1 == -1 and dir2 == -1\n    currTrend := 1\nelse if dir1 == 1 and dir2 == 1\n    currTrend := -1\nelse\n    currTrend := 0\n\n// ===== STATE =====\nvar int trendState = 0\n\n// ===== SIGNALS ONLY ON TRUE FLIP =====\nlongSignal  = currTrend == 1  and trendState != 1\nshortSignal = currTrend == -1 and trendState != -1\n\n// ===== UPDATE STATE AFTER BAR CLOSE =====\nif barstate.isconfirmed\n    if currTrend != 0\n        trendState := currTrend\n\n// ===== PLOT SIGNALS =====\nplotshape(longSignal,  title="Long",  style=shape.triangleup,   location=location.belowbar, color=color.green, size=size.small, text="LONG")\nplotshape(shortSignal, title="Short", style=shape.triangledown, location=location.abovebar, color=color.red,   size=size.small, text="SHORT")\n\n// ===== ALERTS =====\nalertcondition(longSignal,  title="Dual ST LONG",  message="Dual Super Trend Indicator flipped to LONG")\nalertcondition(shortSignal, title="Dual ST SHORT", message="Dual Super Trend Indicator flipped to SHORT")\n'
[CAPTURE 2] '//@version=6\nindicator("Dual Super Trend Indicator", overlay=true)\n\n// ===== INPUTS =====\natrLen1 = input.int(10, "ATR Length TF1")\nfactor1 = input.float(3.0, "Factor TF1")\n\natrLen2 = input.int(10, "ATR Length TF2")\nfactor2 = input.float(3.0, "Factor TF2")\n\ntf1 = input.timeframe("15", "Lower TF")\ntf2 = input.timeframe("60", "Higher TF")\n\n// ===== SUPER TREND FUNCTION =====\nf_st(_factor, _len) =>\n    [st, dir] = ta.supertrend(_factor, _len)\n    dir\n\n// ===== GET CONFIRMED MTF DIRECTIONS =====\ndir1 = request.security(syminfo.tickerid, tf1, f_st(factor1, atrLen1), barmerge.gaps_off, barmerge.lookahead_off)\ndir2 = request.security(syminfo.tickerid, tf2, f_st(factor2, atrLen2), barmerge.gaps_off, barmerge.lookahead_off)\n\n// ===== CURRENT TREND =====\n// Supertrend dir = -1 → Bullish (Long)\n// Supertrend dir =  1 → Bearish (Short)\nint currTrend = 0\nif dir1 == -1 and dir2 == -1\n    currTrend := 1\nelse if dir1 == 1 and dir2 == 1\n    currTrend := -1\nelse\n    currTrend := 0\n\n// ===== STATE =====\nvar int trendState = 0\n\n// ===== SIGNALS ONLY ON TRUE FLIP =====\nlongSignal  = currTrend == 1  and trendState != 1\nshortSignal = currTrend == -1 and trendState != -1\n\n// ===== UPDATE STATE AFTER BAR CLOSE =====\nif barstate.isconfirmed\n    if currTrend != 0\n        trendState := currTrend\n\n// ===== PLOT SIGNALS =====\nplotshape(longSignal,  title="Long",  style=shape.triangleup,   location=location.belowbar, color=color.green, size=size.small, text="LONG")\nplotshape(shortSignal, title="Short", style=shape.triangledown, location=location.abovebar, color=color.red,   size=size.small, text="SHORT")\n\n// ===== ALERTS =====\nalertcondition(longSignal,  title="Dual ST LONG",  message="Dual Super Trend Indicator flipped to LONG")\nalertcondition(shortSignal, title="Dual ST SHORT", message="Dual Super Trend Indicator flipped to SHORT")\n'
[DEBUG] save_script called: script_id=vZ62NKZ7 title=Dual Super Trend Indicator category=vZ62NKZ7 force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\vZ62NKZ7_Dual_Super_Trend_Indicator.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\vZ62NKZ7_Dual_Super_Trend_Indicator.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 03:32:53 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 03:32:53 GMT' as: 2026-02-09T03:32:53+00:00
[DEBUG] Exact published date for header: 2026-02-09T03:32:53+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/ckh4Wg4B/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\r\nindicator("Anchor-Point Average", shorttitle="Anchor-Point Average", overlay=true)\r\n\r\n// Interactive time input: add confirm=true parameter to select start time by clicking on chart\r\nstartTime = input.time(timestamp("2024-01-01 00:00 +0000"), "Start Time (Click Chart to Select)", confirm=true)\r\n\r\n// Price type selection\r\npriceType = input.string("Close", "Price Type", options=["Close", "Open", "High", "Low", "HL2", "HLC3", "OHLC4"], group="Calculation Settings")\r\n\r\n// Label color settings\r\nstartLabelColor = input.color(color.green, "Start Point Label Color", group="Label Settings")\r\ncurrentLabelColor = input.color(color.blue, "Current Point Label Color", group="Label Settings")\r\n\r\n// Get selected price\r\nselectedPrice = switch priceType\r\n    "Close" => close\r\n    "Open" => open\r\n    "High" => high\r\n    "Low" => low\r\n    "HL2" => hl2\r\n    "HLC3" => hlc3\r\n    "OHLC4" => ohlc4\r\n    => close\r\n\r\n// Check if current bar is after start time\r\nisAfterStart = time >= startTime\r\n\r\n// Accumulate prices and count\r\nvar float sumPrice = 0.0\r\nvar int count = 0\r\n\r\n// Reset flag: recalculate when start time changes\r\nvar int lastStartTime = 0\r\nif startTime != lastStartTime\r\n    sumPrice := 0.0\r\n    count := 0\r\n    lastStartTime := startTime\r\n\r\nif isAfterStart\r\n    sumPrice := sumPrice + selectedPrice\r\n    count := count + 1\r\n\r\n// Calculate average\r\navgPrice = count > 0 ? sumPrice / count : na\r\n\r\n// Plot average line\r\nplot(avgPrice, title="Average Price", color=color.blue, linewidth=2)\r\n\r\n// Draw marker at start time point, showing date and time\r\nif time == startTime\r\n    startDateStr = str.format("{0,date,yyyy-MM-dd}", startTime)\r\n    startTimeStr = str.format("{0,time,HH:mm}", startTime)\r\n    label.new(bar_index, low, \r\n         text="Start Point\\n" + startDateStr + " " + startTimeStr, \r\n         style=label.style_label_up, \r\n         color=startLabelColor, \r\n         textcolor=color.white, \r\n         size=size.normal)\r\n\r\n// Display average value on chart\r\nvar label avgLabel = na\r\nif barstate.islast and not na(avgPrice)\r\n    label.delete(avgLabel)\r\n    avgLabel := label.new(bar_index, avgPrice, \r\n         text=priceType + " Avg: " + str.tostring(avgPrice, "#.##") + "\\nSamples: " + str.tostring(count), \r\n         style=label.style_label_left, \r\n         color=currentLabelColor, \r\n         textcolor=color.white)\r\n\r\n// ===== Alert Functions =====\r\n\r\n// Detect price crossing above average\r\ncrossAbove = ta.crossover(selectedPrice, avgPrice)\r\n\r\n// Detect price crossing below average\r\ncrossBelow = ta.crossunder(selectedPrice, avgPrice)\r\n\r\n// Set alert conditions (using placeholders)\r\nalertcondition(crossAbove, \r\n     title="Price Crosses Above Average", \r\n     message="Price has crossed above average! Current: {{close}}, Ticker: {{ticker}}, Time: {{time}}")\r\n\r\nalertcondition(crossBelow, \r\n     title="Price Crosses Below Average", \r\n     message="Price has crossed below average! Current: {{close}}, Ticker: {{ticker}}, Time: {{time}}")\r\n\r\n// Mark crossover points on chart\r\nplotshape(crossAbove, title="Cross Above", style=shape.triangleup, location=location.belowbar, \r\n     color=color.green, size=size.small)\r\n     \r\nplotshape(crossBelow, title="Cross Below", style=shape.triangledown, location=location.abovebar, \r\n     color=color.red, size=size.small)\r\n'
[CAPTURE 1] '//@version=5\r\nindicator("Anchor-Point Average", shorttitle="Anchor-Point Average", overlay=true)\r\n\r\n// Interactive time input: add confirm=true parameter to select start time by clicking on chart\r\nstartTime = input.time(timestamp("2024-01-01 00:00 +0000"), "Start Time (Click Chart to Select)", confirm=true)\r\n\r\n// Price type selection\r\npriceType = input.string("Close", "Price Type", options=["Close", "Open", "High", "Low", "HL2", "HLC3", "OHLC4"], group="Calculation Settings")\r\n\r\n// Label color settings\r\nstartLabelColor = input.color(color.green, "Start Point Label Color", group="Label Settings")\r\ncurrentLabelColor = input.color(color.blue, "Current Point Label Color", group="Label Settings")\r\n\r\n// Get selected price\r\nselectedPrice = switch priceType\r\n    "Close" => close\r\n    "Open" => open\r\n    "High" => high\r\n    "Low" => low\r\n    "HL2" => hl2\r\n    "HLC3" => hlc3\r\n    "OHLC4" => ohlc4\r\n    => close\r\n\r\n// Check if current bar is after start time\r\nisAfterStart = time >= startTime\r\n\r\n// Accumulate prices and count\r\nvar float sumPrice = 0.0\r\nvar int count = 0\r\n\r\n// Reset flag: recalculate when start time changes\r\nvar int lastStartTime = 0\r\nif startTime != lastStartTime\r\n    sumPrice := 0.0\r\n    count := 0\r\n    lastStartTime := startTime\r\n\r\nif isAfterStart\r\n    sumPrice := sumPrice + selectedPrice\r\n    count := count + 1\r\n\r\n// Calculate average\r\navgPrice = count > 0 ? sumPrice / count : na\r\n\r\n// Plot average line\r\nplot(avgPrice, title="Average Price", color=color.blue, linewidth=2)\r\n\r\n// Draw marker at start time point, showing date and time\r\nif time == startTime\r\n    startDateStr = str.format("{0,date,yyyy-MM-dd}", startTime)\r\n    startTimeStr = str.format("{0,time,HH:mm}", startTime)\r\n    label.new(bar_index, low, \r\n         text="Start Point\\n" + startDateStr + " " + startTimeStr, \r\n         style=label.style_label_up, \r\n         color=startLabelColor, \r\n         textcolor=color.white, \r\n         size=size.normal)\r\n\r\n// Display average value on chart\r\nvar label avgLabel = na\r\nif barstate.islast and not na(avgPrice)\r\n    label.delete(avgLabel)\r\n    avgLabel := label.new(bar_index, avgPrice, \r\n         text=priceType + " Avg: " + str.tostring(avgPrice, "#.##") + "\\nSamples: " + str.tostring(count), \r\n         style=label.style_label_left, \r\n         color=currentLabelColor, \r\n         textcolor=color.white)\r\n\r\n// ===== Alert Functions =====\r\n\r\n// Detect price crossing above average\r\ncrossAbove = ta.crossover(selectedPrice, avgPrice)\r\n\r\n// Detect price crossing below average\r\ncrossBelow = ta.crossunder(selectedPrice, avgPrice)\r\n\r\n// Set alert conditions (using placeholders)\r\nalertcondition(crossAbove, \r\n     title="Price Crosses Above Average", \r\n     message="Price has crossed above average! Current: {{close}}, Ticker: {{ticker}}, Time: {{time}}")\r\n\r\nalertcondition(crossBelow, \r\n     title="Price Crosses Below Average", \r\n     message="Price has crossed below average! Current: {{close}}, Ticker: {{ticker}}, Time: {{time}}")\r\n\r\n// Mark crossover points on chart\r\nplotshape(crossAbove, title="Cross Above", style=shape.triangleup, location=location.belowbar, \r\n     color=color.green, size=size.small)\r\n     \r\nplotshape(crossBelow, title="Cross Below", style=shape.triangledown, location=location.abovebar, \r\n     color=color.red, size=size.small)\r\n'
[CAPTURE 2] '//@version=5\r\nindicator("Anchor-Point Average", shorttitle="Anchor-Point Average", overlay=true)\r\n\r\n// Interactive time input: add confirm=true parameter to select start time by clicking on chart\r\nstartTime = input.time(timestamp("2024-01-01 00:00 +0000"), "Start Time (Click Chart to Select)", confirm=true)\r\n\r\n// Price type selection\r\npriceType = input.string("Close", "Price Type", options=["Close", "Open", "High", "Low", "HL2", "HLC3", "OHLC4"], group="Calculation Settings")\r\n\r\n// Label color settings\r\nstartLabelColor = input.color(color.green, "Start Point Label Color", group="Label Settings")\r\ncurrentLabelColor = input.color(color.blue, "Current Point Label Color", group="Label Settings")\r\n\r\n// Get selected price\r\nselectedPrice = switch priceType\r\n    "Close" => close\r\n    "Open" => open\r\n    "High" => high\r\n    "Low" => low\r\n    "HL2" => hl2\r\n    "HLC3" => hlc3\r\n    "OHLC4" => ohlc4\r\n    => close\r\n\r\n// Check if current bar is after start time\r\nisAfterStart = time >= startTime\r\n\r\n// Accumulate prices and count\r\nvar float sumPrice = 0.0\r\nvar int count = 0\r\n\r\n// Reset flag: recalculate when start time changes\r\nvar int lastStartTime = 0\r\nif startTime != lastStartTime\r\n    sumPrice := 0.0\r\n    count := 0\r\n    lastStartTime := startTime\r\n\r\nif isAfterStart\r\n    sumPrice := sumPrice + selectedPrice\r\n    count := count + 1\r\n\r\n// Calculate average\r\navgPrice = count > 0 ? sumPrice / count : na\r\n\r\n// Plot average line\r\nplot(avgPrice, title="Average Price", color=color.blue, linewidth=2)\r\n\r\n// Draw marker at start time point, showing date and time\r\nif time == startTime\r\n    startDateStr = str.format("{0,date,yyyy-MM-dd}", startTime)\r\n    startTimeStr = str.format("{0,time,HH:mm}", startTime)\r\n    label.new(bar_index, low, \r\n         text="Start Point\\n" + startDateStr + " " + startTimeStr, \r\n         style=label.style_label_up, \r\n         color=startLabelColor, \r\n         textcolor=color.white, \r\n         size=size.normal)\r\n\r\n// Display average value on chart\r\nvar label avgLabel = na\r\nif barstate.islast and not na(avgPrice)\r\n    label.delete(avgLabel)\r\n    avgLabel := label.new(bar_index, avgPrice, \r\n         text=priceType + " Avg: " + str.tostring(avgPrice, "#.##") + "\\nSamples: " + str.tostring(count), \r\n         style=label.style_label_left, \r\n         color=currentLabelColor, \r\n         textcolor=color.white)\r\n\r\n// ===== Alert Functions =====\r\n\r\n// Detect price crossing above average\r\ncrossAbove = ta.crossover(selectedPrice, avgPrice)\r\n\r\n// Detect price crossing below average\r\ncrossBelow = ta.crossunder(selectedPrice, avgPrice)\r\n\r\n// Set alert conditions (using placeholders)\r\nalertcondition(crossAbove, \r\n     title="Price Crosses Above Average", \r\n     message="Price has crossed above average! Current: {{close}}, Ticker: {{ticker}}, Time: {{time}}")\r\n\r\nalertcondition(crossBelow, \r\n     title="Price Crosses Below Average", \r\n     message="Price has crossed below average! Current: {{close}}, Ticker: {{ticker}}, Time: {{time}}")\r\n\r\n// Mark crossover points on chart\r\nplotshape(crossAbove, title="Cross Above", style=shape.triangleup, location=location.belowbar, \r\n     color=color.green, size=size.small)\r\n     \r\nplotshape(crossBelow, title="Cross Below", style=shape.triangledown, location=location.abovebar, \r\n     color=color.red, size=size.small)\r\n'
[DEBUG] save_script called: script_id=ckh4Wg4B title=Anchor-Point Average category=ckh4Wg4B force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\ckh4Wg4B_Anchor-Point_Average.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\ckh4Wg4B_Anchor-Point_Average.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 03:32:52 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 03:32:52 GMT' as: 2026-02-09T03:32:52+00:00
[DEBUG] Exact published date for header: 2026-02-09T03:32:52+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/dRuxhoAV-CPI-Strat-Points-Labels/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
//@version=6indicator("CPI St
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\nindicator("CPI Strat - Points & Labels", overlay=true)\r\n\r\n// 1. Inputs\r\nentryOffset  = input.float(25.0, "Entry Offset (Points)", minval=1)\r\ntargetDist   = input.float(15.0, "Target Distance (Points)", minval=1)\r\n\r\n// --- Customization ---\r\nlineStyleInput = input.string("Dashed", "Line Style", options=["Solid", "Dashed", "Dotted"])\r\nlineWidth      = input.int(2, "Line Thickness", minval=1)\r\nc_entry        = input.color(color.gray, "Entry Color")\r\nc_target       = input.color(color.new(color.gray, 50), "Target Color")\r\n\r\n// Function for Styles\r\ngetLineStyle(style) =>\r\n    switch style\r\n        "Solid"  => line.style_solid\r\n        "Dashed" => line.style_dashed\r\n        "Dotted" => line.style_dotted\r\n        => line.style_dashed\r\n\r\ncurrentStyle = getLineStyle(lineStyleInput)\r\n\r\n// 2. Create Lines and Labels\r\nvar line upEntryLine  = line.new(na, na, na, na, color=c_entry, width=lineWidth, style=currentStyle)\r\nvar line upTargetLine = line.new(na, na, na, na, color=c_target, width=lineWidth, style=currentStyle)\r\nvar line dnEntryLine  = line.new(na, na, na, na, color=c_entry, width=lineWidth, style=currentStyle)\r\nvar line dnTargetLine = line.new(na, na, na, na, color=c_target, width=lineWidth, style=currentStyle)\r\n\r\n// Labels\r\nvar label upEntryLbl  = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_entry, style=label.style_label_left)\r\nvar label upTargetLbl = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_target, style=label.style_label_left)\r\nvar label dnEntryLbl  = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_entry, style=label.style_label_left)\r\nvar label dnTargetLbl = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_target, style=label.style_label_left)\r\n\r\n// 3. Update Logic\r\nif barstate.islast\r\n    uE = close + entryOffset\r\n    uT = uE + targetDist\r\n    dE = close - entryOffset\r\n    dT = dE - targetDist\r\n\r\n    // Update Lines\r\n    line.set_xy1(upEntryLine,  bar_index, uE), line.set_xy2(upEntryLine,  bar_index + 20, uE)\r\n    line.set_xy1(upTargetLine, bar_index, uT), line.set_xy2(upTargetLine, bar_index + 20, uT)\r\n    line.set_xy1(dnEntryLine,  bar_index, dE), line.set_xy2(dnEntryLine,  bar_index + 20, dE)\r\n    line.set_xy1(dnTargetLine, bar_index, dT), line.set_xy2(dnTargetLine, bar_index + 20, dT)\r\n\r\n    // Update Labels with point info\r\n    label.set_xy(upEntryLbl,  bar_index + 21, uE)\r\n    label.set_text(upEntryLbl, str.tostring(entryOffset) + " pts Entry")\r\n    \r\n    label.set_xy(upTargetLbl, bar_index + 21, uT)\r\n    label.set_text(upTargetLbl, str.tostring(entryOffset + targetDist) + " pts TP")\r\n\r\n    label.set_xy(dnEntryLbl,  bar_index + 21, dE)\r\n    label.set_text(dnEntryLbl, str.tostring(entryOffset) + " pts Entry")\r\n\r\n    label.set_xy(dnTargetLbl, bar_index + 21, dT)\r\n    label.set_text(dnTargetLbl, str.tostring(entryOffset + targetDist) + " pts TP")'
[CAPTURE 1] '//@version=6\r\nindicator("CPI Strat - Points & Labels", overlay=true)\r\n\r\n// 1. Inputs\r\nentryOffset  = input.float(25.0, "Entry Offset (Points)", minval=1)\r\ntargetDist   = input.float(15.0, "Target Distance (Points)", minval=1)\r\n\r\n// --- Customization ---\r\nlineStyleInput = input.string("Dashed", "Line Style", options=["Solid", "Dashed", "Dotted"])\r\nlineWidth      = input.int(2, "Line Thickness", minval=1)\r\nc_entry        = input.color(color.gray, "Entry Color")\r\nc_target       = input.color(color.new(color.gray, 50), "Target Color")\r\n\r\n// Function for Styles\r\ngetLineStyle(style) =>\r\n    switch style\r\n        "Solid"  => line.style_solid\r\n        "Dashed" => line.style_dashed\r\n        "Dotted" => line.style_dotted\r\n        => line.style_dashed\r\n\r\ncurrentStyle = getLineStyle(lineStyleInput)\r\n\r\n// 2. Create Lines and Labels\r\nvar line upEntryLine  = line.new(na, na, na, na, color=c_entry, width=lineWidth, style=currentStyle)\r\nvar line upTargetLine = line.new(na, na, na, na, color=c_target, width=lineWidth, style=currentStyle)\r\nvar line dnEntryLine  = line.new(na, na, na, na, color=c_entry, width=lineWidth, style=currentStyle)\r\nvar line dnTargetLine = line.new(na, na, na, na, color=c_target, width=lineWidth, style=currentStyle)\r\n\r\n// Labels\r\nvar label upEntryLbl  = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_entry, style=label.style_label_left)\r\nvar label upTargetLbl = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_target, style=label.style_label_left)\r\nvar label dnEntryLbl  = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_entry, style=label.style_label_left)\r\nvar label dnTargetLbl = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_target, style=label.style_label_left)\r\n\r\n// 3. Update Logic\r\nif barstate.islast\r\n    uE = close + entryOffset\r\n    uT = uE + targetDist\r\n    dE = close - entryOffset\r\n    dT = dE - targetDist\r\n\r\n    // Update Lines\r\n    line.set_xy1(upEntryLine,  bar_index, uE), line.set_xy2(upEntryLine,  bar_index + 20, uE)\r\n    line.set_xy1(upTargetLine, bar_index, uT), line.set_xy2(upTargetLine, bar_index + 20, uT)\r\n    line.set_xy1(dnEntryLine,  bar_index, dE), line.set_xy2(dnEntryLine,  bar_index + 20, dE)\r\n    line.set_xy1(dnTargetLine, bar_index, dT), line.set_xy2(dnTargetLine, bar_index + 20, dT)\r\n\r\n    // Update Labels with point info\r\n    label.set_xy(upEntryLbl,  bar_index + 21, uE)\r\n    label.set_text(upEntryLbl, str.tostring(entryOffset) + " pts Entry")\r\n    \r\n    label.set_xy(upTargetLbl, bar_index + 21, uT)\r\n    label.set_text(upTargetLbl, str.tostring(entryOffset + targetDist) + " pts TP")\r\n\r\n    label.set_xy(dnEntryLbl,  bar_index + 21, dE)\r\n    label.set_text(dnEntryLbl, str.tostring(entryOffset) + " pts Entry")\r\n\r\n    label.set_xy(dnTargetLbl, bar_index + 21, dT)\r\n    label.set_text(dnTargetLbl, str.tostring(entryOffset + targetDist) + " pts TP")'
[CAPTURE 2] '//@version=6\r\nindicator("CPI Strat - Points & Labels", overlay=true)\r\n\r\n// 1. Inputs\r\nentryOffset  = input.float(25.0, "Entry Offset (Points)", minval=1)\r\ntargetDist   = input.float(15.0, "Target Distance (Points)", minval=1)\r\n\r\n// --- Customization ---\r\nlineStyleInput = input.string("Dashed", "Line Style", options=["Solid", "Dashed", "Dotted"])\r\nlineWidth      = input.int(2, "Line Thickness", minval=1)\r\nc_entry        = input.color(color.gray, "Entry Color")\r\nc_target       = input.color(color.new(color.gray, 50), "Target Color")\r\n\r\n// Function for Styles\r\ngetLineStyle(style) =>\r\n    switch style\r\n        "Solid"  => line.style_solid\r\n        "Dashed" => line.style_dashed\r\n        "Dotted" => line.style_dotted\r\n        => line.style_dashed\r\n\r\ncurrentStyle = getLineStyle(lineStyleInput)\r\n\r\n// 2. Create Lines and Labels\r\nvar line upEntryLine  = line.new(na, na, na, na, color=c_entry, width=lineWidth, style=currentStyle)\r\nvar line upTargetLine = line.new(na, na, na, na, color=c_target, width=lineWidth, style=currentStyle)\r\nvar line dnEntryLine  = line.new(na, na, na, na, color=c_entry, width=lineWidth, style=currentStyle)\r\nvar line dnTargetLine = line.new(na, na, na, na, color=c_target, width=lineWidth, style=currentStyle)\r\n\r\n// Labels\r\nvar label upEntryLbl  = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_entry, style=label.style_label_left)\r\nvar label upTargetLbl = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_target, style=label.style_label_left)\r\nvar label dnEntryLbl  = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_entry, style=label.style_label_left)\r\nvar label dnTargetLbl = label.new(na, na, "", color=color.new(color.black, 100), textcolor=c_target, style=label.style_label_left)\r\n\r\n// 3. Update Logic\r\nif barstate.islast\r\n    uE = close + entryOffset\r\n    uT = uE + targetDist\r\n    dE = close - entryOffset\r\n    dT = dE - targetDist\r\n\r\n    // Update Lines\r\n    line.set_xy1(upEntryLine,  bar_index, uE), line.set_xy2(upEntryLine,  bar_index + 20, uE)\r\n    line.set_xy1(upTargetLine, bar_index, uT), line.set_xy2(upTargetLine, bar_index + 20, uT)\r\n    line.set_xy1(dnEntryLine,  bar_index, dE), line.set_xy2(dnEntryLine,  bar_index + 20, dE)\r\n    line.set_xy1(dnTargetLine, bar_index, dT), line.set_xy2(dnTargetLine, bar_index + 20, dT)\r\n\r\n    // Update Labels with point info\r\n    label.set_xy(upEntryLbl,  bar_index + 21, uE)\r\n    label.set_text(upEntryLbl, str.tostring(entryOffset) + " pts Entry")\r\n    \r\n    label.set_xy(upTargetLbl, bar_index + 21, uT)\r\n    label.set_text(upTargetLbl, str.tostring(entryOffset + targetDist) + " pts TP")\r\n\r\n    label.set_xy(dnEntryLbl,  bar_index + 21, dE)\r\n    label.set_text(dnEntryLbl, str.tostring(entryOffset) + " pts Entry")\r\n\r\n    label.set_xy(dnTargetLbl, bar_index + 21, dT)\r\n    label.set_text(dnTargetLbl, str.tostring(entryOffset + targetDist) + " pts TP")'
[DEBUG] save_script called: script_id=dRuxhoAV title=CPI Strat - Points & Labels category=dRuxhoAV force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\dRuxhoAV_CPI_Strat_-_Points_&_Labels.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\dRuxhoAV_CPI_Strat_-_Points_&_Labels.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 03:32:42 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 03:32:42 GMT' as: 2026-02-09T03:32:42+00:00
[DEBUG] Exact published date for header: 2026-02-09T03:32:42+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/HSkndXUq-Lil-B-s-Time-based-Liquidity-IFVG-Alerts/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\nindicator("Sweep -> ICT FVG -> IFVG OK | Asia/London/PD (Clean + Polished)",\r\n     overlay=true, max_lines_count=300, max_labels_count=500, max_boxes_count=300)\r\n\r\n//===========================\r\n// INPUTS\r\n//===========================\r\ntz         = input.string("America/New_York", "Timezone")\r\nasiaSess   = input.session("1800-0230", "Asia Session (NY)")\r\nlondonSess = input.session("0231-0700", "London Session (NY)")\r\n\r\nuseAsiaLevels   = input.bool(true, "Use Asia Levels")\r\nuseLondonLevels = input.bool(true, "Use London Levels")\r\nusePDLevels     = input.bool(true, "Use Prev Day Levels")\r\n\r\nuseWickSweep = input.bool(true, "Sweep detection uses wick (else close)")\r\n\r\nmaxBarsWaitFVG  = input.int(240, "Max bars after sweep to allow FVG", minval=5)\r\nminFvgGapTicks  = input.int(0, "Min FVG gap filter (ticks, 0 = none)", minval=0)\r\nstrongInversion = input.bool(true, "Strong inversion (full fill). Off = entry only")\r\noneIFVGPerLevelPerDay = input.bool(true, "Only 1 IFVG OK per level per day")\r\n\r\nautoCleanAtMidnight = input.bool(false, "Auto-clean FVGs/labels at NY midnight")\r\nmarkFailedOnTimeout = input.bool(false, "Mark FVG as FAILED on timeout")\r\n\r\nshowFvgBox   = input.bool(true, "Show FVG Box")\r\nshowFvgLabel = input.bool(true, "Show FVG Label")\r\n\r\n// ✅ NEW POLISH SETTINGS\r\nshowLevelNameLabels     = input.bool(true, "Show Level Name Labels (ASIA/LONDON/PD)")\r\nhideFvgLabelAfterIfvgOk = input.bool(true, "Hide FVG label after IFVG OK")\r\nkeepOnlyLatestFvgPerLvl = input.bool(false, "Keep only MOST RECENT FVG per level")\r\n\r\nkeepLastFVGs   = input.int(200, "Keep last N FVG boxes", minval=20, maxval=280)\r\nkeepLastEvents = input.int(300, "Keep last N Event labels", minval=20, maxval=480)\r\n\r\n// Colors\r\ncAsia   = input.color(color.aqua,    "Asia Level Color")\r\ncLondon = input.color(color.orange,  "London Level Color")\r\ncPD     = input.color(color.fuchsia, "Prev Day Level Color")\r\n\r\nlvlLblText     = input.color(color.white, "Level Label Text")\r\nsweepLblBg     = input.color(color.new(color.yellow, 0), "Sweep Label BG")\r\nsweepLblText   = input.color(color.white,               "Sweep Label Text")\r\n\r\nfvgLblBg       = input.color(color.new(color.gray, 20), "FVG Label BG")\r\nfvgLblText     = input.color(color.white,               "FVG Label Text")\r\n\r\nifvgOkLongBg   = input.color(color.new(color.green, 0), "IFVG OK (Long) Label BG")\r\nifvgOkShortBg  = input.color(color.new(color.red,   0), "IFVG OK (Short) Label BG")\r\nifvgOkLblText  = input.color(color.white,               "IFVG OK Label Text")\r\n\r\nfvgFillActive  = input.color(color.new(color.gray, 82), "FVG Fill (Active)")\r\nfvgFillOk      = input.color(color.new(color.green, 88),"FVG Fill (Confirmed)")\r\nfvgFillFail    = input.color(color.new(color.red,  90), "FVG Fill (Failed)")\r\n\r\n//===========================\r\n// HELPERS\r\n//===========================\r\ntick = syminfo.mintick\r\ngap  = float(minFvgGapTicks) * tick\r\n\r\nf_inSession(sess) =>\r\n    not na(time(timeframe.period, sess, tz))\r\n\r\nf_sweptHigh(level) =>\r\n    useWickSweep ? high >= level : close >= level\r\n\r\nf_sweptLow(level) =>\r\n    useWickSweep ? low <= level : close <= level\r\n\r\n// force borders fully off (prevents dashed artifacts)\r\nf_borderNone() => color.new(color.black, 100)\r\n\r\nf_key() => str.tostring(time) + "_" + str.tostring(bar_index)\r\n\r\n//===========================\r\n// GLOBAL STORAGE (recycling)\r\n//===========================\r\nvar box[]    gBoxes   = array.new_box()\r\nvar string[] gKeys    = array.new_string()\r\nvar int[]    gStatus  = array.new_int()  // 0=active, 1=ok, 2=fail\r\nvar label[]  gFvgLbls = array.new_label()\r\nvar label[]  gEventLbls = array.new_label()\r\n\r\nf_trimFVG() =>\r\n    while array.size(gBoxes) > keepLastFVGs\r\n        box.delete(array.shift(gBoxes))\r\n        array.shift(gKeys)\r\n        array.shift(gStatus)\r\n        label lb = array.shift(gFvgLbls)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n\r\nf_trimEvents() =>\r\n    while array.size(gEventLbls) > keepLastEvents\r\n        label.delete(array.shift(gEventLbls))\r\n\r\nf_addEvent(label lb) =>\r\n    array.push(gEventLbls, lb)\r\n    f_trimEvents()\r\n\r\nf_addFvg(box b, label lb, string key) =>\r\n    array.push(gBoxes, b)\r\n    array.push(gKeys, key)\r\n    array.push(gStatus, 0)\r\n    array.push(gFvgLbls, lb)\r\n    f_trimFVG()\r\n\r\nf_findKeyIndex(string key) =>\r\n    int idx = na\r\n    for i = array.size(gKeys) - 1 to 0\r\n        if array.get(gKeys, i) == key\r\n            idx := i\r\n            break\r\n    idx\r\n\r\nf_setStatus(string key, int st) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        array.set(gStatus, idx, st)\r\n\r\nf_deleteFvgLabelByKey(string key) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        label lb = array.get(gFvgLbls, idx)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n        array.set(gFvgLbls, idx, na)\r\n\r\nf_removeFvgByKey(string key) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        box b = array.get(gBoxes, idx)\r\n        label lb = array.get(gFvgLbls, idx)\r\n        if not na(b)\r\n            box.delete(b)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n        array.remove(gBoxes, idx)\r\n        array.remove(gKeys, idx)\r\n        array.remove(gStatus, idx)\r\n        array.remove(gFvgLbls, idx)\r\n\r\n// Guard against empty arrays\r\nf_applyStatusStyling() =>\r\n    int n = array.size(gBoxes)\r\n    if n > 0\r\n        for i = 0 to n - 1\r\n            box b = array.get(gBoxes, i)\r\n            int st = array.get(gStatus, i)\r\n            color fill = st == 1 ? fvgFillOk : st == 2 ? fvgFillFail : fvgFillActive\r\n            box.set_bgcolor(b, showFvgBox ? fill : color.new(fill, 100))\r\n            box.set_border_color(b, f_borderNone())\r\n\r\nf_clearAll() =>\r\n    while array.size(gBoxes) > 0\r\n        box.delete(array.pop(gBoxes))\r\n    while array.size(gKeys) > 0\r\n        array.pop(gKeys)\r\n    while array.size(gStatus) > 0\r\n        array.pop(gStatus)\r\n    while array.size(gFvgLbls) > 0\r\n        label lb = array.pop(gFvgLbls)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n    while array.size(gEventLbls) > 0\r\n        label.delete(array.pop(gEventLbls))\r\n\r\n//===========================\r\n// PREVIOUS DAY (NY midnight -> midnight)\r\n//===========================\r\ndayKey    = time("D", "0000-2359", tz)\r\nnewCalDay = ta.change(dayKey) != 0\r\n\r\nvar float dayHigh = na\r\nvar float dayLow  = na\r\nvar float pdHigh  = na\r\nvar float pdLow   = na\r\n\r\nif newCalDay\r\n    pdHigh  := dayHigh\r\n    pdLow   := dayLow\r\n    dayHigh := high\r\n    dayLow  := low\r\nelse\r\n    dayHigh := na(dayHigh) ? high : math.max(dayHigh, high)\r\n    dayLow  := na(dayLow)  ? low  : math.min(dayLow, low)\r\n\r\nif newCalDay and autoCleanAtMidnight\r\n    f_clearAll()\r\n\r\n//===========================\r\n// SESSION RANGES\r\n//===========================\r\ninAsia    = f_inSession(asiaSess)\r\nasiaStart = inAsia and not inAsia[1]\r\nasiaEnd   = not inAsia and inAsia[1]\r\nvar float asiaHigh = na\r\nvar float asiaLow  = na\r\nif asiaStart\r\n    asiaHigh := high\r\n    asiaLow  := low\r\nelse if inAsia\r\n    asiaHigh := math.max(asiaHigh, high)\r\n    asiaLow  := math.min(asiaLow, low)\r\n\r\ninLondon    = f_inSession(londonSess)\r\nlondonStart = inLondon and not inLondon[1]\r\nlondonEnd   = not inLondon and inLondon[1]\r\nvar float londonHigh = na\r\nvar float londonLow  = na\r\nif londonStart\r\n    londonHigh := high\r\n    londonLow  := low\r\nelse if inLondon\r\n    londonHigh := math.max(londonHigh, high)\r\n    londonLow  := math.min(londonLow, low)\r\n\r\n//===========================\r\n// LEVEL LINES (extend until swept, then stop) + DAY-STAMP GATING\r\n//===========================\r\n\r\n// --- Asia\r\nvar line asiaHighLine = na\r\nvar line asiaLowLine  = na\r\nvar bool asiaHighHit  = false\r\nvar bool asiaLowHit   = false\r\nvar int  asiaLineDay  = na\r\n\r\nif useAsiaLevels and asiaEnd and not na(asiaHigh) and not na(asiaLow)\r\n    asiaHighHit := false\r\n    asiaLowHit  := false\r\n    asiaLineDay := dayKey\r\n\r\n    if not na(asiaHighLine)\r\n        line.delete(asiaHighLine)\r\n    if not na(asiaLowLine)\r\n        line.delete(asiaLowLine)\r\n\r\n    asiaHighLine := line.new(bar_index - 2, asiaHigh, bar_index, asiaHigh, extend=extend.right, color=cAsia, width=2)\r\n    asiaLowLine  := line.new(bar_index - 2, asiaLow,  bar_index, asiaLow,  extend=extend.right, color=cAsia, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, asiaHigh, "ASIA HIGH", style=label.style_label_left, color=cAsia, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, asiaLow,  "ASIA LOW",  style=label.style_label_left, color=cAsia, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif useAsiaLevels and not asiaHighHit and not na(asiaHighLine) and (asiaLineDay == dayKey) and f_sweptHigh(asiaHigh)\r\n    asiaHighHit := true\r\n    line.set_extend(asiaHighLine, extend.none)\r\n    line.set_x2(asiaHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, asiaHigh, "ASIA HIGH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif useAsiaLevels and not asiaLowHit and not na(asiaLowLine) and (asiaLineDay == dayKey) and f_sweptLow(asiaLow)\r\n    asiaLowHit := true\r\n    line.set_extend(asiaLowLine, extend.none)\r\n    line.set_x2(asiaLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, asiaLow, "ASIA LOW SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n// --- London\r\nvar line londonHighLine = na\r\nvar line londonLowLine  = na\r\nvar bool londonHighHit  = false\r\nvar bool londonLowHit   = false\r\nvar int  londonLineDay  = na\r\n\r\nif useLondonLevels and newCalDay\r\n    londonHigh := na\r\n    londonLow  := na\r\n    londonHighHit := false\r\n    londonLowHit  := false\r\n    londonLineDay := na\r\n    if not na(londonHighLine)\r\n        line.delete(londonHighLine), londonHighLine := na\r\n    if not na(londonLowLine)\r\n        line.delete(londonLowLine), londonLowLine := na\r\n\r\nif useLondonLevels and londonEnd and not na(londonHigh) and not na(londonLow)\r\n    londonHighHit := false\r\n    londonLowHit  := false\r\n    londonLineDay := dayKey\r\n\r\n    if not na(londonHighLine)\r\n        line.delete(londonHighLine)\r\n    if not na(londonLowLine)\r\n        line.delete(londonLowLine)\r\n\r\n    londonHighLine := line.new(bar_index - 2, londonHigh, bar_index, londonHigh, extend=extend.right, color=cLondon, width=2)\r\n    londonLowLine  := line.new(bar_index - 2, londonLow,  bar_index, londonLow,  extend=extend.right, color=cLondon, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, londonHigh, "LONDON HIGH", style=label.style_label_left, color=cLondon, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, londonLow,  "LONDON LOW",  style=label.style_label_left, color=cLondon, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif useLondonLevels and not londonHighHit and not na(londonHighLine) and (londonLineDay == dayKey) and f_sweptHigh(londonHigh)\r\n    londonHighHit := true\r\n    line.set_extend(londonHighLine, extend.none)\r\n    line.set_x2(londonHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, londonHigh, "LONDON HIGH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif useLondonLevels and not londonLowHit and not na(londonLowLine) and (londonLineDay == dayKey) and f_sweptLow(londonLow)\r\n    londonLowHit := true\r\n    line.set_extend(londonLowLine, extend.none)\r\n    line.set_x2(londonLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, londonLow, "LONDON LOW SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n// --- Prev Day\r\nvar line pdHighLine = na\r\nvar line pdLowLine  = na\r\nvar bool pdHighHit  = false\r\nvar bool pdLowHit   = false\r\n\r\nif usePDLevels and newCalDay and not na(pdHigh) and not na(pdLow)\r\n    pdHighHit := false\r\n    pdLowHit  := false\r\n    if not na(pdHighLine)\r\n        line.delete(pdHighLine)\r\n    if not na(pdLowLine)\r\n        line.delete(pdLowLine)\r\n    pdHighLine := line.new(bar_index - 2, pdHigh, bar_index, pdHigh, extend=extend.right, color=cPD, width=2)\r\n    pdLowLine  := line.new(bar_index - 2, pdLow,  bar_index, pdLow,  extend=extend.right, color=cPD, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, pdHigh, "PDH", style=label.style_label_left, color=cPD, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, pdLow,  "PDL", style=label.style_label_left, color=cPD, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif usePDLevels and not pdHighHit and not na(pdHighLine) and f_sweptHigh(pdHigh)\r\n    pdHighHit := true\r\n    line.set_extend(pdHighLine, extend.none)\r\n    line.set_x2(pdHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, pdHigh, "PDH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif usePDLevels and not pdLowHit and not na(pdLowLine) and f_sweptLow(pdLow)\r\n    pdLowHit := true\r\n    line.set_extend(pdLowLine, extend.none)\r\n    line.set_x2(pdLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, pdLow, "PDL SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n//===========================\r\n// INDEPENDENT IFVG STATE PER LEVEL (+ "latest FVG only" support)\r\n//===========================\r\ntype LevelState\r\n    bool   waiting\r\n    int    sweepBar\r\n    int    dir\r\n    bool   haveFVG\r\n    float  refWeak\r\n    float  refStrong\r\n    box    b\r\n    label  fvgLbl\r\n    string key\r\n    int    lastOkDayKey\r\n    string lastFvgKey    // persists so we can delete older FVGs per level\r\n\r\nf_makeState() => LevelState.new(false, na, 0, false, na, na, na, na, "", 0, "")\r\n\r\nf_arm(LevelState s, int _dir) =>\r\n    bool blockedToday = oneIFVGPerLevelPerDay and (s.lastOkDayKey == dayKey)\r\n    blockedToday ? s : LevelState.new(true, bar_index, _dir, false, na, na, na, na, "", s.lastOkDayKey, s.lastFvgKey)\r\n\r\nf_buildBearIct(LevelState s) =>\r\n    // bearish ICT FVG: high < low[2]\r\n    if keepOnlyLatestFvgPerLvl and s.lastFvgKey != ""\r\n        f_removeFvgByKey(s.lastFvgKey)\r\n\r\n    float top = low[2]\r\n    float bot = high\r\n    string k = f_key()\r\n    float weak = bot\r\n    float strong = top\r\n\r\n    box b = box.new(bar_index, top, bar_index, bot,\r\n        bgcolor = showFvgBox ? fvgFillActive : color.new(fvgFillActive, 100),\r\n        border_color = f_borderNone())\r\n\r\n    label lb = na\r\n    if showFvgLabel\r\n        lb := label.new(bar_index, (top+bot)/2.0, "FVG", style=label.style_label_left, color=fvgLblBg, textcolor=fvgLblText, size=size.small)\r\n\r\n    f_addFvg(b, lb, k)\r\n    LevelState.new(true, s.sweepBar, s.dir, true, weak, strong, b, lb, k, s.lastOkDayKey, k)\r\n\r\nf_buildBullIct(LevelState s) =>\r\n    // bullish ICT FVG: low > high[2]\r\n    if keepOnlyLatestFvgPerLvl and s.lastFvgKey != ""\r\n        f_removeFvgByKey(s.lastFvgKey)\r\n\r\n    float top = low\r\n    float bot = high[2]\r\n    string k = f_key()\r\n    float weak = top\r\n    float strong = bot\r\n\r\n    box b = box.new(bar_index, top, bar_index, bot,\r\n        bgcolor = showFvgBox ? fvgFillActive : color.new(fvgFillActive, 100),\r\n        border_color = f_borderNone())\r\n\r\n    label lb = na\r\n    if showFvgLabel\r\n        lb := label.new(bar_index, (top+bot)/2.0, "FVG", style=label.style_label_left, color=fvgLblBg, textcolor=fvgLblText, size=size.small)\r\n\r\n    f_addFvg(b, lb, k)\r\n    LevelState.new(true, s.sweepBar, s.dir, true, weak, strong, b, lb, k, s.lastOkDayKey, k)\r\n\r\nf_process(LevelState s) =>\r\n    LevelState st = s\r\n    bool blockedToday = oneIFVGPerLevelPerDay and (st.lastOkDayKey == dayKey)\r\n\r\n    if st.waiting and not blockedToday and not na(st.sweepBar) and bar_index - st.sweepBar > maxBarsWaitFVG\r\n        if markFailedOnTimeout and st.haveFVG and st.key != ""\r\n            f_setStatus(st.key, 2)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n\r\n    if st.waiting and not blockedToday and not st.haveFVG and bar_index >= 2\r\n        if st.dir == +1 and high < (low[2] - gap)\r\n            st := f_buildBearIct(st)\r\n        else if st.dir == -1 and low > (high[2] + gap)\r\n            st := f_buildBullIct(st)\r\n\r\n    if st.waiting and st.haveFVG and not na(st.b)\r\n        box.set_right(st.b, bar_index)\r\n\r\n    float invRef = strongInversion ? st.refStrong : st.refWeak\r\n    bool okLong  = st.waiting and not blockedToday and st.dir == +1 and st.haveFVG and not na(invRef) and close >= invRef\r\n    bool okShort = st.waiting and not blockedToday and st.dir == -1 and st.haveFVG and not na(invRef) and close <= invRef\r\n\r\n    if okLong\r\n        f_addEvent(label.new(bar_index, low, "IFVG OK", style=label.style_label_up, color=ifvgOkLongBg, textcolor=ifvgOkLblText, size=size.small))\r\n        if st.key != ""\r\n            f_setStatus(st.key, 1)\r\n            if hideFvgLabelAfterIfvgOk\r\n                f_deleteFvgLabelByKey(st.key)\r\n        if not na(st.b)\r\n            box.set_right(st.b, bar_index)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n        st.lastOkDayKey := dayKey\r\n\r\n    if okShort\r\n        f_addEvent(label.new(bar_index, high, "IFVG OK", style=label.style_label_down, color=ifvgOkShortBg, textcolor=ifvgOkLblText, size=size.small))\r\n        if st.key != ""\r\n            f_setStatus(st.key, 1)\r\n            if hideFvgLabelAfterIfvgOk\r\n                f_deleteFvgLabelByKey(st.key)\r\n        if not na(st.b)\r\n            box.set_right(st.b, bar_index)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n        st.lastOkDayKey := dayKey\r\n\r\n    st\r\n\r\n//===========================\r\n// 6 independent states\r\n//===========================\r\nvar LevelState stAsiaH = f_makeState()\r\nvar LevelState stAsiaL = f_makeState()\r\nvar LevelState stLonH  = f_makeState()\r\nvar LevelState stLonL  = f_makeState()\r\nvar LevelState stPDH   = f_makeState()\r\nvar LevelState stPDL   = f_makeState()\r\n\r\nif useAsiaLevels and not asiaHighHit[1] and asiaHighHit\r\n    stAsiaH := f_arm(stAsiaH, -1)\r\nif useAsiaLevels and not asiaLowHit[1] and asiaLowHit\r\n    stAsiaL := f_arm(stAsiaL, +1)\r\n\r\nif useLondonLevels and not londonHighHit[1] and londonHighHit\r\n    stLonH := f_arm(stLonH, -1)\r\nif useLondonLevels and not londonLowHit[1] and londonLowHit\r\n    stLonL := f_arm(stLonL, +1)\r\n\r\nif usePDLevels and not pdHighHit[1] and pdHighHit\r\n    stPDH := f_arm(stPDH, -1)\r\nif usePDLevels and not pdLowHit[1] and pdLowHit\r\n    stPDL := f_arm(stPDL, +1)\r\n\r\nstAsiaH := f_process(stAsiaH)\r\nstAsiaL := f_process(stAsiaL)\r\nstLonH  := f_process(stLonH)\r\nstLonL  := f_process(stLonL)\r\nstPDH   := f_process(stPDH)\r\nstPDL   := f_process(stPDL)\r\n\r\nf_applyStatusStyling()\r\n'
[CAPTURE 1] '//@version=6\r\nindicator("Sweep -> ICT FVG -> IFVG OK | Asia/London/PD (Clean + Polished)",\r\n     overlay=true, max_lines_count=300, max_labels_count=500, max_boxes_count=300)\r\n\r\n//===========================\r\n// INPUTS\r\n//===========================\r\ntz         = input.string("America/New_York", "Timezone")\r\nasiaSess   = input.session("1800-0230", "Asia Session (NY)")\r\nlondonSess = input.session("0231-0700", "London Session (NY)")\r\n\r\nuseAsiaLevels   = input.bool(true, "Use Asia Levels")\r\nuseLondonLevels = input.bool(true, "Use London Levels")\r\nusePDLevels     = input.bool(true, "Use Prev Day Levels")\r\n\r\nuseWickSweep = input.bool(true, "Sweep detection uses wick (else close)")\r\n\r\nmaxBarsWaitFVG  = input.int(240, "Max bars after sweep to allow FVG", minval=5)\r\nminFvgGapTicks  = input.int(0, "Min FVG gap filter (ticks, 0 = none)", minval=0)\r\nstrongInversion = input.bool(true, "Strong inversion (full fill). Off = entry only")\r\noneIFVGPerLevelPerDay = input.bool(true, "Only 1 IFVG OK per level per day")\r\n\r\nautoCleanAtMidnight = input.bool(false, "Auto-clean FVGs/labels at NY midnight")\r\nmarkFailedOnTimeout = input.bool(false, "Mark FVG as FAILED on timeout")\r\n\r\nshowFvgBox   = input.bool(true, "Show FVG Box")\r\nshowFvgLabel = input.bool(true, "Show FVG Label")\r\n\r\n// ✅ NEW POLISH SETTINGS\r\nshowLevelNameLabels     = input.bool(true, "Show Level Name Labels (ASIA/LONDON/PD)")\r\nhideFvgLabelAfterIfvgOk = input.bool(true, "Hide FVG label after IFVG OK")\r\nkeepOnlyLatestFvgPerLvl = input.bool(false, "Keep only MOST RECENT FVG per level")\r\n\r\nkeepLastFVGs   = input.int(200, "Keep last N FVG boxes", minval=20, maxval=280)\r\nkeepLastEvents = input.int(300, "Keep last N Event labels", minval=20, maxval=480)\r\n\r\n// Colors\r\ncAsia   = input.color(color.aqua,    "Asia Level Color")\r\ncLondon = input.color(color.orange,  "London Level Color")\r\ncPD     = input.color(color.fuchsia, "Prev Day Level Color")\r\n\r\nlvlLblText     = input.color(color.white, "Level Label Text")\r\nsweepLblBg     = input.color(color.new(color.yellow, 0), "Sweep Label BG")\r\nsweepLblText   = input.color(color.white,               "Sweep Label Text")\r\n\r\nfvgLblBg       = input.color(color.new(color.gray, 20), "FVG Label BG")\r\nfvgLblText     = input.color(color.white,               "FVG Label Text")\r\n\r\nifvgOkLongBg   = input.color(color.new(color.green, 0), "IFVG OK (Long) Label BG")\r\nifvgOkShortBg  = input.color(color.new(color.red,   0), "IFVG OK (Short) Label BG")\r\nifvgOkLblText  = input.color(color.white,               "IFVG OK Label Text")\r\n\r\nfvgFillActive  = input.color(color.new(color.gray, 82), "FVG Fill (Active)")\r\nfvgFillOk      = input.color(color.new(color.green, 88),"FVG Fill (Confirmed)")\r\nfvgFillFail    = input.color(color.new(color.red,  90), "FVG Fill (Failed)")\r\n\r\n//===========================\r\n// HELPERS\r\n//===========================\r\ntick = syminfo.mintick\r\ngap  = float(minFvgGapTicks) * tick\r\n\r\nf_inSession(sess) =>\r\n    not na(time(timeframe.period, sess, tz))\r\n\r\nf_sweptHigh(level) =>\r\n    useWickSweep ? high >= level : close >= level\r\n\r\nf_sweptLow(level) =>\r\n    useWickSweep ? low <= level : close <= level\r\n\r\n// force borders fully off (prevents dashed artifacts)\r\nf_borderNone() => color.new(color.black, 100)\r\n\r\nf_key() => str.tostring(time) + "_" + str.tostring(bar_index)\r\n\r\n//===========================\r\n// GLOBAL STORAGE (recycling)\r\n//===========================\r\nvar box[]    gBoxes   = array.new_box()\r\nvar string[] gKeys    = array.new_string()\r\nvar int[]    gStatus  = array.new_int()  // 0=active, 1=ok, 2=fail\r\nvar label[]  gFvgLbls = array.new_label()\r\nvar label[]  gEventLbls = array.new_label()\r\n\r\nf_trimFVG() =>\r\n    while array.size(gBoxes) > keepLastFVGs\r\n        box.delete(array.shift(gBoxes))\r\n        array.shift(gKeys)\r\n        array.shift(gStatus)\r\n        label lb = array.shift(gFvgLbls)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n\r\nf_trimEvents() =>\r\n    while array.size(gEventLbls) > keepLastEvents\r\n        label.delete(array.shift(gEventLbls))\r\n\r\nf_addEvent(label lb) =>\r\n    array.push(gEventLbls, lb)\r\n    f_trimEvents()\r\n\r\nf_addFvg(box b, label lb, string key) =>\r\n    array.push(gBoxes, b)\r\n    array.push(gKeys, key)\r\n    array.push(gStatus, 0)\r\n    array.push(gFvgLbls, lb)\r\n    f_trimFVG()\r\n\r\nf_findKeyIndex(string key) =>\r\n    int idx = na\r\n    for i = array.size(gKeys) - 1 to 0\r\n        if array.get(gKeys, i) == key\r\n            idx := i\r\n            break\r\n    idx\r\n\r\nf_setStatus(string key, int st) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        array.set(gStatus, idx, st)\r\n\r\nf_deleteFvgLabelByKey(string key) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        label lb = array.get(gFvgLbls, idx)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n        array.set(gFvgLbls, idx, na)\r\n\r\nf_removeFvgByKey(string key) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        box b = array.get(gBoxes, idx)\r\n        label lb = array.get(gFvgLbls, idx)\r\n        if not na(b)\r\n            box.delete(b)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n        array.remove(gBoxes, idx)\r\n        array.remove(gKeys, idx)\r\n        array.remove(gStatus, idx)\r\n        array.remove(gFvgLbls, idx)\r\n\r\n// Guard against empty arrays\r\nf_applyStatusStyling() =>\r\n    int n = array.size(gBoxes)\r\n    if n > 0\r\n        for i = 0 to n - 1\r\n            box b = array.get(gBoxes, i)\r\n            int st = array.get(gStatus, i)\r\n            color fill = st == 1 ? fvgFillOk : st == 2 ? fvgFillFail : fvgFillActive\r\n            box.set_bgcolor(b, showFvgBox ? fill : color.new(fill, 100))\r\n            box.set_border_color(b, f_borderNone())\r\n\r\nf_clearAll() =>\r\n    while array.size(gBoxes) > 0\r\n        box.delete(array.pop(gBoxes))\r\n    while array.size(gKeys) > 0\r\n        array.pop(gKeys)\r\n    while array.size(gStatus) > 0\r\n        array.pop(gStatus)\r\n    while array.size(gFvgLbls) > 0\r\n        label lb = array.pop(gFvgLbls)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n    while array.size(gEventLbls) > 0\r\n        label.delete(array.pop(gEventLbls))\r\n\r\n//===========================\r\n// PREVIOUS DAY (NY midnight -> midnight)\r\n//===========================\r\ndayKey    = time("D", "0000-2359", tz)\r\nnewCalDay = ta.change(dayKey) != 0\r\n\r\nvar float dayHigh = na\r\nvar float dayLow  = na\r\nvar float pdHigh  = na\r\nvar float pdLow   = na\r\n\r\nif newCalDay\r\n    pdHigh  := dayHigh\r\n    pdLow   := dayLow\r\n    dayHigh := high\r\n    dayLow  := low\r\nelse\r\n    dayHigh := na(dayHigh) ? high : math.max(dayHigh, high)\r\n    dayLow  := na(dayLow)  ? low  : math.min(dayLow, low)\r\n\r\nif newCalDay and autoCleanAtMidnight\r\n    f_clearAll()\r\n\r\n//===========================\r\n// SESSION RANGES\r\n//===========================\r\ninAsia    = f_inSession(asiaSess)\r\nasiaStart = inAsia and not inAsia[1]\r\nasiaEnd   = not inAsia and inAsia[1]\r\nvar float asiaHigh = na\r\nvar float asiaLow  = na\r\nif asiaStart\r\n    asiaHigh := high\r\n    asiaLow  := low\r\nelse if inAsia\r\n    asiaHigh := math.max(asiaHigh, high)\r\n    asiaLow  := math.min(asiaLow, low)\r\n\r\ninLondon    = f_inSession(londonSess)\r\nlondonStart = inLondon and not inLondon[1]\r\nlondonEnd   = not inLondon and inLondon[1]\r\nvar float londonHigh = na\r\nvar float londonLow  = na\r\nif londonStart\r\n    londonHigh := high\r\n    londonLow  := low\r\nelse if inLondon\r\n    londonHigh := math.max(londonHigh, high)\r\n    londonLow  := math.min(londonLow, low)\r\n\r\n//===========================\r\n// LEVEL LINES (extend until swept, then stop) + DAY-STAMP GATING\r\n//===========================\r\n\r\n// --- Asia\r\nvar line asiaHighLine = na\r\nvar line asiaLowLine  = na\r\nvar bool asiaHighHit  = false\r\nvar bool asiaLowHit   = false\r\nvar int  asiaLineDay  = na\r\n\r\nif useAsiaLevels and asiaEnd and not na(asiaHigh) and not na(asiaLow)\r\n    asiaHighHit := false\r\n    asiaLowHit  := false\r\n    asiaLineDay := dayKey\r\n\r\n    if not na(asiaHighLine)\r\n        line.delete(asiaHighLine)\r\n    if not na(asiaLowLine)\r\n        line.delete(asiaLowLine)\r\n\r\n    asiaHighLine := line.new(bar_index - 2, asiaHigh, bar_index, asiaHigh, extend=extend.right, color=cAsia, width=2)\r\n    asiaLowLine  := line.new(bar_index - 2, asiaLow,  bar_index, asiaLow,  extend=extend.right, color=cAsia, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, asiaHigh, "ASIA HIGH", style=label.style_label_left, color=cAsia, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, asiaLow,  "ASIA LOW",  style=label.style_label_left, color=cAsia, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif useAsiaLevels and not asiaHighHit and not na(asiaHighLine) and (asiaLineDay == dayKey) and f_sweptHigh(asiaHigh)\r\n    asiaHighHit := true\r\n    line.set_extend(asiaHighLine, extend.none)\r\n    line.set_x2(asiaHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, asiaHigh, "ASIA HIGH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif useAsiaLevels and not asiaLowHit and not na(asiaLowLine) and (asiaLineDay == dayKey) and f_sweptLow(asiaLow)\r\n    asiaLowHit := true\r\n    line.set_extend(asiaLowLine, extend.none)\r\n    line.set_x2(asiaLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, asiaLow, "ASIA LOW SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n// --- London\r\nvar line londonHighLine = na\r\nvar line londonLowLine  = na\r\nvar bool londonHighHit  = false\r\nvar bool londonLowHit   = false\r\nvar int  londonLineDay  = na\r\n\r\nif useLondonLevels and newCalDay\r\n    londonHigh := na\r\n    londonLow  := na\r\n    londonHighHit := false\r\n    londonLowHit  := false\r\n    londonLineDay := na\r\n    if not na(londonHighLine)\r\n        line.delete(londonHighLine), londonHighLine := na\r\n    if not na(londonLowLine)\r\n        line.delete(londonLowLine), londonLowLine := na\r\n\r\nif useLondonLevels and londonEnd and not na(londonHigh) and not na(londonLow)\r\n    londonHighHit := false\r\n    londonLowHit  := false\r\n    londonLineDay := dayKey\r\n\r\n    if not na(londonHighLine)\r\n        line.delete(londonHighLine)\r\n    if not na(londonLowLine)\r\n        line.delete(londonLowLine)\r\n\r\n    londonHighLine := line.new(bar_index - 2, londonHigh, bar_index, londonHigh, extend=extend.right, color=cLondon, width=2)\r\n    londonLowLine  := line.new(bar_index - 2, londonLow,  bar_index, londonLow,  extend=extend.right, color=cLondon, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, londonHigh, "LONDON HIGH", style=label.style_label_left, color=cLondon, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, londonLow,  "LONDON LOW",  style=label.style_label_left, color=cLondon, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif useLondonLevels and not londonHighHit and not na(londonHighLine) and (londonLineDay == dayKey) and f_sweptHigh(londonHigh)\r\n    londonHighHit := true\r\n    line.set_extend(londonHighLine, extend.none)\r\n    line.set_x2(londonHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, londonHigh, "LONDON HIGH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif useLondonLevels and not londonLowHit and not na(londonLowLine) and (londonLineDay == dayKey) and f_sweptLow(londonLow)\r\n    londonLowHit := true\r\n    line.set_extend(londonLowLine, extend.none)\r\n    line.set_x2(londonLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, londonLow, "LONDON LOW SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n// --- Prev Day\r\nvar line pdHighLine = na\r\nvar line pdLowLine  = na\r\nvar bool pdHighHit  = false\r\nvar bool pdLowHit   = false\r\n\r\nif usePDLevels and newCalDay and not na(pdHigh) and not na(pdLow)\r\n    pdHighHit := false\r\n    pdLowHit  := false\r\n    if not na(pdHighLine)\r\n        line.delete(pdHighLine)\r\n    if not na(pdLowLine)\r\n        line.delete(pdLowLine)\r\n    pdHighLine := line.new(bar_index - 2, pdHigh, bar_index, pdHigh, extend=extend.right, color=cPD, width=2)\r\n    pdLowLine  := line.new(bar_index - 2, pdLow,  bar_index, pdLow,  extend=extend.right, color=cPD, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, pdHigh, "PDH", style=label.style_label_left, color=cPD, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, pdLow,  "PDL", style=label.style_label_left, color=cPD, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif usePDLevels and not pdHighHit and not na(pdHighLine) and f_sweptHigh(pdHigh)\r\n    pdHighHit := true\r\n    line.set_extend(pdHighLine, extend.none)\r\n    line.set_x2(pdHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, pdHigh, "PDH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif usePDLevels and not pdLowHit and not na(pdLowLine) and f_sweptLow(pdLow)\r\n    pdLowHit := true\r\n    line.set_extend(pdLowLine, extend.none)\r\n    line.set_x2(pdLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, pdLow, "PDL SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n//===========================\r\n// INDEPENDENT IFVG STATE PER LEVEL (+ "latest FVG only" support)\r\n//===========================\r\ntype LevelState\r\n    bool   waiting\r\n    int    sweepBar\r\n    int    dir\r\n    bool   haveFVG\r\n    float  refWeak\r\n    float  refStrong\r\n    box    b\r\n    label  fvgLbl\r\n    string key\r\n    int    lastOkDayKey\r\n    string lastFvgKey    // persists so we can delete older FVGs per level\r\n\r\nf_makeState() => LevelState.new(false, na, 0, false, na, na, na, na, "", 0, "")\r\n\r\nf_arm(LevelState s, int _dir) =>\r\n    bool blockedToday = oneIFVGPerLevelPerDay and (s.lastOkDayKey == dayKey)\r\n    blockedToday ? s : LevelState.new(true, bar_index, _dir, false, na, na, na, na, "", s.lastOkDayKey, s.lastFvgKey)\r\n\r\nf_buildBearIct(LevelState s) =>\r\n    // bearish ICT FVG: high < low[2]\r\n    if keepOnlyLatestFvgPerLvl and s.lastFvgKey != ""\r\n        f_removeFvgByKey(s.lastFvgKey)\r\n\r\n    float top = low[2]\r\n    float bot = high\r\n    string k = f_key()\r\n    float weak = bot\r\n    float strong = top\r\n\r\n    box b = box.new(bar_index, top, bar_index, bot,\r\n        bgcolor = showFvgBox ? fvgFillActive : color.new(fvgFillActive, 100),\r\n        border_color = f_borderNone())\r\n\r\n    label lb = na\r\n    if showFvgLabel\r\n        lb := label.new(bar_index, (top+bot)/2.0, "FVG", style=label.style_label_left, color=fvgLblBg, textcolor=fvgLblText, size=size.small)\r\n\r\n    f_addFvg(b, lb, k)\r\n    LevelState.new(true, s.sweepBar, s.dir, true, weak, strong, b, lb, k, s.lastOkDayKey, k)\r\n\r\nf_buildBullIct(LevelState s) =>\r\n    // bullish ICT FVG: low > high[2]\r\n    if keepOnlyLatestFvgPerLvl and s.lastFvgKey != ""\r\n        f_removeFvgByKey(s.lastFvgKey)\r\n\r\n    float top = low\r\n    float bot = high[2]\r\n    string k = f_key()\r\n    float weak = top\r\n    float strong = bot\r\n\r\n    box b = box.new(bar_index, top, bar_index, bot,\r\n        bgcolor = showFvgBox ? fvgFillActive : color.new(fvgFillActive, 100),\r\n        border_color = f_borderNone())\r\n\r\n    label lb = na\r\n    if showFvgLabel\r\n        lb := label.new(bar_index, (top+bot)/2.0, "FVG", style=label.style_label_left, color=fvgLblBg, textcolor=fvgLblText, size=size.small)\r\n\r\n    f_addFvg(b, lb, k)\r\n    LevelState.new(true, s.sweepBar, s.dir, true, weak, strong, b, lb, k, s.lastOkDayKey, k)\r\n\r\nf_process(LevelState s) =>\r\n    LevelState st = s\r\n    bool blockedToday = oneIFVGPerLevelPerDay and (st.lastOkDayKey == dayKey)\r\n\r\n    if st.waiting and not blockedToday and not na(st.sweepBar) and bar_index - st.sweepBar > maxBarsWaitFVG\r\n        if markFailedOnTimeout and st.haveFVG and st.key != ""\r\n            f_setStatus(st.key, 2)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n\r\n    if st.waiting and not blockedToday and not st.haveFVG and bar_index >= 2\r\n        if st.dir == +1 and high < (low[2] - gap)\r\n            st := f_buildBearIct(st)\r\n        else if st.dir == -1 and low > (high[2] + gap)\r\n            st := f_buildBullIct(st)\r\n\r\n    if st.waiting and st.haveFVG and not na(st.b)\r\n        box.set_right(st.b, bar_index)\r\n\r\n    float invRef = strongInversion ? st.refStrong : st.refWeak\r\n    bool okLong  = st.waiting and not blockedToday and st.dir == +1 and st.haveFVG and not na(invRef) and close >= invRef\r\n    bool okShort = st.waiting and not blockedToday and st.dir == -1 and st.haveFVG and not na(invRef) and close <= invRef\r\n\r\n    if okLong\r\n        f_addEvent(label.new(bar_index, low, "IFVG OK", style=label.style_label_up, color=ifvgOkLongBg, textcolor=ifvgOkLblText, size=size.small))\r\n        if st.key != ""\r\n            f_setStatus(st.key, 1)\r\n            if hideFvgLabelAfterIfvgOk\r\n                f_deleteFvgLabelByKey(st.key)\r\n        if not na(st.b)\r\n            box.set_right(st.b, bar_index)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n        st.lastOkDayKey := dayKey\r\n\r\n    if okShort\r\n        f_addEvent(label.new(bar_index, high, "IFVG OK", style=label.style_label_down, color=ifvgOkShortBg, textcolor=ifvgOkLblText, size=size.small))\r\n        if st.key != ""\r\n            f_setStatus(st.key, 1)\r\n            if hideFvgLabelAfterIfvgOk\r\n                f_deleteFvgLabelByKey(st.key)\r\n        if not na(st.b)\r\n            box.set_right(st.b, bar_index)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n        st.lastOkDayKey := dayKey\r\n\r\n    st\r\n\r\n//===========================\r\n// 6 independent states\r\n//===========================\r\nvar LevelState stAsiaH = f_makeState()\r\nvar LevelState stAsiaL = f_makeState()\r\nvar LevelState stLonH  = f_makeState()\r\nvar LevelState stLonL  = f_makeState()\r\nvar LevelState stPDH   = f_makeState()\r\nvar LevelState stPDL   = f_makeState()\r\n\r\nif useAsiaLevels and not asiaHighHit[1] and asiaHighHit\r\n    stAsiaH := f_arm(stAsiaH, -1)\r\nif useAsiaLevels and not asiaLowHit[1] and asiaLowHit\r\n    stAsiaL := f_arm(stAsiaL, +1)\r\n\r\nif useLondonLevels and not londonHighHit[1] and londonHighHit\r\n    stLonH := f_arm(stLonH, -1)\r\nif useLondonLevels and not londonLowHit[1] and londonLowHit\r\n    stLonL := f_arm(stLonL, +1)\r\n\r\nif usePDLevels and not pdHighHit[1] and pdHighHit\r\n    stPDH := f_arm(stPDH, -1)\r\nif usePDLevels and not pdLowHit[1] and pdLowHit\r\n    stPDL := f_arm(stPDL, +1)\r\n\r\nstAsiaH := f_process(stAsiaH)\r\nstAsiaL := f_process(stAsiaL)\r\nstLonH  := f_process(stLonH)\r\nstLonL  := f_process(stLonL)\r\nstPDH   := f_process(stPDH)\r\nstPDL   := f_process(stPDL)\r\n\r\nf_applyStatusStyling()\r\n'
[CAPTURE 2] '//@version=6\r\nindicator("Sweep -> ICT FVG -> IFVG OK | Asia/London/PD (Clean + Polished)",\r\n     overlay=true, max_lines_count=300, max_labels_count=500, max_boxes_count=300)\r\n\r\n//===========================\r\n// INPUTS\r\n//===========================\r\ntz         = input.string("America/New_York", "Timezone")\r\nasiaSess   = input.session("1800-0230", "Asia Session (NY)")\r\nlondonSess = input.session("0231-0700", "London Session (NY)")\r\n\r\nuseAsiaLevels   = input.bool(true, "Use Asia Levels")\r\nuseLondonLevels = input.bool(true, "Use London Levels")\r\nusePDLevels     = input.bool(true, "Use Prev Day Levels")\r\n\r\nuseWickSweep = input.bool(true, "Sweep detection uses wick (else close)")\r\n\r\nmaxBarsWaitFVG  = input.int(240, "Max bars after sweep to allow FVG", minval=5)\r\nminFvgGapTicks  = input.int(0, "Min FVG gap filter (ticks, 0 = none)", minval=0)\r\nstrongInversion = input.bool(true, "Strong inversion (full fill). Off = entry only")\r\noneIFVGPerLevelPerDay = input.bool(true, "Only 1 IFVG OK per level per day")\r\n\r\nautoCleanAtMidnight = input.bool(false, "Auto-clean FVGs/labels at NY midnight")\r\nmarkFailedOnTimeout = input.bool(false, "Mark FVG as FAILED on timeout")\r\n\r\nshowFvgBox   = input.bool(true, "Show FVG Box")\r\nshowFvgLabel = input.bool(true, "Show FVG Label")\r\n\r\n// ✅ NEW POLISH SETTINGS\r\nshowLevelNameLabels     = input.bool(true, "Show Level Name Labels (ASIA/LONDON/PD)")\r\nhideFvgLabelAfterIfvgOk = input.bool(true, "Hide FVG label after IFVG OK")\r\nkeepOnlyLatestFvgPerLvl = input.bool(false, "Keep only MOST RECENT FVG per level")\r\n\r\nkeepLastFVGs   = input.int(200, "Keep last N FVG boxes", minval=20, maxval=280)\r\nkeepLastEvents = input.int(300, "Keep last N Event labels", minval=20, maxval=480)\r\n\r\n// Colors\r\ncAsia   = input.color(color.aqua,    "Asia Level Color")\r\ncLondon = input.color(color.orange,  "London Level Color")\r\ncPD     = input.color(color.fuchsia, "Prev Day Level Color")\r\n\r\nlvlLblText     = input.color(color.white, "Level Label Text")\r\nsweepLblBg     = input.color(color.new(color.yellow, 0), "Sweep Label BG")\r\nsweepLblText   = input.color(color.white,               "Sweep Label Text")\r\n\r\nfvgLblBg       = input.color(color.new(color.gray, 20), "FVG Label BG")\r\nfvgLblText     = input.color(color.white,               "FVG Label Text")\r\n\r\nifvgOkLongBg   = input.color(color.new(color.green, 0), "IFVG OK (Long) Label BG")\r\nifvgOkShortBg  = input.color(color.new(color.red,   0), "IFVG OK (Short) Label BG")\r\nifvgOkLblText  = input.color(color.white,               "IFVG OK Label Text")\r\n\r\nfvgFillActive  = input.color(color.new(color.gray, 82), "FVG Fill (Active)")\r\nfvgFillOk      = input.color(color.new(color.green, 88),"FVG Fill (Confirmed)")\r\nfvgFillFail    = input.color(color.new(color.red,  90), "FVG Fill (Failed)")\r\n\r\n//===========================\r\n// HELPERS\r\n//===========================\r\ntick = syminfo.mintick\r\ngap  = float(minFvgGapTicks) * tick\r\n\r\nf_inSession(sess) =>\r\n    not na(time(timeframe.period, sess, tz))\r\n\r\nf_sweptHigh(level) =>\r\n    useWickSweep ? high >= level : close >= level\r\n\r\nf_sweptLow(level) =>\r\n    useWickSweep ? low <= level : close <= level\r\n\r\n// force borders fully off (prevents dashed artifacts)\r\nf_borderNone() => color.new(color.black, 100)\r\n\r\nf_key() => str.tostring(time) + "_" + str.tostring(bar_index)\r\n\r\n//===========================\r\n// GLOBAL STORAGE (recycling)\r\n//===========================\r\nvar box[]    gBoxes   = array.new_box()\r\nvar string[] gKeys    = array.new_string()\r\nvar int[]    gStatus  = array.new_int()  // 0=active, 1=ok, 2=fail\r\nvar label[]  gFvgLbls = array.new_label()\r\nvar label[]  gEventLbls = array.new_label()\r\n\r\nf_trimFVG() =>\r\n    while array.size(gBoxes) > keepLastFVGs\r\n        box.delete(array.shift(gBoxes))\r\n        array.shift(gKeys)\r\n        array.shift(gStatus)\r\n        label lb = array.shift(gFvgLbls)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n\r\nf_trimEvents() =>\r\n    while array.size(gEventLbls) > keepLastEvents\r\n        label.delete(array.shift(gEventLbls))\r\n\r\nf_addEvent(label lb) =>\r\n    array.push(gEventLbls, lb)\r\n    f_trimEvents()\r\n\r\nf_addFvg(box b, label lb, string key) =>\r\n    array.push(gBoxes, b)\r\n    array.push(gKeys, key)\r\n    array.push(gStatus, 0)\r\n    array.push(gFvgLbls, lb)\r\n    f_trimFVG()\r\n\r\nf_findKeyIndex(string key) =>\r\n    int idx = na\r\n    for i = array.size(gKeys) - 1 to 0\r\n        if array.get(gKeys, i) == key\r\n            idx := i\r\n            break\r\n    idx\r\n\r\nf_setStatus(string key, int st) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        array.set(gStatus, idx, st)\r\n\r\nf_deleteFvgLabelByKey(string key) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        label lb = array.get(gFvgLbls, idx)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n        array.set(gFvgLbls, idx, na)\r\n\r\nf_removeFvgByKey(string key) =>\r\n    int idx = f_findKeyIndex(key)\r\n    if not na(idx)\r\n        box b = array.get(gBoxes, idx)\r\n        label lb = array.get(gFvgLbls, idx)\r\n        if not na(b)\r\n            box.delete(b)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n        array.remove(gBoxes, idx)\r\n        array.remove(gKeys, idx)\r\n        array.remove(gStatus, idx)\r\n        array.remove(gFvgLbls, idx)\r\n\r\n// Guard against empty arrays\r\nf_applyStatusStyling() =>\r\n    int n = array.size(gBoxes)\r\n    if n > 0\r\n        for i = 0 to n - 1\r\n            box b = array.get(gBoxes, i)\r\n            int st = array.get(gStatus, i)\r\n            color fill = st == 1 ? fvgFillOk : st == 2 ? fvgFillFail : fvgFillActive\r\n            box.set_bgcolor(b, showFvgBox ? fill : color.new(fill, 100))\r\n            box.set_border_color(b, f_borderNone())\r\n\r\nf_clearAll() =>\r\n    while array.size(gBoxes) > 0\r\n        box.delete(array.pop(gBoxes))\r\n    while array.size(gKeys) > 0\r\n        array.pop(gKeys)\r\n    while array.size(gStatus) > 0\r\n        array.pop(gStatus)\r\n    while array.size(gFvgLbls) > 0\r\n        label lb = array.pop(gFvgLbls)\r\n        if not na(lb)\r\n            label.delete(lb)\r\n    while array.size(gEventLbls) > 0\r\n        label.delete(array.pop(gEventLbls))\r\n\r\n//===========================\r\n// PREVIOUS DAY (NY midnight -> midnight)\r\n//===========================\r\ndayKey    = time("D", "0000-2359", tz)\r\nnewCalDay = ta.change(dayKey) != 0\r\n\r\nvar float dayHigh = na\r\nvar float dayLow  = na\r\nvar float pdHigh  = na\r\nvar float pdLow   = na\r\n\r\nif newCalDay\r\n    pdHigh  := dayHigh\r\n    pdLow   := dayLow\r\n    dayHigh := high\r\n    dayLow  := low\r\nelse\r\n    dayHigh := na(dayHigh) ? high : math.max(dayHigh, high)\r\n    dayLow  := na(dayLow)  ? low  : math.min(dayLow, low)\r\n\r\nif newCalDay and autoCleanAtMidnight\r\n    f_clearAll()\r\n\r\n//===========================\r\n// SESSION RANGES\r\n//===========================\r\ninAsia    = f_inSession(asiaSess)\r\nasiaStart = inAsia and not inAsia[1]\r\nasiaEnd   = not inAsia and inAsia[1]\r\nvar float asiaHigh = na\r\nvar float asiaLow  = na\r\nif asiaStart\r\n    asiaHigh := high\r\n    asiaLow  := low\r\nelse if inAsia\r\n    asiaHigh := math.max(asiaHigh, high)\r\n    asiaLow  := math.min(asiaLow, low)\r\n\r\ninLondon    = f_inSession(londonSess)\r\nlondonStart = inLondon and not inLondon[1]\r\nlondonEnd   = not inLondon and inLondon[1]\r\nvar float londonHigh = na\r\nvar float londonLow  = na\r\nif londonStart\r\n    londonHigh := high\r\n    londonLow  := low\r\nelse if inLondon\r\n    londonHigh := math.max(londonHigh, high)\r\n    londonLow  := math.min(londonLow, low)\r\n\r\n//===========================\r\n// LEVEL LINES (extend until swept, then stop) + DAY-STAMP GATING\r\n//===========================\r\n\r\n// --- Asia\r\nvar line asiaHighLine = na\r\nvar line asiaLowLine  = na\r\nvar bool asiaHighHit  = false\r\nvar bool asiaLowHit   = false\r\nvar int  asiaLineDay  = na\r\n\r\nif useAsiaLevels and asiaEnd and not na(asiaHigh) and not na(asiaLow)\r\n    asiaHighHit := false\r\n    asiaLowHit  := false\r\n    asiaLineDay := dayKey\r\n\r\n    if not na(asiaHighLine)\r\n        line.delete(asiaHighLine)\r\n    if not na(asiaLowLine)\r\n        line.delete(asiaLowLine)\r\n\r\n    asiaHighLine := line.new(bar_index - 2, asiaHigh, bar_index, asiaHigh, extend=extend.right, color=cAsia, width=2)\r\n    asiaLowLine  := line.new(bar_index - 2, asiaLow,  bar_index, asiaLow,  extend=extend.right, color=cAsia, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, asiaHigh, "ASIA HIGH", style=label.style_label_left, color=cAsia, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, asiaLow,  "ASIA LOW",  style=label.style_label_left, color=cAsia, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif useAsiaLevels and not asiaHighHit and not na(asiaHighLine) and (asiaLineDay == dayKey) and f_sweptHigh(asiaHigh)\r\n    asiaHighHit := true\r\n    line.set_extend(asiaHighLine, extend.none)\r\n    line.set_x2(asiaHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, asiaHigh, "ASIA HIGH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif useAsiaLevels and not asiaLowHit and not na(asiaLowLine) and (asiaLineDay == dayKey) and f_sweptLow(asiaLow)\r\n    asiaLowHit := true\r\n    line.set_extend(asiaLowLine, extend.none)\r\n    line.set_x2(asiaLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, asiaLow, "ASIA LOW SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n// --- London\r\nvar line londonHighLine = na\r\nvar line londonLowLine  = na\r\nvar bool londonHighHit  = false\r\nvar bool londonLowHit   = false\r\nvar int  londonLineDay  = na\r\n\r\nif useLondonLevels and newCalDay\r\n    londonHigh := na\r\n    londonLow  := na\r\n    londonHighHit := false\r\n    londonLowHit  := false\r\n    londonLineDay := na\r\n    if not na(londonHighLine)\r\n        line.delete(londonHighLine), londonHighLine := na\r\n    if not na(londonLowLine)\r\n        line.delete(londonLowLine), londonLowLine := na\r\n\r\nif useLondonLevels and londonEnd and not na(londonHigh) and not na(londonLow)\r\n    londonHighHit := false\r\n    londonLowHit  := false\r\n    londonLineDay := dayKey\r\n\r\n    if not na(londonHighLine)\r\n        line.delete(londonHighLine)\r\n    if not na(londonLowLine)\r\n        line.delete(londonLowLine)\r\n\r\n    londonHighLine := line.new(bar_index - 2, londonHigh, bar_index, londonHigh, extend=extend.right, color=cLondon, width=2)\r\n    londonLowLine  := line.new(bar_index - 2, londonLow,  bar_index, londonLow,  extend=extend.right, color=cLondon, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, londonHigh, "LONDON HIGH", style=label.style_label_left, color=cLondon, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, londonLow,  "LONDON LOW",  style=label.style_label_left, color=cLondon, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif useLondonLevels and not londonHighHit and not na(londonHighLine) and (londonLineDay == dayKey) and f_sweptHigh(londonHigh)\r\n    londonHighHit := true\r\n    line.set_extend(londonHighLine, extend.none)\r\n    line.set_x2(londonHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, londonHigh, "LONDON HIGH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif useLondonLevels and not londonLowHit and not na(londonLowLine) and (londonLineDay == dayKey) and f_sweptLow(londonLow)\r\n    londonLowHit := true\r\n    line.set_extend(londonLowLine, extend.none)\r\n    line.set_x2(londonLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, londonLow, "LONDON LOW SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n// --- Prev Day\r\nvar line pdHighLine = na\r\nvar line pdLowLine  = na\r\nvar bool pdHighHit  = false\r\nvar bool pdLowHit   = false\r\n\r\nif usePDLevels and newCalDay and not na(pdHigh) and not na(pdLow)\r\n    pdHighHit := false\r\n    pdLowHit  := false\r\n    if not na(pdHighLine)\r\n        line.delete(pdHighLine)\r\n    if not na(pdLowLine)\r\n        line.delete(pdLowLine)\r\n    pdHighLine := line.new(bar_index - 2, pdHigh, bar_index, pdHigh, extend=extend.right, color=cPD, width=2)\r\n    pdLowLine  := line.new(bar_index - 2, pdLow,  bar_index, pdLow,  extend=extend.right, color=cPD, width=2)\r\n\r\n    if showLevelNameLabels\r\n        f_addEvent(label.new(bar_index, pdHigh, "PDH", style=label.style_label_left, color=cPD, textcolor=lvlLblText, size=size.tiny))\r\n        f_addEvent(label.new(bar_index, pdLow,  "PDL", style=label.style_label_left, color=cPD, textcolor=lvlLblText, size=size.tiny))\r\n\r\nif usePDLevels and not pdHighHit and not na(pdHighLine) and f_sweptHigh(pdHigh)\r\n    pdHighHit := true\r\n    line.set_extend(pdHighLine, extend.none)\r\n    line.set_x2(pdHighLine, bar_index)\r\n    f_addEvent(label.new(bar_index, pdHigh, "PDH SWEEP", style=label.style_label_down, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\nif usePDLevels and not pdLowHit and not na(pdLowLine) and f_sweptLow(pdLow)\r\n    pdLowHit := true\r\n    line.set_extend(pdLowLine, extend.none)\r\n    line.set_x2(pdLowLine, bar_index)\r\n    f_addEvent(label.new(bar_index, pdLow, "PDL SWEEP", style=label.style_label_up, color=sweepLblBg, textcolor=sweepLblText, size=size.tiny))\r\n\r\n//===========================\r\n// INDEPENDENT IFVG STATE PER LEVEL (+ "latest FVG only" support)\r\n//===========================\r\ntype LevelState\r\n    bool   waiting\r\n    int    sweepBar\r\n    int    dir\r\n    bool   haveFVG\r\n    float  refWeak\r\n    float  refStrong\r\n    box    b\r\n    label  fvgLbl\r\n    string key\r\n    int    lastOkDayKey\r\n    string lastFvgKey    // persists so we can delete older FVGs per level\r\n\r\nf_makeState() => LevelState.new(false, na, 0, false, na, na, na, na, "", 0, "")\r\n\r\nf_arm(LevelState s, int _dir) =>\r\n    bool blockedToday = oneIFVGPerLevelPerDay and (s.lastOkDayKey == dayKey)\r\n    blockedToday ? s : LevelState.new(true, bar_index, _dir, false, na, na, na, na, "", s.lastOkDayKey, s.lastFvgKey)\r\n\r\nf_buildBearIct(LevelState s) =>\r\n    // bearish ICT FVG: high < low[2]\r\n    if keepOnlyLatestFvgPerLvl and s.lastFvgKey != ""\r\n        f_removeFvgByKey(s.lastFvgKey)\r\n\r\n    float top = low[2]\r\n    float bot = high\r\n    string k = f_key()\r\n    float weak = bot\r\n    float strong = top\r\n\r\n    box b = box.new(bar_index, top, bar_index, bot,\r\n        bgcolor = showFvgBox ? fvgFillActive : color.new(fvgFillActive, 100),\r\n        border_color = f_borderNone())\r\n\r\n    label lb = na\r\n    if showFvgLabel\r\n        lb := label.new(bar_index, (top+bot)/2.0, "FVG", style=label.style_label_left, color=fvgLblBg, textcolor=fvgLblText, size=size.small)\r\n\r\n    f_addFvg(b, lb, k)\r\n    LevelState.new(true, s.sweepBar, s.dir, true, weak, strong, b, lb, k, s.lastOkDayKey, k)\r\n\r\nf_buildBullIct(LevelState s) =>\r\n    // bullish ICT FVG: low > high[2]\r\n    if keepOnlyLatestFvgPerLvl and s.lastFvgKey != ""\r\n        f_removeFvgByKey(s.lastFvgKey)\r\n\r\n    float top = low\r\n    float bot = high[2]\r\n    string k = f_key()\r\n    float weak = top\r\n    float strong = bot\r\n\r\n    box b = box.new(bar_index, top, bar_index, bot,\r\n        bgcolor = showFvgBox ? fvgFillActive : color.new(fvgFillActive, 100),\r\n        border_color = f_borderNone())\r\n\r\n    label lb = na\r\n    if showFvgLabel\r\n        lb := label.new(bar_index, (top+bot)/2.0, "FVG", style=label.style_label_left, color=fvgLblBg, textcolor=fvgLblText, size=size.small)\r\n\r\n    f_addFvg(b, lb, k)\r\n    LevelState.new(true, s.sweepBar, s.dir, true, weak, strong, b, lb, k, s.lastOkDayKey, k)\r\n\r\nf_process(LevelState s) =>\r\n    LevelState st = s\r\n    bool blockedToday = oneIFVGPerLevelPerDay and (st.lastOkDayKey == dayKey)\r\n\r\n    if st.waiting and not blockedToday and not na(st.sweepBar) and bar_index - st.sweepBar > maxBarsWaitFVG\r\n        if markFailedOnTimeout and st.haveFVG and st.key != ""\r\n            f_setStatus(st.key, 2)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n\r\n    if st.waiting and not blockedToday and not st.haveFVG and bar_index >= 2\r\n        if st.dir == +1 and high < (low[2] - gap)\r\n            st := f_buildBearIct(st)\r\n        else if st.dir == -1 and low > (high[2] + gap)\r\n            st := f_buildBullIct(st)\r\n\r\n    if st.waiting and st.haveFVG and not na(st.b)\r\n        box.set_right(st.b, bar_index)\r\n\r\n    float invRef = strongInversion ? st.refStrong : st.refWeak\r\n    bool okLong  = st.waiting and not blockedToday and st.dir == +1 and st.haveFVG and not na(invRef) and close >= invRef\r\n    bool okShort = st.waiting and not blockedToday and st.dir == -1 and st.haveFVG and not na(invRef) and close <= invRef\r\n\r\n    if okLong\r\n        f_addEvent(label.new(bar_index, low, "IFVG OK", style=label.style_label_up, color=ifvgOkLongBg, textcolor=ifvgOkLblText, size=size.small))\r\n        if st.key != ""\r\n            f_setStatus(st.key, 1)\r\n            if hideFvgLabelAfterIfvgOk\r\n                f_deleteFvgLabelByKey(st.key)\r\n        if not na(st.b)\r\n            box.set_right(st.b, bar_index)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n        st.lastOkDayKey := dayKey\r\n\r\n    if okShort\r\n        f_addEvent(label.new(bar_index, high, "IFVG OK", style=label.style_label_down, color=ifvgOkShortBg, textcolor=ifvgOkLblText, size=size.small))\r\n        if st.key != ""\r\n            f_setStatus(st.key, 1)\r\n            if hideFvgLabelAfterIfvgOk\r\n                f_deleteFvgLabelByKey(st.key)\r\n        if not na(st.b)\r\n            box.set_right(st.b, bar_index)\r\n        st.waiting := false\r\n        st.haveFVG := false\r\n        st.dir := 0\r\n        st.key := ""\r\n        st.lastOkDayKey := dayKey\r\n\r\n    st\r\n\r\n//===========================\r\n// 6 independent states\r\n//===========================\r\nvar LevelState stAsiaH = f_makeState()\r\nvar LevelState stAsiaL = f_makeState()\r\nvar LevelState stLonH  = f_makeState()\r\nvar LevelState stLonL  = f_makeState()\r\nvar LevelState stPDH   = f_makeState()\r\nvar LevelState stPDL   = f_makeState()\r\n\r\nif useAsiaLevels and not asiaHighHit[1] and asiaHighHit\r\n    stAsiaH := f_arm(stAsiaH, -1)\r\nif useAsiaLevels and not asiaLowHit[1] and asiaLowHit\r\n    stAsiaL := f_arm(stAsiaL, +1)\r\n\r\nif useLondonLevels and not londonHighHit[1] and londonHighHit\r\n    stLonH := f_arm(stLonH, -1)\r\nif useLondonLevels and not londonLowHit[1] and londonLowHit\r\n    stLonL := f_arm(stLonL, +1)\r\n\r\nif usePDLevels and not pdHighHit[1] and pdHighHit\r\n    stPDH := f_arm(stPDH, -1)\r\nif usePDLevels and not pdLowHit[1] and pdLowHit\r\n    stPDL := f_arm(stPDL, +1)\r\n\r\nstAsiaH := f_process(stAsiaH)\r\nstAsiaL := f_process(stAsiaL)\r\nstLonH  := f_process(stLonH)\r\nstLonL  := f_process(stLonL)\r\nstPDH   := f_process(stPDH)\r\nstPDL   := f_process(stPDL)\r\n\r\nf_applyStatusStyling()\r\n'
[DEBUG] save_script called: script_id=HSkndXUq title=Lil B's: Time based Liquidity + IFVG Alerts category=HSkndXUq force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\HSkndXUq_Lil_B's_Time_based_Liquidity_+_IFVG_Alerts.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\HSkndXUq_Lil_B's_Time_based_Liquidity_+_IFVG_Alerts.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 03:13:52 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 03:13:52 GMT' as: 2026-02-09T03:13:52+00:00
[DEBUG] Exact published date for header: 2026-02-09T03:13:52+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/oAYoTjuD-2-Bar-Strategy-Fib-Entry/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
//@version=6indicator("2 B
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator("2 Bar Strategy + Fib Entry", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ===== Inputs =====\nbodyPercent = input.float(70.0, "Strong Body %", minval=1, maxval=100)\nextendBars = input.int(40, "Extend Lines Right")\n\n// ===== Candle Direction =====\nbull1 = close[1] > open[1]\nbull2 = close > open\nbear1 = close[1] < open[1]\nbear2 = close < open\n\ntwoBull = bull1 and bull2\ntwoBear = bear1 and bear2\n\n// ===== Strong body calc (2nd candle) =====\ncandleRange = high - low\nbody = math.abs(close - open)\nstrong = candleRange > 0 and (body / candleRange) * 100 >= bodyPercent\n\n// ===== Volume =====\nrisingVol = volume > volume[1]\n\n// ===== Final setups =====\nbullSetup = twoBull and strong and risingVol\nbearSetup = twoBear and strong and risingVol\n\n// ===== Markers =====\nplotshape(bullSetup, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small)\nplotshape(bearSetup, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small)\n\n// ===== Labels =====\nif bullSetup\n    label.new(bar_index, low, "2 Bar Bull", style=label.style_label_up, color=color.green, textcolor=color.white)\n\nif bearSetup\n    label.new(bar_index, high, "2 Bar Bear", style=label.style_label_down, color=color.red, textcolor=color.white)\n\n// ===== Fib Entry =====\nif bullSetup or bearSetup\n    rng = high - low\n    if rng > 0\n        bull50  = high - rng * 0.5\n        bull618 = high - rng * 0.618\n\n        bear50  = low + rng * 0.5\n        bear618 = low + rng * 0.618\n\n        level50  = bullSetup ? bull50 : bear50\n        level618 = bullSetup ? bull618 : bear618\n\n        l1 = line.new(bar_index, level50, bar_index + extendBars, level50, style=line.style_dotted, width=2)\n        l2 = line.new(bar_index, level618, bar_index + extendBars, level618, style=line.style_dotted, width=2)\n\n        line.set_color(l1, bullSetup ? color.green : color.red)\n        line.set_color(l2, bullSetup ? color.green : color.red)\n\n// ===== Alerts =====\nalertcondition(bullSetup, "Bull Setup", "2 Bar Bull Setup")\nalertcondition(bearSetup, "Bear Setup", "2 Bar Bear Setup")\n\n'
[CAPTURE 1] '//@version=6\nindicator("2 Bar Strategy + Fib Entry", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ===== Inputs =====\nbodyPercent = input.float(70.0, "Strong Body %", minval=1, maxval=100)\nextendBars = input.int(40, "Extend Lines Right")\n\n// ===== Candle Direction =====\nbull1 = close[1] > open[1]\nbull2 = close > open\nbear1 = close[1] < open[1]\nbear2 = close < open\n\ntwoBull = bull1 and bull2\ntwoBear = bear1 and bear2\n\n// ===== Strong body calc (2nd candle) =====\ncandleRange = high - low\nbody = math.abs(close - open)\nstrong = candleRange > 0 and (body / candleRange) * 100 >= bodyPercent\n\n// ===== Volume =====\nrisingVol = volume > volume[1]\n\n// ===== Final setups =====\nbullSetup = twoBull and strong and risingVol\nbearSetup = twoBear and strong and risingVol\n\n// ===== Markers =====\nplotshape(bullSetup, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small)\nplotshape(bearSetup, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small)\n\n// ===== Labels =====\nif bullSetup\n    label.new(bar_index, low, "2 Bar Bull", style=label.style_label_up, color=color.green, textcolor=color.white)\n\nif bearSetup\n    label.new(bar_index, high, "2 Bar Bear", style=label.style_label_down, color=color.red, textcolor=color.white)\n\n// ===== Fib Entry =====\nif bullSetup or bearSetup\n    rng = high - low\n    if rng > 0\n        bull50  = high - rng * 0.5\n        bull618 = high - rng * 0.618\n\n        bear50  = low + rng * 0.5\n        bear618 = low + rng * 0.618\n\n        level50  = bullSetup ? bull50 : bear50\n        level618 = bullSetup ? bull618 : bear618\n\n        l1 = line.new(bar_index, level50, bar_index + extendBars, level50, style=line.style_dotted, width=2)\n        l2 = line.new(bar_index, level618, bar_index + extendBars, level618, style=line.style_dotted, width=2)\n\n        line.set_color(l1, bullSetup ? color.green : color.red)\n        line.set_color(l2, bullSetup ? color.green : color.red)\n\n// ===== Alerts =====\nalertcondition(bullSetup, "Bull Setup", "2 Bar Bull Setup")\nalertcondition(bearSetup, "Bear Setup", "2 Bar Bear Setup")\n\n'
[CAPTURE 2] '//@version=6\nindicator("2 Bar Strategy + Fib Entry", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ===== Inputs =====\nbodyPercent = input.float(70.0, "Strong Body %", minval=1, maxval=100)\nextendBars = input.int(40, "Extend Lines Right")\n\n// ===== Candle Direction =====\nbull1 = close[1] > open[1]\nbull2 = close > open\nbear1 = close[1] < open[1]\nbear2 = close < open\n\ntwoBull = bull1 and bull2\ntwoBear = bear1 and bear2\n\n// ===== Strong body calc (2nd candle) =====\ncandleRange = high - low\nbody = math.abs(close - open)\nstrong = candleRange > 0 and (body / candleRange) * 100 >= bodyPercent\n\n// ===== Volume =====\nrisingVol = volume > volume[1]\n\n// ===== Final setups =====\nbullSetup = twoBull and strong and risingVol\nbearSetup = twoBear and strong and risingVol\n\n// ===== Markers =====\nplotshape(bullSetup, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.small)\nplotshape(bearSetup, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.small)\n\n// ===== Labels =====\nif bullSetup\n    label.new(bar_index, low, "2 Bar Bull", style=label.style_label_up, color=color.green, textcolor=color.white)\n\nif bearSetup\n    label.new(bar_index, high, "2 Bar Bear", style=label.style_label_down, color=color.red, textcolor=color.white)\n\n// ===== Fib Entry =====\nif bullSetup or bearSetup\n    rng = high - low\n    if rng > 0\n        bull50  = high - rng * 0.5\n        bull618 = high - rng * 0.618\n\n        bear50  = low + rng * 0.5\n        bear618 = low + rng * 0.618\n\n        level50  = bullSetup ? bull50 : bear50\n        level618 = bullSetup ? bull618 : bear618\n\n        l1 = line.new(bar_index, level50, bar_index + extendBars, level50, style=line.style_dotted, width=2)\n        l2 = line.new(bar_index, level618, bar_index + extendBars, level618, style=line.style_dotted, width=2)\n\n        line.set_color(l1, bullSetup ? color.green : color.red)\n        line.set_color(l2, bullSetup ? color.green : color.red)\n\n// ===== Alerts =====\nalertcondition(bullSetup, "Bull Setup", "2 Bar Bull Setup")\nalertcondition(bearSetup, "Bear Setup", "2 Bar Bear Setup")\n\n'
[DEBUG] save_script called: script_id=oAYoTjuD title=2 Bar Strategy + Fib Entry category=oAYoTjuD force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\oAYoTjuD_2_Bar_Strategy_+_Fib_Entry.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\oAYoTjuD_2_Bar_Strategy_+_Fib_Entry.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 03:05:25 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 03:05:25 GMT' as: 2026-02-09T03:05:25+00:00
[DEBUG] Exact published date for header: 2026-02-09T03:05:25+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/win6rVhs/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator(title="ATR Percentage", shorttitle="ATR Percentage", overlay=false)\n\n//--------- Parameters ----------\nlength    = input.int(title="Length", defval=14, minval=1)\nsmoothing = input.string(title="Smoothing", defval="RMA", options=["RMA", "SMA", "EMA", "WMA"])\n\n// ATR% Calculation Basis: Current Open or Previous Close\nbasisOpt  = input.string(\n     title   = "ATR% Basis",\n     defval  = "Current Open",\n     options = ["Current Open", "Prev Close"]\n)\n\n// Wait for current bar to close\nwaitClose = input.bool(true, "Wait for Bar Close to Update")\n\n// New: Flip coordinate scale (multiply ATR% by -1)\nflipScale = input.bool(false, "Flip Coordinate Scale (Invert ATR%)")\n\n// New: Horizontal line options\nshowHLine = input.bool(true, "Show Current Value Horizontal Line")\nhLineColor = input.color(color.new(#B71C1C, 0), "Horizontal Line Color")\nhLineStyle = input.string("Solid", "Horizontal Line Style", options=["Solid", "Dashed", "Dotted"])\nhLineWidth = input.int(1, "Horizontal Line Width", minval=1, maxval=4)\n\n// New: 3-day extreme value marker options\nshow3DayLow = input.bool(true, "Show 3-Day Low Marker")\nlow3DayColor = input.color(color.new(#FF9800, 0), "3-Day Low Color")\nlow3DayStyle = input.string("Circle", "3-Day Low Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow3DayHigh = input.bool(true, "Show 3-Day High Marker")\nhigh3DayColor = input.color(color.new(#4CAF50, 0), "3-Day High Color")\nhigh3DayStyle = input.string("Circle", "3-Day High Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n// New: 7-day extreme value marker options\nshow7DayLow = input.bool(true, "Show 7-Day Low Marker")\nlow7DayColor = input.color(color.new(#FF5722, 0), "7-Day Low Color")\nlow7DayStyle = input.string("Circle", "7-Day Low Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow7DayHigh = input.bool(true, "Show 7-Day High Marker")\nhigh7DayColor = input.color(color.new(#2196F3, 0), "7-Day High Color")\nhigh7DayStyle = input.string("Circle", "7-Day High Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n//--------- Smoothing Function ----------\nma_function(source, length) =>\n    switch smoothing\n        "RMA" => ta.rma(source, length)\n        "SMA" => ta.sma(source, length)\n        "EMA" => ta.ema(source, length)\n        =>       ta.wma(source, length)\n\n//--------- ATR Raw Value ----------\natr_value = ma_function(ta.tr(true), length)\n\n// Calculate basis (fixed: wrap multi-line expression in parentheses)\nbasisPrice = (\n     basisOpt == "Current Open" ? open :\n     close[1]\n)\n\n// ATR% raw calculation\nraw_atr_percent = basisPrice != 0 ? (atr_value / basisPrice) * 100 : na\n\n//--------- Wait for Bar Close Logic ----------\nvar float atr_percent = na\n\nif waitClose\n    if barstate.isconfirmed\n        atr_percent := raw_atr_percent\nelse\n    atr_percent := raw_atr_percent\n\n//--------- Coordinate Flip Processing ----------\n// If flip is enabled, multiply ATR% by -1 for display\nplot_val = flipScale ? -atr_percent : atr_percent\n\n//--------- Plotting ----------\nplot(plot_val, title = "ATR %", color=color.new(#B71C1C, 0))\n\n// New: Draw dynamic horizontal line using line.new() (fixed: use time instead of bar_index)\n// Convert style string to line.style enum\nhlineStyleVal = (\n     hLineStyle == "Solid" ? line.style_solid :\n     hLineStyle == "Dashed" ? line.style_dashed :\n     line.style_dotted\n)\n\n// Create mutable line object\nvar line hline = na\n\n// Update horizontal line on last bar (extends across entire chart)\nif showHLine and barstate.islast\n    // If line doesn\'t exist, create horizontal line from far past time to current time\n    if na(hline)\n        // Use current time minus 10 years as start time\n        var int start_time = time - 1000 * 60 * 60 * 24 * 365 * 10\n        hline := line.new(start_time, plot_val, time, plot_val, \n                           xloc = xloc.bar_time,  // Explicitly specify using time coordinate\n                           color = hLineColor, \n                           style = hlineStyleVal, \n                           width = hLineWidth, \n                           extend = extend.right)\n    else\n        // If line exists, update its position and style\n        line.set_xy2(hline, time, plot_val)\n        line.set_y1(hline, plot_val)\n        line.set_y2(hline, plot_val)\n        line.set_color(hline, hLineColor)\n        line.set_style(hline, hlineStyleVal)\n        line.set_width(hline, hLineWidth)\n\n// New: Detect if current value is an extreme (only on last bar)\n// Convert style string to shape enum (fixed: wrap multi-line expression in parentheses)\ngetShape(styleStr) => (\n     styleStr == "Circle" ? shape.circle :\n     styleStr == "Triangle Up" ? shape.triangleup :\n     styleStr == "Triangle Down" ? shape.triangledown :\n     styleStr == "Square" ? shape.square :\n     styleStr == "Diamond" ? shape.diamond :\n     styleStr == "Cross" ? shape.cross :\n     shape.xcross  // X Cross\n)\n\n// Calculate 3-day and 7-day extremes (including current bar)\nlow3 = ta.lowest(plot_val, 3)\nhigh3 = ta.highest(plot_val, 3)\nlow7 = ta.lowest(plot_val, 7)\nhigh7 = ta.highest(plot_val, 7)\n\n// Detect if current bar is an extreme (only on last bar, ensure sufficient historical data)\nis3DayLow = barstate.islast and bar_index >= 2 and plot_val == low3 and low3 != high3\nis3DayHigh = barstate.islast and bar_index >= 2 and plot_val == high3 and low3 != high3\n\nis7DayLow = barstate.islast and bar_index >= 6 and plot_val == low7 and low7 != high7\nis7DayHigh = barstate.islast and bar_index >= 6 and plot_val == high7 and low7 != high7\n\n// Draw 3-day low marker (only on current bar)\nplotshape(series=show3DayLow and is3DayLow, \n          title="3-Day Low", \n          location=location.absolute, \n          color=low3DayColor, \n          style=getShape(low3DayStyle), \n          size=size.small)\n\n// Draw 3-day high marker (only on current bar)\nplotshape(series=show3DayHigh and is3DayHigh, \n          title="3-Day High", \n          location=location.absolute, \n          color=high3DayColor, \n          style=getShape(high3DayStyle), \n          size=size.small)\n\n// Draw 7-day low marker (only on current bar)\nplotshape(series=show7DayLow and is7DayLow, \n          title="7-Day Low", \n          location=location.absolute, \n          color=low7DayColor, \n          style=getShape(low7DayStyle), \n          size=size.small)\n\n// Draw 7-day high marker (only on current bar)\nplotshape(series=show7DayHigh and is7DayHigh, \n          title="7-Day High", \n          location=location.absolute, \n          color=high7DayColor, \n          style=getShape(high7DayStyle), \n          size=size.small)\n'
[CAPTURE 1] '//@version=6\nindicator(title="ATR Percentage", shorttitle="ATR Percentage", overlay=false)\n\n//--------- Parameters ----------\nlength    = input.int(title="Length", defval=14, minval=1)\nsmoothing = input.string(title="Smoothing", defval="RMA", options=["RMA", "SMA", "EMA", "WMA"])\n\n// ATR% Calculation Basis: Current Open or Previous Close\nbasisOpt  = input.string(\n     title   = "ATR% Basis",\n     defval  = "Current Open",\n     options = ["Current Open", "Prev Close"]\n)\n\n// Wait for current bar to close\nwaitClose = input.bool(true, "Wait for Bar Close to Update")\n\n// New: Flip coordinate scale (multiply ATR% by -1)\nflipScale = input.bool(false, "Flip Coordinate Scale (Invert ATR%)")\n\n// New: Horizontal line options\nshowHLine = input.bool(true, "Show Current Value Horizontal Line")\nhLineColor = input.color(color.new(#B71C1C, 0), "Horizontal Line Color")\nhLineStyle = input.string("Solid", "Horizontal Line Style", options=["Solid", "Dashed", "Dotted"])\nhLineWidth = input.int(1, "Horizontal Line Width", minval=1, maxval=4)\n\n// New: 3-day extreme value marker options\nshow3DayLow = input.bool(true, "Show 3-Day Low Marker")\nlow3DayColor = input.color(color.new(#FF9800, 0), "3-Day Low Color")\nlow3DayStyle = input.string("Circle", "3-Day Low Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow3DayHigh = input.bool(true, "Show 3-Day High Marker")\nhigh3DayColor = input.color(color.new(#4CAF50, 0), "3-Day High Color")\nhigh3DayStyle = input.string("Circle", "3-Day High Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n// New: 7-day extreme value marker options\nshow7DayLow = input.bool(true, "Show 7-Day Low Marker")\nlow7DayColor = input.color(color.new(#FF5722, 0), "7-Day Low Color")\nlow7DayStyle = input.string("Circle", "7-Day Low Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow7DayHigh = input.bool(true, "Show 7-Day High Marker")\nhigh7DayColor = input.color(color.new(#2196F3, 0), "7-Day High Color")\nhigh7DayStyle = input.string("Circle", "7-Day High Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n//--------- Smoothing Function ----------\nma_function(source, length) =>\n    switch smoothing\n        "RMA" => ta.rma(source, length)\n        "SMA" => ta.sma(source, length)\n        "EMA" => ta.ema(source, length)\n        =>       ta.wma(source, length)\n\n//--------- ATR Raw Value ----------\natr_value = ma_function(ta.tr(true), length)\n\n// Calculate basis (fixed: wrap multi-line expression in parentheses)\nbasisPrice = (\n     basisOpt == "Current Open" ? open :\n     close[1]\n)\n\n// ATR% raw calculation\nraw_atr_percent = basisPrice != 0 ? (atr_value / basisPrice) * 100 : na\n\n//--------- Wait for Bar Close Logic ----------\nvar float atr_percent = na\n\nif waitClose\n    if barstate.isconfirmed\n        atr_percent := raw_atr_percent\nelse\n    atr_percent := raw_atr_percent\n\n//--------- Coordinate Flip Processing ----------\n// If flip is enabled, multiply ATR% by -1 for display\nplot_val = flipScale ? -atr_percent : atr_percent\n\n//--------- Plotting ----------\nplot(plot_val, title = "ATR %", color=color.new(#B71C1C, 0))\n\n// New: Draw dynamic horizontal line using line.new() (fixed: use time instead of bar_index)\n// Convert style string to line.style enum\nhlineStyleVal = (\n     hLineStyle == "Solid" ? line.style_solid :\n     hLineStyle == "Dashed" ? line.style_dashed :\n     line.style_dotted\n)\n\n// Create mutable line object\nvar line hline = na\n\n// Update horizontal line on last bar (extends across entire chart)\nif showHLine and barstate.islast\n    // If line doesn\'t exist, create horizontal line from far past time to current time\n    if na(hline)\n        // Use current time minus 10 years as start time\n        var int start_time = time - 1000 * 60 * 60 * 24 * 365 * 10\n        hline := line.new(start_time, plot_val, time, plot_val, \n                           xloc = xloc.bar_time,  // Explicitly specify using time coordinate\n                           color = hLineColor, \n                           style = hlineStyleVal, \n                           width = hLineWidth, \n                           extend = extend.right)\n    else\n        // If line exists, update its position and style\n        line.set_xy2(hline, time, plot_val)\n        line.set_y1(hline, plot_val)\n        line.set_y2(hline, plot_val)\n        line.set_color(hline, hLineColor)\n        line.set_style(hline, hlineStyleVal)\n        line.set_width(hline, hLineWidth)\n\n// New: Detect if current value is an extreme (only on last bar)\n// Convert style string to shape enum (fixed: wrap multi-line expression in parentheses)\ngetShape(styleStr) => (\n     styleStr == "Circle" ? shape.circle :\n     styleStr == "Triangle Up" ? shape.triangleup :\n     styleStr == "Triangle Down" ? shape.triangledown :\n     styleStr == "Square" ? shape.square :\n     styleStr == "Diamond" ? shape.diamond :\n     styleStr == "Cross" ? shape.cross :\n     shape.xcross  // X Cross\n)\n\n// Calculate 3-day and 7-day extremes (including current bar)\nlow3 = ta.lowest(plot_val, 3)\nhigh3 = ta.highest(plot_val, 3)\nlow7 = ta.lowest(plot_val, 7)\nhigh7 = ta.highest(plot_val, 7)\n\n// Detect if current bar is an extreme (only on last bar, ensure sufficient historical data)\nis3DayLow = barstate.islast and bar_index >= 2 and plot_val == low3 and low3 != high3\nis3DayHigh = barstate.islast and bar_index >= 2 and plot_val == high3 and low3 != high3\n\nis7DayLow = barstate.islast and bar_index >= 6 and plot_val == low7 and low7 != high7\nis7DayHigh = barstate.islast and bar_index >= 6 and plot_val == high7 and low7 != high7\n\n// Draw 3-day low marker (only on current bar)\nplotshape(series=show3DayLow and is3DayLow, \n          title="3-Day Low", \n          location=location.absolute, \n          color=low3DayColor, \n          style=getShape(low3DayStyle), \n          size=size.small)\n\n// Draw 3-day high marker (only on current bar)\nplotshape(series=show3DayHigh and is3DayHigh, \n          title="3-Day High", \n          location=location.absolute, \n          color=high3DayColor, \n          style=getShape(high3DayStyle), \n          size=size.small)\n\n// Draw 7-day low marker (only on current bar)\nplotshape(series=show7DayLow and is7DayLow, \n          title="7-Day Low", \n          location=location.absolute, \n          color=low7DayColor, \n          style=getShape(low7DayStyle), \n          size=size.small)\n\n// Draw 7-day high marker (only on current bar)\nplotshape(series=show7DayHigh and is7DayHigh, \n          title="7-Day High", \n          location=location.absolute, \n          color=high7DayColor, \n          style=getShape(high7DayStyle), \n          size=size.small)\n'
[CAPTURE 2] '//@version=6\nindicator(title="ATR Percentage", shorttitle="ATR Percentage", overlay=false)\n\n//--------- Parameters ----------\nlength    = input.int(title="Length", defval=14, minval=1)\nsmoothing = input.string(title="Smoothing", defval="RMA", options=["RMA", "SMA", "EMA", "WMA"])\n\n// ATR% Calculation Basis: Current Open or Previous Close\nbasisOpt  = input.string(\n     title   = "ATR% Basis",\n     defval  = "Current Open",\n     options = ["Current Open", "Prev Close"]\n)\n\n// Wait for current bar to close\nwaitClose = input.bool(true, "Wait for Bar Close to Update")\n\n// New: Flip coordinate scale (multiply ATR% by -1)\nflipScale = input.bool(false, "Flip Coordinate Scale (Invert ATR%)")\n\n// New: Horizontal line options\nshowHLine = input.bool(true, "Show Current Value Horizontal Line")\nhLineColor = input.color(color.new(#B71C1C, 0), "Horizontal Line Color")\nhLineStyle = input.string("Solid", "Horizontal Line Style", options=["Solid", "Dashed", "Dotted"])\nhLineWidth = input.int(1, "Horizontal Line Width", minval=1, maxval=4)\n\n// New: 3-day extreme value marker options\nshow3DayLow = input.bool(true, "Show 3-Day Low Marker")\nlow3DayColor = input.color(color.new(#FF9800, 0), "3-Day Low Color")\nlow3DayStyle = input.string("Circle", "3-Day Low Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow3DayHigh = input.bool(true, "Show 3-Day High Marker")\nhigh3DayColor = input.color(color.new(#4CAF50, 0), "3-Day High Color")\nhigh3DayStyle = input.string("Circle", "3-Day High Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n// New: 7-day extreme value marker options\nshow7DayLow = input.bool(true, "Show 7-Day Low Marker")\nlow7DayColor = input.color(color.new(#FF5722, 0), "7-Day Low Color")\nlow7DayStyle = input.string("Circle", "7-Day Low Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow7DayHigh = input.bool(true, "Show 7-Day High Marker")\nhigh7DayColor = input.color(color.new(#2196F3, 0), "7-Day High Color")\nhigh7DayStyle = input.string("Circle", "7-Day High Style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n//--------- Smoothing Function ----------\nma_function(source, length) =>\n    switch smoothing\n        "RMA" => ta.rma(source, length)\n        "SMA" => ta.sma(source, length)\n        "EMA" => ta.ema(source, length)\n        =>       ta.wma(source, length)\n\n//--------- ATR Raw Value ----------\natr_value = ma_function(ta.tr(true), length)\n\n// Calculate basis (fixed: wrap multi-line expression in parentheses)\nbasisPrice = (\n     basisOpt == "Current Open" ? open :\n     close[1]\n)\n\n// ATR% raw calculation\nraw_atr_percent = basisPrice != 0 ? (atr_value / basisPrice) * 100 : na\n\n//--------- Wait for Bar Close Logic ----------\nvar float atr_percent = na\n\nif waitClose\n    if barstate.isconfirmed\n        atr_percent := raw_atr_percent\nelse\n    atr_percent := raw_atr_percent\n\n//--------- Coordinate Flip Processing ----------\n// If flip is enabled, multiply ATR% by -1 for display\nplot_val = flipScale ? -atr_percent : atr_percent\n\n//--------- Plotting ----------\nplot(plot_val, title = "ATR %", color=color.new(#B71C1C, 0))\n\n// New: Draw dynamic horizontal line using line.new() (fixed: use time instead of bar_index)\n// Convert style string to line.style enum\nhlineStyleVal = (\n     hLineStyle == "Solid" ? line.style_solid :\n     hLineStyle == "Dashed" ? line.style_dashed :\n     line.style_dotted\n)\n\n// Create mutable line object\nvar line hline = na\n\n// Update horizontal line on last bar (extends across entire chart)\nif showHLine and barstate.islast\n    // If line doesn\'t exist, create horizontal line from far past time to current time\n    if na(hline)\n        // Use current time minus 10 years as start time\n        var int start_time = time - 1000 * 60 * 60 * 24 * 365 * 10\n        hline := line.new(start_time, plot_val, time, plot_val, \n                           xloc = xloc.bar_time,  // Explicitly specify using time coordinate\n                           color = hLineColor, \n                           style = hlineStyleVal, \n                           width = hLineWidth, \n                           extend = extend.right)\n    else\n        // If line exists, update its position and style\n        line.set_xy2(hline, time, plot_val)\n        line.set_y1(hline, plot_val)\n        line.set_y2(hline, plot_val)\n        line.set_color(hline, hLineColor)\n        line.set_style(hline, hlineStyleVal)\n        line.set_width(hline, hLineWidth)\n\n// New: Detect if current value is an extreme (only on last bar)\n// Convert style string to shape enum (fixed: wrap multi-line expression in parentheses)\ngetShape(styleStr) => (\n     styleStr == "Circle" ? shape.circle :\n     styleStr == "Triangle Up" ? shape.triangleup :\n     styleStr == "Triangle Down" ? shape.triangledown :\n     styleStr == "Square" ? shape.square :\n     styleStr == "Diamond" ? shape.diamond :\n     styleStr == "Cross" ? shape.cross :\n     shape.xcross  // X Cross\n)\n\n// Calculate 3-day and 7-day extremes (including current bar)\nlow3 = ta.lowest(plot_val, 3)\nhigh3 = ta.highest(plot_val, 3)\nlow7 = ta.lowest(plot_val, 7)\nhigh7 = ta.highest(plot_val, 7)\n\n// Detect if current bar is an extreme (only on last bar, ensure sufficient historical data)\nis3DayLow = barstate.islast and bar_index >= 2 and plot_val == low3 and low3 != high3\nis3DayHigh = barstate.islast and bar_index >= 2 and plot_val == high3 and low3 != high3\n\nis7DayLow = barstate.islast and bar_index >= 6 and plot_val == low7 and low7 != high7\nis7DayHigh = barstate.islast and bar_index >= 6 and plot_val == high7 and low7 != high7\n\n// Draw 3-day low marker (only on current bar)\nplotshape(series=show3DayLow and is3DayLow, \n          title="3-Day Low", \n          location=location.absolute, \n          color=low3DayColor, \n          style=getShape(low3DayStyle), \n          size=size.small)\n\n// Draw 3-day high marker (only on current bar)\nplotshape(series=show3DayHigh and is3DayHigh, \n          title="3-Day High", \n          location=location.absolute, \n          color=high3DayColor, \n          style=getShape(high3DayStyle), \n          size=size.small)\n\n// Draw 7-day low marker (only on current bar)\nplotshape(series=show7DayLow and is7DayLow, \n          title="7-Day Low", \n          location=location.absolute, \n          color=low7DayColor, \n          style=getShape(low7DayStyle), \n          size=size.small)\n\n// Draw 7-day high marker (only on current bar)\nplotshape(series=show7DayHigh and is7DayHigh, \n          title="7-Day High", \n          location=location.absolute, \n          color=high7DayColor, \n          style=getShape(high7DayStyle), \n          size=size.small)\n'
[DEBUG] save_script called: script_id=win6rVhs title=ATR % V3 category=win6rVhs force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\win6rVhs_ATR_%_V3.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\win6rVhs_ATR_%_V3.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 03:00:00 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 03:00:00 GMT' as: 2026-02-09T03:00:00+00:00
[DEBUG] Exact published date for header: 2026-02-09T03:00:00+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/jXqbVDxO-15m-BOS-OTE-FVG-OB-Prop-Firm/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\nindicator("15m BOS + OTE + FVG + OB (Prop Firm)", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ==========================\n// INPUTS\n// ==========================\nhtf           = "15"\nswingLen      = 3\nnySession     = "0930-1130"\nshowZones     = true\n\n// ==========================\n// SESSION FILTER\n// ==========================\ninSession = not na(time(timeframe.period, nySession))\n\n// ==========================\n// 15M STRUCTURE\n// ==========================\n[htfH, htfL, htfC] = request.security(syminfo.tickerid, htf, [high, low, close])\n\nph = ta.pivothigh(htfH, swingLen, swingLen)\npl = ta.pivotlow(htfL, swingLen, swingLen)\n\nvar float lastHigh = na\nvar float lastLow  = na\n\nif not na(ph)\n    lastHigh := ph\nif not na(pl)\n    lastLow := pl\n\nbullBOS = ta.crossover(htfC, lastHigh)\nbearBOS = ta.crossunder(htfC, lastLow)\n\n// ==========================\n// DEALING RANGE + OTE\n// ==========================\nvar float rangeHigh = na\nvar float rangeLow  = na\nvar bool  traded    = false\n\nif bullBOS\n    rangeHigh := htfH\n    rangeLow  := lastLow\n    traded    := false\n\nif bearBOS\n    rangeLow  := htfL\n    rangeHigh := lastHigh\n    traded    := false\n\noteH = rangeLow + (rangeHigh - rangeLow) * 0.79\noteL = rangeLow + (rangeHigh - rangeLow) * 0.618\n\n// ==========================\n// FAIR VALUE GAP (3-CANDLE)\n// ==========================\nbullFVG = low > high[2]\nbearFVG = high < low[2]\n\nfvgLowBull  = high[2]\nfvgHighBull = low\n\nfvgHighBear = low[2]\nfvgLowBear  = high\n\n// ==========================\n// ORDER BLOCK (LAST OPPOSING CANDLE)\n// ==========================\nbullOB = close[1] < open[1] and bullBOS\nbearOB = close[1] > open[1] and bearBOS\n\nobHigh = high[1]\nobLow  = low[1]\n\n// ==========================\n// LOWER TF INTERNAL BOS\n// ==========================\niHigh = ta.pivothigh(high, 2, 2)\niLow  = ta.pivotlow(low, 2, 2)\n\nvar float internalHigh = na\nvar float internalLow  = na\n\nif not na(iHigh)\n    internalHigh := iHigh\nif not na(iLow)\n    internalLow := iLow\n\nltfBullBOS = ta.crossover(close, internalHigh)\nltfBearBOS = ta.crossunder(close, internalLow)\n\n// ==========================\n// RETRACEMENT CONDITIONS\n// ==========================\ninOTEbull = low <= oteH and low >= oteL\ninOTEbear = high >= oteL and high <= oteH\n\ntapBullFVG = low <= fvgHighBull and low >= fvgLowBull\ntapBearFVG = high >= fvgLowBear and high <= fvgHighBear\n\ntapBullOB = low <= obHigh and low >= obLow\ntapBearOB = high >= obLow and high <= obHigh\n\n// ==========================\n// ENTRY CONDITIONS\n// ==========================\nlongEntry = bullBOS == false and inSession and not traded and inOTEbull and tapBullFVG and tapBullOB and  ltfBullBOS\n\nshortEntry = bearBOS == false and inSession and not traded and inOTEbear and tapBearFVG and tapBearOB and ltfBearBOS\n\nif longEntry or shortEntry\n    traded := true\n\n// ==========================\n// VISUALS\n// ==========================\nif bullBOS\n    label.new(bar_index, high, "15m BOS ↑", color=color.green)\n\nif bearBOS\n    label.new(bar_index, low, "15m BOS ↓", color=color.red)\n\nif longEntry\n    label.new(bar_index, low, "PROP LONG", style=label.style_label_up, color=color.lime)\n\nif shortEntry\n    label.new(bar_index, high, "PROP SHORT", style=label.style_label_down, color=color.red)\n\n// ==========================\n// STOPS & TARGETS\n// ==========================\nif longEntry\n    line.new(bar_index, internalLow, bar_index + 25, internalLow, color=color.red)\n    line.new(bar_index, rangeHigh, bar_index + 25, rangeHigh, color=color.green)\n\nif shortEntry\n    line.new(bar_index, internalHigh, bar_index + 25, internalHigh, color=color.red)\n    line.new(bar_index, rangeLow, bar_index + 25, rangeLow, color=color.green)\n\n// ==========================\n// BUY / SELL SIGNALS\n// ==========================\nplotshape(longEntry, title="Buy Signal", style=shape.triangleup,location=location.belowbar,color=color.lime,size=size.small,text="BUY")\n\nplotshape(shortEntry,title="Sell Signal",style=shape.triangledown,location=location.abovebar,color=color.red,size=size.small,text="SELL")\n\n// ==========================\n// ALERTS\n// ==========================\nalertcondition(longEntry, title="Long Entry Alert", message="LONG entry signal")\nalertcondition(shortEntry, title="Short Entry Alert", message="SHORT entry signal")\n'
[CAPTURE 1] '//@version=5\nindicator("15m BOS + OTE + FVG + OB (Prop Firm)", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ==========================\n// INPUTS\n// ==========================\nhtf           = "15"\nswingLen      = 3\nnySession     = "0930-1130"\nshowZones     = true\n\n// ==========================\n// SESSION FILTER\n// ==========================\ninSession = not na(time(timeframe.period, nySession))\n\n// ==========================\n// 15M STRUCTURE\n// ==========================\n[htfH, htfL, htfC] = request.security(syminfo.tickerid, htf, [high, low, close])\n\nph = ta.pivothigh(htfH, swingLen, swingLen)\npl = ta.pivotlow(htfL, swingLen, swingLen)\n\nvar float lastHigh = na\nvar float lastLow  = na\n\nif not na(ph)\n    lastHigh := ph\nif not na(pl)\n    lastLow := pl\n\nbullBOS = ta.crossover(htfC, lastHigh)\nbearBOS = ta.crossunder(htfC, lastLow)\n\n// ==========================\n// DEALING RANGE + OTE\n// ==========================\nvar float rangeHigh = na\nvar float rangeLow  = na\nvar bool  traded    = false\n\nif bullBOS\n    rangeHigh := htfH\n    rangeLow  := lastLow\n    traded    := false\n\nif bearBOS\n    rangeLow  := htfL\n    rangeHigh := lastHigh\n    traded    := false\n\noteH = rangeLow + (rangeHigh - rangeLow) * 0.79\noteL = rangeLow + (rangeHigh - rangeLow) * 0.618\n\n// ==========================\n// FAIR VALUE GAP (3-CANDLE)\n// ==========================\nbullFVG = low > high[2]\nbearFVG = high < low[2]\n\nfvgLowBull  = high[2]\nfvgHighBull = low\n\nfvgHighBear = low[2]\nfvgLowBear  = high\n\n// ==========================\n// ORDER BLOCK (LAST OPPOSING CANDLE)\n// ==========================\nbullOB = close[1] < open[1] and bullBOS\nbearOB = close[1] > open[1] and bearBOS\n\nobHigh = high[1]\nobLow  = low[1]\n\n// ==========================\n// LOWER TF INTERNAL BOS\n// ==========================\niHigh = ta.pivothigh(high, 2, 2)\niLow  = ta.pivotlow(low, 2, 2)\n\nvar float internalHigh = na\nvar float internalLow  = na\n\nif not na(iHigh)\n    internalHigh := iHigh\nif not na(iLow)\n    internalLow := iLow\n\nltfBullBOS = ta.crossover(close, internalHigh)\nltfBearBOS = ta.crossunder(close, internalLow)\n\n// ==========================\n// RETRACEMENT CONDITIONS\n// ==========================\ninOTEbull = low <= oteH and low >= oteL\ninOTEbear = high >= oteL and high <= oteH\n\ntapBullFVG = low <= fvgHighBull and low >= fvgLowBull\ntapBearFVG = high >= fvgLowBear and high <= fvgHighBear\n\ntapBullOB = low <= obHigh and low >= obLow\ntapBearOB = high >= obLow and high <= obHigh\n\n// ==========================\n// ENTRY CONDITIONS\n// ==========================\nlongEntry = bullBOS == false and inSession and not traded and inOTEbull and tapBullFVG and tapBullOB and  ltfBullBOS\n\nshortEntry = bearBOS == false and inSession and not traded and inOTEbear and tapBearFVG and tapBearOB and ltfBearBOS\n\nif longEntry or shortEntry\n    traded := true\n\n// ==========================\n// VISUALS\n// ==========================\nif bullBOS\n    label.new(bar_index, high, "15m BOS ↑", color=color.green)\n\nif bearBOS\n    label.new(bar_index, low, "15m BOS ↓", color=color.red)\n\nif longEntry\n    label.new(bar_index, low, "PROP LONG", style=label.style_label_up, color=color.lime)\n\nif shortEntry\n    label.new(bar_index, high, "PROP SHORT", style=label.style_label_down, color=color.red)\n\n// ==========================\n// STOPS & TARGETS\n// ==========================\nif longEntry\n    line.new(bar_index, internalLow, bar_index + 25, internalLow, color=color.red)\n    line.new(bar_index, rangeHigh, bar_index + 25, rangeHigh, color=color.green)\n\nif shortEntry\n    line.new(bar_index, internalHigh, bar_index + 25, internalHigh, color=color.red)\n    line.new(bar_index, rangeLow, bar_index + 25, rangeLow, color=color.green)\n\n// ==========================\n// BUY / SELL SIGNALS\n// ==========================\nplotshape(longEntry, title="Buy Signal", style=shape.triangleup,location=location.belowbar,color=color.lime,size=size.small,text="BUY")\n\nplotshape(shortEntry,title="Sell Signal",style=shape.triangledown,location=location.abovebar,color=color.red,size=size.small,text="SELL")\n\n// ==========================\n// ALERTS\n// ==========================\nalertcondition(longEntry, title="Long Entry Alert", message="LONG entry signal")\nalertcondition(shortEntry, title="Short Entry Alert", message="SHORT entry signal")\n'
[CAPTURE 2] '//@version=5\nindicator("15m BOS + OTE + FVG + OB (Prop Firm)", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ==========================\n// INPUTS\n// ==========================\nhtf           = "15"\nswingLen      = 3\nnySession     = "0930-1130"\nshowZones     = true\n\n// ==========================\n// SESSION FILTER\n// ==========================\ninSession = not na(time(timeframe.period, nySession))\n\n// ==========================\n// 15M STRUCTURE\n// ==========================\n[htfH, htfL, htfC] = request.security(syminfo.tickerid, htf, [high, low, close])\n\nph = ta.pivothigh(htfH, swingLen, swingLen)\npl = ta.pivotlow(htfL, swingLen, swingLen)\n\nvar float lastHigh = na\nvar float lastLow  = na\n\nif not na(ph)\n    lastHigh := ph\nif not na(pl)\n    lastLow := pl\n\nbullBOS = ta.crossover(htfC, lastHigh)\nbearBOS = ta.crossunder(htfC, lastLow)\n\n// ==========================\n// DEALING RANGE + OTE\n// ==========================\nvar float rangeHigh = na\nvar float rangeLow  = na\nvar bool  traded    = false\n\nif bullBOS\n    rangeHigh := htfH\n    rangeLow  := lastLow\n    traded    := false\n\nif bearBOS\n    rangeLow  := htfL\n    rangeHigh := lastHigh\n    traded    := false\n\noteH = rangeLow + (rangeHigh - rangeLow) * 0.79\noteL = rangeLow + (rangeHigh - rangeLow) * 0.618\n\n// ==========================\n// FAIR VALUE GAP (3-CANDLE)\n// ==========================\nbullFVG = low > high[2]\nbearFVG = high < low[2]\n\nfvgLowBull  = high[2]\nfvgHighBull = low\n\nfvgHighBear = low[2]\nfvgLowBear  = high\n\n// ==========================\n// ORDER BLOCK (LAST OPPOSING CANDLE)\n// ==========================\nbullOB = close[1] < open[1] and bullBOS\nbearOB = close[1] > open[1] and bearBOS\n\nobHigh = high[1]\nobLow  = low[1]\n\n// ==========================\n// LOWER TF INTERNAL BOS\n// ==========================\niHigh = ta.pivothigh(high, 2, 2)\niLow  = ta.pivotlow(low, 2, 2)\n\nvar float internalHigh = na\nvar float internalLow  = na\n\nif not na(iHigh)\n    internalHigh := iHigh\nif not na(iLow)\n    internalLow := iLow\n\nltfBullBOS = ta.crossover(close, internalHigh)\nltfBearBOS = ta.crossunder(close, internalLow)\n\n// ==========================\n// RETRACEMENT CONDITIONS\n// ==========================\ninOTEbull = low <= oteH and low >= oteL\ninOTEbear = high >= oteL and high <= oteH\n\ntapBullFVG = low <= fvgHighBull and low >= fvgLowBull\ntapBearFVG = high >= fvgLowBear and high <= fvgHighBear\n\ntapBullOB = low <= obHigh and low >= obLow\ntapBearOB = high >= obLow and high <= obHigh\n\n// ==========================\n// ENTRY CONDITIONS\n// ==========================\nlongEntry = bullBOS == false and inSession and not traded and inOTEbull and tapBullFVG and tapBullOB and  ltfBullBOS\n\nshortEntry = bearBOS == false and inSession and not traded and inOTEbear and tapBearFVG and tapBearOB and ltfBearBOS\n\nif longEntry or shortEntry\n    traded := true\n\n// ==========================\n// VISUALS\n// ==========================\nif bullBOS\n    label.new(bar_index, high, "15m BOS ↑", color=color.green)\n\nif bearBOS\n    label.new(bar_index, low, "15m BOS ↓", color=color.red)\n\nif longEntry\n    label.new(bar_index, low, "PROP LONG", style=label.style_label_up, color=color.lime)\n\nif shortEntry\n    label.new(bar_index, high, "PROP SHORT", style=label.style_label_down, color=color.red)\n\n// ==========================\n// STOPS & TARGETS\n// ==========================\nif longEntry\n    line.new(bar_index, internalLow, bar_index + 25, internalLow, color=color.red)\n    line.new(bar_index, rangeHigh, bar_index + 25, rangeHigh, color=color.green)\n\nif shortEntry\n    line.new(bar_index, internalHigh, bar_index + 25, internalHigh, color=color.red)\n    line.new(bar_index, rangeLow, bar_index + 25, rangeLow, color=color.green)\n\n// ==========================\n// BUY / SELL SIGNALS\n// ==========================\nplotshape(longEntry, title="Buy Signal", style=shape.triangleup,location=location.belowbar,color=color.lime,size=size.small,text="BUY")\n\nplotshape(shortEntry,title="Sell Signal",style=shape.triangledown,location=location.abovebar,color=color.red,size=size.small,text="SELL")\n\n// ==========================\n// ALERTS\n// ==========================\nalertcondition(longEntry, title="Long Entry Alert", message="LONG entry signal")\nalertcondition(shortEntry, title="Short Entry Alert", message="SHORT entry signal")\n'
[DEBUG] save_script called: script_id=jXqbVDxO title=15m BOS + OTE + FVG + OB (Prop Firm) category=jXqbVDxO force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\jXqbVDxO_15m_BOS_+_OTE_+_FVG_+_OB_(Prop_Firm).pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\jXqbVDxO_15m_BOS_+_OTE_+_FVG_+_OB_(Prop_Firm).pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 02:57:38 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 02:57:38 GMT' as: 2026-02-09T02:57:38+00:00
[DEBUG] Exact published date for header: 2026-02-09T02:57:38+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/ihVmRHsZ/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator(title="Average True Range V2", shorttitle="ATR V2", overlay=false)\n\nlength = input.int(title="Length", defval=14, minval=1)\nsmoothing = input.string(title="Smoothing", defval="RMA", options=["RMA", "SMA", "EMA", "WMA"])\n\n// New: Wait for current candle close\nwaitClose = input.bool(true, "Wait for period end before updating")\n\n// New: Flip scale (multiply ATR by -1)\nflipScale = input.bool(false, "Flip scale (invert ATR)")\n\n// New: Horizontal line options\nshowHLine = input.bool(true, "Show current value horizontal line")\nhLineColor = input.color(color.new(#B71C1C, 0), "Horizontal line color")\nhLineStyle = input.string("Solid", "Horizontal line style", options=["Solid", "Dashed", "Dotted"])\nhLineWidth = input.int(1, "Horizontal line width", minval=1, maxval=4)\n\n// New: 3-day extreme marker options\nshow3DayLow = input.bool(true, "Show 3-day low marker")\nlow3DayColor = input.color(color.new(#FF9800, 0), "3-day low color")\nlow3DayStyle = input.string("Circle", "3-day low style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow3DayHigh = input.bool(true, "Show 3-day high marker")\nhigh3DayColor = input.color(color.new(#4CAF50, 0), "3-day high color")\nhigh3DayStyle = input.string("Circle", "3-day high style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n// New: 7-day extreme marker options\nshow7DayLow = input.bool(true, "Show 7-day low marker")\nlow7DayColor = input.color(color.new(#FF5722, 0), "7-day low color")\nlow7DayStyle = input.string("Circle", "7-day low style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow7DayHigh = input.bool(true, "Show 7-day high marker")\nhigh7DayColor = input.color(color.new(#2196F3, 0), "7-day high color")\nhigh7DayStyle = input.string("Circle", "7-day high style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nma_function(source, length) =>\n    switch smoothing\n        "RMA" => ta.rma(source, length)\n        "SMA" => ta.sma(source, length)\n        "EMA" => ta.ema(source, length)\n        => ta.wma(source, length)\n\n// ATR original calculation\nraw_atr_value = ma_function(ta.tr(true), length)\n\n// Wait for period end logic\nvar float atr_value = na\n\nif waitClose\n    if barstate.isconfirmed\n        atr_value := raw_atr_value\nelse\n    atr_value := raw_atr_value\n\n// Scale flip handling\nplot_val = flipScale ? -atr_value : atr_value\n\n// Main plot\nplot(plot_val, title = "ATR", color=color.new(#B71C1C, 0))\n\n// Horizontal line function (fix: using xloc.bar_time)\nhlineStyleVal = (\n     hLineStyle == "Solid" ? line.style_solid :\n     hLineStyle == "Dashed" ? line.style_dashed :\n     line.style_dotted\n)\n\nvar line hline = na\n\n// Only process horizontal line on last bar\nif showHLine and barstate.islast\n    if na(hline)\n        // Use current time minus large offset as start time\n        var int start_time = time - 1000 * 60 * 60 * 24 * 365 * 10  // 10 years ago\n        hline := line.new(start_time, plot_val, time, plot_val, \n                           xloc = xloc.bar_time,  // Explicitly specify using time coordinates\n                           color = hLineColor, \n                           style = hlineStyleVal, \n                           width = hLineWidth, \n                           extend = extend.right)\n    else\n        // Update line endpoint and Y coordinates\n        line.set_xy2(hline, time, plot_val)\n        line.set_y1(hline, plot_val)\n        line.set_y2(hline, plot_val)\n        line.set_color(hline, hLineColor)\n        line.set_style(hline, hlineStyleVal)\n        line.set_width(hline, hLineWidth)\n\n// Extreme value detection function\ngetShape(styleStr) => (\n     styleStr == "Circle" ? shape.circle :\n     styleStr == "Triangle Up" ? shape.triangleup :\n     styleStr == "Triangle Down" ? shape.triangledown :\n     styleStr == "Square" ? shape.square :\n     styleStr == "Diamond" ? shape.diamond :\n     styleStr == "Cross" ? shape.cross :\n     shape.xcross\n)\n\n// Calculate extremes (using flipped values)\nlow3 = ta.lowest(plot_val, 3)\nhigh3 = ta.highest(plot_val, 3)\nlow7 = ta.lowest(plot_val, 7)\nhigh7 = ta.highest(plot_val, 7)\n\n// Detect if current is extreme (only on last bar, ensuring valid range)\nis3DayLow = barstate.islast and bar_index >= 2 and plot_val == low3 and low3 != high3\nis3DayHigh = barstate.islast and bar_index >= 2 and plot_val == high3 and low3 != high3\nis7DayLow = barstate.islast and bar_index >= 6 and plot_val == low7 and low7 != high7\nis7DayHigh = barstate.islast and bar_index >= 6 and plot_val == high7 and low7 != high7\n\n// Draw markers\nplotshape(series=show3DayLow and is3DayLow, \n          title="3-day low", \n          location=location.absolute, \n          color=low3DayColor, \n          style=getShape(low3DayStyle), \n          size=size.small)\n\nplotshape(series=show3DayHigh and is3DayHigh, \n          title="3-day high", \n          location=location.absolute, \n          color=high3DayColor, \n          style=getShape(high3DayStyle), \n          size=size.small)\n\nplotshape(series=show7DayLow and is7DayLow, \n          title="7-day low", \n          location=location.absolute, \n          color=low7DayColor, \n          style=getShape(low7DayStyle), \n          size=size.small)\n\nplotshape(series=show7DayHigh and is7DayHigh, \n          title="7-day high", \n          location=location.absolute, \n          color=high7DayColor, \n          style=getShape(high7DayStyle), \n          size=size.small)\n'
[CAPTURE 1] '//@version=6\nindicator(title="Average True Range V2", shorttitle="ATR V2", overlay=false)\n\nlength = input.int(title="Length", defval=14, minval=1)\nsmoothing = input.string(title="Smoothing", defval="RMA", options=["RMA", "SMA", "EMA", "WMA"])\n\n// New: Wait for current candle close\nwaitClose = input.bool(true, "Wait for period end before updating")\n\n// New: Flip scale (multiply ATR by -1)\nflipScale = input.bool(false, "Flip scale (invert ATR)")\n\n// New: Horizontal line options\nshowHLine = input.bool(true, "Show current value horizontal line")\nhLineColor = input.color(color.new(#B71C1C, 0), "Horizontal line color")\nhLineStyle = input.string("Solid", "Horizontal line style", options=["Solid", "Dashed", "Dotted"])\nhLineWidth = input.int(1, "Horizontal line width", minval=1, maxval=4)\n\n// New: 3-day extreme marker options\nshow3DayLow = input.bool(true, "Show 3-day low marker")\nlow3DayColor = input.color(color.new(#FF9800, 0), "3-day low color")\nlow3DayStyle = input.string("Circle", "3-day low style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow3DayHigh = input.bool(true, "Show 3-day high marker")\nhigh3DayColor = input.color(color.new(#4CAF50, 0), "3-day high color")\nhigh3DayStyle = input.string("Circle", "3-day high style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n// New: 7-day extreme marker options\nshow7DayLow = input.bool(true, "Show 7-day low marker")\nlow7DayColor = input.color(color.new(#FF5722, 0), "7-day low color")\nlow7DayStyle = input.string("Circle", "7-day low style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow7DayHigh = input.bool(true, "Show 7-day high marker")\nhigh7DayColor = input.color(color.new(#2196F3, 0), "7-day high color")\nhigh7DayStyle = input.string("Circle", "7-day high style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nma_function(source, length) =>\n    switch smoothing\n        "RMA" => ta.rma(source, length)\n        "SMA" => ta.sma(source, length)\n        "EMA" => ta.ema(source, length)\n        => ta.wma(source, length)\n\n// ATR original calculation\nraw_atr_value = ma_function(ta.tr(true), length)\n\n// Wait for period end logic\nvar float atr_value = na\n\nif waitClose\n    if barstate.isconfirmed\n        atr_value := raw_atr_value\nelse\n    atr_value := raw_atr_value\n\n// Scale flip handling\nplot_val = flipScale ? -atr_value : atr_value\n\n// Main plot\nplot(plot_val, title = "ATR", color=color.new(#B71C1C, 0))\n\n// Horizontal line function (fix: using xloc.bar_time)\nhlineStyleVal = (\n     hLineStyle == "Solid" ? line.style_solid :\n     hLineStyle == "Dashed" ? line.style_dashed :\n     line.style_dotted\n)\n\nvar line hline = na\n\n// Only process horizontal line on last bar\nif showHLine and barstate.islast\n    if na(hline)\n        // Use current time minus large offset as start time\n        var int start_time = time - 1000 * 60 * 60 * 24 * 365 * 10  // 10 years ago\n        hline := line.new(start_time, plot_val, time, plot_val, \n                           xloc = xloc.bar_time,  // Explicitly specify using time coordinates\n                           color = hLineColor, \n                           style = hlineStyleVal, \n                           width = hLineWidth, \n                           extend = extend.right)\n    else\n        // Update line endpoint and Y coordinates\n        line.set_xy2(hline, time, plot_val)\n        line.set_y1(hline, plot_val)\n        line.set_y2(hline, plot_val)\n        line.set_color(hline, hLineColor)\n        line.set_style(hline, hlineStyleVal)\n        line.set_width(hline, hLineWidth)\n\n// Extreme value detection function\ngetShape(styleStr) => (\n     styleStr == "Circle" ? shape.circle :\n     styleStr == "Triangle Up" ? shape.triangleup :\n     styleStr == "Triangle Down" ? shape.triangledown :\n     styleStr == "Square" ? shape.square :\n     styleStr == "Diamond" ? shape.diamond :\n     styleStr == "Cross" ? shape.cross :\n     shape.xcross\n)\n\n// Calculate extremes (using flipped values)\nlow3 = ta.lowest(plot_val, 3)\nhigh3 = ta.highest(plot_val, 3)\nlow7 = ta.lowest(plot_val, 7)\nhigh7 = ta.highest(plot_val, 7)\n\n// Detect if current is extreme (only on last bar, ensuring valid range)\nis3DayLow = barstate.islast and bar_index >= 2 and plot_val == low3 and low3 != high3\nis3DayHigh = barstate.islast and bar_index >= 2 and plot_val == high3 and low3 != high3\nis7DayLow = barstate.islast and bar_index >= 6 and plot_val == low7 and low7 != high7\nis7DayHigh = barstate.islast and bar_index >= 6 and plot_val == high7 and low7 != high7\n\n// Draw markers\nplotshape(series=show3DayLow and is3DayLow, \n          title="3-day low", \n          location=location.absolute, \n          color=low3DayColor, \n          style=getShape(low3DayStyle), \n          size=size.small)\n\nplotshape(series=show3DayHigh and is3DayHigh, \n          title="3-day high", \n          location=location.absolute, \n          color=high3DayColor, \n          style=getShape(high3DayStyle), \n          size=size.small)\n\nplotshape(series=show7DayLow and is7DayLow, \n          title="7-day low", \n          location=location.absolute, \n          color=low7DayColor, \n          style=getShape(low7DayStyle), \n          size=size.small)\n\nplotshape(series=show7DayHigh and is7DayHigh, \n          title="7-day high", \n          location=location.absolute, \n          color=high7DayColor, \n          style=getShape(high7DayStyle), \n          size=size.small)\n'
[CAPTURE 2] '//@version=6\nindicator(title="Average True Range V2", shorttitle="ATR V2", overlay=false)\n\nlength = input.int(title="Length", defval=14, minval=1)\nsmoothing = input.string(title="Smoothing", defval="RMA", options=["RMA", "SMA", "EMA", "WMA"])\n\n// New: Wait for current candle close\nwaitClose = input.bool(true, "Wait for period end before updating")\n\n// New: Flip scale (multiply ATR by -1)\nflipScale = input.bool(false, "Flip scale (invert ATR)")\n\n// New: Horizontal line options\nshowHLine = input.bool(true, "Show current value horizontal line")\nhLineColor = input.color(color.new(#B71C1C, 0), "Horizontal line color")\nhLineStyle = input.string("Solid", "Horizontal line style", options=["Solid", "Dashed", "Dotted"])\nhLineWidth = input.int(1, "Horizontal line width", minval=1, maxval=4)\n\n// New: 3-day extreme marker options\nshow3DayLow = input.bool(true, "Show 3-day low marker")\nlow3DayColor = input.color(color.new(#FF9800, 0), "3-day low color")\nlow3DayStyle = input.string("Circle", "3-day low style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow3DayHigh = input.bool(true, "Show 3-day high marker")\nhigh3DayColor = input.color(color.new(#4CAF50, 0), "3-day high color")\nhigh3DayStyle = input.string("Circle", "3-day high style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\n// New: 7-day extreme marker options\nshow7DayLow = input.bool(true, "Show 7-day low marker")\nlow7DayColor = input.color(color.new(#FF5722, 0), "7-day low color")\nlow7DayStyle = input.string("Circle", "7-day low style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nshow7DayHigh = input.bool(true, "Show 7-day high marker")\nhigh7DayColor = input.color(color.new(#2196F3, 0), "7-day high color")\nhigh7DayStyle = input.string("Circle", "7-day high style", options=["Circle", "Triangle Up", "Triangle Down", "Square", "Diamond", "Cross", "X Cross"])\n\nma_function(source, length) =>\n    switch smoothing\n        "RMA" => ta.rma(source, length)\n        "SMA" => ta.sma(source, length)\n        "EMA" => ta.ema(source, length)\n        => ta.wma(source, length)\n\n// ATR original calculation\nraw_atr_value = ma_function(ta.tr(true), length)\n\n// Wait for period end logic\nvar float atr_value = na\n\nif waitClose\n    if barstate.isconfirmed\n        atr_value := raw_atr_value\nelse\n    atr_value := raw_atr_value\n\n// Scale flip handling\nplot_val = flipScale ? -atr_value : atr_value\n\n// Main plot\nplot(plot_val, title = "ATR", color=color.new(#B71C1C, 0))\n\n// Horizontal line function (fix: using xloc.bar_time)\nhlineStyleVal = (\n     hLineStyle == "Solid" ? line.style_solid :\n     hLineStyle == "Dashed" ? line.style_dashed :\n     line.style_dotted\n)\n\nvar line hline = na\n\n// Only process horizontal line on last bar\nif showHLine and barstate.islast\n    if na(hline)\n        // Use current time minus large offset as start time\n        var int start_time = time - 1000 * 60 * 60 * 24 * 365 * 10  // 10 years ago\n        hline := line.new(start_time, plot_val, time, plot_val, \n                           xloc = xloc.bar_time,  // Explicitly specify using time coordinates\n                           color = hLineColor, \n                           style = hlineStyleVal, \n                           width = hLineWidth, \n                           extend = extend.right)\n    else\n        // Update line endpoint and Y coordinates\n        line.set_xy2(hline, time, plot_val)\n        line.set_y1(hline, plot_val)\n        line.set_y2(hline, plot_val)\n        line.set_color(hline, hLineColor)\n        line.set_style(hline, hlineStyleVal)\n        line.set_width(hline, hLineWidth)\n\n// Extreme value detection function\ngetShape(styleStr) => (\n     styleStr == "Circle" ? shape.circle :\n     styleStr == "Triangle Up" ? shape.triangleup :\n     styleStr == "Triangle Down" ? shape.triangledown :\n     styleStr == "Square" ? shape.square :\n     styleStr == "Diamond" ? shape.diamond :\n     styleStr == "Cross" ? shape.cross :\n     shape.xcross\n)\n\n// Calculate extremes (using flipped values)\nlow3 = ta.lowest(plot_val, 3)\nhigh3 = ta.highest(plot_val, 3)\nlow7 = ta.lowest(plot_val, 7)\nhigh7 = ta.highest(plot_val, 7)\n\n// Detect if current is extreme (only on last bar, ensuring valid range)\nis3DayLow = barstate.islast and bar_index >= 2 and plot_val == low3 and low3 != high3\nis3DayHigh = barstate.islast and bar_index >= 2 and plot_val == high3 and low3 != high3\nis7DayLow = barstate.islast and bar_index >= 6 and plot_val == low7 and low7 != high7\nis7DayHigh = barstate.islast and bar_index >= 6 and plot_val == high7 and low7 != high7\n\n// Draw markers\nplotshape(series=show3DayLow and is3DayLow, \n          title="3-day low", \n          location=location.absolute, \n          color=low3DayColor, \n          style=getShape(low3DayStyle), \n          size=size.small)\n\nplotshape(series=show3DayHigh and is3DayHigh, \n          title="3-day high", \n          location=location.absolute, \n          color=high3DayColor, \n          style=getShape(high3DayStyle), \n          size=size.small)\n\nplotshape(series=show7DayLow and is7DayLow, \n          title="7-day low", \n          location=location.absolute, \n          color=low7DayColor, \n          style=getShape(low7DayStyle), \n          size=size.small)\n\nplotshape(series=show7DayHigh and is7DayHigh, \n          title="7-day high", \n          location=location.absolute, \n          color=high7DayColor, \n          style=getShape(high7DayStyle), \n          size=size.small)\n'
[DEBUG] save_script called: script_id=ihVmRHsZ title=Average True Range V2 category=ihVmRHsZ force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\ihVmRHsZ_Average_True_Range_V2.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\ihVmRHsZ_Average_True_Range_V2.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected

[1/21] Downloading: https://www.tradingview.com/script/frTDeuJf-Chitranjan-Shastri-Fixed-Ultra-Clear-Pilot/
   ✗ Fout bij downloaden: https://www.tradingview.com/script/frTDeuJf-Chitranjan-Shastri-Fixed-Ultra-Clear-Pilot/

[2/21] Downloading: https://www.tradingview.com/script/qgSSrerD-AMT-Institutional-Model-v2/
   ✓ Gedownload: https://www.tradingview.com/script/qgSSrerD-AMT-Institutional-Model-v2/

[3/21] Downloading: https://www.tradingview.com/script/biGUf4YI-MACD-20-Uptrend-Candlestick-Patterns/
   ✓ Gedownload: https://www.tradingview.com/script/biGUf4YI-MACD-20-Uptrend-Candlestick-Patterns/

[4/21] Downloading: https://www.tradingview.com/script/e9HAPhVq-Market-Structure-HH-HL-LH-LL/
   ✓ Gedownload: https://www.tradingview.com/script/e9HAPhVq-Market-Structure-HH-HL-LH-LL/

[5/21] Downloading: https://www.tradingview.com/script/I7Wh8tGl-KSCP-Dist25/
   ✓ Gedownload: https://www.tradingview.com/script/I7Wh8tGl-KSCP-Dist25/

[6/21] Downloading: https://www.tradingview.com/script/YB39NHms-Daily-Range-Risk-Filter-by-nq-rew1nd/
   ✓ Gedownload: https://www.tradingview.com/script/YB39NHms-Daily-Range-Risk-Filter-by-nq-rew1nd/

[7/21] Downloading: https://www.tradingview.com/script/FBkkkUxy-Asia-Range-London-Breakouts-NY-Range/
   ✓ Gedownload: https://www.tradingview.com/script/FBkkkUxy-Asia-Range-London-Breakouts-NY-Range/

[8/21] Downloading: https://www.tradingview.com/script/PNS8tTkY-Target-Radar/
   ✓ Gedownload: https://www.tradingview.com/script/PNS8tTkY-Target-Radar/

[9/21] Downloading: https://www.tradingview.com/script/OeT4X3ux-Strat-Numbers-Daily-Weekly-and-Monthly-Levels-plus-50-Rule/
   ✓ Gedownload: https://www.tradingview.com/script/OeT4X3ux-Strat-Numbers-Daily-Weekly-and-Monthly-Levels-plus-50-Rule/

[10/21] Downloading: https://www.tradingview.com/script/FzuGS5N3-Ema200-Fractals-Dynamic-ORB-Zone/
   ✓ Gedownload: https://www.tradingview.com/script/FzuGS5N3-Ema200-Fractals-Dynamic-ORB-Zone/

[11/21] Downloading: https://www.tradingview.com/script/mQaM6RQ0-Option-Tracker/
   ✓ Gedownload: https://www.tradingview.com/script/mQaM6RQ0-Option-Tracker/

[12/21] Downloading: https://www.tradingview.com/script/yP9VsTfe/
   ✓ Gedownload: https://www.tradingview.com/script/yP9VsTfe/

[13/21] Downloading: https://www.tradingview.com/script/PQBNt8DJ-Auto-Lensed-MACD-Z-Score-v8-2/
   ✓ Gedownload: https://www.tradingview.com/script/PQBNt8DJ-Auto-Lensed-MACD-Z-Score-v8-2/

[14/21] Downloading: https://www.tradingview.com/script/vZ62NKZ7-Dual-Super-Trend-Indicator/
   ✓ Gedownload: https://www.tradingview.com/script/vZ62NKZ7-Dual-Super-Trend-Indicator/

[15/21] Downloading: https://www.tradingview.com/script/ckh4Wg4B/
   ✓ Gedownload: https://www.tradingview.com/script/ckh4Wg4B/

[16/21] Downloading: https://www.tradingview.com/script/dRuxhoAV-CPI-Strat-Points-Labels/
   ✓ Gedownload: https://www.tradingview.com/script/dRuxhoAV-CPI-Strat-Points-Labels/

[17/21] Downloading: https://www.tradingview.com/script/HSkndXUq-Lil-B-s-Time-based-Liquidity-IFVG-Alerts/
   ✓ Gedownload: https://www.tradingview.com/script/HSkndXUq-Lil-B-s-Time-based-Liquidity-IFVG-Alerts/

[18/21] Downloading: https://www.tradingview.com/script/oAYoTjuD-2-Bar-Strategy-Fib-Entry/
   ✓ Gedownload: https://www.tradingview.com/script/oAYoTjuD-2-Bar-Strategy-Fib-Entry/

[19/21] Downloading: https://www.tradingview.com/script/win6rVhs/
   ✓ Gedownload: https://www.tradingview.com/script/win6rVhs/

[20/21] Downloading: https://www.tradingview.com/script/jXqbVDxO-15m-BOS-OTE-FVG-OB-Prop-Firm/
   ✓ Gedownload: https://www.tradingview.com/script/jXqbVDxO-15m-BOS-OTE-FVG-OB-Prop-Firm/

[21/21] Downloading: https://www.tradingview.com/script/ihVmRHsZ/
   ✓ Gedownload: https://www.tradingview.com/script/ihVmRHsZ/

Bulk run summary:
  Succeeded: 20
  Skipped  : 0
  Failed   : 1

[1/24] Skipping (exists): https://www.tradingview.com/script/9VwS0ZXI-DafeLiquidityEngine/  - matched script id: 9VwS0ZXI

[2/24] Skipping (exists): https://www.tradingview.com/script/DTD7ZD8p-WClose/  - matched script id: DTD7ZD8p

[3/24] Skipping (exists): https://www.tradingview.com/script/sGHpPSWu-funy/  - matched script id: sGHpPSWu

[4/24] Skipping (exists): https://www.tradingview.com/script/pV79FBzj-StolenKernelFunctions/  - matched script id: pV79FBzj

[5/24] Skipping (exists): https://www.tradingview.com/script/rmwwDaok-DafeVIXEngine/  - matched script id: rmwwDaok

[6/24] Skipping (exists): https://www.tradingview.com/script/94IaCMvA-MovingAverages/  - matched script id: 94IaCMvA

[7/24] Skipping (exists): https://www.tradingview.com/script/f7cvFJjG-blueprint-ephemeris-lib/  - matched script id: f7cvFJjG

[8/24] Skipping (exists): https://www.tradingview.com/script/xaZ8g26p-DafePatternsLib/  - matched script id: xaZ8g26p

[9/24] Skipping (exists): https://www.tradingview.com/script/N8sTblk0-WickPressureLib/  - matched script id: N8sTblk0

[10/24] Skipping (exists): https://www.tradingview.com/script/gZ9i5E41-Damodaran-EV-EBIT/  - matched script id: gZ9i5E41

[11/24] Skipping (exists): https://www.tradingview.com/script/fvweK197-MyLibraryV1/  - matched script id: fvweK197

[12/24] Skipping (exists): https://www.tradingview.com/script/bwqcOb5i-DafeSPALib/  - matched script id: bwqcOb5i

[13/24] Skipping (exists): https://www.tradingview.com/script/bYCROfeE-UkutaLabs-General-library/  - matched script id: bYCROfeE

[14/24] Skipping (exists): https://www.tradingview.com/script/kCzMCBrT-DafeRLMLLib/  - matched script id: kCzMCBrT

[15/24] Skipping (exists): https://www.tradingview.com/script/WG1TMUbE-Deep-AI/  - matched script id: WG1TMUbE

[16/24] Skipping (exists): https://www.tradingview.com/script/E2O8LIzW/  - matched script id: E2O8LIzW

[17/24] Skipping (exists): https://www.tradingview.com/script/hDNV49KE-ATLAS-CORE/  - matched script id: hDNV49KE

[18/24] Skipping (exists): https://www.tradingview.com/script/TwJL6AIB-Better-Contrast-NTSC-Optimized/  - matched script id: TwJL6AIB

[19/24] Skipping (exists): https://www.tradingview.com/script/VT8BI9jl/  - matched script id: VT8BI9jl

[20/24] Skipping (exists): https://www.tradingview.com/script/Y77F2Ncw/  - matched script id: Y77F2Ncw

[21/24] Skipping (exists): https://www.tradingview.com/script/Sxmc9YZp/  - matched script id: Sxmc9YZp

[22/24] Skipping (exists): https://www.tradingview.com/script/efef4vVA/  - matched script id: efef4vVA

[23/24] Skipping (exists): https://www.tradingview.com/script/4j7MLW39/  - matched script id: 4j7MLW39

[24/24] Skipping (exists): https://www.tradingview.com/script/UevkUGHg/  - matched script id: UevkUGHg

Bulk run summary:
  Succeeded: 0
  Skipped  : 24
  Failed   : 0
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\strategies
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 05:25:53 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 05:25:53 GMT' as: 2026-02-09T05:25:53+00:00
[DEBUG] Exact published date for header: 2026-02-09T05:25:53+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/8bMOrrAB/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nstrategy(title="Stochastic RSI (K-D Candle Compressed) STRATEGY - signals on KD candle",\n     shorttitle="StochRSI KDc Strategy",\n     overlay=false,\n     pyramiding=0,\n     initial_capital=10000,\n     commission_type=strategy.commission.percent,\n     commission_value=0.0,\n     calc_on_order_fills=true,\n     process_orders_on_close=true)\n\n// ==== Inputs ====\nsmoothK      = input.int(3,  "K", minval=1)\nsmoothD      = input.int(3,  "D", minval=1)\nlengthRSI    = input.int(14, "RSI Length", minval=1)\nlengthStoch  = input.int(21, "Stochastic Length", minval=1)\nsrc          = input.source(close, "RSI Source")\ncompress     = input.float(0.70, "K-D Compress (0~1)", minval=0.0, maxval=1.0, step=0.05)\ndiffSmooth   = input.int(3, "K-D Extra Smooth (EMA)", minval=1)\n\nGRP = "Smoothing (from rsi-line)"\nTT_BB = "Only applies when \'SMA + Bollinger Bands\' is selected."\nmaTypeInput   = input.string("SMA", "Type", options = ["None", "SMA", "SMA + Bollinger Bands", "EMA", "SMMA (RMA)", "WMA", "VWMA"], group = GRP)\nmaLengthInput = input.int(14, "Length", group = GRP, minval=1, inline="ma")\nbbMultInput   = input.float(2.0, "BB StdDev", minval = 0.001, maxval = 50, step = 0.5, tooltip = TT_BB, group = GRP, inline="ma")\n\nqtyLots = input.float(0.1, "Order size (lots/contracts)", minval=0.0, step=0.1)\n\n// 风控（以账户货币USD计的盈亏金额）\nslUsd = input.float(10.0, "Stop Loss (USD)", minval=0.01, step=0.1)\ntpUsd = input.float(20.0, "Take Profit (USD)", minval=0.01, step=0.1)\n\n// 回测开始时间\nfromTime = input.time(timestamp("2026-01-01T00:00:00"), "Backtest from")\ninRange = time >= fromTime\n\n// ==== K/D ====\nrsi1 = ta.rsi(src, lengthRSI)\nk0   = ta.stoch(rsi1, rsi1, rsi1, lengthStoch)\nk    = ta.sma(k0, smoothK)\nd    = ta.sma(k,  smoothD)\n\n// ==== RSI + smoothing MA ====\nchange = ta.change(src)\nup     = ta.rma(math.max(change, 0), lengthRSI)\ndown   = ta.rma(-math.min(change, 0), lengthRSI)\nrsi    = down == 0 ? 100 : up == 0 ? 0 : 100 - (100 / (1 + up / down))\n\nma(source, length, MAtype) =>\n    switch MAtype\n        "SMA"                   => ta.sma(source, length)\n        "SMA + Bollinger Bands" => ta.sma(source, length)\n        "EMA"                   => ta.ema(source, length)\n        "SMMA (RMA)"            => ta.rma(source, length)\n        "WMA"                   => ta.wma(source, length)\n        "VWMA"                  => ta.vwma(source, length)\n        => na\n\nenableMA = maTypeInput != "None"\nisBB     = maTypeInput == "SMA + Bollinger Bands"\nsmoothingMA = enableMA ? ma(rsi, maLengthInput, maTypeInput) : na\n\nmid = na(smoothingMA) ? rsi : (rsi + smoothingMA) / 2.0\n\n// ==== Plots ====\nplot(rsi, "RSI", color=#7E57C2)\nplot(smoothingMA, "RSI MA", color=color.yellow)\n\nbbBasis = ta.sma(mid, maLengthInput)\nbbDev   = bbMultInput * ta.stdev(mid, maLengthInput)\nbbUpper = bbBasis + bbDev\nbbLower = bbBasis - bbDev\npBasis = plot(isBB ? bbBasis : na, title="BB Basis (mid)", color=color.new(color.yellow, 0))\npUpper = plot(isBB ? bbUpper : na, title="BB Upper (mid)", color=color.new(color.aqua, 0))\npLower = plot(isBB ? bbLower : na, title="BB Lower (mid)", color=color.new(color.aqua, 0))\nfill(pUpper, pLower, title="BB Fill (mid)", color=color.new(color.aqua, 85))\n\nh0 = hline(80, "Upper Band", color=#787B86)\nhline(50, "Middle Band", color=color.new(#787B86, 50))\nh1 = hline(20, "Lower Band", color=#787B86)\nfill(h0, h1, title="Background", color=color.rgb(33, 150, 243, 90))\nhline(70, "Level 70", color=color.new(#787B86, 0), linestyle=hline.style_dotted)\nhline(30, "Level 30", color=color.new(#787B86, 0), linestyle=hline.style_dotted)\n\n// ==== KD candle ====\ndiffRaw = (k - d) * compress\ndiffSm  = ta.ema(diffRaw, diffSmooth)\n\no  = mid - diffSm\nc  = mid + diffSm\nhi = math.max(o, c)\nlo = math.min(o, c)\n\ncol = diffSm >= 0 ? color.red : color.white\nplotcandle(o, hi, lo, c, title="K-D Candle", color=col, wickcolor=col, bordercolor=col)\n\n// ==== Signal logic ====\nisRed   = diffSm >= 0\nisWhite = diffSm < 0\n\nvar int whiteStreak = 0\nvar int redStreak   = 0\nwhiteStreak := isWhite ? nz(whiteStreak[1]) + 1 : 0\nredStreak   := isRed   ? nz(redStreak[1])   + 1 : 0\n\nbuySignal  = inRange and (mid < 45) and isRed   and (nz(whiteStreak[1]) >= 2)\nsellSignal = inRange and (mid > 55) and isWhite and (nz(redStreak[1])   >= 2)\n\nplotshape(buySignal,  title="Buy",  style=shape.triangleup,   location=location.bottom, color=color.lime, text="Buy",  size=size.tiny)\nplotshape(sellSignal, title="Sell", style=shape.triangledown, location=location.top,    color=color.red,  text="Sell", size=size.tiny)\n\n// ==== Exits: SL/TP in USD (profit/loss are in account currency) ====\nstrategy.exit("XL", from_entry="L", loss=slUsd, profit=tpUsd)\nstrategy.exit("XS", from_entry="S", loss=slUsd, profit=tpUsd)\n\n// ==== Cooldown after SL/TP: wait next signal ====\nposNow  = strategy.position_size\nposPrev = nz(strategy.position_size[1])\n\njustClosed = (posPrev != 0) and (posNow == 0)\n\n// 用净利润变化 + 刚刚平仓 近似判定是否为止盈/止损触发（平仓原因在 Pine 里拿不到精确标签）\nnetChg = strategy.netprofit - nz(strategy.netprofit[1])\nclosedBySLTP = justClosed  // 这里按“任何平仓”都进入冷却；最符合你说的“止损或止盈后等下一个吸纳”\n\nvar bool cooldown = false\nif closedBySLTP\n    cooldown := true\n\n// 下一次出现“吸纳信号”（buy 或 sell）时解除冷却（但在同一根上不立即二次下单）\nunlock = cooldown and (buySignal or sellSignal)\nif unlock\n    cooldown := false\n\n// ==== Entries: use signals as open/close; no immediate flip on same bar ====\ncanTrade = inRange and not cooldown\n\nif canTrade and buySignal\n    // 多单开仓，同时确保空单已平\n    if strategy.position_size < 0\n        strategy.close("S", comment="Close Short by BuySignal")\n    if strategy.position_size == 0\n        strategy.entry("L", strategy.long, qty=qtyLots, comment="Open Long")\n\nif canTrade and sellSignal\n    if strategy.position_size > 0\n        strategy.close("L", comment="Close Long by SellSignal")\n    if strategy.position_size == 0\n        strategy.entry("S", strategy.short, qty=qtyLots, comment="Open Short")\n\nalertcondition(buySignal,  title="Buy alert",  message="Buy: below 30, >=2 white then 1 red")\nalertcondition(sellSignal, title="Sell alert", message="Sell: above 70, >=2 red then 1 white")'
[CAPTURE 1] '//@version=6\nstrategy(title="Stochastic RSI (K-D Candle Compressed) STRATEGY - signals on KD candle",\n     shorttitle="StochRSI KDc Strategy",\n     overlay=false,\n     pyramiding=0,\n     initial_capital=10000,\n     commission_type=strategy.commission.percent,\n     commission_value=0.0,\n     calc_on_order_fills=true,\n     process_orders_on_close=true)\n\n// ==== Inputs ====\nsmoothK      = input.int(3,  "K", minval=1)\nsmoothD      = input.int(3,  "D", minval=1)\nlengthRSI    = input.int(14, "RSI Length", minval=1)\nlengthStoch  = input.int(21, "Stochastic Length", minval=1)\nsrc          = input.source(close, "RSI Source")\ncompress     = input.float(0.70, "K-D Compress (0~1)", minval=0.0, maxval=1.0, step=0.05)\ndiffSmooth   = input.int(3, "K-D Extra Smooth (EMA)", minval=1)\n\nGRP = "Smoothing (from rsi-line)"\nTT_BB = "Only applies when \'SMA + Bollinger Bands\' is selected."\nmaTypeInput   = input.string("SMA", "Type", options = ["None", "SMA", "SMA + Bollinger Bands", "EMA", "SMMA (RMA)", "WMA", "VWMA"], group = GRP)\nmaLengthInput = input.int(14, "Length", group = GRP, minval=1, inline="ma")\nbbMultInput   = input.float(2.0, "BB StdDev", minval = 0.001, maxval = 50, step = 0.5, tooltip = TT_BB, group = GRP, inline="ma")\n\nqtyLots = input.float(0.1, "Order size (lots/contracts)", minval=0.0, step=0.1)\n\n// 风控（以账户货币USD计的盈亏金额）\nslUsd = input.float(10.0, "Stop Loss (USD)", minval=0.01, step=0.1)\ntpUsd = input.float(20.0, "Take Profit (USD)", minval=0.01, step=0.1)\n\n// 回测开始时间\nfromTime = input.time(timestamp("2026-01-01T00:00:00"), "Backtest from")\ninRange = time >= fromTime\n\n// ==== K/D ====\nrsi1 = ta.rsi(src, lengthRSI)\nk0   = ta.stoch(rsi1, rsi1, rsi1, lengthStoch)\nk    = ta.sma(k0, smoothK)\nd    = ta.sma(k,  smoothD)\n\n// ==== RSI + smoothing MA ====\nchange = ta.change(src)\nup     = ta.rma(math.max(change, 0), lengthRSI)\ndown   = ta.rma(-math.min(change, 0), lengthRSI)\nrsi    = down == 0 ? 100 : up == 0 ? 0 : 100 - (100 / (1 + up / down))\n\nma(source, length, MAtype) =>\n    switch MAtype\n        "SMA"                   => ta.sma(source, length)\n        "SMA + Bollinger Bands" => ta.sma(source, length)\n        "EMA"                   => ta.ema(source, length)\n        "SMMA (RMA)"            => ta.rma(source, length)\n        "WMA"                   => ta.wma(source, length)\n        "VWMA"                  => ta.vwma(source, length)\n        => na\n\nenableMA = maTypeInput != "None"\nisBB     = maTypeInput == "SMA + Bollinger Bands"\nsmoothingMA = enableMA ? ma(rsi, maLengthInput, maTypeInput) : na\n\nmid = na(smoothingMA) ? rsi : (rsi + smoothingMA) / 2.0\n\n// ==== Plots ====\nplot(rsi, "RSI", color=#7E57C2)\nplot(smoothingMA, "RSI MA", color=color.yellow)\n\nbbBasis = ta.sma(mid, maLengthInput)\nbbDev   = bbMultInput * ta.stdev(mid, maLengthInput)\nbbUpper = bbBasis + bbDev\nbbLower = bbBasis - bbDev\npBasis = plot(isBB ? bbBasis : na, title="BB Basis (mid)", color=color.new(color.yellow, 0))\npUpper = plot(isBB ? bbUpper : na, title="BB Upper (mid)", color=color.new(color.aqua, 0))\npLower = plot(isBB ? bbLower : na, title="BB Lower (mid)", color=color.new(color.aqua, 0))\nfill(pUpper, pLower, title="BB Fill (mid)", color=color.new(color.aqua, 85))\n\nh0 = hline(80, "Upper Band", color=#787B86)\nhline(50, "Middle Band", color=color.new(#787B86, 50))\nh1 = hline(20, "Lower Band", color=#787B86)\nfill(h0, h1, title="Background", color=color.rgb(33, 150, 243, 90))\nhline(70, "Level 70", color=color.new(#787B86, 0), linestyle=hline.style_dotted)\nhline(30, "Level 30", color=color.new(#787B86, 0), linestyle=hline.style_dotted)\n\n// ==== KD candle ====\ndiffRaw = (k - d) * compress\ndiffSm  = ta.ema(diffRaw, diffSmooth)\n\no  = mid - diffSm\nc  = mid + diffSm\nhi = math.max(o, c)\nlo = math.min(o, c)\n\ncol = diffSm >= 0 ? color.red : color.white\nplotcandle(o, hi, lo, c, title="K-D Candle", color=col, wickcolor=col, bordercolor=col)\n\n// ==== Signal logic ====\nisRed   = diffSm >= 0\nisWhite = diffSm < 0\n\nvar int whiteStreak = 0\nvar int redStreak   = 0\nwhiteStreak := isWhite ? nz(whiteStreak[1]) + 1 : 0\nredStreak   := isRed   ? nz(redStreak[1])   + 1 : 0\n\nbuySignal  = inRange and (mid < 45) and isRed   and (nz(whiteStreak[1]) >= 2)\nsellSignal = inRange and (mid > 55) and isWhite and (nz(redStreak[1])   >= 2)\n\nplotshape(buySignal,  title="Buy",  style=shape.triangleup,   location=location.bottom, color=color.lime, text="Buy",  size=size.tiny)\nplotshape(sellSignal, title="Sell", style=shape.triangledown, location=location.top,    color=color.red,  text="Sell", size=size.tiny)\n\n// ==== Exits: SL/TP in USD (profit/loss are in account currency) ====\nstrategy.exit("XL", from_entry="L", loss=slUsd, profit=tpUsd)\nstrategy.exit("XS", from_entry="S", loss=slUsd, profit=tpUsd)\n\n// ==== Cooldown after SL/TP: wait next signal ====\nposNow  = strategy.position_size\nposPrev = nz(strategy.position_size[1])\n\njustClosed = (posPrev != 0) and (posNow == 0)\n\n// 用净利润变化 + 刚刚平仓 近似判定是否为止盈/止损触发（平仓原因在 Pine 里拿不到精确标签）\nnetChg = strategy.netprofit - nz(strategy.netprofit[1])\nclosedBySLTP = justClosed  // 这里按“任何平仓”都进入冷却；最符合你说的“止损或止盈后等下一个吸纳”\n\nvar bool cooldown = false\nif closedBySLTP\n    cooldown := true\n\n// 下一次出现“吸纳信号”（buy 或 sell）时解除冷却（但在同一根上不立即二次下单）\nunlock = cooldown and (buySignal or sellSignal)\nif unlock\n    cooldown := false\n\n// ==== Entries: use signals as open/close; no immediate flip on same bar ====\ncanTrade = inRange and not cooldown\n\nif canTrade and buySignal\n    // 多单开仓，同时确保空单已平\n    if strategy.position_size < 0\n        strategy.close("S", comment="Close Short by BuySignal")\n    if strategy.position_size == 0\n        strategy.entry("L", strategy.long, qty=qtyLots, comment="Open Long")\n\nif canTrade and sellSignal\n    if strategy.position_size > 0\n        strategy.close("L", comment="Close Long by SellSignal")\n    if strategy.position_size == 0\n        strategy.entry("S", strategy.short, qty=qtyLots, comment="Open Short")\n\nalertcondition(buySignal,  title="Buy alert",  message="Buy: below 30, >=2 white then 1 red")\nalertcondition(sellSignal, title="Sell alert", message="Sell: above 70, >=2 red then 1 white")'
[CAPTURE 2] '//@version=6\nstrategy(title="Stochastic RSI (K-D Candle Compressed) STRATEGY - signals on KD candle",\n     shorttitle="StochRSI KDc Strategy",\n     overlay=false,\n     pyramiding=0,\n     initial_capital=10000,\n     commission_type=strategy.commission.percent,\n     commission_value=0.0,\n     calc_on_order_fills=true,\n     process_orders_on_close=true)\n\n// ==== Inputs ====\nsmoothK      = input.int(3,  "K", minval=1)\nsmoothD      = input.int(3,  "D", minval=1)\nlengthRSI    = input.int(14, "RSI Length", minval=1)\nlengthStoch  = input.int(21, "Stochastic Length", minval=1)\nsrc          = input.source(close, "RSI Source")\ncompress     = input.float(0.70, "K-D Compress (0~1)", minval=0.0, maxval=1.0, step=0.05)\ndiffSmooth   = input.int(3, "K-D Extra Smooth (EMA)", minval=1)\n\nGRP = "Smoothing (from rsi-line)"\nTT_BB = "Only applies when \'SMA + Bollinger Bands\' is selected."\nmaTypeInput   = input.string("SMA", "Type", options = ["None", "SMA", "SMA + Bollinger Bands", "EMA", "SMMA (RMA)", "WMA", "VWMA"], group = GRP)\nmaLengthInput = input.int(14, "Length", group = GRP, minval=1, inline="ma")\nbbMultInput   = input.float(2.0, "BB StdDev", minval = 0.001, maxval = 50, step = 0.5, tooltip = TT_BB, group = GRP, inline="ma")\n\nqtyLots = input.float(0.1, "Order size (lots/contracts)", minval=0.0, step=0.1)\n\n// 风控（以账户货币USD计的盈亏金额）\nslUsd = input.float(10.0, "Stop Loss (USD)", minval=0.01, step=0.1)\ntpUsd = input.float(20.0, "Take Profit (USD)", minval=0.01, step=0.1)\n\n// 回测开始时间\nfromTime = input.time(timestamp("2026-01-01T00:00:00"), "Backtest from")\ninRange = time >= fromTime\n\n// ==== K/D ====\nrsi1 = ta.rsi(src, lengthRSI)\nk0   = ta.stoch(rsi1, rsi1, rsi1, lengthStoch)\nk    = ta.sma(k0, smoothK)\nd    = ta.sma(k,  smoothD)\n\n// ==== RSI + smoothing MA ====\nchange = ta.change(src)\nup     = ta.rma(math.max(change, 0), lengthRSI)\ndown   = ta.rma(-math.min(change, 0), lengthRSI)\nrsi    = down == 0 ? 100 : up == 0 ? 0 : 100 - (100 / (1 + up / down))\n\nma(source, length, MAtype) =>\n    switch MAtype\n        "SMA"                   => ta.sma(source, length)\n        "SMA + Bollinger Bands" => ta.sma(source, length)\n        "EMA"                   => ta.ema(source, length)\n        "SMMA (RMA)"            => ta.rma(source, length)\n        "WMA"                   => ta.wma(source, length)\n        "VWMA"                  => ta.vwma(source, length)\n        => na\n\nenableMA = maTypeInput != "None"\nisBB     = maTypeInput == "SMA + Bollinger Bands"\nsmoothingMA = enableMA ? ma(rsi, maLengthInput, maTypeInput) : na\n\nmid = na(smoothingMA) ? rsi : (rsi + smoothingMA) / 2.0\n\n// ==== Plots ====\nplot(rsi, "RSI", color=#7E57C2)\nplot(smoothingMA, "RSI MA", color=color.yellow)\n\nbbBasis = ta.sma(mid, maLengthInput)\nbbDev   = bbMultInput * ta.stdev(mid, maLengthInput)\nbbUpper = bbBasis + bbDev\nbbLower = bbBasis - bbDev\npBasis = plot(isBB ? bbBasis : na, title="BB Basis (mid)", color=color.new(color.yellow, 0))\npUpper = plot(isBB ? bbUpper : na, title="BB Upper (mid)", color=color.new(color.aqua, 0))\npLower = plot(isBB ? bbLower : na, title="BB Lower (mid)", color=color.new(color.aqua, 0))\nfill(pUpper, pLower, title="BB Fill (mid)", color=color.new(color.aqua, 85))\n\nh0 = hline(80, "Upper Band", color=#787B86)\nhline(50, "Middle Band", color=color.new(#787B86, 50))\nh1 = hline(20, "Lower Band", color=#787B86)\nfill(h0, h1, title="Background", color=color.rgb(33, 150, 243, 90))\nhline(70, "Level 70", color=color.new(#787B86, 0), linestyle=hline.style_dotted)\nhline(30, "Level 30", color=color.new(#787B86, 0), linestyle=hline.style_dotted)\n\n// ==== KD candle ====\ndiffRaw = (k - d) * compress\ndiffSm  = ta.ema(diffRaw, diffSmooth)\n\no  = mid - diffSm\nc  = mid + diffSm\nhi = math.max(o, c)\nlo = math.min(o, c)\n\ncol = diffSm >= 0 ? color.red : color.white\nplotcandle(o, hi, lo, c, title="K-D Candle", color=col, wickcolor=col, bordercolor=col)\n\n// ==== Signal logic ====\nisRed   = diffSm >= 0\nisWhite = diffSm < 0\n\nvar int whiteStreak = 0\nvar int redStreak   = 0\nwhiteStreak := isWhite ? nz(whiteStreak[1]) + 1 : 0\nredStreak   := isRed   ? nz(redStreak[1])   + 1 : 0\n\nbuySignal  = inRange and (mid < 45) and isRed   and (nz(whiteStreak[1]) >= 2)\nsellSignal = inRange and (mid > 55) and isWhite and (nz(redStreak[1])   >= 2)\n\nplotshape(buySignal,  title="Buy",  style=shape.triangleup,   location=location.bottom, color=color.lime, text="Buy",  size=size.tiny)\nplotshape(sellSignal, title="Sell", style=shape.triangledown, location=location.top,    color=color.red,  text="Sell", size=size.tiny)\n\n// ==== Exits: SL/TP in USD (profit/loss are in account currency) ====\nstrategy.exit("XL", from_entry="L", loss=slUsd, profit=tpUsd)\nstrategy.exit("XS", from_entry="S", loss=slUsd, profit=tpUsd)\n\n// ==== Cooldown after SL/TP: wait next signal ====\nposNow  = strategy.position_size\nposPrev = nz(strategy.position_size[1])\n\njustClosed = (posPrev != 0) and (posNow == 0)\n\n// 用净利润变化 + 刚刚平仓 近似判定是否为止盈/止损触发（平仓原因在 Pine 里拿不到精确标签）\nnetChg = strategy.netprofit - nz(strategy.netprofit[1])\nclosedBySLTP = justClosed  // 这里按“任何平仓”都进入冷却；最符合你说的“止损或止盈后等下一个吸纳”\n\nvar bool cooldown = false\nif closedBySLTP\n    cooldown := true\n\n// 下一次出现“吸纳信号”（buy 或 sell）时解除冷却（但在同一根上不立即二次下单）\nunlock = cooldown and (buySignal or sellSignal)\nif unlock\n    cooldown := false\n\n// ==== Entries: use signals as open/close; no immediate flip on same bar ====\ncanTrade = inRange and not cooldown\n\nif canTrade and buySignal\n    // 多单开仓，同时确保空单已平\n    if strategy.position_size < 0\n        strategy.close("S", comment="Close Short by BuySignal")\n    if strategy.position_size == 0\n        strategy.entry("L", strategy.long, qty=qtyLots, comment="Open Long")\n\nif canTrade and sellSignal\n    if strategy.position_size > 0\n        strategy.close("L", comment="Close Long by SellSignal")\n    if strategy.position_size == 0\n        strategy.entry("S", strategy.short, qty=qtyLots, comment="Open Short")\n\nalertcondition(buySignal,  title="Buy alert",  message="Buy: below 30, >=2 white then 1 red")\nalertcondition(sellSignal, title="Sell alert", message="Sell: above 70, >=2 red then 1 white")'
[DEBUG] save_script called: script_id=8bMOrrAB title=Stochastic RSI -Assisit category=8bMOrrAB force_flat=True
[DEBUG] Writing script to: pinescript_downloads\strategies\8bMOrrAB_Stochastic_RSI_-Assisit.pine
[DEBUG] Marker written to: pinescript_downloads\strategies\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\strategies\8bMOrrAB_Stochastic_RSI_-Assisit.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\strategies
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 02:59:57 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 02:59:57 GMT' as: 2026-02-09T02:59:57+00:00
[DEBUG] Exact published date for header: 2026-02-09T02:59:57+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/VfL2KrgA-ICT-Opening-Gap-Confirmed-Close-w-Breakeven/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\nstrategy("ICT Opening Gap - Confirmed Close w/ Breakeven", overlay = true, max_boxes_count = 500, margin_long = 100, margin_short = 100)\n\n//------------------------------------------------------------------------------\n// Settings\n//------------------------------------------------------------------------------\ngapType         = input.string(\'NDOG\', \'Gap Type\' , options = [\'NWOG\', \'NDOG\'])\nrequiredCrosses = input.int(3, "Crosses Required for Entry", minval = 1)\nexitTime        = input.string("1400", "Exit Time (NY Time)", tooltip = "Default 1400 (2 PM)")\n\ngroupTP = "Targets & Protection"\nuseTP           = input.bool(true, "Use Take Profit?", group = groupTP)\ntpTicks         = input.int(40, "Take Profit (Ticks)", minval = 1, group = groupTP)\nuseTrailing     = input.bool(true, "Use Trailing Stop?", group = groupTP)\ntrailTicks      = input.int(20, "Trailing Stop (Ticks)", minval = 1, group = groupTP)\n\ngroupBE = "Breakeven Logic"\nuseBE           = input.bool(true, "Use Breakeven?", group = groupBE)\nbeTrigger       = input.int(20, "BE Trigger (Ticks In Profit)", minval = 1, group = groupBE)\nbeOffset        = input.int(1, "BE Offset (Ticks above entry)", minval = 0, group = groupBE)\n\n//------------------------------------------------------------------------------\n// Gap Detection & State Tracking\n//------------------------------------------------------------------------------\nvar float gapTop = na\nvar float gapBtm = na\nvar int crossCount = 0\nvar bool tradeTakenToday = false\nvar int lastSide = 0 \n\nisNewDay = timeframe.change("D")\ntf = gapType == \'NWOG\' ? \'W\' : \'D\'\nisNewPeriod = timeframe.change(tf)\n\nif isNewDay\n    tradeTakenToday := false\n    crossCount := 0\n    lastSide := 0 \n\nif isNewPeriod\n    gapTop := math.max(close[1], open)\n    gapBtm := math.min(close[1], open)\n\n// Confirmed Close Cross Logic\ncurrentSide = close > gapTop ? 1 : close < gapBtm ? -1 : 0\nif not na(gapTop) and not tradeTakenToday\n    if currentSide != 0 and currentSide != lastSide\n        crossCount += 1\n        lastSide := currentSide\n\n//------------------------------------------------------------------------------\n// Entry Logic\n//------------------------------------------------------------------------------\ncanTrade = crossCount == requiredCrosses and not tradeTakenToday and strategy.position_size == 0\n\nif canTrade\n    if close > gapTop\n        strategy.entry("Long", strategy.long)\n        tradeTakenToday := true\n    else if close < gapBtm\n        strategy.entry("Short", strategy.short)\n        tradeTakenToday := true\n\n//------------------------------------------------------------------------------\n// Exit Logic\n//------------------------------------------------------------------------------\n// 1. Time-Based Exit\nexitHour   = math.floor(str.tonumber(exitTime) / 100)\nexitMinute = str.tonumber(exitTime) % 100\nisExitTime = hour(time, "America/New_York") == exitHour and minute(time, "America/New_York") == exitMinute\n\n// 2. Gap Stop Loss (Close on opposite side)\nstopLossLong  = strategy.position_size > 0 and close < gapBtm\nstopLossShort = strategy.position_size < 0 and close > gapTop\n\n// 3. Breakeven / TP / Trailing Logic\nif strategy.position_size != 0\n    float tpDist = useTP ? tpTicks * syminfo.mintick : na\n    float trailP = useTrailing ? trailTicks : na\n    \n    // Calculate Breakeven\n    if useBE\n        float beTriggerPrice = strategy.position_size > 0 ? \n             strategy.position_avg_price + (beTrigger * syminfo.mintick) : \n             strategy.position_avg_price - (beTrigger * syminfo.mintick)\n        \n        float bePrice = strategy.position_size > 0 ? \n             strategy.position_avg_price + (beOffset * syminfo.mintick) : \n             strategy.position_avg_price - (beOffset * syminfo.mintick)\n        \n        // If profit target for BE is hit, move stop to entry + offset\n        if (strategy.position_size > 0 and high >= beTriggerPrice) or (strategy.position_size < 0 and low <= beTriggerPrice)\n            strategy.exit("BE/Exit", stop = bePrice, limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n        else\n            strategy.exit("BE/Exit", limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n    else\n        strategy.exit("BE/Exit", limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n\n// Execution for Time and Gap Side Close\nif isExitTime or stopLossLong or stopLossShort\n    strategy.close_all("Exit Triggered")\n\n//------------------------------------------------------------------------------\n// Visuals\n//------------------------------------------------------------------------------\nplot(gapTop, "Gap Top", color=color.new(color.teal, 50), style=plot.style_linebr, linewidth = 2)\nplot(gapBtm, "Gap Bottom", color=color.new(color.orange, 50), style=plot.style_linebr, linewidth = 2)\n\nif not tradeTakenToday and not na(gapTop) and ta.change(crossCount)\n    label.new(bar_index, high, "Cross #" + str.tostring(crossCount), color=color.yellow, style=label.style_label_down, size=size.small)'
[CAPTURE 1] '//@version=5\nstrategy("ICT Opening Gap - Confirmed Close w/ Breakeven", overlay = true, max_boxes_count = 500, margin_long = 100, margin_short = 100)\n\n//------------------------------------------------------------------------------\n// Settings\n//------------------------------------------------------------------------------\ngapType         = input.string(\'NDOG\', \'Gap Type\' , options = [\'NWOG\', \'NDOG\'])\nrequiredCrosses = input.int(3, "Crosses Required for Entry", minval = 1)\nexitTime        = input.string("1400", "Exit Time (NY Time)", tooltip = "Default 1400 (2 PM)")\n\ngroupTP = "Targets & Protection"\nuseTP           = input.bool(true, "Use Take Profit?", group = groupTP)\ntpTicks         = input.int(40, "Take Profit (Ticks)", minval = 1, group = groupTP)\nuseTrailing     = input.bool(true, "Use Trailing Stop?", group = groupTP)\ntrailTicks      = input.int(20, "Trailing Stop (Ticks)", minval = 1, group = groupTP)\n\ngroupBE = "Breakeven Logic"\nuseBE           = input.bool(true, "Use Breakeven?", group = groupBE)\nbeTrigger       = input.int(20, "BE Trigger (Ticks In Profit)", minval = 1, group = groupBE)\nbeOffset        = input.int(1, "BE Offset (Ticks above entry)", minval = 0, group = groupBE)\n\n//------------------------------------------------------------------------------\n// Gap Detection & State Tracking\n//------------------------------------------------------------------------------\nvar float gapTop = na\nvar float gapBtm = na\nvar int crossCount = 0\nvar bool tradeTakenToday = false\nvar int lastSide = 0 \n\nisNewDay = timeframe.change("D")\ntf = gapType == \'NWOG\' ? \'W\' : \'D\'\nisNewPeriod = timeframe.change(tf)\n\nif isNewDay\n    tradeTakenToday := false\n    crossCount := 0\n    lastSide := 0 \n\nif isNewPeriod\n    gapTop := math.max(close[1], open)\n    gapBtm := math.min(close[1], open)\n\n// Confirmed Close Cross Logic\ncurrentSide = close > gapTop ? 1 : close < gapBtm ? -1 : 0\nif not na(gapTop) and not tradeTakenToday\n    if currentSide != 0 and currentSide != lastSide\n        crossCount += 1\n        lastSide := currentSide\n\n//------------------------------------------------------------------------------\n// Entry Logic\n//------------------------------------------------------------------------------\ncanTrade = crossCount == requiredCrosses and not tradeTakenToday and strategy.position_size == 0\n\nif canTrade\n    if close > gapTop\n        strategy.entry("Long", strategy.long)\n        tradeTakenToday := true\n    else if close < gapBtm\n        strategy.entry("Short", strategy.short)\n        tradeTakenToday := true\n\n//------------------------------------------------------------------------------\n// Exit Logic\n//------------------------------------------------------------------------------\n// 1. Time-Based Exit\nexitHour   = math.floor(str.tonumber(exitTime) / 100)\nexitMinute = str.tonumber(exitTime) % 100\nisExitTime = hour(time, "America/New_York") == exitHour and minute(time, "America/New_York") == exitMinute\n\n// 2. Gap Stop Loss (Close on opposite side)\nstopLossLong  = strategy.position_size > 0 and close < gapBtm\nstopLossShort = strategy.position_size < 0 and close > gapTop\n\n// 3. Breakeven / TP / Trailing Logic\nif strategy.position_size != 0\n    float tpDist = useTP ? tpTicks * syminfo.mintick : na\n    float trailP = useTrailing ? trailTicks : na\n    \n    // Calculate Breakeven\n    if useBE\n        float beTriggerPrice = strategy.position_size > 0 ? \n             strategy.position_avg_price + (beTrigger * syminfo.mintick) : \n             strategy.position_avg_price - (beTrigger * syminfo.mintick)\n        \n        float bePrice = strategy.position_size > 0 ? \n             strategy.position_avg_price + (beOffset * syminfo.mintick) : \n             strategy.position_avg_price - (beOffset * syminfo.mintick)\n        \n        // If profit target for BE is hit, move stop to entry + offset\n        if (strategy.position_size > 0 and high >= beTriggerPrice) or (strategy.position_size < 0 and low <= beTriggerPrice)\n            strategy.exit("BE/Exit", stop = bePrice, limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n        else\n            strategy.exit("BE/Exit", limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n    else\n        strategy.exit("BE/Exit", limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n\n// Execution for Time and Gap Side Close\nif isExitTime or stopLossLong or stopLossShort\n    strategy.close_all("Exit Triggered")\n\n//------------------------------------------------------------------------------\n// Visuals\n//------------------------------------------------------------------------------\nplot(gapTop, "Gap Top", color=color.new(color.teal, 50), style=plot.style_linebr, linewidth = 2)\nplot(gapBtm, "Gap Bottom", color=color.new(color.orange, 50), style=plot.style_linebr, linewidth = 2)\n\nif not tradeTakenToday and not na(gapTop) and ta.change(crossCount)\n    label.new(bar_index, high, "Cross #" + str.tostring(crossCount), color=color.yellow, style=label.style_label_down, size=size.small)'
[CAPTURE 2] '//@version=5\nstrategy("ICT Opening Gap - Confirmed Close w/ Breakeven", overlay = true, max_boxes_count = 500, margin_long = 100, margin_short = 100)\n\n//------------------------------------------------------------------------------\n// Settings\n//------------------------------------------------------------------------------\ngapType         = input.string(\'NDOG\', \'Gap Type\' , options = [\'NWOG\', \'NDOG\'])\nrequiredCrosses = input.int(3, "Crosses Required for Entry", minval = 1)\nexitTime        = input.string("1400", "Exit Time (NY Time)", tooltip = "Default 1400 (2 PM)")\n\ngroupTP = "Targets & Protection"\nuseTP           = input.bool(true, "Use Take Profit?", group = groupTP)\ntpTicks         = input.int(40, "Take Profit (Ticks)", minval = 1, group = groupTP)\nuseTrailing     = input.bool(true, "Use Trailing Stop?", group = groupTP)\ntrailTicks      = input.int(20, "Trailing Stop (Ticks)", minval = 1, group = groupTP)\n\ngroupBE = "Breakeven Logic"\nuseBE           = input.bool(true, "Use Breakeven?", group = groupBE)\nbeTrigger       = input.int(20, "BE Trigger (Ticks In Profit)", minval = 1, group = groupBE)\nbeOffset        = input.int(1, "BE Offset (Ticks above entry)", minval = 0, group = groupBE)\n\n//------------------------------------------------------------------------------\n// Gap Detection & State Tracking\n//------------------------------------------------------------------------------\nvar float gapTop = na\nvar float gapBtm = na\nvar int crossCount = 0\nvar bool tradeTakenToday = false\nvar int lastSide = 0 \n\nisNewDay = timeframe.change("D")\ntf = gapType == \'NWOG\' ? \'W\' : \'D\'\nisNewPeriod = timeframe.change(tf)\n\nif isNewDay\n    tradeTakenToday := false\n    crossCount := 0\n    lastSide := 0 \n\nif isNewPeriod\n    gapTop := math.max(close[1], open)\n    gapBtm := math.min(close[1], open)\n\n// Confirmed Close Cross Logic\ncurrentSide = close > gapTop ? 1 : close < gapBtm ? -1 : 0\nif not na(gapTop) and not tradeTakenToday\n    if currentSide != 0 and currentSide != lastSide\n        crossCount += 1\n        lastSide := currentSide\n\n//------------------------------------------------------------------------------\n// Entry Logic\n//------------------------------------------------------------------------------\ncanTrade = crossCount == requiredCrosses and not tradeTakenToday and strategy.position_size == 0\n\nif canTrade\n    if close > gapTop\n        strategy.entry("Long", strategy.long)\n        tradeTakenToday := true\n    else if close < gapBtm\n        strategy.entry("Short", strategy.short)\n        tradeTakenToday := true\n\n//------------------------------------------------------------------------------\n// Exit Logic\n//------------------------------------------------------------------------------\n// 1. Time-Based Exit\nexitHour   = math.floor(str.tonumber(exitTime) / 100)\nexitMinute = str.tonumber(exitTime) % 100\nisExitTime = hour(time, "America/New_York") == exitHour and minute(time, "America/New_York") == exitMinute\n\n// 2. Gap Stop Loss (Close on opposite side)\nstopLossLong  = strategy.position_size > 0 and close < gapBtm\nstopLossShort = strategy.position_size < 0 and close > gapTop\n\n// 3. Breakeven / TP / Trailing Logic\nif strategy.position_size != 0\n    float tpDist = useTP ? tpTicks * syminfo.mintick : na\n    float trailP = useTrailing ? trailTicks : na\n    \n    // Calculate Breakeven\n    if useBE\n        float beTriggerPrice = strategy.position_size > 0 ? \n             strategy.position_avg_price + (beTrigger * syminfo.mintick) : \n             strategy.position_avg_price - (beTrigger * syminfo.mintick)\n        \n        float bePrice = strategy.position_size > 0 ? \n             strategy.position_avg_price + (beOffset * syminfo.mintick) : \n             strategy.position_avg_price - (beOffset * syminfo.mintick)\n        \n        // If profit target for BE is hit, move stop to entry + offset\n        if (strategy.position_size > 0 and high >= beTriggerPrice) or (strategy.position_size < 0 and low <= beTriggerPrice)\n            strategy.exit("BE/Exit", stop = bePrice, limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n        else\n            strategy.exit("BE/Exit", limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n    else\n        strategy.exit("BE/Exit", limit = strategy.position_avg_price + (strategy.position_size > 0 ? tpDist : -tpDist), trail_points = trailP)\n\n// Execution for Time and Gap Side Close\nif isExitTime or stopLossLong or stopLossShort\n    strategy.close_all("Exit Triggered")\n\n//------------------------------------------------------------------------------\n// Visuals\n//------------------------------------------------------------------------------\nplot(gapTop, "Gap Top", color=color.new(color.teal, 50), style=plot.style_linebr, linewidth = 2)\nplot(gapBtm, "Gap Bottom", color=color.new(color.orange, 50), style=plot.style_linebr, linewidth = 2)\n\nif not tradeTakenToday and not na(gapTop) and ta.change(crossCount)\n    label.new(bar_index, high, "Cross #" + str.tostring(crossCount), color=color.yellow, style=label.style_label_down, size=size.small)'
[DEBUG] save_script called: script_id=VfL2KrgA title=ICT Opening Gap - Confirmed Close w/ Breakeven category=VfL2KrgA force_flat=True
[DEBUG] Writing script to: pinescript_downloads\strategies\VfL2KrgA_ICT_Opening_Gap_-_Confirmed_Close_w_Breakeven.pine
[DEBUG] Marker written to: pinescript_downloads\strategies\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\strategies\VfL2KrgA_ICT_Opening_Gap_-_Confirmed_Close_w_Breakeven.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\strategies
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 01:43:48 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 01:43:48 GMT' as: 2026-02-09T01:43:48+00:00
[DEBUG] Exact published date for header: 2026-02-09T01:43:48+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/0DLK91nb-XAUUSD-1-Minute-Scalping-Strategy-Advanced-Strategy-for-Exits/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\nstrategy("XAUUSD 1-Minute Scalping Strategy - FIXED Exits", overlay=true, \r\n         default_qty_type=strategy.fixed, default_qty_value=1, \r\n         initial_capital=1000000, currency=currency.USD)\r\n\r\n// ── Inputs ────────────────────────────────────────────────\r\nlength       = input.int(14, title="RSI Length")\r\noverbought   = input.int(70, title="Overbought Level")\r\noversold     = input.int(30, title="Oversold Level")\r\ntakeProfit   = input.int(10, title="Take Profit (pips)")\r\nstopLoss     = input.int(5,  title="Stop Loss (pips)")\r\n\r\nuse_trend_filter = input.bool(true, "Use 200 EMA Trend Filter (recommended)")\r\n\r\n// ── Calculations ──────────────────────────────────────────\r\nrsi    = ta.rsi(close, length)\r\nema200 = ta.ema(close, 200)\r\n\r\n// ── Entry Conditions ──────────────────────────────────────\r\nlongCondition  = rsi < oversold  and (not use_trend_filter or close > ema200)\r\nshortCondition = rsi > overbought and (not use_trend_filter or close < ema200)\r\n\r\n// ── Entries ───────────────────────────────────────────────\r\nif (longCondition and strategy.position_size == 0)\r\n    strategy.entry("Long", strategy.long)\r\n\r\nif (shortCondition and strategy.position_size == 0)\r\n    strategy.entry("Short", strategy.short)\r\n\r\n// ── FIXED TP/SL (set once at entry) ───────────────────────\r\nvar float long_tp_price  = na\r\nvar float long_sl_price  = na\r\nvar float short_tp_price = na\r\nvar float short_sl_price = na\r\n\r\n// Capture prices on the entry bar only\r\nif strategy.position_size > 0 and strategy.position_size[1] <= 0\r\n    long_tp_price  := close + takeProfit * syminfo.mintick\r\n    long_sl_price  := close - stopLoss  * syminfo.mintick\r\n\r\nif strategy.position_size < 0 and strategy.position_size[1] >= 0\r\n    short_tp_price := close - takeProfit * syminfo.mintick\r\n    short_sl_price := close + stopLoss  * syminfo.mintick\r\n\r\n// Place exits only once right after entry (prevents overwriting)\r\nif strategy.position_size > 0 and strategy.position_size[1] <= 0\r\n    strategy.exit("TP/SL Long", from_entry="Long", \r\n                  limit = long_tp_price, \r\n                  stop  = long_sl_price)\r\n\r\nif strategy.position_size < 0 and strategy.position_size[1] >= 0\r\n    strategy.exit("TP/SL Short", from_entry="Short", \r\n                  limit = short_tp_price, \r\n                  stop  = short_sl_price)\r\n\r\n// ── VISUALIZATION ─────────────────────────────────────────\r\nhline(overbought, "Overbought", color=color.new(color.red, 50), linestyle=hline.style_dashed, linewidth=2)\r\nhline(oversold,   "Oversold",   color=color.new(color.green, 50), linestyle=hline.style_dashed, linewidth=2)\r\nhline(50,         "Midline",    color=color.new(color.gray, 70),  linestyle=hline.style_dotted, linewidth=1)\r\n\r\nrsiPlot = plot(rsi, title="RSI", color=color.new(color.blue, 0), linewidth=2)\r\nfill(plot(50, display=display.none), rsiPlot, color=rsi > 50 ? color.new(color.blue, 90) : color.new(color.orange, 90), title="RSI Background")\r\n\r\nbgcolor(rsi > overbought ? color.new(color.red, 85) : rsi < oversold ? color.new(color.green, 85) : na, title="RSI Zones")\r\n\r\nplotshape(longCondition,  "Long Entry",  style=shape.triangleup,   location=location.belowbar, color=color.new(color.lime, 0), size=size.small, text="BUY",  textcolor=color.white)\r\nplotshape(shortCondition, "Short Entry", style=shape.triangledown, location=location.abovebar, color=color.new(color.red, 0),  size=size.small, text="SELL", textcolor=color.white)\r\n\r\n// ── PROFESSIONAL DASHBOARD ────────────────────────────────\r\nvar table dashboard = table.new(\r\n     position=position.top_right,\r\n     columns=2,\r\n     rows=11,\r\n     bgcolor=color.new(color.black, 30),\r\n     border_color=color.new(color.blue, 70),\r\n     border_width=2,\r\n     frame_color=color.new(color.blue, 70),\r\n     frame_width=2)\r\n\r\nif barstate.islast\r\n    // HEADER\r\n    table.cell(dashboard, 0, 0, "XAUUSD 1M SCALPER", \r\n               bgcolor=color.new(color.blue, 60), text_color=color.white, \r\n               text_size=size.large, text_halign=text.align_center)\r\n    table.merge_cells(dashboard, 0, 0, 1, 0)\r\n    \r\n    // NET PROFIT\r\n    table.cell(dashboard, 0, 1, "Net P&L", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    profitColor = strategy.netprofit > 0 ? color.new(color.green, 30) : color.new(color.red, 30)\r\n    profitTextColor = strategy.netprofit > 0 ? color.lime : color.red\r\n    table.cell(dashboard, 1, 1, "$" + str.tostring(strategy.netprofit, "#,##0.00"), \r\n               bgcolor=profitColor, text_color=profitTextColor, text_size=size.large, text_halign=text.align_right)\r\n    \r\n    // TOTAL TRADES\r\n    table.cell(dashboard, 0, 2, "Total Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 2, str.tostring(strategy.closedtrades), \r\n               text_color=color.white, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // WIN RATE\r\n    table.cell(dashboard, 0, 3, "Win Rate", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    winRate = strategy.closedtrades > 0 ? (strategy.wintrades / strategy.closedtrades) * 100 : 0\r\n    wrColor = winRate > 50 ? color.lime : winRate > 40 ? color.yellow : color.red\r\n    table.cell(dashboard, 1, 3, str.tostring(winRate, "#.##") + "%", \r\n               text_color=wrColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // PROFIT FACTOR\r\n    table.cell(dashboard, 0, 4, "Profit Factor", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    pf = strategy.grossloss != 0 ? math.abs(strategy.grossprofit / strategy.grossloss) : 0\r\n    pfColor = pf > 1.5 ? color.lime : pf > 1.0 ? color.yellow : color.red\r\n    table.cell(dashboard, 1, 4, str.tostring(pf, "#.##"), \r\n               text_color=pfColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // WINNING / LOSING TRADES\r\n    table.cell(dashboard, 0, 5, "Winning Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 5, str.tostring(strategy.wintrades), \r\n               text_color=color.lime, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    table.cell(dashboard, 0, 6, "Losing Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 6, str.tostring(strategy.losstrades), \r\n               text_color=color.red, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // CURRENT RSI\r\n    table.cell(dashboard, 0, 7, "Current RSI", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    rsiColor = rsi > overbought ? color.red : rsi < oversold ? color.lime : color.yellow\r\n    table.cell(dashboard, 1, 7, str.tostring(rsi, "#.##"), \r\n               text_color=rsiColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // POSITION STATUS\r\n    table.cell(dashboard, 0, 8, "Position", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    posText = strategy.position_size > 0 ? "LONG 📈" : strategy.position_size < 0 ? "SHORT 📉" : "FLAT ━"\r\n    posColor = strategy.position_size > 0 ? color.lime : strategy.position_size < 0 ? color.red : color.gray\r\n    table.cell(dashboard, 1, 8, posText, \r\n               text_color=posColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // RISK/REWARD\r\n    rrRatio = takeProfit / stopLoss\r\n    table.cell(dashboard, 0, 9, "TP/SL Ratio", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 9, "1:" + str.tostring(rrRatio, "#.#"), text_color=color.aqua, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // FOOTER\r\n    table.cell(dashboard, 0, 10, "IC Markets • v6 Fixed", bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=size.tiny, text_halign=text.align_center)\r\n    table.merge_cells(dashboard, 0, 10, 1, 10)\r\n\r\n// ── WEBHOOK ALERTS (STRATEGY-SAFE) ───────────────────────\r\n\r\n// BUY ALERT\r\nif longCondition and strategy.position_size == 0\r\n    alert(\r\n        "{\\n" +\r\n        "  \\"symbol\\": \\"XAUUSD\\",\\n" +\r\n        "  \\"quantity\\": 1,\\n" +\r\n        "  \\"action\\": \\"buy\\"\\n" +\r\n        "}",\r\n        alert.freq_once_per_bar_close\r\n    )\r\n\r\n// SELL ALERT\r\nif shortCondition and strategy.position_size == 0\r\n    alert(\r\n        "{\\n" +\r\n        "  \\"symbol\\": \\"XAUUSD\\",\\n" +\r\n        "  \\"quantity\\": 1,\\n" +\r\n        "  \\"action\\": \\"sell\\"\\n" +\r\n        "}",\r\n        alert.freq_once_per_bar_close\r\n    )\r\n'
[CAPTURE 1] '//@version=6\r\nstrategy("XAUUSD 1-Minute Scalping Strategy - FIXED Exits", overlay=true, \r\n         default_qty_type=strategy.fixed, default_qty_value=1, \r\n         initial_capital=1000000, currency=currency.USD)\r\n\r\n// ── Inputs ────────────────────────────────────────────────\r\nlength       = input.int(14, title="RSI Length")\r\noverbought   = input.int(70, title="Overbought Level")\r\noversold     = input.int(30, title="Oversold Level")\r\ntakeProfit   = input.int(10, title="Take Profit (pips)")\r\nstopLoss     = input.int(5,  title="Stop Loss (pips)")\r\n\r\nuse_trend_filter = input.bool(true, "Use 200 EMA Trend Filter (recommended)")\r\n\r\n// ── Calculations ──────────────────────────────────────────\r\nrsi    = ta.rsi(close, length)\r\nema200 = ta.ema(close, 200)\r\n\r\n// ── Entry Conditions ──────────────────────────────────────\r\nlongCondition  = rsi < oversold  and (not use_trend_filter or close > ema200)\r\nshortCondition = rsi > overbought and (not use_trend_filter or close < ema200)\r\n\r\n// ── Entries ───────────────────────────────────────────────\r\nif (longCondition and strategy.position_size == 0)\r\n    strategy.entry("Long", strategy.long)\r\n\r\nif (shortCondition and strategy.position_size == 0)\r\n    strategy.entry("Short", strategy.short)\r\n\r\n// ── FIXED TP/SL (set once at entry) ───────────────────────\r\nvar float long_tp_price  = na\r\nvar float long_sl_price  = na\r\nvar float short_tp_price = na\r\nvar float short_sl_price = na\r\n\r\n// Capture prices on the entry bar only\r\nif strategy.position_size > 0 and strategy.position_size[1] <= 0\r\n    long_tp_price  := close + takeProfit * syminfo.mintick\r\n    long_sl_price  := close - stopLoss  * syminfo.mintick\r\n\r\nif strategy.position_size < 0 and strategy.position_size[1] >= 0\r\n    short_tp_price := close - takeProfit * syminfo.mintick\r\n    short_sl_price := close + stopLoss  * syminfo.mintick\r\n\r\n// Place exits only once right after entry (prevents overwriting)\r\nif strategy.position_size > 0 and strategy.position_size[1] <= 0\r\n    strategy.exit("TP/SL Long", from_entry="Long", \r\n                  limit = long_tp_price, \r\n                  stop  = long_sl_price)\r\n\r\nif strategy.position_size < 0 and strategy.position_size[1] >= 0\r\n    strategy.exit("TP/SL Short", from_entry="Short", \r\n                  limit = short_tp_price, \r\n                  stop  = short_sl_price)\r\n\r\n// ── VISUALIZATION ─────────────────────────────────────────\r\nhline(overbought, "Overbought", color=color.new(color.red, 50), linestyle=hline.style_dashed, linewidth=2)\r\nhline(oversold,   "Oversold",   color=color.new(color.green, 50), linestyle=hline.style_dashed, linewidth=2)\r\nhline(50,         "Midline",    color=color.new(color.gray, 70),  linestyle=hline.style_dotted, linewidth=1)\r\n\r\nrsiPlot = plot(rsi, title="RSI", color=color.new(color.blue, 0), linewidth=2)\r\nfill(plot(50, display=display.none), rsiPlot, color=rsi > 50 ? color.new(color.blue, 90) : color.new(color.orange, 90), title="RSI Background")\r\n\r\nbgcolor(rsi > overbought ? color.new(color.red, 85) : rsi < oversold ? color.new(color.green, 85) : na, title="RSI Zones")\r\n\r\nplotshape(longCondition,  "Long Entry",  style=shape.triangleup,   location=location.belowbar, color=color.new(color.lime, 0), size=size.small, text="BUY",  textcolor=color.white)\r\nplotshape(shortCondition, "Short Entry", style=shape.triangledown, location=location.abovebar, color=color.new(color.red, 0),  size=size.small, text="SELL", textcolor=color.white)\r\n\r\n// ── PROFESSIONAL DASHBOARD ────────────────────────────────\r\nvar table dashboard = table.new(\r\n     position=position.top_right,\r\n     columns=2,\r\n     rows=11,\r\n     bgcolor=color.new(color.black, 30),\r\n     border_color=color.new(color.blue, 70),\r\n     border_width=2,\r\n     frame_color=color.new(color.blue, 70),\r\n     frame_width=2)\r\n\r\nif barstate.islast\r\n    // HEADER\r\n    table.cell(dashboard, 0, 0, "XAUUSD 1M SCALPER", \r\n               bgcolor=color.new(color.blue, 60), text_color=color.white, \r\n               text_size=size.large, text_halign=text.align_center)\r\n    table.merge_cells(dashboard, 0, 0, 1, 0)\r\n    \r\n    // NET PROFIT\r\n    table.cell(dashboard, 0, 1, "Net P&L", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    profitColor = strategy.netprofit > 0 ? color.new(color.green, 30) : color.new(color.red, 30)\r\n    profitTextColor = strategy.netprofit > 0 ? color.lime : color.red\r\n    table.cell(dashboard, 1, 1, "$" + str.tostring(strategy.netprofit, "#,##0.00"), \r\n               bgcolor=profitColor, text_color=profitTextColor, text_size=size.large, text_halign=text.align_right)\r\n    \r\n    // TOTAL TRADES\r\n    table.cell(dashboard, 0, 2, "Total Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 2, str.tostring(strategy.closedtrades), \r\n               text_color=color.white, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // WIN RATE\r\n    table.cell(dashboard, 0, 3, "Win Rate", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    winRate = strategy.closedtrades > 0 ? (strategy.wintrades / strategy.closedtrades) * 100 : 0\r\n    wrColor = winRate > 50 ? color.lime : winRate > 40 ? color.yellow : color.red\r\n    table.cell(dashboard, 1, 3, str.tostring(winRate, "#.##") + "%", \r\n               text_color=wrColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // PROFIT FACTOR\r\n    table.cell(dashboard, 0, 4, "Profit Factor", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    pf = strategy.grossloss != 0 ? math.abs(strategy.grossprofit / strategy.grossloss) : 0\r\n    pfColor = pf > 1.5 ? color.lime : pf > 1.0 ? color.yellow : color.red\r\n    table.cell(dashboard, 1, 4, str.tostring(pf, "#.##"), \r\n               text_color=pfColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // WINNING / LOSING TRADES\r\n    table.cell(dashboard, 0, 5, "Winning Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 5, str.tostring(strategy.wintrades), \r\n               text_color=color.lime, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    table.cell(dashboard, 0, 6, "Losing Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 6, str.tostring(strategy.losstrades), \r\n               text_color=color.red, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // CURRENT RSI\r\n    table.cell(dashboard, 0, 7, "Current RSI", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    rsiColor = rsi > overbought ? color.red : rsi < oversold ? color.lime : color.yellow\r\n    table.cell(dashboard, 1, 7, str.tostring(rsi, "#.##"), \r\n               text_color=rsiColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // POSITION STATUS\r\n    table.cell(dashboard, 0, 8, "Position", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    posText = strategy.position_size > 0 ? "LONG 📈" : strategy.position_size < 0 ? "SHORT 📉" : "FLAT ━"\r\n    posColor = strategy.position_size > 0 ? color.lime : strategy.position_size < 0 ? color.red : color.gray\r\n    table.cell(dashboard, 1, 8, posText, \r\n               text_color=posColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // RISK/REWARD\r\n    rrRatio = takeProfit / stopLoss\r\n    table.cell(dashboard, 0, 9, "TP/SL Ratio", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 9, "1:" + str.tostring(rrRatio, "#.#"), text_color=color.aqua, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // FOOTER\r\n    table.cell(dashboard, 0, 10, "IC Markets • v6 Fixed", bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=size.tiny, text_halign=text.align_center)\r\n    table.merge_cells(dashboard, 0, 10, 1, 10)\r\n\r\n// ── WEBHOOK ALERTS (STRATEGY-SAFE) ───────────────────────\r\n\r\n// BUY ALERT\r\nif longCondition and strategy.position_size == 0\r\n    alert(\r\n        "{\\n" +\r\n        "  \\"symbol\\": \\"XAUUSD\\",\\n" +\r\n        "  \\"quantity\\": 1,\\n" +\r\n        "  \\"action\\": \\"buy\\"\\n" +\r\n        "}",\r\n        alert.freq_once_per_bar_close\r\n    )\r\n\r\n// SELL ALERT\r\nif shortCondition and strategy.position_size == 0\r\n    alert(\r\n        "{\\n" +\r\n        "  \\"symbol\\": \\"XAUUSD\\",\\n" +\r\n        "  \\"quantity\\": 1,\\n" +\r\n        "  \\"action\\": \\"sell\\"\\n" +\r\n        "}",\r\n        alert.freq_once_per_bar_close\r\n    )\r\n'
[CAPTURE 2] '//@version=6\r\nstrategy("XAUUSD 1-Minute Scalping Strategy - FIXED Exits", overlay=true, \r\n         default_qty_type=strategy.fixed, default_qty_value=1, \r\n         initial_capital=1000000, currency=currency.USD)\r\n\r\n// ── Inputs ────────────────────────────────────────────────\r\nlength       = input.int(14, title="RSI Length")\r\noverbought   = input.int(70, title="Overbought Level")\r\noversold     = input.int(30, title="Oversold Level")\r\ntakeProfit   = input.int(10, title="Take Profit (pips)")\r\nstopLoss     = input.int(5,  title="Stop Loss (pips)")\r\n\r\nuse_trend_filter = input.bool(true, "Use 200 EMA Trend Filter (recommended)")\r\n\r\n// ── Calculations ──────────────────────────────────────────\r\nrsi    = ta.rsi(close, length)\r\nema200 = ta.ema(close, 200)\r\n\r\n// ── Entry Conditions ──────────────────────────────────────\r\nlongCondition  = rsi < oversold  and (not use_trend_filter or close > ema200)\r\nshortCondition = rsi > overbought and (not use_trend_filter or close < ema200)\r\n\r\n// ── Entries ───────────────────────────────────────────────\r\nif (longCondition and strategy.position_size == 0)\r\n    strategy.entry("Long", strategy.long)\r\n\r\nif (shortCondition and strategy.position_size == 0)\r\n    strategy.entry("Short", strategy.short)\r\n\r\n// ── FIXED TP/SL (set once at entry) ───────────────────────\r\nvar float long_tp_price  = na\r\nvar float long_sl_price  = na\r\nvar float short_tp_price = na\r\nvar float short_sl_price = na\r\n\r\n// Capture prices on the entry bar only\r\nif strategy.position_size > 0 and strategy.position_size[1] <= 0\r\n    long_tp_price  := close + takeProfit * syminfo.mintick\r\n    long_sl_price  := close - stopLoss  * syminfo.mintick\r\n\r\nif strategy.position_size < 0 and strategy.position_size[1] >= 0\r\n    short_tp_price := close - takeProfit * syminfo.mintick\r\n    short_sl_price := close + stopLoss  * syminfo.mintick\r\n\r\n// Place exits only once right after entry (prevents overwriting)\r\nif strategy.position_size > 0 and strategy.position_size[1] <= 0\r\n    strategy.exit("TP/SL Long", from_entry="Long", \r\n                  limit = long_tp_price, \r\n                  stop  = long_sl_price)\r\n\r\nif strategy.position_size < 0 and strategy.position_size[1] >= 0\r\n    strategy.exit("TP/SL Short", from_entry="Short", \r\n                  limit = short_tp_price, \r\n                  stop  = short_sl_price)\r\n\r\n// ── VISUALIZATION ─────────────────────────────────────────\r\nhline(overbought, "Overbought", color=color.new(color.red, 50), linestyle=hline.style_dashed, linewidth=2)\r\nhline(oversold,   "Oversold",   color=color.new(color.green, 50), linestyle=hline.style_dashed, linewidth=2)\r\nhline(50,         "Midline",    color=color.new(color.gray, 70),  linestyle=hline.style_dotted, linewidth=1)\r\n\r\nrsiPlot = plot(rsi, title="RSI", color=color.new(color.blue, 0), linewidth=2)\r\nfill(plot(50, display=display.none), rsiPlot, color=rsi > 50 ? color.new(color.blue, 90) : color.new(color.orange, 90), title="RSI Background")\r\n\r\nbgcolor(rsi > overbought ? color.new(color.red, 85) : rsi < oversold ? color.new(color.green, 85) : na, title="RSI Zones")\r\n\r\nplotshape(longCondition,  "Long Entry",  style=shape.triangleup,   location=location.belowbar, color=color.new(color.lime, 0), size=size.small, text="BUY",  textcolor=color.white)\r\nplotshape(shortCondition, "Short Entry", style=shape.triangledown, location=location.abovebar, color=color.new(color.red, 0),  size=size.small, text="SELL", textcolor=color.white)\r\n\r\n// ── PROFESSIONAL DASHBOARD ────────────────────────────────\r\nvar table dashboard = table.new(\r\n     position=position.top_right,\r\n     columns=2,\r\n     rows=11,\r\n     bgcolor=color.new(color.black, 30),\r\n     border_color=color.new(color.blue, 70),\r\n     border_width=2,\r\n     frame_color=color.new(color.blue, 70),\r\n     frame_width=2)\r\n\r\nif barstate.islast\r\n    // HEADER\r\n    table.cell(dashboard, 0, 0, "XAUUSD 1M SCALPER", \r\n               bgcolor=color.new(color.blue, 60), text_color=color.white, \r\n               text_size=size.large, text_halign=text.align_center)\r\n    table.merge_cells(dashboard, 0, 0, 1, 0)\r\n    \r\n    // NET PROFIT\r\n    table.cell(dashboard, 0, 1, "Net P&L", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    profitColor = strategy.netprofit > 0 ? color.new(color.green, 30) : color.new(color.red, 30)\r\n    profitTextColor = strategy.netprofit > 0 ? color.lime : color.red\r\n    table.cell(dashboard, 1, 1, "$" + str.tostring(strategy.netprofit, "#,##0.00"), \r\n               bgcolor=profitColor, text_color=profitTextColor, text_size=size.large, text_halign=text.align_right)\r\n    \r\n    // TOTAL TRADES\r\n    table.cell(dashboard, 0, 2, "Total Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 2, str.tostring(strategy.closedtrades), \r\n               text_color=color.white, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // WIN RATE\r\n    table.cell(dashboard, 0, 3, "Win Rate", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    winRate = strategy.closedtrades > 0 ? (strategy.wintrades / strategy.closedtrades) * 100 : 0\r\n    wrColor = winRate > 50 ? color.lime : winRate > 40 ? color.yellow : color.red\r\n    table.cell(dashboard, 1, 3, str.tostring(winRate, "#.##") + "%", \r\n               text_color=wrColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // PROFIT FACTOR\r\n    table.cell(dashboard, 0, 4, "Profit Factor", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    pf = strategy.grossloss != 0 ? math.abs(strategy.grossprofit / strategy.grossloss) : 0\r\n    pfColor = pf > 1.5 ? color.lime : pf > 1.0 ? color.yellow : color.red\r\n    table.cell(dashboard, 1, 4, str.tostring(pf, "#.##"), \r\n               text_color=pfColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // WINNING / LOSING TRADES\r\n    table.cell(dashboard, 0, 5, "Winning Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 5, str.tostring(strategy.wintrades), \r\n               text_color=color.lime, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    table.cell(dashboard, 0, 6, "Losing Trades", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 6, str.tostring(strategy.losstrades), \r\n               text_color=color.red, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // CURRENT RSI\r\n    table.cell(dashboard, 0, 7, "Current RSI", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    rsiColor = rsi > overbought ? color.red : rsi < oversold ? color.lime : color.yellow\r\n    table.cell(dashboard, 1, 7, str.tostring(rsi, "#.##"), \r\n               text_color=rsiColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // POSITION STATUS\r\n    table.cell(dashboard, 0, 8, "Position", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    posText = strategy.position_size > 0 ? "LONG 📈" : strategy.position_size < 0 ? "SHORT 📉" : "FLAT ━"\r\n    posColor = strategy.position_size > 0 ? color.lime : strategy.position_size < 0 ? color.red : color.gray\r\n    table.cell(dashboard, 1, 8, posText, \r\n               text_color=posColor, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // RISK/REWARD\r\n    rrRatio = takeProfit / stopLoss\r\n    table.cell(dashboard, 0, 9, "TP/SL Ratio", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.small)\r\n    table.cell(dashboard, 1, 9, "1:" + str.tostring(rrRatio, "#.#"), text_color=color.aqua, text_size=size.normal, text_halign=text.align_right)\r\n    \r\n    // FOOTER\r\n    table.cell(dashboard, 0, 10, "IC Markets • v6 Fixed", bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=size.tiny, text_halign=text.align_center)\r\n    table.merge_cells(dashboard, 0, 10, 1, 10)\r\n\r\n// ── WEBHOOK ALERTS (STRATEGY-SAFE) ───────────────────────\r\n\r\n// BUY ALERT\r\nif longCondition and strategy.position_size == 0\r\n    alert(\r\n        "{\\n" +\r\n        "  \\"symbol\\": \\"XAUUSD\\",\\n" +\r\n        "  \\"quantity\\": 1,\\n" +\r\n        "  \\"action\\": \\"buy\\"\\n" +\r\n        "}",\r\n        alert.freq_once_per_bar_close\r\n    )\r\n\r\n// SELL ALERT\r\nif shortCondition and strategy.position_size == 0\r\n    alert(\r\n        "{\\n" +\r\n        "  \\"symbol\\": \\"XAUUSD\\",\\n" +\r\n        "  \\"quantity\\": 1,\\n" +\r\n        "  \\"action\\": \\"sell\\"\\n" +\r\n        "}",\r\n        alert.freq_once_per_bar_close\r\n    )\r\n'
[DEBUG] save_script called: script_id=0DLK91nb title=XAUUSD 1-Minute Scalping Strategy - Advanced Strategy for Exits category=0DLK91nb force_flat=True
[DEBUG] Writing script to: pinescript_downloads\strategies\0DLK91nb_XAUUSD_1-Minute_Scalping_Strategy_-_Advanced_Strategy_for_Exits.pine
[DEBUG] Marker written to: pinescript_downloads\strategies\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\strategies\0DLK91nb_XAUUSD_1-Minute_Scalping_Strategy_-_Advanced_Strategy_for_Exits.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\strategies
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 23:51:55 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 23:51:55 GMT' as: 2026-02-08T23:51:55+00:00
[DEBUG] Exact published date for header: 2026-02-08T23:51:55+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/6jf55dTr-London-SR-Cleaner-WR-TP-0-20-BY-MANOLAS/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\nstrategy("London SR Cleaner WR (TP 0.20)", overlay=true, initial_capital=10000,\n     commission_type=strategy.commission.percent, commission_value=0.0)\n\n//===================== INPUTS =====================\nsessionInput     = input.session("1100-2000", "London Session (Athens UTC+2)")\nretestBars       = input.int(2, "Max bars to wait retest (sniper)", minval=1, maxval=10)\nwickBodyMult     = input.float(1.5, "Rejection: Wick > Body *", step=0.1)\n\ntpPct            = input.float(0.20, "TP % (target)", step=0.05)   // <<< 0.20%\nslBuffer         = input.float(0.3, "SL buffer (price units)", step=0.1)\n\nmaxTradesPerDay  = input.int(2, "Max trades/day", minval=1, maxval=10)\n\nemaLen           = input.int(200, "EMA Filter Length", minval=50, maxval=400)\natrLen           = input.int(14, "ATR Length", minval=5, maxval=50)\natrBreakMult     = input.float(0.06, "ATR Break Buffer", step=0.01)\natrCloseAwayMult = input.float(0.12, "ATR Close-away confirm", step=0.01)\n\n//===================== SESSION FLAGS =====================\ninSession = not na(time(timeframe.period, sessionInput))\n\n//===================== FILTERS =====================\nema200 = ta.ema(close, emaLen)\natr    = ta.atr(atrLen)\nplot(ema200, "EMA", color=color.new(color.blue, 0))\n\n//===================== PREVIOUS LONDON LEVELS (FIXED) =====================\nvar float sessHigh = na\nvar float sessLow  = na\nvar float prevHigh = na\nvar float prevLow  = na\n\nif inSession and not inSession[1]\n    prevHigh := sessHigh\n    prevLow  := sessLow\n    sessHigh := high\n    sessLow  := low\nelse if inSession\n    sessHigh := math.max(sessHigh, high)\n    sessLow  := math.min(sessLow, low)\n\nplot(prevHigh, "Prev London High (R)", color=color.red, linewidth=2)\nplot(prevLow,  "Prev London Low (S)",  color=color.green, linewidth=2)\n\n//===================== DAILY LIMIT + ONE TRADE PER LEVEL =====================\nvar int tradesToday = 0\nvar bool usedHighToday = false\nvar bool usedLowToday  = false\n\nif ta.change(time("D"))\n    tradesToday := 0\n    usedHighToday := false\n    usedLowToday  := false\n\ncanTrade = tradesToday < maxTradesPerDay\nflat = strategy.position_size == 0\n\n//===================== BREAK & CLOSE (WITH ATR BUFFER) =====================\nbreakUp = not na(prevHigh) and close > (prevHigh + atr * atrBreakMult) and close[1] <= prevHigh\nbreakDn = not na(prevLow)  and close < (prevLow  - atr * atrBreakMult) and close[1] >= prevLow\n\n//===================== WAIT FOR RETEST =====================\nvar bool waitRetestUp = false\nvar int  breakUpBar   = na\nvar bool waitRetestDn = false\nvar int  breakDnBar   = na\n\nif breakUp and not usedHighToday\n    waitRetestUp := true\n    breakUpBar := bar_index\n\nif breakDn and not usedLowToday\n    waitRetestDn := true\n    breakDnBar := bar_index\n\nif waitRetestUp and (bar_index - breakUpBar > retestBars)\n    waitRetestUp := false\n    breakUpBar := na\n\nif waitRetestDn and (bar_index - breakDnBar > retestBars)\n    waitRetestDn := false\n    breakDnBar := na\n\n// Retest touch\nretestTouchUp = waitRetestUp and low <= prevHigh\nretestTouchDn = waitRetestDn and high >= prevLow\n\n// Rejection strength\nupperWick = high - math.max(open, close)\nlowerWick = math.min(open, close) - low\nbodySize  = math.abs(close - open)\n\n// Close-away confirmation\ncloseAwayUp = close > (prevHigh + atr * atrCloseAwayMult)\ncloseAwayDn = close < (prevLow  - atr * atrCloseAwayMult)\n\n//===================== FINAL SIGNALS (CLOSE ENTRY) =====================\nbuySignal =\n     canTrade and flat and not usedHighToday and\n     retestTouchUp and\n     (close > open) and\n     (lowerWick > bodySize * wickBodyMult) and\n     closeAwayUp and\n     close > ema200\n\nsellSignal =\n     canTrade and flat and not usedLowToday and\n     retestTouchDn and\n     (close < open) and\n     (upperWick > bodySize * wickBodyMult) and\n     closeAwayDn and\n     close < ema200\n\nbuySL  = low  - slBuffer\nsellSL = high + slBuffer\n\nbuyTP  = close * (1.0 + tpPct/100.0)\nsellTP = close * (1.0 - tpPct/100.0)\n\n//===================== ORDERS + LABELS =====================\nif buySignal\n    tradesToday += 1\n    usedHighToday := true\n    waitRetestUp := false\n    breakUpBar := na\n    strategy.entry("BUY", strategy.long)\n    strategy.exit("BUY-EXIT", "BUY", stop=buySL, limit=buyTP)\n    label.new(bar_index, low, "BUY\\nEntry: " + str.tostring(close), style=label.style_label_up,\n         color=color.new(color.green, 0), textcolor=color.white)\n\nif sellSignal\n    tradesToday += 1\n    usedLowToday := true\n    waitRetestDn := false\n    breakDnBar := na\n    strategy.entry("SELL", strategy.short)\n    strategy.exit("SELL-EXIT", "SELL", stop=sellSL, limit=sellTP)\n    label.new(bar_index, high, "SELL\\nEntry: " + str.tostring(close), style=label.style_label_down,\n         color=color.new(color.red, 0), textcolor=color.white)\n'
[CAPTURE 1] '//@version=5\nstrategy("London SR Cleaner WR (TP 0.20)", overlay=true, initial_capital=10000,\n     commission_type=strategy.commission.percent, commission_value=0.0)\n\n//===================== INPUTS =====================\nsessionInput     = input.session("1100-2000", "London Session (Athens UTC+2)")\nretestBars       = input.int(2, "Max bars to wait retest (sniper)", minval=1, maxval=10)\nwickBodyMult     = input.float(1.5, "Rejection: Wick > Body *", step=0.1)\n\ntpPct            = input.float(0.20, "TP % (target)", step=0.05)   // <<< 0.20%\nslBuffer         = input.float(0.3, "SL buffer (price units)", step=0.1)\n\nmaxTradesPerDay  = input.int(2, "Max trades/day", minval=1, maxval=10)\n\nemaLen           = input.int(200, "EMA Filter Length", minval=50, maxval=400)\natrLen           = input.int(14, "ATR Length", minval=5, maxval=50)\natrBreakMult     = input.float(0.06, "ATR Break Buffer", step=0.01)\natrCloseAwayMult = input.float(0.12, "ATR Close-away confirm", step=0.01)\n\n//===================== SESSION FLAGS =====================\ninSession = not na(time(timeframe.period, sessionInput))\n\n//===================== FILTERS =====================\nema200 = ta.ema(close, emaLen)\natr    = ta.atr(atrLen)\nplot(ema200, "EMA", color=color.new(color.blue, 0))\n\n//===================== PREVIOUS LONDON LEVELS (FIXED) =====================\nvar float sessHigh = na\nvar float sessLow  = na\nvar float prevHigh = na\nvar float prevLow  = na\n\nif inSession and not inSession[1]\n    prevHigh := sessHigh\n    prevLow  := sessLow\n    sessHigh := high\n    sessLow  := low\nelse if inSession\n    sessHigh := math.max(sessHigh, high)\n    sessLow  := math.min(sessLow, low)\n\nplot(prevHigh, "Prev London High (R)", color=color.red, linewidth=2)\nplot(prevLow,  "Prev London Low (S)",  color=color.green, linewidth=2)\n\n//===================== DAILY LIMIT + ONE TRADE PER LEVEL =====================\nvar int tradesToday = 0\nvar bool usedHighToday = false\nvar bool usedLowToday  = false\n\nif ta.change(time("D"))\n    tradesToday := 0\n    usedHighToday := false\n    usedLowToday  := false\n\ncanTrade = tradesToday < maxTradesPerDay\nflat = strategy.position_size == 0\n\n//===================== BREAK & CLOSE (WITH ATR BUFFER) =====================\nbreakUp = not na(prevHigh) and close > (prevHigh + atr * atrBreakMult) and close[1] <= prevHigh\nbreakDn = not na(prevLow)  and close < (prevLow  - atr * atrBreakMult) and close[1] >= prevLow\n\n//===================== WAIT FOR RETEST =====================\nvar bool waitRetestUp = false\nvar int  breakUpBar   = na\nvar bool waitRetestDn = false\nvar int  breakDnBar   = na\n\nif breakUp and not usedHighToday\n    waitRetestUp := true\n    breakUpBar := bar_index\n\nif breakDn and not usedLowToday\n    waitRetestDn := true\n    breakDnBar := bar_index\n\nif waitRetestUp and (bar_index - breakUpBar > retestBars)\n    waitRetestUp := false\n    breakUpBar := na\n\nif waitRetestDn and (bar_index - breakDnBar > retestBars)\n    waitRetestDn := false\n    breakDnBar := na\n\n// Retest touch\nretestTouchUp = waitRetestUp and low <= prevHigh\nretestTouchDn = waitRetestDn and high >= prevLow\n\n// Rejection strength\nupperWick = high - math.max(open, close)\nlowerWick = math.min(open, close) - low\nbodySize  = math.abs(close - open)\n\n// Close-away confirmation\ncloseAwayUp = close > (prevHigh + atr * atrCloseAwayMult)\ncloseAwayDn = close < (prevLow  - atr * atrCloseAwayMult)\n\n//===================== FINAL SIGNALS (CLOSE ENTRY) =====================\nbuySignal =\n     canTrade and flat and not usedHighToday and\n     retestTouchUp and\n     (close > open) and\n     (lowerWick > bodySize * wickBodyMult) and\n     closeAwayUp and\n     close > ema200\n\nsellSignal =\n     canTrade and flat and not usedLowToday and\n     retestTouchDn and\n     (close < open) and\n     (upperWick > bodySize * wickBodyMult) and\n     closeAwayDn and\n     close < ema200\n\nbuySL  = low  - slBuffer\nsellSL = high + slBuffer\n\nbuyTP  = close * (1.0 + tpPct/100.0)\nsellTP = close * (1.0 - tpPct/100.0)\n\n//===================== ORDERS + LABELS =====================\nif buySignal\n    tradesToday += 1\n    usedHighToday := true\n    waitRetestUp := false\n    breakUpBar := na\n    strategy.entry("BUY", strategy.long)\n    strategy.exit("BUY-EXIT", "BUY", stop=buySL, limit=buyTP)\n    label.new(bar_index, low, "BUY\\nEntry: " + str.tostring(close), style=label.style_label_up,\n         color=color.new(color.green, 0), textcolor=color.white)\n\nif sellSignal\n    tradesToday += 1\n    usedLowToday := true\n    waitRetestDn := false\n    breakDnBar := na\n    strategy.entry("SELL", strategy.short)\n    strategy.exit("SELL-EXIT", "SELL", stop=sellSL, limit=sellTP)\n    label.new(bar_index, high, "SELL\\nEntry: " + str.tostring(close), style=label.style_label_down,\n         color=color.new(color.red, 0), textcolor=color.white)\n'
[CAPTURE 2] '//@version=5\nstrategy("London SR Cleaner WR (TP 0.20)", overlay=true, initial_capital=10000,\n     commission_type=strategy.commission.percent, commission_value=0.0)\n\n//===================== INPUTS =====================\nsessionInput     = input.session("1100-2000", "London Session (Athens UTC+2)")\nretestBars       = input.int(2, "Max bars to wait retest (sniper)", minval=1, maxval=10)\nwickBodyMult     = input.float(1.5, "Rejection: Wick > Body *", step=0.1)\n\ntpPct            = input.float(0.20, "TP % (target)", step=0.05)   // <<< 0.20%\nslBuffer         = input.float(0.3, "SL buffer (price units)", step=0.1)\n\nmaxTradesPerDay  = input.int(2, "Max trades/day", minval=1, maxval=10)\n\nemaLen           = input.int(200, "EMA Filter Length", minval=50, maxval=400)\natrLen           = input.int(14, "ATR Length", minval=5, maxval=50)\natrBreakMult     = input.float(0.06, "ATR Break Buffer", step=0.01)\natrCloseAwayMult = input.float(0.12, "ATR Close-away confirm", step=0.01)\n\n//===================== SESSION FLAGS =====================\ninSession = not na(time(timeframe.period, sessionInput))\n\n//===================== FILTERS =====================\nema200 = ta.ema(close, emaLen)\natr    = ta.atr(atrLen)\nplot(ema200, "EMA", color=color.new(color.blue, 0))\n\n//===================== PREVIOUS LONDON LEVELS (FIXED) =====================\nvar float sessHigh = na\nvar float sessLow  = na\nvar float prevHigh = na\nvar float prevLow  = na\n\nif inSession and not inSession[1]\n    prevHigh := sessHigh\n    prevLow  := sessLow\n    sessHigh := high\n    sessLow  := low\nelse if inSession\n    sessHigh := math.max(sessHigh, high)\n    sessLow  := math.min(sessLow, low)\n\nplot(prevHigh, "Prev London High (R)", color=color.red, linewidth=2)\nplot(prevLow,  "Prev London Low (S)",  color=color.green, linewidth=2)\n\n//===================== DAILY LIMIT + ONE TRADE PER LEVEL =====================\nvar int tradesToday = 0\nvar bool usedHighToday = false\nvar bool usedLowToday  = false\n\nif ta.change(time("D"))\n    tradesToday := 0\n    usedHighToday := false\n    usedLowToday  := false\n\ncanTrade = tradesToday < maxTradesPerDay\nflat = strategy.position_size == 0\n\n//===================== BREAK & CLOSE (WITH ATR BUFFER) =====================\nbreakUp = not na(prevHigh) and close > (prevHigh + atr * atrBreakMult) and close[1] <= prevHigh\nbreakDn = not na(prevLow)  and close < (prevLow  - atr * atrBreakMult) and close[1] >= prevLow\n\n//===================== WAIT FOR RETEST =====================\nvar bool waitRetestUp = false\nvar int  breakUpBar   = na\nvar bool waitRetestDn = false\nvar int  breakDnBar   = na\n\nif breakUp and not usedHighToday\n    waitRetestUp := true\n    breakUpBar := bar_index\n\nif breakDn and not usedLowToday\n    waitRetestDn := true\n    breakDnBar := bar_index\n\nif waitRetestUp and (bar_index - breakUpBar > retestBars)\n    waitRetestUp := false\n    breakUpBar := na\n\nif waitRetestDn and (bar_index - breakDnBar > retestBars)\n    waitRetestDn := false\n    breakDnBar := na\n\n// Retest touch\nretestTouchUp = waitRetestUp and low <= prevHigh\nretestTouchDn = waitRetestDn and high >= prevLow\n\n// Rejection strength\nupperWick = high - math.max(open, close)\nlowerWick = math.min(open, close) - low\nbodySize  = math.abs(close - open)\n\n// Close-away confirmation\ncloseAwayUp = close > (prevHigh + atr * atrCloseAwayMult)\ncloseAwayDn = close < (prevLow  - atr * atrCloseAwayMult)\n\n//===================== FINAL SIGNALS (CLOSE ENTRY) =====================\nbuySignal =\n     canTrade and flat and not usedHighToday and\n     retestTouchUp and\n     (close > open) and\n     (lowerWick > bodySize * wickBodyMult) and\n     closeAwayUp and\n     close > ema200\n\nsellSignal =\n     canTrade and flat and not usedLowToday and\n     retestTouchDn and\n     (close < open) and\n     (upperWick > bodySize * wickBodyMult) and\n     closeAwayDn and\n     close < ema200\n\nbuySL  = low  - slBuffer\nsellSL = high + slBuffer\n\nbuyTP  = close * (1.0 + tpPct/100.0)\nsellTP = close * (1.0 - tpPct/100.0)\n\n//===================== ORDERS + LABELS =====================\nif buySignal\n    tradesToday += 1\n    usedHighToday := true\n    waitRetestUp := false\n    breakUpBar := na\n    strategy.entry("BUY", strategy.long)\n    strategy.exit("BUY-EXIT", "BUY", stop=buySL, limit=buyTP)\n    label.new(bar_index, low, "BUY\\nEntry: " + str.tostring(close), style=label.style_label_up,\n         color=color.new(color.green, 0), textcolor=color.white)\n\nif sellSignal\n    tradesToday += 1\n    usedLowToday := true\n    waitRetestDn := false\n    breakDnBar := na\n    strategy.entry("SELL", strategy.short)\n    strategy.exit("SELL-EXIT", "SELL", stop=sellSL, limit=sellTP)\n    label.new(bar_index, high, "SELL\\nEntry: " + str.tostring(close), style=label.style_label_down,\n         color=color.new(color.red, 0), textcolor=color.white)\n'
[DEBUG] save_script called: script_id=6jf55dTr title=London SR Cleaner WR (TP 0.20) BY MANOLAS category=6jf55dTr force_flat=True
[DEBUG] Writing script to: pinescript_downloads\strategies\6jf55dTr_London_SR_Cleaner_WR_(TP_0.20)_BY_MANOLAS.pine
[DEBUG] Marker written to: pinescript_downloads\strategies\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\strategies\6jf55dTr_London_SR_Cleaner_WR_(TP_0.20)_BY_MANOLAS.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected

[1/24] Downloading: https://www.tradingview.com/script/8bMOrrAB/
   ✓ Gedownload: https://www.tradingview.com/script/8bMOrrAB/

[2/24] Downloading: https://www.tradingview.com/script/VfL2KrgA-ICT-Opening-Gap-Confirmed-Close-w-Breakeven/
   ✓ Gedownload: https://www.tradingview.com/script/VfL2KrgA-ICT-Opening-Gap-Confirmed-Close-w-Breakeven/

[3/24] Downloading: https://www.tradingview.com/script/0DLK91nb-XAUUSD-1-Minute-Scalping-Strategy-Advanced-Strategy-for-Exits/
   ✓ Gedownload: https://www.tradingview.com/script/0DLK91nb-XAUUSD-1-Minute-Scalping-Strategy-Advanced-Strategy-for-Exits/

[4/24] Downloading: https://www.tradingview.com/script/6jf55dTr-London-SR-Cleaner-WR-TP-0-20-BY-MANOLAS/
   ✓ Gedownload: https://www.tradingview.com/script/6jf55dTr-London-SR-Cleaner-WR-TP-0-20-BY-MANOLAS/

[5/24] Skipping (exists): https://www.tradingview.com/script/ZhJzjmAk-Crypto-Institutional-Liquidity-Sweep-Strategy/  - matched script id: ZhJzjmAk

[6/24] Skipping (exists): https://www.tradingview.com/script/CMNxymM9-Supertrend-Elite-Trend-System/  - matched script id: CMNxymM9

[7/24] Skipping (exists): https://www.tradingview.com/script/ZCaYuSbH-green-bull-strategy/  - matched script id: ZCaYuSbH

[8/24] Skipping (exists): https://www.tradingview.com/script/4IL50OPg/  - matched script id: 4IL50OPg

[9/24] Skipping (exists): https://www.tradingview.com/script/tE6a5fXq-Swing-Trade-Strategy/  - matched script id: tE6a5fXq

[10/24] Skipping (exists): https://www.tradingview.com/script/fWehf6Wa-Manoj-1/  - matched script id: fWehf6Wa

[11/24] Skipping (exists): https://www.tradingview.com/script/wuJcx1LW-manoj-1-by-asclepius/  - matched script id: wuJcx1LW

[12/24] Skipping (exists): https://www.tradingview.com/script/p7ht0y24-Heston-Multi-Slot-Periodicity/  - matched script id: p7ht0y24

[13/24] Skipping (exists): https://www.tradingview.com/script/iMidohXq-Squared9-Pro-v1/  - matched script id: iMidohXq

[14/24] Skipping (exists): https://www.tradingview.com/script/dzuBSwXS-15-min-orb/  - matched script id: dzuBSwXS

[15/24] Skipping (exists): https://www.tradingview.com/script/Sh13Snca-neural-edge-ai-4-tp-trailing/  - matched script id: Sh13Snca

[16/24] Skipping (exists): https://www.tradingview.com/script/EsLcfh7G-mutanabby-ai-5-tp-sl-breakeven-fill-based/  - matched script id: EsLcfh7G

[17/24] Skipping (exists): https://www.tradingview.com/script/cggrdM2y-MA-Stack-Trend-Strategy-No-Lookahead-Trailing-Stop/  - matched script id: cggrdM2y

[18/24] Skipping (exists): https://www.tradingview.com/script/UEgggqHF/  - matched script id: UEgggqHF

[19/24] Skipping (exists): https://www.tradingview.com/script/mUaXm2Sx-MASU-Institutional-The-Ultimate-Trading-Ecosystem/  - matched script id: mUaXm2Sx

[20/24] Skipping (exists): https://www.tradingview.com/script/K9dwfwgg-Master-ORB-Custom-TZ-TF-5m-15m-30m-60m/  - matched script id: K9dwfwgg

[21/24] Skipping (exists): https://www.tradingview.com/script/BE0VKAuz-Bollinger-Bands-EMA-Strategy/  - matched script id: BE0VKAuz

[22/24] Skipping (exists): https://www.tradingview.com/script/sv3TEYvW-SAl-VWAP-LITE/  - matched script id: sv3TEYvW

[23/24] Skipping (exists): https://www.tradingview.com/script/hSAW8NxA-BP-Strategy-Malisa/  - matched script id: hSAW8NxA

[24/24] Skipping (exists): https://www.tradingview.com/script/Xn4yJr9F-Anh-Nga-6-0-Split-Dynamic-MACD-PC/  - matched script id: Xn4yJr9F

Bulk run summary:
  Succeeded: 4
  Skipped  : 20
  Failed   : 0
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 02:57:17 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 02:57:17 GMT' as: 2026-02-09T02:57:17+00:00
[DEBUG] Exact published date for header: 2026-02-09T02:57:17+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/7bfbrEMT-TL5-Volume-Profile-Market-Structure-Volume-Distribution/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © AquaTickTrader\r\n\r\n//==================================================================================================\r\n//  [TL5 Volume Profile] Market Structure Volume Distribution (original by LuxAlgo – Modified by AquaTickTrader)\r\n//\r\n//  ⚠️ IMPORTANT – ATTRIBUTION & DISCLAIMER\r\n//  -----------------------------------------------------------------------------------------------\r\n//  This script is a MODIFIED version of the original\r\n//  "Market Structure Volume Distribution" indicator created by LuxAlgo.\r\n//\r\n//  • All core logic, calculations, and market structure methodology belong to LuxAlgo.\r\n//  • The volume calculation, pivot detection, BOS logic, and aggregation are UNCHANGED.\r\n//  • ONLY the visual communication of volume has been modified (layout, styling, alerts).\r\n//\r\n//  This version is shared for educational and experimental purposes only.\r\n//  This is NOT an official LuxAlgo release.\r\n//\r\n//===============================================================================================\r\n\r\n//@version=6\r\nindicator("[TL5 Volume Profile] Market Structure Volume Distribution (original by LuxAlgo – Modified by AquaTickTrader)", overlay = true, max_lines_count = 500, max_boxes_count = 200, max_bars_back = 5000)\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//CONSTANTS & STRINGS & INPUTS\r\n//---------------------------------------------------------------------------------------------------------------------{\r\nTOTAL_VOLUME    = \'TOTAL VOLUME\'\r\nBUY_SELL_VOLUME = \'BUY&SELL VOLUME\'\r\nBULLISH         = \'BULLISH\'\r\nBEARISH         = \'BEARISH\'\r\nGREEN           = #089981\r\nRED             = #F23645\r\n\r\nDATA_GROUP      = \'Data Gathering\'\r\nPROFILE_GROUP   = \'Profile\'\r\nSTYLE_GROUP     = \'Style\'\r\n\r\nexecutionVisualRangeTooltip = \'Activate this to use all visible bars on the calculations. This disables the use of the next parameter `Execute on the last N bars`. Default false.\'\r\nexecutionLastNBarsTooltip   = \'Use last N bars on the calculations. To use this parameter `Execute on all visible range` must be disabled. Values from 20 to 5000, default 500.\'\r\npivotLengthTooltip          = \'How many bars will be used to confirm a pivot. The bigger this parameter is the fewer breaks of structure will detect. Values from 1, default 2\'\r\nprofileSizeTooltip          = \'Number of rows in the volume profile. Values from 2 to 100, default 10.\'\r\nprofileWidthTooltip         = \'Maximum width of the volume profile. Values from 25 to 500, default 200.\'\r\nprofileModeTooltip          = \'How the volume will be displayed on each row. `TOTAL VOLUME` will aggregate buy & sell volume per row, `BUY&SELL VOLUME` will separate the buy volume from the sell volume on each row. Default BUY&SELL VOLUME\'\r\nbuyColorTooltip             = \'This is the color for the buy volume on the profile when the `BUY&SELL VOLUME` mode is activated. Default green.\'\r\nsellColorTooltip            = \'This is the color for the sell volume on the profile when the `BUY&SELL VOLUME` mode is activated. Default red.\'\r\nshowGridTooltip             = \'Show dotted inner grid levels. Default true.\'\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//Settings\r\n//---------------------------------------------------------------------------------------------------------------------{\r\nexecutionVisualRangeInput   = input.bool(   false,          \'Execute on all visible range\', group=DATA_GROUP,       tooltip = executionVisualRangeTooltip)\r\nexecutionLastNBarsInput     = input.int(    500,            \'Execute on the last N bars\',   group=DATA_GROUP,       tooltip = executionLastNBarsTooltip,    minval=20,  maxval=5000)\r\npivotLengthInput            = input.int(    2,              \'Pivot Length\',                 group=DATA_GROUP,       tooltip = pivotLengthTooltip,           minval=1)\r\nprofileSizeInput            = input.int(    20,             \'Profile Rows\',                 group=PROFILE_GROUP,    tooltip = profileSizeTooltip,           minval=2,   maxval=100)\r\nprofileWidthInput           = input.int(    25,            \'Profile Width\',                group=PROFILE_GROUP,    tooltip = profileWidthTooltip,          minval=25,  maxval=500, step=25)\r\nprofileModeInput            = input.string( BUY_SELL_VOLUME,\'Profile Mode\',                 group=PROFILE_GROUP,    tooltip = profileModeTooltip,           options=[TOTAL_VOLUME,BUY_SELL_VOLUME])\r\nbuyColorInput               = input.color(  GREEN,          \'Buy Color\',                    group=STYLE_GROUP,      tooltip = buyColorTooltip)\r\nsellColorInput              = input.color(  RED,            \'Sell Color\',                   group=STYLE_GROUP,      tooltip = sellColorTooltip)\r\nshowGridInput               = input.bool(   true,           \'Show dotted grid levels\',      group=STYLE_GROUP,      tooltip = showGridTooltip)\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//UDT\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @type                Storage UDT for pivot points\r\n// @field barIndex      Bar index of the privot point\r\n// @field priceLevel    Price level of the pivot point\r\ntype pivotPoint\r\n    int barIndex\r\n    float priceLevel\r\n\r\n// @type                    Storage UDT for breakouts (aka breaks of pivot points)\r\n// @field pivot             Broken pivot point\r\n// @field breakoutVolume    Volume of the breakout bar\r\n// @field bias              Bias can be BULLISH or BEARISH and is used to catalog the volume as buy or sell volume\r\n// @field row               Row in the volume profile where this breakout belongs\r\ntype breakout\r\n    pivotPoint pivot\r\n    float breakoutVolume\r\n    string bias\r\n    int row\r\n\r\n// @type                Storege UDT for the volume profile\r\n// @field sellVolume    Array for sell volume, each element represents one row of the profile\r\n// @field buyVolume     Array for buy volume, each element represents one row of the profile\r\n// @field totalVolume   Array for total volume, each element represents one row of the profile\r\ntype profile\r\n    array<float> sellVolume\r\n    array<float> buyVolume\r\n    array<float> totalVolume\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//USER-DEFINED FUNCTIONS\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @variable    Pivot point high: only the last pivot high is stored until it breaks or a new pivot high is found\r\nvar pivotPoint pivotHigh        = na\r\n// @variable    Pivot point low: only the last pivot low is stored until it breaks or a new pivot low is found\r\nvar pivotPoint pivotLow         = na\r\n// @variable    Collection of all breakouts (aka breaks of pivot points)\r\nvar array<breakout> breakouts   = array.new<breakout>(na)\r\n// @variable    Volume profile storage: contains 3 arrays for buy, sell and total volume\r\nvar profile volumeProfile       = profile.new(na,na,na)\r\n// @variable    Collection of lines representing the grid\r\nvar array<line> grid            = array.new<line>(profileSizeInput,na)\r\n// @variable    Top price in the execution window\r\nvar float executionTop          = 0\r\n// @variable    Bottom price in the execution window\r\nvar float executionBottom       = 0\r\n// @variable    Storage the previous value of executionWindow\r\nvar bool lastExecutionWindow    = false\r\n// @variable    Storage the bar_index of the first bar inside the execution window\r\nvar int firstExecutionBar       = 0\r\n\r\n// @function        Draw a new line from the pivot point to the current bar\r\n// @param point     (pivotPoint) Pivot point containing the starting bar and price level for the line\r\n// @param lineColor (series color) Color for the new line\r\n// @returns         New line ID\r\ndrawBreakLine(pivotPoint point,color lineColor) => line.new(point.barIndex,point.priceLevel,bar_index,point.priceLevel,color=lineColor, width = 1)\r\n\r\n// @function        Set for each breakout the correct row parameter (which row of the profile it belongs to)\r\n// @param top       (series float) Top price inside the execution window\r\n// @param bottom    (series float) Bottom price inside the execution window\r\n// @returns         Last row of the last breakout\r\nupdateBreakoutRows(float top, float bottom) =>\r\n    rowHeight = math.round_to_mintick((top - bottom) / profileSizeInput)\r\n    for eachBreakout in breakouts        \r\n        eachBreakout.row := math.min(int((top - eachBreakout.pivot.priceLevel)/rowHeight),profileSizeInput-1)\r\n\r\n// @function    Recreate the profile 3 volume arrays from the breakouts: buy, sell and total volume\r\n// @returns     void\r\nupdateProfileRows() =>    \r\n    volumeProfile.buyVolume     := array.new<float>(profileSizeInput,0)\r\n    volumeProfile.sellVolume    := array.new<float>(profileSizeInput,0)\r\n    volumeProfile.totalVolume   := array.new<float>(profileSizeInput,0)\r\n    \r\n    for eachBreakout in breakouts\r\n        array<float> selectedVolume = na\r\n\r\n        if eachBreakout.bias == BULLISH\r\n            selectedVolume := volumeProfile.buyVolume\r\n        else\r\n            selectedVolume := volumeProfile.sellVolume        \r\n\r\n        currentVolume = array.get(selectedVolume,eachBreakout.row)\r\n        array.set(selectedVolume,eachBreakout.row,currentVolume + eachBreakout.breakoutVolume)\r\n        array.set(volumeProfile.totalVolume,eachBreakout.row,array.get(volumeProfile.totalVolume,eachBreakout.row)+eachBreakout.breakoutVolume)\r\n\r\n// @function    Draw a line from `bar` to `last_bar_index + 10` at the specified level and style\r\n// @param bar   (series int) Starting bar for drawing the line\r\n// @param level (series float) Price level for drawing the line\r\n// @param style (series string) Style of the line\r\n// @returns     void\r\ndrawGridLine(int bar, float level,string style) => \r\n    startPoint  = chart.point.new(na,bar,level)\r\n    endPoint    = chart.point.new(na,last_bar_index + 10,level)\r\n    array.push(grid,line.new(startPoint,endPoint,color=chart.fg_color,style = style))\r\n\r\n// @function                        Draw a volume profile box with the specified parameters                      \r\n// @param top                       (float) Top price of the box\r\n// @param bottom                    (float) Bottom price of the box\r\n// @param rowVolume                 (float) Volume data that gives the width of the box and the text inside\r\n// @param backgroundColor           (color) Background color of the box\r\n// @param textHAlign                (string) Text horizontal align inside the box\r\n// @returns                         New box ID\r\ndrawProfileSimpleRow(float top, float bottom, int left,float rowVolume1, rowVolume,a,color backgroundColor = color.blue,string textHAlign = text.align_left) =>\r\n    boxWidth    = int((rowVolume * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n    topLeft     = chart.point.new(na,left,top)\r\n    bottomRight = chart.point.new(na,left + 12,bottom)            \r\n    box.new(topLeft,bottomRight,border_color = na,text = rowVolume > 0 ? str.tostring(rowVolume,format.volume) : na,bgcolor = a,text_color = chart.fg_color, text_size = size.normal,text_halign = textHAlign)\r\n\r\n// @function                        Draw 2 volume profile boxes with the specified parameters\r\n// @param top                       (float) Top price of the box\r\n// @param bottom                    (float) Bottom price of the box\r\n// @param middle                    (int) Middle bar index from where draw the boxes\r\n// @param buyVolume                 (float) Buy volume for the green box\r\n// @param sellVolume                (float) Sell volume for the red box\r\n// @returns                         New box ID\r\ndrawProfileDoubleRow(float top, float bottom, int middle, float buyVolume, float sellVolume) =>    \r\n    boxWidth    = int((sellVolume * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n    // drawProfileSimpleRow(top,bottom,bar_index + 2,totalVolume,color(na),text.align_left)\r\n    drawProfileSimpleRow(top,bottom,bar_index + 21,buyVolume, sellVolume,color.yellow,sellVolume>buyVolume?color.red:color.lime,text.align_left)\r\n    drawProfileSimpleRow(top,bottom,bar_index + 31,sellVolume, buyVolume, color.white,sellVolume>buyVolume?color.red:color.lime,text.align_left)\r\n\r\n// @function        Draw the grid and the volume profile\r\n// @param top       (series float) Top price inside the execution window\r\n// @param bottom    (series float) Bottom price inside the execution window\r\n// @param firstBar  (series int) First bar inside the execution window\r\n// @returns         Last drawn box ID\r\ndrawFullProfile(float top, float bottom,int firstBar) =>\r\n    updateBreakoutRows(top,bottom)\r\n    updateProfileRows()\r\n\r\n    for eachBox in box.all\r\n        box.delete(eachBox)\r\n\r\n    for eachLine in grid\r\n        line.delete(eachLine)\r\n\r\n    rowHeight = math.round_to_mintick((top - bottom) / profileSizeInput)\r\n    rowGap = math.max(math.round_to_mintick(rowHeight/10),syminfo.mintick)\r\n    \r\n    leftIndex = last_bar_index + 10\r\n    middleIndex = leftIndex + int((array.max(volumeProfile.sellVolume) * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n\r\n    // draw top solid grid line            \r\n    drawGridLine(firstBar,top,line.style_dashed)                   \r\n\r\n    for index = 0 to profileSizeInput - 1\r\n        rowTop = top - index * rowHeight - rowGap\r\n        rowBottom = (index == (profileSizeInput - 1) ? bottom : rowTop - rowHeight + rowGap) + rowGap\r\n\r\n        if showGridInput and index > 0\r\n            drawGridLine(firstBar,rowTop+rowGap,line.style_dotted)        \r\n\r\n        if profileModeInput != TOTAL_VOLUME\r\n            drawProfileSimpleRow(rowTop,rowBottom,leftIndex,array.get(volumeProfile.totalVolume,index), array.get(volumeProfile.totalVolume,index), array.get(volumeProfile.buyVolume,index)>array.get(volumeProfile.sellVolume,index)?color.lime:array.get(volumeProfile.buyVolume,index)<array.get(volumeProfile.sellVolume,index)?color.red:color.gray)            \r\n            drawProfileDoubleRow(rowTop,rowBottom,leftIndex,array.get(volumeProfile.buyVolume,index),array.get(volumeProfile.sellVolume,index))            \r\n    // draw bottom grid line            \r\n    drawGridLine(firstBar,bottom,line.style_dashed)                   \r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//MUTABLE VARIABLES & EXECUTION\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @variable Storage for possible pivot high on current bar\r\ncurrentPivotHigh        = ta.pivothigh(pivotLengthInput,pivotLengthInput)\r\n// @variable Storage for possible pivot low on current bar\r\ncurrentPivotLow         = ta.pivotlow(pivotLengthInput,pivotLengthInput)\r\n// @variable Calculate if current bar is inside execution window\r\ncurrentExecutionWindow  = executionVisualRangeInput ? time >= chart.left_visible_bar_time : (last_bar_index - bar_index) <= executionLastNBarsInput\r\n// @variable bar_index of possible pivot point\r\npivotBarIndex           = bar_index[pivotLengthInput]\r\n\r\n// check if we are inside execution window\r\nif currentExecutionWindow\r\n    \r\n    // check if this is the first bar inside execution window\r\n    if not lastExecutionWindow    \r\n        executionTop        := high\r\n        executionBottom     := low\r\n        firstExecutionBar   := bar_index    \r\n\r\n    lastExecutionWindow := currentExecutionWindow    \r\n   \r\n    // we execute this logic only once per bar \r\n    var line a = na\r\n    var line b = na\r\n    var line a1 = na\r\n    var line b1 = na\r\n    if barstate.isconfirmed\r\n        if low <= executionBottom\r\n            line.delete(a)\r\n            line.delete(a1)\r\n            alert("Execution Low Detected", alert.freq_once_per_bar)\r\n            a := line.new(bar_index, close, bar_index + 1, close, width = 4, extend = extend.right, color = color.black)\r\n            a1 := line.new(bar_index, low, bar_index + 1, low, width = 2, extend = extend.right, color = color.black)\r\n        if high >= executionTop\r\n            line.delete(b)\r\n            line.delete(b1)\r\n            alert("Execution High Detected", alert.freq_once_per_bar)\r\n            b := line.new(bar_index, close, bar_index + 1, close, width = 4, extend = extend.right, color = color.black)\r\n            b1 := line.new(bar_index, high, bar_index + 1, high, width = 2, extend = extend.right, color = color.black)\r\n        // Here we are throwing a custom error with the `runtime.error` built-in function\r\n        // Why this is necessary? To avoid runtime enviroment throwing an error when it tries to create a new line with a x1 parameter (bar_index) bigger than the max buffer of 5000\r\n        // this will happen when `executionVisualRangeInput` is `true` and the user drags the screen several times to show more past bars until the limit is reached and throws our custom error        \r\n        if (last_bar_index - firstExecutionBar) > 5000\r\n            runtime.error(\'Execution windows bigger than 5000 bars are not allowed. Please use a smaller execution window.\')\r\n\r\n        // update of top and bottom prices inside execution window\r\n        executionTop    := math.max(high,executionTop)\r\n        executionBottom := math.min(low,executionBottom)\r\n        \r\n        // if we identify a pivot high, we store it into `pivotHigh` variable\r\n        if not na(currentPivotHigh)\r\n            pivotHigh := pivotPoint.new(pivotBarIndex,currentPivotHigh)\r\n\r\n        // if we identify a pivot low, we store it into `pivotLow` variable\r\n        if not na(currentPivotLow)\r\n            pivotLow := pivotPoint.new(pivotBarIndex,currentPivotLow)\r\n\r\n        // if we have a pivotHigh and a break of its level, we store the breakout and draw the line\r\n        if not na(pivotHigh) \r\n            if close > pivotHigh.priceLevel            \r\n                array.push(breakouts,breakout.new(pivotHigh,volume,BULLISH))                \r\n                drawBreakLine(pivotHigh,buyColorInput)        \r\n                pivotHigh := na \r\n                alert("haha", alert.freq_once_per_bar)               \r\n\r\n        // if we have a pivotLow and a break of its level, we store the breakout and draw the line\r\n        if not na(pivotLow)\r\n            if close < pivotLow.priceLevel           \r\n                array.push(breakouts,breakout.new(pivotLow,volume,BEARISH))                \r\n                drawBreakLine(pivotLow,sellColorInput)\r\n                pivotLow := na\r\n                alert("lala", alert.freq_once_per_bar)                \r\n                \r\n        // Coding trick: avoid the use of drawings like `line` or `box` on unnecesary bars, just plot them on the last bar to smooth script execution\r\n        if barstate.islastconfirmedhistory or barstate.isrealtime\r\n\r\n            // Another custom error, this one is to prevent drawing grid (lines) and profile (boxes) when there is no breaks of structure,\r\n            // this will happen when the user sets a big pivotLengthInput and a small executionLastNBarsInput\r\n            if array.size(breakouts) == 0\r\n                runtime.error(\'No breaks of structure detected. Please modify `Data Gathering` parameters on the settings window. Ex. smaller `Pivot Length` and/or bigger execution window\')\r\n\r\n            // we draw both the grid and the volume profile\r\n            drawFullProfile(executionTop,executionBottom,firstExecutionBar)           \r\n            \r\n//---------------------------------------------------------------------------------------------------------------------}\r\n\r\n'
[CAPTURE 1] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © AquaTickTrader\r\n\r\n//==================================================================================================\r\n//  [TL5 Volume Profile] Market Structure Volume Distribution (original by LuxAlgo – Modified by AquaTickTrader)\r\n//\r\n//  ⚠️ IMPORTANT – ATTRIBUTION & DISCLAIMER\r\n//  -----------------------------------------------------------------------------------------------\r\n//  This script is a MODIFIED version of the original\r\n//  "Market Structure Volume Distribution" indicator created by LuxAlgo.\r\n//\r\n//  • All core logic, calculations, and market structure methodology belong to LuxAlgo.\r\n//  • The volume calculation, pivot detection, BOS logic, and aggregation are UNCHANGED.\r\n//  • ONLY the visual communication of volume has been modified (layout, styling, alerts).\r\n//\r\n//  This version is shared for educational and experimental purposes only.\r\n//  This is NOT an official LuxAlgo release.\r\n//\r\n//===============================================================================================\r\n\r\n//@version=6\r\nindicator("[TL5 Volume Profile] Market Structure Volume Distribution (original by LuxAlgo – Modified by AquaTickTrader)", overlay = true, max_lines_count = 500, max_boxes_count = 200, max_bars_back = 5000)\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//CONSTANTS & STRINGS & INPUTS\r\n//---------------------------------------------------------------------------------------------------------------------{\r\nTOTAL_VOLUME    = \'TOTAL VOLUME\'\r\nBUY_SELL_VOLUME = \'BUY&SELL VOLUME\'\r\nBULLISH         = \'BULLISH\'\r\nBEARISH         = \'BEARISH\'\r\nGREEN           = #089981\r\nRED             = #F23645\r\n\r\nDATA_GROUP      = \'Data Gathering\'\r\nPROFILE_GROUP   = \'Profile\'\r\nSTYLE_GROUP     = \'Style\'\r\n\r\nexecutionVisualRangeTooltip = \'Activate this to use all visible bars on the calculations. This disables the use of the next parameter `Execute on the last N bars`. Default false.\'\r\nexecutionLastNBarsTooltip   = \'Use last N bars on the calculations. To use this parameter `Execute on all visible range` must be disabled. Values from 20 to 5000, default 500.\'\r\npivotLengthTooltip          = \'How many bars will be used to confirm a pivot. The bigger this parameter is the fewer breaks of structure will detect. Values from 1, default 2\'\r\nprofileSizeTooltip          = \'Number of rows in the volume profile. Values from 2 to 100, default 10.\'\r\nprofileWidthTooltip         = \'Maximum width of the volume profile. Values from 25 to 500, default 200.\'\r\nprofileModeTooltip          = \'How the volume will be displayed on each row. `TOTAL VOLUME` will aggregate buy & sell volume per row, `BUY&SELL VOLUME` will separate the buy volume from the sell volume on each row. Default BUY&SELL VOLUME\'\r\nbuyColorTooltip             = \'This is the color for the buy volume on the profile when the `BUY&SELL VOLUME` mode is activated. Default green.\'\r\nsellColorTooltip            = \'This is the color for the sell volume on the profile when the `BUY&SELL VOLUME` mode is activated. Default red.\'\r\nshowGridTooltip             = \'Show dotted inner grid levels. Default true.\'\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//Settings\r\n//---------------------------------------------------------------------------------------------------------------------{\r\nexecutionVisualRangeInput   = input.bool(   false,          \'Execute on all visible range\', group=DATA_GROUP,       tooltip = executionVisualRangeTooltip)\r\nexecutionLastNBarsInput     = input.int(    500,            \'Execute on the last N bars\',   group=DATA_GROUP,       tooltip = executionLastNBarsTooltip,    minval=20,  maxval=5000)\r\npivotLengthInput            = input.int(    2,              \'Pivot Length\',                 group=DATA_GROUP,       tooltip = pivotLengthTooltip,           minval=1)\r\nprofileSizeInput            = input.int(    20,             \'Profile Rows\',                 group=PROFILE_GROUP,    tooltip = profileSizeTooltip,           minval=2,   maxval=100)\r\nprofileWidthInput           = input.int(    25,            \'Profile Width\',                group=PROFILE_GROUP,    tooltip = profileWidthTooltip,          minval=25,  maxval=500, step=25)\r\nprofileModeInput            = input.string( BUY_SELL_VOLUME,\'Profile Mode\',                 group=PROFILE_GROUP,    tooltip = profileModeTooltip,           options=[TOTAL_VOLUME,BUY_SELL_VOLUME])\r\nbuyColorInput               = input.color(  GREEN,          \'Buy Color\',                    group=STYLE_GROUP,      tooltip = buyColorTooltip)\r\nsellColorInput              = input.color(  RED,            \'Sell Color\',                   group=STYLE_GROUP,      tooltip = sellColorTooltip)\r\nshowGridInput               = input.bool(   true,           \'Show dotted grid levels\',      group=STYLE_GROUP,      tooltip = showGridTooltip)\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//UDT\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @type                Storage UDT for pivot points\r\n// @field barIndex      Bar index of the privot point\r\n// @field priceLevel    Price level of the pivot point\r\ntype pivotPoint\r\n    int barIndex\r\n    float priceLevel\r\n\r\n// @type                    Storage UDT for breakouts (aka breaks of pivot points)\r\n// @field pivot             Broken pivot point\r\n// @field breakoutVolume    Volume of the breakout bar\r\n// @field bias              Bias can be BULLISH or BEARISH and is used to catalog the volume as buy or sell volume\r\n// @field row               Row in the volume profile where this breakout belongs\r\ntype breakout\r\n    pivotPoint pivot\r\n    float breakoutVolume\r\n    string bias\r\n    int row\r\n\r\n// @type                Storege UDT for the volume profile\r\n// @field sellVolume    Array for sell volume, each element represents one row of the profile\r\n// @field buyVolume     Array for buy volume, each element represents one row of the profile\r\n// @field totalVolume   Array for total volume, each element represents one row of the profile\r\ntype profile\r\n    array<float> sellVolume\r\n    array<float> buyVolume\r\n    array<float> totalVolume\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//USER-DEFINED FUNCTIONS\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @variable    Pivot point high: only the last pivot high is stored until it breaks or a new pivot high is found\r\nvar pivotPoint pivotHigh        = na\r\n// @variable    Pivot point low: only the last pivot low is stored until it breaks or a new pivot low is found\r\nvar pivotPoint pivotLow         = na\r\n// @variable    Collection of all breakouts (aka breaks of pivot points)\r\nvar array<breakout> breakouts   = array.new<breakout>(na)\r\n// @variable    Volume profile storage: contains 3 arrays for buy, sell and total volume\r\nvar profile volumeProfile       = profile.new(na,na,na)\r\n// @variable    Collection of lines representing the grid\r\nvar array<line> grid            = array.new<line>(profileSizeInput,na)\r\n// @variable    Top price in the execution window\r\nvar float executionTop          = 0\r\n// @variable    Bottom price in the execution window\r\nvar float executionBottom       = 0\r\n// @variable    Storage the previous value of executionWindow\r\nvar bool lastExecutionWindow    = false\r\n// @variable    Storage the bar_index of the first bar inside the execution window\r\nvar int firstExecutionBar       = 0\r\n\r\n// @function        Draw a new line from the pivot point to the current bar\r\n// @param point     (pivotPoint) Pivot point containing the starting bar and price level for the line\r\n// @param lineColor (series color) Color for the new line\r\n// @returns         New line ID\r\ndrawBreakLine(pivotPoint point,color lineColor) => line.new(point.barIndex,point.priceLevel,bar_index,point.priceLevel,color=lineColor, width = 1)\r\n\r\n// @function        Set for each breakout the correct row parameter (which row of the profile it belongs to)\r\n// @param top       (series float) Top price inside the execution window\r\n// @param bottom    (series float) Bottom price inside the execution window\r\n// @returns         Last row of the last breakout\r\nupdateBreakoutRows(float top, float bottom) =>\r\n    rowHeight = math.round_to_mintick((top - bottom) / profileSizeInput)\r\n    for eachBreakout in breakouts        \r\n        eachBreakout.row := math.min(int((top - eachBreakout.pivot.priceLevel)/rowHeight),profileSizeInput-1)\r\n\r\n// @function    Recreate the profile 3 volume arrays from the breakouts: buy, sell and total volume\r\n// @returns     void\r\nupdateProfileRows() =>    \r\n    volumeProfile.buyVolume     := array.new<float>(profileSizeInput,0)\r\n    volumeProfile.sellVolume    := array.new<float>(profileSizeInput,0)\r\n    volumeProfile.totalVolume   := array.new<float>(profileSizeInput,0)\r\n    \r\n    for eachBreakout in breakouts\r\n        array<float> selectedVolume = na\r\n\r\n        if eachBreakout.bias == BULLISH\r\n            selectedVolume := volumeProfile.buyVolume\r\n        else\r\n            selectedVolume := volumeProfile.sellVolume        \r\n\r\n        currentVolume = array.get(selectedVolume,eachBreakout.row)\r\n        array.set(selectedVolume,eachBreakout.row,currentVolume + eachBreakout.breakoutVolume)\r\n        array.set(volumeProfile.totalVolume,eachBreakout.row,array.get(volumeProfile.totalVolume,eachBreakout.row)+eachBreakout.breakoutVolume)\r\n\r\n// @function    Draw a line from `bar` to `last_bar_index + 10` at the specified level and style\r\n// @param bar   (series int) Starting bar for drawing the line\r\n// @param level (series float) Price level for drawing the line\r\n// @param style (series string) Style of the line\r\n// @returns     void\r\ndrawGridLine(int bar, float level,string style) => \r\n    startPoint  = chart.point.new(na,bar,level)\r\n    endPoint    = chart.point.new(na,last_bar_index + 10,level)\r\n    array.push(grid,line.new(startPoint,endPoint,color=chart.fg_color,style = style))\r\n\r\n// @function                        Draw a volume profile box with the specified parameters                      \r\n// @param top                       (float) Top price of the box\r\n// @param bottom                    (float) Bottom price of the box\r\n// @param rowVolume                 (float) Volume data that gives the width of the box and the text inside\r\n// @param backgroundColor           (color) Background color of the box\r\n// @param textHAlign                (string) Text horizontal align inside the box\r\n// @returns                         New box ID\r\ndrawProfileSimpleRow(float top, float bottom, int left,float rowVolume1, rowVolume,a,color backgroundColor = color.blue,string textHAlign = text.align_left) =>\r\n    boxWidth    = int((rowVolume * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n    topLeft     = chart.point.new(na,left,top)\r\n    bottomRight = chart.point.new(na,left + 12,bottom)            \r\n    box.new(topLeft,bottomRight,border_color = na,text = rowVolume > 0 ? str.tostring(rowVolume,format.volume) : na,bgcolor = a,text_color = chart.fg_color, text_size = size.normal,text_halign = textHAlign)\r\n\r\n// @function                        Draw 2 volume profile boxes with the specified parameters\r\n// @param top                       (float) Top price of the box\r\n// @param bottom                    (float) Bottom price of the box\r\n// @param middle                    (int) Middle bar index from where draw the boxes\r\n// @param buyVolume                 (float) Buy volume for the green box\r\n// @param sellVolume                (float) Sell volume for the red box\r\n// @returns                         New box ID\r\ndrawProfileDoubleRow(float top, float bottom, int middle, float buyVolume, float sellVolume) =>    \r\n    boxWidth    = int((sellVolume * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n    // drawProfileSimpleRow(top,bottom,bar_index + 2,totalVolume,color(na),text.align_left)\r\n    drawProfileSimpleRow(top,bottom,bar_index + 21,buyVolume, sellVolume,color.yellow,sellVolume>buyVolume?color.red:color.lime,text.align_left)\r\n    drawProfileSimpleRow(top,bottom,bar_index + 31,sellVolume, buyVolume, color.white,sellVolume>buyVolume?color.red:color.lime,text.align_left)\r\n\r\n// @function        Draw the grid and the volume profile\r\n// @param top       (series float) Top price inside the execution window\r\n// @param bottom    (series float) Bottom price inside the execution window\r\n// @param firstBar  (series int) First bar inside the execution window\r\n// @returns         Last drawn box ID\r\ndrawFullProfile(float top, float bottom,int firstBar) =>\r\n    updateBreakoutRows(top,bottom)\r\n    updateProfileRows()\r\n\r\n    for eachBox in box.all\r\n        box.delete(eachBox)\r\n\r\n    for eachLine in grid\r\n        line.delete(eachLine)\r\n\r\n    rowHeight = math.round_to_mintick((top - bottom) / profileSizeInput)\r\n    rowGap = math.max(math.round_to_mintick(rowHeight/10),syminfo.mintick)\r\n    \r\n    leftIndex = last_bar_index + 10\r\n    middleIndex = leftIndex + int((array.max(volumeProfile.sellVolume) * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n\r\n    // draw top solid grid line            \r\n    drawGridLine(firstBar,top,line.style_dashed)                   \r\n\r\n    for index = 0 to profileSizeInput - 1\r\n        rowTop = top - index * rowHeight - rowGap\r\n        rowBottom = (index == (profileSizeInput - 1) ? bottom : rowTop - rowHeight + rowGap) + rowGap\r\n\r\n        if showGridInput and index > 0\r\n            drawGridLine(firstBar,rowTop+rowGap,line.style_dotted)        \r\n\r\n        if profileModeInput != TOTAL_VOLUME\r\n            drawProfileSimpleRow(rowTop,rowBottom,leftIndex,array.get(volumeProfile.totalVolume,index), array.get(volumeProfile.totalVolume,index), array.get(volumeProfile.buyVolume,index)>array.get(volumeProfile.sellVolume,index)?color.lime:array.get(volumeProfile.buyVolume,index)<array.get(volumeProfile.sellVolume,index)?color.red:color.gray)            \r\n            drawProfileDoubleRow(rowTop,rowBottom,leftIndex,array.get(volumeProfile.buyVolume,index),array.get(volumeProfile.sellVolume,index))            \r\n    // draw bottom grid line            \r\n    drawGridLine(firstBar,bottom,line.style_dashed)                   \r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//MUTABLE VARIABLES & EXECUTION\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @variable Storage for possible pivot high on current bar\r\ncurrentPivotHigh        = ta.pivothigh(pivotLengthInput,pivotLengthInput)\r\n// @variable Storage for possible pivot low on current bar\r\ncurrentPivotLow         = ta.pivotlow(pivotLengthInput,pivotLengthInput)\r\n// @variable Calculate if current bar is inside execution window\r\ncurrentExecutionWindow  = executionVisualRangeInput ? time >= chart.left_visible_bar_time : (last_bar_index - bar_index) <= executionLastNBarsInput\r\n// @variable bar_index of possible pivot point\r\npivotBarIndex           = bar_index[pivotLengthInput]\r\n\r\n// check if we are inside execution window\r\nif currentExecutionWindow\r\n    \r\n    // check if this is the first bar inside execution window\r\n    if not lastExecutionWindow    \r\n        executionTop        := high\r\n        executionBottom     := low\r\n        firstExecutionBar   := bar_index    \r\n\r\n    lastExecutionWindow := currentExecutionWindow    \r\n   \r\n    // we execute this logic only once per bar \r\n    var line a = na\r\n    var line b = na\r\n    var line a1 = na\r\n    var line b1 = na\r\n    if barstate.isconfirmed\r\n        if low <= executionBottom\r\n            line.delete(a)\r\n            line.delete(a1)\r\n            alert("Execution Low Detected", alert.freq_once_per_bar)\r\n            a := line.new(bar_index, close, bar_index + 1, close, width = 4, extend = extend.right, color = color.black)\r\n            a1 := line.new(bar_index, low, bar_index + 1, low, width = 2, extend = extend.right, color = color.black)\r\n        if high >= executionTop\r\n            line.delete(b)\r\n            line.delete(b1)\r\n            alert("Execution High Detected", alert.freq_once_per_bar)\r\n            b := line.new(bar_index, close, bar_index + 1, close, width = 4, extend = extend.right, color = color.black)\r\n            b1 := line.new(bar_index, high, bar_index + 1, high, width = 2, extend = extend.right, color = color.black)\r\n        // Here we are throwing a custom error with the `runtime.error` built-in function\r\n        // Why this is necessary? To avoid runtime enviroment throwing an error when it tries to create a new line with a x1 parameter (bar_index) bigger than the max buffer of 5000\r\n        // this will happen when `executionVisualRangeInput` is `true` and the user drags the screen several times to show more past bars until the limit is reached and throws our custom error        \r\n        if (last_bar_index - firstExecutionBar) > 5000\r\n            runtime.error(\'Execution windows bigger than 5000 bars are not allowed. Please use a smaller execution window.\')\r\n\r\n        // update of top and bottom prices inside execution window\r\n        executionTop    := math.max(high,executionTop)\r\n        executionBottom := math.min(low,executionBottom)\r\n        \r\n        // if we identify a pivot high, we store it into `pivotHigh` variable\r\n        if not na(currentPivotHigh)\r\n            pivotHigh := pivotPoint.new(pivotBarIndex,currentPivotHigh)\r\n\r\n        // if we identify a pivot low, we store it into `pivotLow` variable\r\n        if not na(currentPivotLow)\r\n            pivotLow := pivotPoint.new(pivotBarIndex,currentPivotLow)\r\n\r\n        // if we have a pivotHigh and a break of its level, we store the breakout and draw the line\r\n        if not na(pivotHigh) \r\n            if close > pivotHigh.priceLevel            \r\n                array.push(breakouts,breakout.new(pivotHigh,volume,BULLISH))                \r\n                drawBreakLine(pivotHigh,buyColorInput)        \r\n                pivotHigh := na \r\n                alert("haha", alert.freq_once_per_bar)               \r\n\r\n        // if we have a pivotLow and a break of its level, we store the breakout and draw the line\r\n        if not na(pivotLow)\r\n            if close < pivotLow.priceLevel           \r\n                array.push(breakouts,breakout.new(pivotLow,volume,BEARISH))                \r\n                drawBreakLine(pivotLow,sellColorInput)\r\n                pivotLow := na\r\n                alert("lala", alert.freq_once_per_bar)                \r\n                \r\n        // Coding trick: avoid the use of drawings like `line` or `box` on unnecesary bars, just plot them on the last bar to smooth script execution\r\n        if barstate.islastconfirmedhistory or barstate.isrealtime\r\n\r\n            // Another custom error, this one is to prevent drawing grid (lines) and profile (boxes) when there is no breaks of structure,\r\n            // this will happen when the user sets a big pivotLengthInput and a small executionLastNBarsInput\r\n            if array.size(breakouts) == 0\r\n                runtime.error(\'No breaks of structure detected. Please modify `Data Gathering` parameters on the settings window. Ex. smaller `Pivot Length` and/or bigger execution window\')\r\n\r\n            // we draw both the grid and the volume profile\r\n            drawFullProfile(executionTop,executionBottom,firstExecutionBar)           \r\n            \r\n//---------------------------------------------------------------------------------------------------------------------}\r\n\r\n'
[CAPTURE 2] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © AquaTickTrader\r\n\r\n//==================================================================================================\r\n//  [TL5 Volume Profile] Market Structure Volume Distribution (original by LuxAlgo – Modified by AquaTickTrader)\r\n//\r\n//  ⚠️ IMPORTANT – ATTRIBUTION & DISCLAIMER\r\n//  -----------------------------------------------------------------------------------------------\r\n//  This script is a MODIFIED version of the original\r\n//  "Market Structure Volume Distribution" indicator created by LuxAlgo.\r\n//\r\n//  • All core logic, calculations, and market structure methodology belong to LuxAlgo.\r\n//  • The volume calculation, pivot detection, BOS logic, and aggregation are UNCHANGED.\r\n//  • ONLY the visual communication of volume has been modified (layout, styling, alerts).\r\n//\r\n//  This version is shared for educational and experimental purposes only.\r\n//  This is NOT an official LuxAlgo release.\r\n//\r\n//===============================================================================================\r\n\r\n//@version=6\r\nindicator("[TL5 Volume Profile] Market Structure Volume Distribution (original by LuxAlgo – Modified by AquaTickTrader)", overlay = true, max_lines_count = 500, max_boxes_count = 200, max_bars_back = 5000)\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//CONSTANTS & STRINGS & INPUTS\r\n//---------------------------------------------------------------------------------------------------------------------{\r\nTOTAL_VOLUME    = \'TOTAL VOLUME\'\r\nBUY_SELL_VOLUME = \'BUY&SELL VOLUME\'\r\nBULLISH         = \'BULLISH\'\r\nBEARISH         = \'BEARISH\'\r\nGREEN           = #089981\r\nRED             = #F23645\r\n\r\nDATA_GROUP      = \'Data Gathering\'\r\nPROFILE_GROUP   = \'Profile\'\r\nSTYLE_GROUP     = \'Style\'\r\n\r\nexecutionVisualRangeTooltip = \'Activate this to use all visible bars on the calculations. This disables the use of the next parameter `Execute on the last N bars`. Default false.\'\r\nexecutionLastNBarsTooltip   = \'Use last N bars on the calculations. To use this parameter `Execute on all visible range` must be disabled. Values from 20 to 5000, default 500.\'\r\npivotLengthTooltip          = \'How many bars will be used to confirm a pivot. The bigger this parameter is the fewer breaks of structure will detect. Values from 1, default 2\'\r\nprofileSizeTooltip          = \'Number of rows in the volume profile. Values from 2 to 100, default 10.\'\r\nprofileWidthTooltip         = \'Maximum width of the volume profile. Values from 25 to 500, default 200.\'\r\nprofileModeTooltip          = \'How the volume will be displayed on each row. `TOTAL VOLUME` will aggregate buy & sell volume per row, `BUY&SELL VOLUME` will separate the buy volume from the sell volume on each row. Default BUY&SELL VOLUME\'\r\nbuyColorTooltip             = \'This is the color for the buy volume on the profile when the `BUY&SELL VOLUME` mode is activated. Default green.\'\r\nsellColorTooltip            = \'This is the color for the sell volume on the profile when the `BUY&SELL VOLUME` mode is activated. Default red.\'\r\nshowGridTooltip             = \'Show dotted inner grid levels. Default true.\'\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//Settings\r\n//---------------------------------------------------------------------------------------------------------------------{\r\nexecutionVisualRangeInput   = input.bool(   false,          \'Execute on all visible range\', group=DATA_GROUP,       tooltip = executionVisualRangeTooltip)\r\nexecutionLastNBarsInput     = input.int(    500,            \'Execute on the last N bars\',   group=DATA_GROUP,       tooltip = executionLastNBarsTooltip,    minval=20,  maxval=5000)\r\npivotLengthInput            = input.int(    2,              \'Pivot Length\',                 group=DATA_GROUP,       tooltip = pivotLengthTooltip,           minval=1)\r\nprofileSizeInput            = input.int(    20,             \'Profile Rows\',                 group=PROFILE_GROUP,    tooltip = profileSizeTooltip,           minval=2,   maxval=100)\r\nprofileWidthInput           = input.int(    25,            \'Profile Width\',                group=PROFILE_GROUP,    tooltip = profileWidthTooltip,          minval=25,  maxval=500, step=25)\r\nprofileModeInput            = input.string( BUY_SELL_VOLUME,\'Profile Mode\',                 group=PROFILE_GROUP,    tooltip = profileModeTooltip,           options=[TOTAL_VOLUME,BUY_SELL_VOLUME])\r\nbuyColorInput               = input.color(  GREEN,          \'Buy Color\',                    group=STYLE_GROUP,      tooltip = buyColorTooltip)\r\nsellColorInput              = input.color(  RED,            \'Sell Color\',                   group=STYLE_GROUP,      tooltip = sellColorTooltip)\r\nshowGridInput               = input.bool(   true,           \'Show dotted grid levels\',      group=STYLE_GROUP,      tooltip = showGridTooltip)\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//UDT\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @type                Storage UDT for pivot points\r\n// @field barIndex      Bar index of the privot point\r\n// @field priceLevel    Price level of the pivot point\r\ntype pivotPoint\r\n    int barIndex\r\n    float priceLevel\r\n\r\n// @type                    Storage UDT for breakouts (aka breaks of pivot points)\r\n// @field pivot             Broken pivot point\r\n// @field breakoutVolume    Volume of the breakout bar\r\n// @field bias              Bias can be BULLISH or BEARISH and is used to catalog the volume as buy or sell volume\r\n// @field row               Row in the volume profile where this breakout belongs\r\ntype breakout\r\n    pivotPoint pivot\r\n    float breakoutVolume\r\n    string bias\r\n    int row\r\n\r\n// @type                Storege UDT for the volume profile\r\n// @field sellVolume    Array for sell volume, each element represents one row of the profile\r\n// @field buyVolume     Array for buy volume, each element represents one row of the profile\r\n// @field totalVolume   Array for total volume, each element represents one row of the profile\r\ntype profile\r\n    array<float> sellVolume\r\n    array<float> buyVolume\r\n    array<float> totalVolume\r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//USER-DEFINED FUNCTIONS\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @variable    Pivot point high: only the last pivot high is stored until it breaks or a new pivot high is found\r\nvar pivotPoint pivotHigh        = na\r\n// @variable    Pivot point low: only the last pivot low is stored until it breaks or a new pivot low is found\r\nvar pivotPoint pivotLow         = na\r\n// @variable    Collection of all breakouts (aka breaks of pivot points)\r\nvar array<breakout> breakouts   = array.new<breakout>(na)\r\n// @variable    Volume profile storage: contains 3 arrays for buy, sell and total volume\r\nvar profile volumeProfile       = profile.new(na,na,na)\r\n// @variable    Collection of lines representing the grid\r\nvar array<line> grid            = array.new<line>(profileSizeInput,na)\r\n// @variable    Top price in the execution window\r\nvar float executionTop          = 0\r\n// @variable    Bottom price in the execution window\r\nvar float executionBottom       = 0\r\n// @variable    Storage the previous value of executionWindow\r\nvar bool lastExecutionWindow    = false\r\n// @variable    Storage the bar_index of the first bar inside the execution window\r\nvar int firstExecutionBar       = 0\r\n\r\n// @function        Draw a new line from the pivot point to the current bar\r\n// @param point     (pivotPoint) Pivot point containing the starting bar and price level for the line\r\n// @param lineColor (series color) Color for the new line\r\n// @returns         New line ID\r\ndrawBreakLine(pivotPoint point,color lineColor) => line.new(point.barIndex,point.priceLevel,bar_index,point.priceLevel,color=lineColor, width = 1)\r\n\r\n// @function        Set for each breakout the correct row parameter (which row of the profile it belongs to)\r\n// @param top       (series float) Top price inside the execution window\r\n// @param bottom    (series float) Bottom price inside the execution window\r\n// @returns         Last row of the last breakout\r\nupdateBreakoutRows(float top, float bottom) =>\r\n    rowHeight = math.round_to_mintick((top - bottom) / profileSizeInput)\r\n    for eachBreakout in breakouts        \r\n        eachBreakout.row := math.min(int((top - eachBreakout.pivot.priceLevel)/rowHeight),profileSizeInput-1)\r\n\r\n// @function    Recreate the profile 3 volume arrays from the breakouts: buy, sell and total volume\r\n// @returns     void\r\nupdateProfileRows() =>    \r\n    volumeProfile.buyVolume     := array.new<float>(profileSizeInput,0)\r\n    volumeProfile.sellVolume    := array.new<float>(profileSizeInput,0)\r\n    volumeProfile.totalVolume   := array.new<float>(profileSizeInput,0)\r\n    \r\n    for eachBreakout in breakouts\r\n        array<float> selectedVolume = na\r\n\r\n        if eachBreakout.bias == BULLISH\r\n            selectedVolume := volumeProfile.buyVolume\r\n        else\r\n            selectedVolume := volumeProfile.sellVolume        \r\n\r\n        currentVolume = array.get(selectedVolume,eachBreakout.row)\r\n        array.set(selectedVolume,eachBreakout.row,currentVolume + eachBreakout.breakoutVolume)\r\n        array.set(volumeProfile.totalVolume,eachBreakout.row,array.get(volumeProfile.totalVolume,eachBreakout.row)+eachBreakout.breakoutVolume)\r\n\r\n// @function    Draw a line from `bar` to `last_bar_index + 10` at the specified level and style\r\n// @param bar   (series int) Starting bar for drawing the line\r\n// @param level (series float) Price level for drawing the line\r\n// @param style (series string) Style of the line\r\n// @returns     void\r\ndrawGridLine(int bar, float level,string style) => \r\n    startPoint  = chart.point.new(na,bar,level)\r\n    endPoint    = chart.point.new(na,last_bar_index + 10,level)\r\n    array.push(grid,line.new(startPoint,endPoint,color=chart.fg_color,style = style))\r\n\r\n// @function                        Draw a volume profile box with the specified parameters                      \r\n// @param top                       (float) Top price of the box\r\n// @param bottom                    (float) Bottom price of the box\r\n// @param rowVolume                 (float) Volume data that gives the width of the box and the text inside\r\n// @param backgroundColor           (color) Background color of the box\r\n// @param textHAlign                (string) Text horizontal align inside the box\r\n// @returns                         New box ID\r\ndrawProfileSimpleRow(float top, float bottom, int left,float rowVolume1, rowVolume,a,color backgroundColor = color.blue,string textHAlign = text.align_left) =>\r\n    boxWidth    = int((rowVolume * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n    topLeft     = chart.point.new(na,left,top)\r\n    bottomRight = chart.point.new(na,left + 12,bottom)            \r\n    box.new(topLeft,bottomRight,border_color = na,text = rowVolume > 0 ? str.tostring(rowVolume,format.volume) : na,bgcolor = a,text_color = chart.fg_color, text_size = size.normal,text_halign = textHAlign)\r\n\r\n// @function                        Draw 2 volume profile boxes with the specified parameters\r\n// @param top                       (float) Top price of the box\r\n// @param bottom                    (float) Bottom price of the box\r\n// @param middle                    (int) Middle bar index from where draw the boxes\r\n// @param buyVolume                 (float) Buy volume for the green box\r\n// @param sellVolume                (float) Sell volume for the red box\r\n// @returns                         New box ID\r\ndrawProfileDoubleRow(float top, float bottom, int middle, float buyVolume, float sellVolume) =>    \r\n    boxWidth    = int((sellVolume * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n    // drawProfileSimpleRow(top,bottom,bar_index + 2,totalVolume,color(na),text.align_left)\r\n    drawProfileSimpleRow(top,bottom,bar_index + 21,buyVolume, sellVolume,color.yellow,sellVolume>buyVolume?color.red:color.lime,text.align_left)\r\n    drawProfileSimpleRow(top,bottom,bar_index + 31,sellVolume, buyVolume, color.white,sellVolume>buyVolume?color.red:color.lime,text.align_left)\r\n\r\n// @function        Draw the grid and the volume profile\r\n// @param top       (series float) Top price inside the execution window\r\n// @param bottom    (series float) Bottom price inside the execution window\r\n// @param firstBar  (series int) First bar inside the execution window\r\n// @returns         Last drawn box ID\r\ndrawFullProfile(float top, float bottom,int firstBar) =>\r\n    updateBreakoutRows(top,bottom)\r\n    updateProfileRows()\r\n\r\n    for eachBox in box.all\r\n        box.delete(eachBox)\r\n\r\n    for eachLine in grid\r\n        line.delete(eachLine)\r\n\r\n    rowHeight = math.round_to_mintick((top - bottom) / profileSizeInput)\r\n    rowGap = math.max(math.round_to_mintick(rowHeight/10),syminfo.mintick)\r\n    \r\n    leftIndex = last_bar_index + 10\r\n    middleIndex = leftIndex + int((array.max(volumeProfile.sellVolume) * (profileWidthInput - 10))/array.max(volumeProfile.totalVolume))\r\n\r\n    // draw top solid grid line            \r\n    drawGridLine(firstBar,top,line.style_dashed)                   \r\n\r\n    for index = 0 to profileSizeInput - 1\r\n        rowTop = top - index * rowHeight - rowGap\r\n        rowBottom = (index == (profileSizeInput - 1) ? bottom : rowTop - rowHeight + rowGap) + rowGap\r\n\r\n        if showGridInput and index > 0\r\n            drawGridLine(firstBar,rowTop+rowGap,line.style_dotted)        \r\n\r\n        if profileModeInput != TOTAL_VOLUME\r\n            drawProfileSimpleRow(rowTop,rowBottom,leftIndex,array.get(volumeProfile.totalVolume,index), array.get(volumeProfile.totalVolume,index), array.get(volumeProfile.buyVolume,index)>array.get(volumeProfile.sellVolume,index)?color.lime:array.get(volumeProfile.buyVolume,index)<array.get(volumeProfile.sellVolume,index)?color.red:color.gray)            \r\n            drawProfileDoubleRow(rowTop,rowBottom,leftIndex,array.get(volumeProfile.buyVolume,index),array.get(volumeProfile.sellVolume,index))            \r\n    // draw bottom grid line            \r\n    drawGridLine(firstBar,bottom,line.style_dashed)                   \r\n\r\n//---------------------------------------------------------------------------------------------------------------------}\r\n//MUTABLE VARIABLES & EXECUTION\r\n//---------------------------------------------------------------------------------------------------------------------{\r\n// @variable Storage for possible pivot high on current bar\r\ncurrentPivotHigh        = ta.pivothigh(pivotLengthInput,pivotLengthInput)\r\n// @variable Storage for possible pivot low on current bar\r\ncurrentPivotLow         = ta.pivotlow(pivotLengthInput,pivotLengthInput)\r\n// @variable Calculate if current bar is inside execution window\r\ncurrentExecutionWindow  = executionVisualRangeInput ? time >= chart.left_visible_bar_time : (last_bar_index - bar_index) <= executionLastNBarsInput\r\n// @variable bar_index of possible pivot point\r\npivotBarIndex           = bar_index[pivotLengthInput]\r\n\r\n// check if we are inside execution window\r\nif currentExecutionWindow\r\n    \r\n    // check if this is the first bar inside execution window\r\n    if not lastExecutionWindow    \r\n        executionTop        := high\r\n        executionBottom     := low\r\n        firstExecutionBar   := bar_index    \r\n\r\n    lastExecutionWindow := currentExecutionWindow    \r\n   \r\n    // we execute this logic only once per bar \r\n    var line a = na\r\n    var line b = na\r\n    var line a1 = na\r\n    var line b1 = na\r\n    if barstate.isconfirmed\r\n        if low <= executionBottom\r\n            line.delete(a)\r\n            line.delete(a1)\r\n            alert("Execution Low Detected", alert.freq_once_per_bar)\r\n            a := line.new(bar_index, close, bar_index + 1, close, width = 4, extend = extend.right, color = color.black)\r\n            a1 := line.new(bar_index, low, bar_index + 1, low, width = 2, extend = extend.right, color = color.black)\r\n        if high >= executionTop\r\n            line.delete(b)\r\n            line.delete(b1)\r\n            alert("Execution High Detected", alert.freq_once_per_bar)\r\n            b := line.new(bar_index, close, bar_index + 1, close, width = 4, extend = extend.right, color = color.black)\r\n            b1 := line.new(bar_index, high, bar_index + 1, high, width = 2, extend = extend.right, color = color.black)\r\n        // Here we are throwing a custom error with the `runtime.error` built-in function\r\n        // Why this is necessary? To avoid runtime enviroment throwing an error when it tries to create a new line with a x1 parameter (bar_index) bigger than the max buffer of 5000\r\n        // this will happen when `executionVisualRangeInput` is `true` and the user drags the screen several times to show more past bars until the limit is reached and throws our custom error        \r\n        if (last_bar_index - firstExecutionBar) > 5000\r\n            runtime.error(\'Execution windows bigger than 5000 bars are not allowed. Please use a smaller execution window.\')\r\n\r\n        // update of top and bottom prices inside execution window\r\n        executionTop    := math.max(high,executionTop)\r\n        executionBottom := math.min(low,executionBottom)\r\n        \r\n        // if we identify a pivot high, we store it into `pivotHigh` variable\r\n        if not na(currentPivotHigh)\r\n            pivotHigh := pivotPoint.new(pivotBarIndex,currentPivotHigh)\r\n\r\n        // if we identify a pivot low, we store it into `pivotLow` variable\r\n        if not na(currentPivotLow)\r\n            pivotLow := pivotPoint.new(pivotBarIndex,currentPivotLow)\r\n\r\n        // if we have a pivotHigh and a break of its level, we store the breakout and draw the line\r\n        if not na(pivotHigh) \r\n            if close > pivotHigh.priceLevel            \r\n                array.push(breakouts,breakout.new(pivotHigh,volume,BULLISH))                \r\n                drawBreakLine(pivotHigh,buyColorInput)        \r\n                pivotHigh := na \r\n                alert("haha", alert.freq_once_per_bar)               \r\n\r\n        // if we have a pivotLow and a break of its level, we store the breakout and draw the line\r\n        if not na(pivotLow)\r\n            if close < pivotLow.priceLevel           \r\n                array.push(breakouts,breakout.new(pivotLow,volume,BEARISH))                \r\n                drawBreakLine(pivotLow,sellColorInput)\r\n                pivotLow := na\r\n                alert("lala", alert.freq_once_per_bar)                \r\n                \r\n        // Coding trick: avoid the use of drawings like `line` or `box` on unnecesary bars, just plot them on the last bar to smooth script execution\r\n        if barstate.islastconfirmedhistory or barstate.isrealtime\r\n\r\n            // Another custom error, this one is to prevent drawing grid (lines) and profile (boxes) when there is no breaks of structure,\r\n            // this will happen when the user sets a big pivotLengthInput and a small executionLastNBarsInput\r\n            if array.size(breakouts) == 0\r\n                runtime.error(\'No breaks of structure detected. Please modify `Data Gathering` parameters on the settings window. Ex. smaller `Pivot Length` and/or bigger execution window\')\r\n\r\n            // we draw both the grid and the volume profile\r\n            drawFullProfile(executionTop,executionBottom,firstExecutionBar)           \r\n            \r\n//---------------------------------------------------------------------------------------------------------------------}\r\n\r\n'
[DEBUG] save_script called: script_id=7bfbrEMT title=[TL5 Volume Profile] Market Structure Volume Distribution category=7bfbrEMT force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\7bfbrEMT_TL5_Volume_Profile_Market_Structure_Volume_Distribution.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\7bfbrEMT_TL5_Volume_Profile_Market_Structure_Volume_Distribution.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 02:49:32 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 02:49:32 GMT' as: 2026-02-09T02:49:32+00:00
[DEBUG] Exact published date for header: 2026-02-09T02:49:32+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/LHtZc9og-Previous-Day-Levels-H-L-O-C/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
//@version=5indic
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\nindicator("Previous Day Levels (H/L + O/C)", overlay=true, max_lines_count=500)\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Settings\n// ─────────────────────────────────────────────────────────────────────────────\nshowPDHL = input.bool(true, "Show Previous Day High/Low (Purple)")\nshowPDOC = input.bool(true, "Show Previous Day Open/Close (Red)")\nlineWidth = input.int(2, "Line Width", minval=1, maxval=5)\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Previous Day values from Daily timeframe\n// We request the *previous* day\'s OHLC by referencing [1] on the daily series.\n// ─────────────────────────────────────────────────────────────────────────────\npdHigh  = request.security(syminfo.tickerid, "D", high[1],  barmerge.gaps_off, barmerge.lookahead_off)\npdLow   = request.security(syminfo.tickerid, "D", low[1],   barmerge.gaps_off, barmerge.lookahead_off)\npdOpen  = request.security(syminfo.tickerid, "D", open[1],  barmerge.gaps_off, barmerge.lookahead_off)\npdClose = request.security(syminfo.tickerid, "D", close[1], barmerge.gaps_off, barmerge.lookahead_off)\n\n// Detect the first bar of a new day (on any intraday chart)\nnewDay = ta.change(time("D"))\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Persistent line handles\n// ─────────────────────────────────────────────────────────────────────────────\nvar line lPDH = na\nvar line lPDL = na\nvar line lPDO = na\nvar line lPDC = na\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Create new lines at the start of each day so the "previous day" levels update\n// Lines extend both ways so they appear from the left side of the screen.\n// ─────────────────────────────────────────────────────────────────────────────\nif newDay\n    if showPDHL\n        line.delete(lPDH)\n        line.delete(lPDL)\n        lPDH := line.new(bar_index, pdHigh, bar_index + 1, pdHigh,\n             extend=extend.both, color=color.purple, width=lineWidth)\n        lPDL := line.new(bar_index, pdLow, bar_index + 1, pdLow,\n             extend=extend.both, color=color.purple, width=lineWidth)\n\n    if showPDOC\n        line.delete(lPDO)\n        line.delete(lPDC)\n        lPDO := line.new(bar_index, pdOpen, bar_index + 1, pdOpen,\n             extend=extend.both, color=color.red, width=lineWidth)\n        lPDC := line.new(bar_index, pdClose, bar_index + 1, pdClose,\n             extend=extend.both, color=color.red, width=lineWidth)\n\n// Optional: also keep lines accurate on the very first load (before first newDay triggers)\nif barstate.isfirst\n    if showPDHL\n        lPDH := line.new(bar_index, pdHigh, bar_index + 1, pdHigh,\n             extend=extend.both, color=color.purple, width=lineWidth)\n        lPDL := line.new(bar_index, pdLow, bar_index + 1, pdLow,\n             extend=extend.both, color=color.purple, width=lineWidth)\n\n    if showPDOC\n        lPDO := line.new(bar_index, pdOpen, bar_index + 1, pdOpen,\n             extend=extend.both, color=color.red, width=lineWidth)\n        lPDC := line.new(bar_index, pdClose, bar_index + 1, pdClose,\n             extend=extend.both, color=color.red, width=lineWidth)\n'
[CAPTURE 1] '//@version=5\nindicator("Previous Day Levels (H/L + O/C)", overlay=true, max_lines_count=500)\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Settings\n// ─────────────────────────────────────────────────────────────────────────────\nshowPDHL = input.bool(true, "Show Previous Day High/Low (Purple)")\nshowPDOC = input.bool(true, "Show Previous Day Open/Close (Red)")\nlineWidth = input.int(2, "Line Width", minval=1, maxval=5)\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Previous Day values from Daily timeframe\n// We request the *previous* day\'s OHLC by referencing [1] on the daily series.\n// ─────────────────────────────────────────────────────────────────────────────\npdHigh  = request.security(syminfo.tickerid, "D", high[1],  barmerge.gaps_off, barmerge.lookahead_off)\npdLow   = request.security(syminfo.tickerid, "D", low[1],   barmerge.gaps_off, barmerge.lookahead_off)\npdOpen  = request.security(syminfo.tickerid, "D", open[1],  barmerge.gaps_off, barmerge.lookahead_off)\npdClose = request.security(syminfo.tickerid, "D", close[1], barmerge.gaps_off, barmerge.lookahead_off)\n\n// Detect the first bar of a new day (on any intraday chart)\nnewDay = ta.change(time("D"))\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Persistent line handles\n// ─────────────────────────────────────────────────────────────────────────────\nvar line lPDH = na\nvar line lPDL = na\nvar line lPDO = na\nvar line lPDC = na\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Create new lines at the start of each day so the "previous day" levels update\n// Lines extend both ways so they appear from the left side of the screen.\n// ─────────────────────────────────────────────────────────────────────────────\nif newDay\n    if showPDHL\n        line.delete(lPDH)\n        line.delete(lPDL)\n        lPDH := line.new(bar_index, pdHigh, bar_index + 1, pdHigh,\n             extend=extend.both, color=color.purple, width=lineWidth)\n        lPDL := line.new(bar_index, pdLow, bar_index + 1, pdLow,\n             extend=extend.both, color=color.purple, width=lineWidth)\n\n    if showPDOC\n        line.delete(lPDO)\n        line.delete(lPDC)\n        lPDO := line.new(bar_index, pdOpen, bar_index + 1, pdOpen,\n             extend=extend.both, color=color.red, width=lineWidth)\n        lPDC := line.new(bar_index, pdClose, bar_index + 1, pdClose,\n             extend=extend.both, color=color.red, width=lineWidth)\n\n// Optional: also keep lines accurate on the very first load (before first newDay triggers)\nif barstate.isfirst\n    if showPDHL\n        lPDH := line.new(bar_index, pdHigh, bar_index + 1, pdHigh,\n             extend=extend.both, color=color.purple, width=lineWidth)\n        lPDL := line.new(bar_index, pdLow, bar_index + 1, pdLow,\n             extend=extend.both, color=color.purple, width=lineWidth)\n\n    if showPDOC\n        lPDO := line.new(bar_index, pdOpen, bar_index + 1, pdOpen,\n             extend=extend.both, color=color.red, width=lineWidth)\n        lPDC := line.new(bar_index, pdClose, bar_index + 1, pdClose,\n             extend=extend.both, color=color.red, width=lineWidth)\n'
[CAPTURE 2] '//@version=5\nindicator("Previous Day Levels (H/L + O/C)", overlay=true, max_lines_count=500)\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Settings\n// ─────────────────────────────────────────────────────────────────────────────\nshowPDHL = input.bool(true, "Show Previous Day High/Low (Purple)")\nshowPDOC = input.bool(true, "Show Previous Day Open/Close (Red)")\nlineWidth = input.int(2, "Line Width", minval=1, maxval=5)\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Previous Day values from Daily timeframe\n// We request the *previous* day\'s OHLC by referencing [1] on the daily series.\n// ─────────────────────────────────────────────────────────────────────────────\npdHigh  = request.security(syminfo.tickerid, "D", high[1],  barmerge.gaps_off, barmerge.lookahead_off)\npdLow   = request.security(syminfo.tickerid, "D", low[1],   barmerge.gaps_off, barmerge.lookahead_off)\npdOpen  = request.security(syminfo.tickerid, "D", open[1],  barmerge.gaps_off, barmerge.lookahead_off)\npdClose = request.security(syminfo.tickerid, "D", close[1], barmerge.gaps_off, barmerge.lookahead_off)\n\n// Detect the first bar of a new day (on any intraday chart)\nnewDay = ta.change(time("D"))\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Persistent line handles\n// ─────────────────────────────────────────────────────────────────────────────\nvar line lPDH = na\nvar line lPDL = na\nvar line lPDO = na\nvar line lPDC = na\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Create new lines at the start of each day so the "previous day" levels update\n// Lines extend both ways so they appear from the left side of the screen.\n// ─────────────────────────────────────────────────────────────────────────────\nif newDay\n    if showPDHL\n        line.delete(lPDH)\n        line.delete(lPDL)\n        lPDH := line.new(bar_index, pdHigh, bar_index + 1, pdHigh,\n             extend=extend.both, color=color.purple, width=lineWidth)\n        lPDL := line.new(bar_index, pdLow, bar_index + 1, pdLow,\n             extend=extend.both, color=color.purple, width=lineWidth)\n\n    if showPDOC\n        line.delete(lPDO)\n        line.delete(lPDC)\n        lPDO := line.new(bar_index, pdOpen, bar_index + 1, pdOpen,\n             extend=extend.both, color=color.red, width=lineWidth)\n        lPDC := line.new(bar_index, pdClose, bar_index + 1, pdClose,\n             extend=extend.both, color=color.red, width=lineWidth)\n\n// Optional: also keep lines accurate on the very first load (before first newDay triggers)\nif barstate.isfirst\n    if showPDHL\n        lPDH := line.new(bar_index, pdHigh, bar_index + 1, pdHigh,\n             extend=extend.both, color=color.purple, width=lineWidth)\n        lPDL := line.new(bar_index, pdLow, bar_index + 1, pdLow,\n             extend=extend.both, color=color.purple, width=lineWidth)\n\n    if showPDOC\n        lPDO := line.new(bar_index, pdOpen, bar_index + 1, pdOpen,\n             extend=extend.both, color=color.red, width=lineWidth)\n        lPDC := line.new(bar_index, pdClose, bar_index + 1, pdClose,\n             extend=extend.both, color=color.red, width=lineWidth)\n'
[DEBUG] save_script called: script_id=LHtZc9og title=Previous Day Levels (H/L + O/C) category=LHtZc9og force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\LHtZc9og_Previous_Day_Levels_(HL_+_OC).pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\LHtZc9og_Previous_Day_Levels_(HL_+_OC).pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 02:44:31 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 02:44:31 GMT' as: 2026-02-09T02:44:31+00:00
[DEBUG] Exact published date for header: 2026-02-09T02:44:31+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/NIRVQjNO-15m-BOS-OTE-FVG-OB-Prop-Firm/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\nindicator("15m BOS + OTE + FVG + OB (Prop Firm)", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ==========================\n// INPUTS\n// ==========================\nhtf           = "15"\nswingLen      = 3\nnySession     = "0930-1130"\nshowZones     = true\n\n// ==========================\n// SESSION FILTER\n// ==========================\ninSession = not na(time(timeframe.period, nySession))\n\n// ==========================\n// 15M STRUCTURE\n// ==========================\n[htfH, htfL, htfC] = request.security(syminfo.tickerid, htf, [high, low, close])\n\nph = ta.pivothigh(htfH, swingLen, swingLen)\npl = ta.pivotlow(htfL, swingLen, swingLen)\n\nvar float lastHigh = na\nvar float lastLow  = na\n\nif not na(ph)\n    lastHigh := ph\nif not na(pl)\n    lastLow := pl\n\nbullBOS = ta.crossover(htfC, lastHigh)\nbearBOS = ta.crossunder(htfC, lastLow)\n\n// ==========================\n// DEALING RANGE + OTE\n// ==========================\nvar float rangeHigh = na\nvar float rangeLow  = na\nvar bool  traded    = false\n\nif bullBOS\n    rangeHigh := htfH\n    rangeLow  := lastLow\n    traded    := false\n\nif bearBOS\n    rangeLow  := htfL\n    rangeHigh := lastHigh\n    traded    := false\n\noteH = rangeLow + (rangeHigh - rangeLow) * 0.79\noteL = rangeLow + (rangeHigh - rangeLow) * 0.618\n\n// ==========================\n// FAIR VALUE GAP (3-CANDLE)\n// ==========================\nbullFVG = low > high[2]\nbearFVG = high < low[2]\n\nfvgLowBull  = high[2]\nfvgHighBull = low\n\nfvgHighBear = low[2]\nfvgLowBear  = high\n\n// ==========================\n// ORDER BLOCK (LAST OPPOSING CANDLE)\n// ==========================\nbullOB = close[1] < open[1] and bullBOS\nbearOB = close[1] > open[1] and bearBOS\n\nobHigh = high[1]\nobLow  = low[1]\n\n// ==========================\n// LOWER TF INTERNAL BOS\n// ==========================\niHigh = ta.pivothigh(high, 2, 2)\niLow  = ta.pivotlow(low, 2, 2)\n\nvar float internalHigh = na\nvar float internalLow  = na\n\nif not na(iHigh)\n    internalHigh := iHigh\nif not na(iLow)\n    internalLow := iLow\n\nltfBullBOS = ta.crossover(close, internalHigh)\nltfBearBOS = ta.crossunder(close, internalLow)\n\n// ==========================\n// RETRACEMENT CONDITIONS\n// ==========================\ninOTEbull = low <= oteH and low >= oteL\ninOTEbear = high >= oteL and high <= oteH\n\ntapBullFVG = low <= fvgHighBull and low >= fvgLowBull\ntapBearFVG = high >= fvgLowBear and high <= fvgHighBear\n\ntapBullOB = low <= obHigh and low >= obLow\ntapBearOB = high >= obLow and high <= obHigh\n\n// ==========================\n// ENTRY CONDITIONS\n// ==========================\nlongEntry = bullBOS == false and inSession and not traded and inOTEbull and tapBullFVG and tapBullOB and  ltfBullBOS\n\nshortEntry = bearBOS == false and inSession and not traded and inOTEbear and tapBearFVG and tapBearOB and ltfBearBOS\n\nif longEntry or shortEntry\n    traded := true\n\n// ==========================\n// VISUALS\n// ==========================\nif bullBOS\n    label.new(bar_index, high, "15m BOS ↑", color=color.green)\n\nif bearBOS\n    label.new(bar_index, low, "15m BOS ↓", color=color.red)\n\nif longEntry\n    label.new(bar_index, low, "PROP LONG", style=label.style_label_up, color=color.lime)\n\nif shortEntry\n    label.new(bar_index, high, "PROP SHORT", style=label.style_label_down, color=color.red)\n\n// ==========================\n// STOPS & TARGETS\n// ==========================\nif longEntry\n    line.new(bar_index, internalLow, bar_index + 25, internalLow, color=color.red)\n    line.new(bar_index, rangeHigh, bar_index + 25, rangeHigh, color=color.green)\n\nif shortEntry\n    line.new(bar_index, internalHigh, bar_index + 25, internalHigh, color=color.red)\n    line.new(bar_index, rangeLow, bar_index + 25, rangeLow, color=color.green)\n\n// ==========================\n// BUY / SELL SIGNALS\n// ==========================\nplotshape(longEntry, title="Buy Signal", style=shape.triangleup,location=location.belowbar,color=color.lime,size=size.small,text="BUY")\n\nplotshape(shortEntry,title="Sell Signal",style=shape.triangledown,location=location.abovebar,color=color.red,size=size.small,text="SELL")\n\n// ==========================\n// ALERTS\n// ==========================\nalertcondition(longEntry, title="Long Entry Alert", message="LONG entry signal")\nalertcondition(shortEntry, title="Short Entry Alert", message="SHORT entry signal")\n'
[CAPTURE 1] '//@version=5\nindicator("15m BOS + OTE + FVG + OB (Prop Firm)", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ==========================\n// INPUTS\n// ==========================\nhtf           = "15"\nswingLen      = 3\nnySession     = "0930-1130"\nshowZones     = true\n\n// ==========================\n// SESSION FILTER\n// ==========================\ninSession = not na(time(timeframe.period, nySession))\n\n// ==========================\n// 15M STRUCTURE\n// ==========================\n[htfH, htfL, htfC] = request.security(syminfo.tickerid, htf, [high, low, close])\n\nph = ta.pivothigh(htfH, swingLen, swingLen)\npl = ta.pivotlow(htfL, swingLen, swingLen)\n\nvar float lastHigh = na\nvar float lastLow  = na\n\nif not na(ph)\n    lastHigh := ph\nif not na(pl)\n    lastLow := pl\n\nbullBOS = ta.crossover(htfC, lastHigh)\nbearBOS = ta.crossunder(htfC, lastLow)\n\n// ==========================\n// DEALING RANGE + OTE\n// ==========================\nvar float rangeHigh = na\nvar float rangeLow  = na\nvar bool  traded    = false\n\nif bullBOS\n    rangeHigh := htfH\n    rangeLow  := lastLow\n    traded    := false\n\nif bearBOS\n    rangeLow  := htfL\n    rangeHigh := lastHigh\n    traded    := false\n\noteH = rangeLow + (rangeHigh - rangeLow) * 0.79\noteL = rangeLow + (rangeHigh - rangeLow) * 0.618\n\n// ==========================\n// FAIR VALUE GAP (3-CANDLE)\n// ==========================\nbullFVG = low > high[2]\nbearFVG = high < low[2]\n\nfvgLowBull  = high[2]\nfvgHighBull = low\n\nfvgHighBear = low[2]\nfvgLowBear  = high\n\n// ==========================\n// ORDER BLOCK (LAST OPPOSING CANDLE)\n// ==========================\nbullOB = close[1] < open[1] and bullBOS\nbearOB = close[1] > open[1] and bearBOS\n\nobHigh = high[1]\nobLow  = low[1]\n\n// ==========================\n// LOWER TF INTERNAL BOS\n// ==========================\niHigh = ta.pivothigh(high, 2, 2)\niLow  = ta.pivotlow(low, 2, 2)\n\nvar float internalHigh = na\nvar float internalLow  = na\n\nif not na(iHigh)\n    internalHigh := iHigh\nif not na(iLow)\n    internalLow := iLow\n\nltfBullBOS = ta.crossover(close, internalHigh)\nltfBearBOS = ta.crossunder(close, internalLow)\n\n// ==========================\n// RETRACEMENT CONDITIONS\n// ==========================\ninOTEbull = low <= oteH and low >= oteL\ninOTEbear = high >= oteL and high <= oteH\n\ntapBullFVG = low <= fvgHighBull and low >= fvgLowBull\ntapBearFVG = high >= fvgLowBear and high <= fvgHighBear\n\ntapBullOB = low <= obHigh and low >= obLow\ntapBearOB = high >= obLow and high <= obHigh\n\n// ==========================\n// ENTRY CONDITIONS\n// ==========================\nlongEntry = bullBOS == false and inSession and not traded and inOTEbull and tapBullFVG and tapBullOB and  ltfBullBOS\n\nshortEntry = bearBOS == false and inSession and not traded and inOTEbear and tapBearFVG and tapBearOB and ltfBearBOS\n\nif longEntry or shortEntry\n    traded := true\n\n// ==========================\n// VISUALS\n// ==========================\nif bullBOS\n    label.new(bar_index, high, "15m BOS ↑", color=color.green)\n\nif bearBOS\n    label.new(bar_index, low, "15m BOS ↓", color=color.red)\n\nif longEntry\n    label.new(bar_index, low, "PROP LONG", style=label.style_label_up, color=color.lime)\n\nif shortEntry\n    label.new(bar_index, high, "PROP SHORT", style=label.style_label_down, color=color.red)\n\n// ==========================\n// STOPS & TARGETS\n// ==========================\nif longEntry\n    line.new(bar_index, internalLow, bar_index + 25, internalLow, color=color.red)\n    line.new(bar_index, rangeHigh, bar_index + 25, rangeHigh, color=color.green)\n\nif shortEntry\n    line.new(bar_index, internalHigh, bar_index + 25, internalHigh, color=color.red)\n    line.new(bar_index, rangeLow, bar_index + 25, rangeLow, color=color.green)\n\n// ==========================\n// BUY / SELL SIGNALS\n// ==========================\nplotshape(longEntry, title="Buy Signal", style=shape.triangleup,location=location.belowbar,color=color.lime,size=size.small,text="BUY")\n\nplotshape(shortEntry,title="Sell Signal",style=shape.triangledown,location=location.abovebar,color=color.red,size=size.small,text="SELL")\n\n// ==========================\n// ALERTS\n// ==========================\nalertcondition(longEntry, title="Long Entry Alert", message="LONG entry signal")\nalertcondition(shortEntry, title="Short Entry Alert", message="SHORT entry signal")\n'
[CAPTURE 2] '//@version=5\nindicator("15m BOS + OTE + FVG + OB (Prop Firm)", overlay=true, max_lines_count=500, max_labels_count=500)\n\n// ==========================\n// INPUTS\n// ==========================\nhtf           = "15"\nswingLen      = 3\nnySession     = "0930-1130"\nshowZones     = true\n\n// ==========================\n// SESSION FILTER\n// ==========================\ninSession = not na(time(timeframe.period, nySession))\n\n// ==========================\n// 15M STRUCTURE\n// ==========================\n[htfH, htfL, htfC] = request.security(syminfo.tickerid, htf, [high, low, close])\n\nph = ta.pivothigh(htfH, swingLen, swingLen)\npl = ta.pivotlow(htfL, swingLen, swingLen)\n\nvar float lastHigh = na\nvar float lastLow  = na\n\nif not na(ph)\n    lastHigh := ph\nif not na(pl)\n    lastLow := pl\n\nbullBOS = ta.crossover(htfC, lastHigh)\nbearBOS = ta.crossunder(htfC, lastLow)\n\n// ==========================\n// DEALING RANGE + OTE\n// ==========================\nvar float rangeHigh = na\nvar float rangeLow  = na\nvar bool  traded    = false\n\nif bullBOS\n    rangeHigh := htfH\n    rangeLow  := lastLow\n    traded    := false\n\nif bearBOS\n    rangeLow  := htfL\n    rangeHigh := lastHigh\n    traded    := false\n\noteH = rangeLow + (rangeHigh - rangeLow) * 0.79\noteL = rangeLow + (rangeHigh - rangeLow) * 0.618\n\n// ==========================\n// FAIR VALUE GAP (3-CANDLE)\n// ==========================\nbullFVG = low > high[2]\nbearFVG = high < low[2]\n\nfvgLowBull  = high[2]\nfvgHighBull = low\n\nfvgHighBear = low[2]\nfvgLowBear  = high\n\n// ==========================\n// ORDER BLOCK (LAST OPPOSING CANDLE)\n// ==========================\nbullOB = close[1] < open[1] and bullBOS\nbearOB = close[1] > open[1] and bearBOS\n\nobHigh = high[1]\nobLow  = low[1]\n\n// ==========================\n// LOWER TF INTERNAL BOS\n// ==========================\niHigh = ta.pivothigh(high, 2, 2)\niLow  = ta.pivotlow(low, 2, 2)\n\nvar float internalHigh = na\nvar float internalLow  = na\n\nif not na(iHigh)\n    internalHigh := iHigh\nif not na(iLow)\n    internalLow := iLow\n\nltfBullBOS = ta.crossover(close, internalHigh)\nltfBearBOS = ta.crossunder(close, internalLow)\n\n// ==========================\n// RETRACEMENT CONDITIONS\n// ==========================\ninOTEbull = low <= oteH and low >= oteL\ninOTEbear = high >= oteL and high <= oteH\n\ntapBullFVG = low <= fvgHighBull and low >= fvgLowBull\ntapBearFVG = high >= fvgLowBear and high <= fvgHighBear\n\ntapBullOB = low <= obHigh and low >= obLow\ntapBearOB = high >= obLow and high <= obHigh\n\n// ==========================\n// ENTRY CONDITIONS\n// ==========================\nlongEntry = bullBOS == false and inSession and not traded and inOTEbull and tapBullFVG and tapBullOB and  ltfBullBOS\n\nshortEntry = bearBOS == false and inSession and not traded and inOTEbear and tapBearFVG and tapBearOB and ltfBearBOS\n\nif longEntry or shortEntry\n    traded := true\n\n// ==========================\n// VISUALS\n// ==========================\nif bullBOS\n    label.new(bar_index, high, "15m BOS ↑", color=color.green)\n\nif bearBOS\n    label.new(bar_index, low, "15m BOS ↓", color=color.red)\n\nif longEntry\n    label.new(bar_index, low, "PROP LONG", style=label.style_label_up, color=color.lime)\n\nif shortEntry\n    label.new(bar_index, high, "PROP SHORT", style=label.style_label_down, color=color.red)\n\n// ==========================\n// STOPS & TARGETS\n// ==========================\nif longEntry\n    line.new(bar_index, internalLow, bar_index + 25, internalLow, color=color.red)\n    line.new(bar_index, rangeHigh, bar_index + 25, rangeHigh, color=color.green)\n\nif shortEntry\n    line.new(bar_index, internalHigh, bar_index + 25, internalHigh, color=color.red)\n    line.new(bar_index, rangeLow, bar_index + 25, rangeLow, color=color.green)\n\n// ==========================\n// BUY / SELL SIGNALS\n// ==========================\nplotshape(longEntry, title="Buy Signal", style=shape.triangleup,location=location.belowbar,color=color.lime,size=size.small,text="BUY")\n\nplotshape(shortEntry,title="Sell Signal",style=shape.triangledown,location=location.abovebar,color=color.red,size=size.small,text="SELL")\n\n// ==========================\n// ALERTS\n// ==========================\nalertcondition(longEntry, title="Long Entry Alert", message="LONG entry signal")\nalertcondition(shortEntry, title="Short Entry Alert", message="SHORT entry signal")\n'
[DEBUG] save_script called: script_id=NIRVQjNO title=15m BOS + OTE + FVG + OB (Prop Firm) category=NIRVQjNO force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\NIRVQjNO_15m_BOS_+_OTE_+_FVG_+_OB_(Prop_Firm).pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\NIRVQjNO_15m_BOS_+_OTE_+_FVG_+_OB_(Prop_Firm).pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 02:15:23 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 02:15:23 GMT' as: 2026-02-09T02:15:23+00:00
[DEBUG] Exact published date for header: 2026-02-09T02:15:23+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/LSlKIAnd-Sector-Divergence-Dashboard/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\n// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © Henrique Centieiro\r\n\r\nindicator("Sector Divergence Dashboard", overlay=false, max_labels_count=500, max_lines_count=500)\r\n\r\n//==============================================================================\r\n// LIBRARY IMPORT\r\n//==============================================================================\r\nimport HenriqueCentieiro/PineStats/1 as stats\r\n\r\n//==============================================================================\r\n// INPUTS\r\n//==============================================================================\r\n// --- Symbol Selection (16 symbols) ---\r\ngrpSymbols = "═══ SYMBOL SELECTION ═══"\r\nsym1  = input.symbol("AMEX:SPY",  "1. SPY  (S&P 500)",         group=grpSymbols)\r\nsym2  = input.symbol("NASDAQ:QQQ", "2. QQQ  (Nasdaq 100)",     group=grpSymbols)\r\nsym3  = input.symbol("AMEX:IWM",  "3. IWM  (Russell 2000)",    group=grpSymbols)\r\nsym4  = input.symbol("AMEX:DIA",  "4. DIA  (Dow Jones)",       group=grpSymbols)\r\nsym5  = input.symbol("AMEX:XLK",  "5. XLK  (Technology)",      group=grpSymbols)\r\nsym6  = input.symbol("AMEX:XLF",  "6. XLF  (Financials)",      group=grpSymbols)\r\nsym7  = input.symbol("AMEX:XLE",  "7. XLE  (Energy)",          group=grpSymbols)\r\nsym8  = input.symbol("AMEX:XLV",  "8. XLV  (Healthcare)",      group=grpSymbols)\r\nsym9  = input.symbol("AMEX:XLY",  "9. XLY  (Cons. Discret.)",  group=grpSymbols)\r\nsym10 = input.symbol("AMEX:XLP",  "10. XLP (Cons. Staples)",   group=grpSymbols)\r\nsym11 = input.symbol("AMEX:XLI",  "11. XLI (Industrials)",     group=grpSymbols)\r\nsym12 = input.symbol("AMEX:XLU",  "12. XLU (Utilities)",       group=grpSymbols)\r\nsym13 = input.symbol("AMEX:XLB",  "13. XLB (Materials)",       group=grpSymbols)\r\nsym14 = input.symbol("AMEX:XLC",  "14. XLC (Comm. Services)",  group=grpSymbols)\r\nsym15 = input.symbol("AMEX:XLRE", "15. XLRE (Real Estate)",    group=grpSymbols)\r\nsym16 = input.symbol("NASDAQ:TLT", "16. TLT (Long Bonds)",     group=grpSymbols)\r\n\r\n// --- Parameters ---\r\ngrpParams = "═══ PARAMETERS ═══"\r\ncorrLengthShort = input.int(35, "Short-Term Correlation Length", minval=5, group=grpParams, tooltip="Lookback period for recent correlation. Lower values (5-10) detect quick changes, higher values (20-50) smooth out noise")\r\ncorrLengthLong  = input.int(100, "Long-Term Correlation Length", minval=20, group=grpParams, tooltip="Lookback period for stable correlation baseline. Use 50-100 for daily charts, 20-50 for intraday. Higher = more stable reference")\r\nzscoreLength    = input.int(100, "Z-Score Length", minval=10, group=grpParams, tooltip="Lookback period for z-score calculation (mean reversion). Lower values (20-30) = more sensitive signals, higher values (100-150) = fewer but stronger signals")\r\nperfLength      = input.int(300, "Relative Performance Length", minval=5, group=grpParams, tooltip="Period for measuring relative performance difference. Lower values (10-20) track recent momentum, higher values (40-100) show longer trends")\r\nzscoreThreshold = input.float(1.0, "Z-Score Signal Threshold", minval=0.5, step=0.1, group=grpParams, tooltip="Minimum z-score for regular signals. Lower values (0.5-1.0) = more signals, higher values (1.5-2.5) = fewer but higher quality signals")\r\nzscoreStrong    = input.float(2.0, "Z-Score Strong Signal", minval=1.0, step=0.1, group=grpParams, tooltip="Z-score threshold for strong divergence signals. Typical: 2.0 for daily charts, 2.5+ for higher conviction trades")\r\ncorrBreakdown   = input.float(0.3, "Correlation Breakdown Threshold", minval=0.1, step=0.1, group=grpParams, tooltip="Alert when short-term corr drops this much below long-term. Lower values (0.1-0.2) = sensitive to correlation changes, higher values (0.4-0.6) = only major breakdowns")\r\n\r\n// --- Composite Score Weights ---\r\ngrpWeights = "═══ COMPOSITE SCORE WEIGHTS ═══"\r\nweightZscore   = input.float(0.5, "Z-Score Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much z-score contributes to composite ranking (0-1). Higher = prioritize extreme divergences. Default 0.5 balances all factors")\r\nweightCorrBrk  = input.float(0.25, "Correlation Breakdown Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much correlation breakdown affects ranking (0-1). Higher = prioritize pairs where correlation recently dropped. Use 0.3-0.4 for mean reversion focus")\r\nweightRelPerf  = input.float(0.25, "Relative Performance Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much relative performance affects ranking (0-1). Higher = prioritize momentum differences. Use 0.3-0.5 for momentum-based trading")\r\n\r\n// --- Visualization ---\r\ngrpVis = "═══ VISUALIZATION ═══"\r\nshowHeatmap    = input.bool(true, "Show Correlation Heatmap", group=grpVis, tooltip="Display 16x16 matrix showing all pair correlations. Turn off to reduce clutter or improve performance")\r\nshowRankTable  = input.bool(true, "Show Divergence Rankings", group=grpVis, tooltip="Show table of top opportunities ranked by composite score. This is your primary trading watchlist")\r\nshowDeepDive   = input.bool(true, "Show Deep Dive Chart", group=grpVis, tooltip="Display detailed z-score chart for selected pair below. Turn off if only using heatmap/rankings")\r\nnumRankings    = input.int(15, "Number of Rankings to Show", minval=5, maxval=15, group=grpVis, tooltip="How many pairs to display in ranking table. Maximum 15 shows all SPY pairs. Lower values (5-10) show only top opportunities")\r\n\r\n// --- Deep Dive Pair Selection ---\r\ngrpDeep = "═══ DEEP DIVE PAIR ═══"\r\ndeepSym1 = input.int(1, "Deep Dive: Symbol A (1-16)", minval=1, maxval=16, group=grpDeep, tooltip="First symbol for deep dive chart (base). 1=SPY, 2=QQQ, 3=IWM, 4=DIA, 5-15=Sectors, 16=TLT. Typically use broad market index")\r\ndeepSym2 = input.int(7, "Deep Dive: Symbol B (1-16)", minval=1, maxval=16, group=grpDeep, tooltip="Second symbol for deep dive chart (comparison). Select sector to analyze divergence. Default: 7=XLE (Energy)")\r\nbbLength = input.int(20, "Bollinger Band Length", minval=5, group=grpDeep, tooltip="Period for Bollinger Bands on price ratio. Lower values (10-20) = tighter bands, more signals. Higher values (40-60) = wider bands, fewer signals")\r\nbbMult   = input.float(2.0, "Bollinger Band Multiplier", minval=0.5, step=0.1, group=grpDeep, tooltip="Standard deviation multiplier for Bollinger Bands. 2.0 = standard (95% confidence), 2.5-3.0 = conservative (fewer signals), 1.5 = aggressive (more signals)")\r\n\r\n// --- Table Positions & Appearance ---\r\ngrpPos = "═══ TABLE POSITIONS & APPEARANCE ═══"\r\nheatmapPos = input.string("Bottom Left", "Heatmap Position", options=["Top Left", "Top Center", "Top Right", "Middle Left", "Middle Center", "Middle Right", "Bottom Left", "Bottom Center", "Bottom Right"], group=grpPos, tooltip="Where to display the correlation heatmap table on your chart. Adjust to avoid overlapping with price action or other tables")\r\nrankTablePos = input.string("Bottom Right", "Ranking Table Position", options=["Top Left", "Top Center", "Top Right", "Middle Left", "Middle Center", "Middle Right", "Bottom Left", "Bottom Center", "Bottom Right"], group=grpPos, tooltip="Where to display the divergence rankings table. Recommended: opposite corner from heatmap to maximize visibility")\r\nfontSize = input.string("Small", "Font Size", options=["Auto", "Tiny", "Small", "Normal", "Large", "Huge"], group=grpPos, tooltip="Table text size. Tiny/Small work best for displaying all data. Increase if tables are hard to read on your monitor")\r\n\r\n//==============================================================================\r\n// HELPER FUNCTIONS\r\n//==============================================================================\r\ngetTablePos(pos) =>\r\n    switch pos\r\n        "Top Left" => position.top_left\r\n        "Top Center" => position.top_center\r\n        "Top Right" => position.top_right\r\n        "Middle Left" => position.middle_left\r\n        "Middle Center" => position.middle_center\r\n        "Middle Right" => position.middle_right\r\n        "Bottom Left" => position.bottom_left\r\n        "Bottom Center" => position.bottom_center\r\n        "Bottom Right" => position.bottom_right\r\n        => position.top_right\r\n\r\ngetFontSize() =>\r\n    switch fontSize\r\n        "Auto" => size.auto\r\n        "Tiny" => size.tiny\r\n        "Small" => size.small\r\n        "Normal" => size.normal\r\n        "Large" => size.large\r\n        "Huge" => size.huge\r\n        => size.tiny\r\n\r\ngetCorrColor(corr) =>\r\n    if corr >= 0.7\r\n        color.new(color.green, 20)\r\n    else if corr >= 0.4\r\n        color.new(color.lime, 40)\r\n    else if corr >= 0.0\r\n        color.new(color.yellow, 40)\r\n    else if corr >= -0.4\r\n        color.new(color.orange, 40)\r\n    else\r\n        color.new(color.red, 20)\r\n\r\ngetZscoreColor(z) =>\r\n    absZ = math.abs(z)\r\n    if absZ >= 2.5\r\n        color.new(color.red, 0)\r\n    else if absZ >= 1.5\r\n        color.new(color.orange, 0)\r\n    else if absZ >= 1.0\r\n        color.new(color.yellow, 20)\r\n    else\r\n        color.new(color.gray, 40)\r\n\r\ngetCompositeColor(score) =>\r\n    if score >= 0.7\r\n        color.new(color.red, 0)\r\n    else if score >= 0.5\r\n        color.new(color.orange, 10)\r\n    else if score >= 0.3\r\n        color.new(color.yellow, 20)\r\n    else\r\n        color.new(color.gray, 50)\r\n\r\ngetTicker(sym) =>\r\n    parts = str.split(sym, ":")\r\n    array.size(parts) > 1 ? array.get(parts, 1) : sym\r\n\r\ngetSectorName(idx) =>\r\n    switch idx\r\n        1  => "S&P 500"\r\n        2  => "Nasdaq"\r\n        3  => "Small Cap"\r\n        4  => "Dow Jones"\r\n        5  => "Technology"\r\n        6  => "Financials"\r\n        7  => "Energy"\r\n        8  => "Healthcare"\r\n        9  => "Cons. Discret."\r\n        10 => "Cons. Staples"\r\n        11 => "Industrials"\r\n        12 => "Utilities"\r\n        13 => "Materials"\r\n        14 => "Communication"\r\n        15 => "Real Estate"\r\n        16 => "Bonds"\r\n        => "Unknown"\r\n\r\n//==============================================================================\r\n// DATA FETCHING (16 symbols)\r\n//==============================================================================\r\nprice1  = request.security(sym1,  timeframe.period, close)\r\nprice2  = request.security(sym2,  timeframe.period, close)\r\nprice3  = request.security(sym3,  timeframe.period, close)\r\nprice4  = request.security(sym4,  timeframe.period, close)\r\nprice5  = request.security(sym5,  timeframe.period, close)\r\nprice6  = request.security(sym6,  timeframe.period, close)\r\nprice7  = request.security(sym7,  timeframe.period, close)\r\nprice8  = request.security(sym8,  timeframe.period, close)\r\nprice9  = request.security(sym9,  timeframe.period, close)\r\nprice10 = request.security(sym10, timeframe.period, close)\r\nprice11 = request.security(sym11, timeframe.period, close)\r\nprice12 = request.security(sym12, timeframe.period, close)\r\nprice13 = request.security(sym13, timeframe.period, close)\r\nprice14 = request.security(sym14, timeframe.period, close)\r\nprice15 = request.security(sym15, timeframe.period, close)\r\nprice16 = request.security(sym16, timeframe.period, close)\r\n\r\n// Symbol names array\r\nvar symNames = array.new_string(16)\r\nif barstate.isfirst\r\n    array.set(symNames, 0,  getTicker(sym1))\r\n    array.set(symNames, 1,  getTicker(sym2))\r\n    array.set(symNames, 2,  getTicker(sym3))\r\n    array.set(symNames, 3,  getTicker(sym4))\r\n    array.set(symNames, 4,  getTicker(sym5))\r\n    array.set(symNames, 5,  getTicker(sym6))\r\n    array.set(symNames, 6,  getTicker(sym7))\r\n    array.set(symNames, 7,  getTicker(sym8))\r\n    array.set(symNames, 8,  getTicker(sym9))\r\n    array.set(symNames, 9,  getTicker(sym10))\r\n    array.set(symNames, 10, getTicker(sym11))\r\n    array.set(symNames, 11, getTicker(sym12))\r\n    array.set(symNames, 12, getTicker(sym13))\r\n    array.set(symNames, 13, getTicker(sym14))\r\n    array.set(symNames, 14, getTicker(sym15))\r\n    array.set(symNames, 15, getTicker(sym16))\r\n\r\n//==============================================================================\r\n// RETURNS CALCULATION\r\n//==============================================================================\r\nret1  = (price1  - price1[1])  / price1[1]\r\nret2  = (price2  - price2[1])  / price2[1]\r\nret3  = (price3  - price3[1])  / price3[1]\r\nret4  = (price4  - price4[1])  / price4[1]\r\nret5  = (price5  - price5[1])  / price5[1]\r\nret6  = (price6  - price6[1])  / price6[1]\r\nret7  = (price7  - price7[1])  / price7[1]\r\nret8  = (price8  - price8[1])  / price8[1]\r\nret9  = (price9  - price9[1])  / price9[1]\r\nret10 = (price10 - price10[1]) / price10[1]\r\nret11 = (price11 - price11[1]) / price11[1]\r\nret12 = (price12 - price12[1]) / price12[1]\r\nret13 = (price13 - price13[1]) / price13[1]\r\nret14 = (price14 - price14[1]) / price14[1]\r\nret15 = (price15 - price15[1]) / price15[1]\r\nret16 = (price16 - price16[1]) / price16[1]\r\n\r\n//==============================================================================\r\n// RELATIVE PERFORMANCE (Normalized returns over perfLength)\r\n//==============================================================================\r\nperf1  = (price1  - price1[perfLength])  / price1[perfLength]  * 100\r\nperf2  = (price2  - price2[perfLength])  / price2[perfLength]  * 100\r\nperf3  = (price3  - price3[perfLength])  / price3[perfLength]  * 100\r\nperf4  = (price4  - price4[perfLength])  / price4[perfLength]  * 100\r\nperf5  = (price5  - price5[perfLength])  / price5[perfLength]  * 100\r\nperf6  = (price6  - price6[perfLength])  / price6[perfLength]  * 100\r\nperf7  = (price7  - price7[perfLength])  / price7[perfLength]  * 100\r\nperf8  = (price8  - price8[perfLength])  / price8[perfLength]  * 100\r\nperf9  = (price9  - price9[perfLength])  / price9[perfLength]  * 100\r\nperf10 = (price10 - price10[perfLength]) / price10[perfLength] * 100\r\nperf11 = (price11 - price11[perfLength]) / price11[perfLength] * 100\r\nperf12 = (price12 - price12[perfLength]) / price12[perfLength] * 100\r\nperf13 = (price13 - price13[perfLength]) / price13[perfLength] * 100\r\nperf14 = (price14 - price14[perfLength]) / price14[perfLength] * 100\r\nperf15 = (price15 - price15[perfLength]) / price15[perfLength] * 100\r\nperf16 = (price16 - price16[perfLength]) / price16[perfLength] * 100\r\n\r\n//==============================================================================\r\n// PAIR DATA TYPE\r\n//==============================================================================\r\ntype PairData\r\n    int idx1\r\n    int idx2\r\n    string name\r\n    float zscore\r\n    float corrShort\r\n    float corrLong\r\n    float corrBreakdown\r\n    float relPerfDiff\r\n    float composite\r\n\r\n//==============================================================================\r\n// CALCULATE ALL PAIR METRICS\r\n// We need to calculate for key pairs - focusing on first 8 vs all for heatmap efficiency\r\n//==============================================================================\r\n\r\n// Helper to get return by index\r\ngetReturn(idx) =>\r\n    switch idx\r\n        1  => ret1\r\n        2  => ret2\r\n        3  => ret3\r\n        4  => ret4\r\n        5  => ret5\r\n        6  => ret6\r\n        7  => ret7\r\n        8  => ret8\r\n        9  => ret9\r\n        10 => ret10\r\n        11 => ret11\r\n        12 => ret12\r\n        13 => ret13\r\n        14 => ret14\r\n        15 => ret15\r\n        16 => ret16\r\n        => ret1\r\n\r\ngetPrice(idx) =>\r\n    switch idx\r\n        1  => price1\r\n        2  => price2\r\n        3  => price3\r\n        4  => price4\r\n        5  => price5\r\n        6  => price6\r\n        7  => price7\r\n        8  => price8\r\n        9  => price9\r\n        10 => price10\r\n        11 => price11\r\n        12 => price12\r\n        13 => price13\r\n        14 => price14\r\n        15 => price15\r\n        16 => price16\r\n        => price1\r\n\r\ngetPerf(idx) =>\r\n    switch idx\r\n        1  => perf1\r\n        2  => perf2\r\n        3  => perf3\r\n        4  => perf4\r\n        5  => perf5\r\n        6  => perf6\r\n        7  => perf7\r\n        8  => perf8\r\n        9  => perf9\r\n        10 => perf10\r\n        11 => perf11\r\n        12 => perf12\r\n        13 => perf13\r\n        14 => perf14\r\n        15 => perf15\r\n        16 => perf16\r\n        => perf1\r\n\r\n// Calculate metrics for a pair\r\ncalcPairMetrics(idx1, idx2) =>\r\n    r1 = getReturn(idx1)\r\n    r2 = getReturn(idx2)\r\n    p1 = getPrice(idx1)\r\n    p2 = getPrice(idx2)\r\n    pf1 = getPerf(idx1)\r\n    pf2 = getPerf(idx2)\r\n\r\n    // Correlations\r\n    corrS = stats.correlation(r1, r2, corrLengthShort)\r\n    corrL = stats.correlation(r1, r2, corrLengthLong)\r\n\r\n    // Log price ratio and z-score\r\n    ratio = math.log(p1 / p2)\r\n    z = stats.zscore(ratio, zscoreLength)\r\n\r\n    // Correlation breakdown (how much short-term dropped below long-term)\r\n    corrBrk = corrL - corrS\r\n\r\n    // Relative performance difference\r\n    relDiff = pf1 - pf2\r\n\r\n    // Normalize components for composite score\r\n    zNorm = math.min(math.abs(z) / 3.0, 1.0)  // Cap at 3 sigma\r\n    corrBrkNorm = math.min(math.max(corrBrk, 0) / 0.5, 1.0)  // Positive breakdown capped at 0.5\r\n    relDiffNorm = math.min(math.abs(relDiff) / 10.0, 1.0)  // Cap at 10% difference\r\n\r\n    // Composite score\r\n    comp = weightZscore * zNorm + weightCorrBrk * corrBrkNorm + weightRelPerf * relDiffNorm\r\n\r\n    [z, corrS, corrL, corrBrk, relDiff, comp]\r\n\r\n//==============================================================================\r\n// CALCULATE KEY PAIRS FOR RANKING (120 pairs for 16 symbols)\r\n// We\'ll calculate the most important subset for performance\r\n//==============================================================================\r\n\r\n// Calculate all 120 pairs\r\n[z_1_2, cs_1_2, cl_1_2, cb_1_2, rp_1_2, cp_1_2] = calcPairMetrics(1, 2)\r\n[z_1_3, cs_1_3, cl_1_3, cb_1_3, rp_1_3, cp_1_3] = calcPairMetrics(1, 3)\r\n[z_1_4, cs_1_4, cl_1_4, cb_1_4, rp_1_4, cp_1_4] = calcPairMetrics(1, 4)\r\n[z_1_5, cs_1_5, cl_1_5, cb_1_5, rp_1_5, cp_1_5] = calcPairMetrics(1, 5)\r\n[z_1_6, cs_1_6, cl_1_6, cb_1_6, rp_1_6, cp_1_6] = calcPairMetrics(1, 6)\r\n[z_1_7, cs_1_7, cl_1_7, cb_1_7, rp_1_7, cp_1_7] = calcPairMetrics(1, 7)\r\n[z_1_8, cs_1_8, cl_1_8, cb_1_8, rp_1_8, cp_1_8] = calcPairMetrics(1, 8)\r\n[z_1_9, cs_1_9, cl_1_9, cb_1_9, rp_1_9, cp_1_9] = calcPairMetrics(1, 9)\r\n[z_1_10, cs_1_10, cl_1_10, cb_1_10, rp_1_10, cp_1_10] = calcPairMetrics(1, 10)\r\n[z_1_11, cs_1_11, cl_1_11, cb_1_11, rp_1_11, cp_1_11] = calcPairMetrics(1, 11)\r\n[z_1_12, cs_1_12, cl_1_12, cb_1_12, rp_1_12, cp_1_12] = calcPairMetrics(1, 12)\r\n[z_1_13, cs_1_13, cl_1_13, cb_1_13, rp_1_13, cp_1_13] = calcPairMetrics(1, 13)\r\n[z_1_14, cs_1_14, cl_1_14, cb_1_14, rp_1_14, cp_1_14] = calcPairMetrics(1, 14)\r\n[z_1_15, cs_1_15, cl_1_15, cb_1_15, rp_1_15, cp_1_15] = calcPairMetrics(1, 15)\r\n[z_1_16, cs_1_16, cl_1_16, cb_1_16, rp_1_16, cp_1_16] = calcPairMetrics(1, 16)\r\n\r\n[z_2_3, cs_2_3, cl_2_3, cb_2_3, rp_2_3, cp_2_3] = calcPairMetrics(2, 3)\r\n[z_2_4, cs_2_4, cl_2_4, cb_2_4, rp_2_4, cp_2_4] = calcPairMetrics(2, 4)\r\n[z_2_5, cs_2_5, cl_2_5, cb_2_5, rp_2_5, cp_2_5] = calcPairMetrics(2, 5)\r\n[z_2_6, cs_2_6, cl_2_6, cb_2_6, rp_2_6, cp_2_6] = calcPairMetrics(2, 6)\r\n[z_2_7, cs_2_7, cl_2_7, cb_2_7, rp_2_7, cp_2_7] = calcPairMetrics(2, 7)\r\n[z_2_8, cs_2_8, cl_2_8, cb_2_8, rp_2_8, cp_2_8] = calcPairMetrics(2, 8)\r\n[z_2_9, cs_2_9, cl_2_9, cb_2_9, rp_2_9, cp_2_9] = calcPairMetrics(2, 9)\r\n[z_2_10, cs_2_10, cl_2_10, cb_2_10, rp_2_10, cp_2_10] = calcPairMetrics(2, 10)\r\n[z_2_11, cs_2_11, cl_2_11, cb_2_11, rp_2_11, cp_2_11] = calcPairMetrics(2, 11)\r\n[z_2_12, cs_2_12, cl_2_12, cb_2_12, rp_2_12, cp_2_12] = calcPairMetrics(2, 12)\r\n[z_2_13, cs_2_13, cl_2_13, cb_2_13, rp_2_13, cp_2_13] = calcPairMetrics(2, 13)\r\n[z_2_14, cs_2_14, cl_2_14, cb_2_14, rp_2_14, cp_2_14] = calcPairMetrics(2, 14)\r\n[z_2_15, cs_2_15, cl_2_15, cb_2_15, rp_2_15, cp_2_15] = calcPairMetrics(2, 15)\r\n[z_2_16, cs_2_16, cl_2_16, cb_2_16, rp_2_16, cp_2_16] = calcPairMetrics(2, 16)\r\n\r\n[z_3_4, cs_3_4, cl_3_4, cb_3_4, rp_3_4, cp_3_4] = calcPairMetrics(3, 4)\r\n[z_3_5, cs_3_5, cl_3_5, cb_3_5, rp_3_5, cp_3_5] = calcPairMetrics(3, 5)\r\n[z_3_6, cs_3_6, cl_3_6, cb_3_6, rp_3_6, cp_3_6] = calcPairMetrics(3, 6)\r\n[z_3_7, cs_3_7, cl_3_7, cb_3_7, rp_3_7, cp_3_7] = calcPairMetrics(3, 7)\r\n[z_3_8, cs_3_8, cl_3_8, cb_3_8, rp_3_8, cp_3_8] = calcPairMetrics(3, 8)\r\n[z_3_9, cs_3_9, cl_3_9, cb_3_9, rp_3_9, cp_3_9] = calcPairMetrics(3, 9)\r\n[z_3_10, cs_3_10, cl_3_10, cb_3_10, rp_3_10, cp_3_10] = calcPairMetrics(3, 10)\r\n[z_3_11, cs_3_11, cl_3_11, cb_3_11, rp_3_11, cp_3_11] = calcPairMetrics(3, 11)\r\n[z_3_12, cs_3_12, cl_3_12, cb_3_12, rp_3_12, cp_3_12] = calcPairMetrics(3, 12)\r\n[z_3_13, cs_3_13, cl_3_13, cb_3_13, rp_3_13, cp_3_13] = calcPairMetrics(3, 13)\r\n[z_3_14, cs_3_14, cl_3_14, cb_3_14, rp_3_14, cp_3_14] = calcPairMetrics(3, 14)\r\n[z_3_15, cs_3_15, cl_3_15, cb_3_15, rp_3_15, cp_3_15] = calcPairMetrics(3, 15)\r\n[z_3_16, cs_3_16, cl_3_16, cb_3_16, rp_3_16, cp_3_16] = calcPairMetrics(3, 16)\r\n\r\n[z_4_5, cs_4_5, cl_4_5, cb_4_5, rp_4_5, cp_4_5] = calcPairMetrics(4, 5)\r\n[z_4_6, cs_4_6, cl_4_6, cb_4_6, rp_4_6, cp_4_6] = calcPairMetrics(4, 6)\r\n[z_4_7, cs_4_7, cl_4_7, cb_4_7, rp_4_7, cp_4_7] = calcPairMetrics(4, 7)\r\n[z_4_8, cs_4_8, cl_4_8, cb_4_8, rp_4_8, cp_4_8] = calcPairMetrics(4, 8)\r\n[z_4_9, cs_4_9, cl_4_9, cb_4_9, rp_4_9, cp_4_9] = calcPairMetrics(4, 9)\r\n[z_4_10, cs_4_10, cl_4_10, cb_4_10, rp_4_10, cp_4_10] = calcPairMetrics(4, 10)\r\n[z_4_11, cs_4_11, cl_4_11, cb_4_11, rp_4_11, cp_4_11] = calcPairMetrics(4, 11)\r\n[z_4_12, cs_4_12, cl_4_12, cb_4_12, rp_4_12, cp_4_12] = calcPairMetrics(4, 12)\r\n[z_4_13, cs_4_13, cl_4_13, cb_4_13, rp_4_13, cp_4_13] = calcPairMetrics(4, 13)\r\n[z_4_14, cs_4_14, cl_4_14, cb_4_14, rp_4_14, cp_4_14] = calcPairMetrics(4, 14)\r\n[z_4_15, cs_4_15, cl_4_15, cb_4_15, rp_4_15, cp_4_15] = calcPairMetrics(4, 15)\r\n[z_4_16, cs_4_16, cl_4_16, cb_4_16, rp_4_16, cp_4_16] = calcPairMetrics(4, 16)\r\n\r\n[z_5_6, cs_5_6, cl_5_6, cb_5_6, rp_5_6, cp_5_6] = calcPairMetrics(5, 6)\r\n[z_5_7, cs_5_7, cl_5_7, cb_5_7, rp_5_7, cp_5_7] = calcPairMetrics(5, 7)\r\n[z_5_8, cs_5_8, cl_5_8, cb_5_8, rp_5_8, cp_5_8] = calcPairMetrics(5, 8)\r\n[z_5_9, cs_5_9, cl_5_9, cb_5_9, rp_5_9, cp_5_9] = calcPairMetrics(5, 9)\r\n[z_5_10, cs_5_10, cl_5_10, cb_5_10, rp_5_10, cp_5_10] = calcPairMetrics(5, 10)\r\n[z_5_11, cs_5_11, cl_5_11, cb_5_11, rp_5_11, cp_5_11] = calcPairMetrics(5, 11)\r\n[z_5_12, cs_5_12, cl_5_12, cb_5_12, rp_5_12, cp_5_12] = calcPairMetrics(5, 12)\r\n[z_5_13, cs_5_13, cl_5_13, cb_5_13, rp_5_13, cp_5_13] = calcPairMetrics(5, 13)\r\n[z_5_14, cs_5_14, cl_5_14, cb_5_14, rp_5_14, cp_5_14] = calcPairMetrics(5, 14)\r\n[z_5_15, cs_5_15, cl_5_15, cb_5_15, rp_5_15, cp_5_15] = calcPairMetrics(5, 15)\r\n[z_5_16, cs_5_16, cl_5_16, cb_5_16, rp_5_16, cp_5_16] = calcPairMetrics(5, 16)\r\n\r\n[z_6_7, cs_6_7, cl_6_7, cb_6_7, rp_6_7, cp_6_7] = calcPairMetrics(6, 7)\r\n[z_6_8, cs_6_8, cl_6_8, cb_6_8, rp_6_8, cp_6_8] = calcPairMetrics(6, 8)\r\n[z_6_9, cs_6_9, cl_6_9, cb_6_9, rp_6_9, cp_6_9] = calcPairMetrics(6, 9)\r\n[z_6_10, cs_6_10, cl_6_10, cb_6_10, rp_6_10, cp_6_10] = calcPairMetrics(6, 10)\r\n[z_6_11, cs_6_11, cl_6_11, cb_6_11, rp_6_11, cp_6_11] = calcPairMetrics(6, 11)\r\n[z_6_12, cs_6_12, cl_6_12, cb_6_12, rp_6_12, cp_6_12] = calcPairMetrics(6, 12)\r\n[z_6_13, cs_6_13, cl_6_13, cb_6_13, rp_6_13, cp_6_13] = calcPairMetrics(6, 13)\r\n[z_6_14, cs_6_14, cl_6_14, cb_6_14, rp_6_14, cp_6_14] = calcPairMetrics(6, 14)\r\n[z_6_15, cs_6_15, cl_6_15, cb_6_15, rp_6_15, cp_6_15] = calcPairMetrics(6, 15)\r\n[z_6_16, cs_6_16, cl_6_16, cb_6_16, rp_6_16, cp_6_16] = calcPairMetrics(6, 16)\r\n\r\n[z_7_8, cs_7_8, cl_7_8, cb_7_8, rp_7_8, cp_7_8] = calcPairMetrics(7, 8)\r\n[z_7_9, cs_7_9, cl_7_9, cb_7_9, rp_7_9, cp_7_9] = calcPairMetrics(7, 9)\r\n[z_7_10, cs_7_10, cl_7_10, cb_7_10, rp_7_10, cp_7_10] = calcPairMetrics(7, 10)\r\n[z_7_11, cs_7_11, cl_7_11, cb_7_11, rp_7_11, cp_7_11] = calcPairMetrics(7, 11)\r\n[z_7_12, cs_7_12, cl_7_12, cb_7_12, rp_7_12, cp_7_12] = calcPairMetrics(7, 12)\r\n[z_7_13, cs_7_13, cl_7_13, cb_7_13, rp_7_13, cp_7_13] = calcPairMetrics(7, 13)\r\n[z_7_14, cs_7_14, cl_7_14, cb_7_14, rp_7_14, cp_7_14] = calcPairMetrics(7, 14)\r\n[z_7_15, cs_7_15, cl_7_15, cb_7_15, rp_7_15, cp_7_15] = calcPairMetrics(7, 15)\r\n[z_7_16, cs_7_16, cl_7_16, cb_7_16, rp_7_16, cp_7_16] = calcPairMetrics(7, 16)\r\n\r\n[z_8_9, cs_8_9, cl_8_9, cb_8_9, rp_8_9, cp_8_9] = calcPairMetrics(8, 9)\r\n[z_8_10, cs_8_10, cl_8_10, cb_8_10, rp_8_10, cp_8_10] = calcPairMetrics(8, 10)\r\n[z_8_11, cs_8_11, cl_8_11, cb_8_11, rp_8_11, cp_8_11] = calcPairMetrics(8, 11)\r\n[z_8_12, cs_8_12, cl_8_12, cb_8_12, rp_8_12, cp_8_12] = calcPairMetrics(8, 12)\r\n[z_8_13, cs_8_13, cl_8_13, cb_8_13, rp_8_13, cp_8_13] = calcPairMetrics(8, 13)\r\n[z_8_14, cs_8_14, cl_8_14, cb_8_14, rp_8_14, cp_8_14] = calcPairMetrics(8, 14)\r\n[z_8_15, cs_8_15, cl_8_15, cb_8_15, rp_8_15, cp_8_15] = calcPairMetrics(8, 15)\r\n[z_8_16, cs_8_16, cl_8_16, cb_8_16, rp_8_16, cp_8_16] = calcPairMetrics(8, 16)\r\n\r\n[z_9_10, cs_9_10, cl_9_10, cb_9_10, rp_9_10, cp_9_10] = calcPairMetrics(9, 10)\r\n[z_9_11, cs_9_11, cl_9_11, cb_9_11, rp_9_11, cp_9_11] = calcPairMetrics(9, 11)\r\n[z_9_12, cs_9_12, cl_9_12, cb_9_12, rp_9_12, cp_9_12] = calcPairMetrics(9, 12)\r\n[z_9_13, cs_9_13, cl_9_13, cb_9_13, rp_9_13, cp_9_13] = calcPairMetrics(9, 13)\r\n[z_9_14, cs_9_14, cl_9_14, cb_9_14, rp_9_14, cp_9_14] = calcPairMetrics(9, 14)\r\n[z_9_15, cs_9_15, cl_9_15, cb_9_15, rp_9_15, cp_9_15] = calcPairMetrics(9, 15)\r\n[z_9_16, cs_9_16, cl_9_16, cb_9_16, rp_9_16, cp_9_16] = calcPairMetrics(9, 16)\r\n\r\n[z_10_11, cs_10_11, cl_10_11, cb_10_11, rp_10_11, cp_10_11] = calcPairMetrics(10, 11)\r\n[z_10_12, cs_10_12, cl_10_12, cb_10_12, rp_10_12, cp_10_12] = calcPairMetrics(10, 12)\r\n[z_10_13, cs_10_13, cl_10_13, cb_10_13, rp_10_13, cp_10_13] = calcPairMetrics(10, 13)\r\n[z_10_14, cs_10_14, cl_10_14, cb_10_14, rp_10_14, cp_10_14] = calcPairMetrics(10, 14)\r\n[z_10_15, cs_10_15, cl_10_15, cb_10_15, rp_10_15, cp_10_15] = calcPairMetrics(10, 15)\r\n[z_10_16, cs_10_16, cl_10_16, cb_10_16, rp_10_16, cp_10_16] = calcPairMetrics(10, 16)\r\n\r\n[z_11_12, cs_11_12, cl_11_12, cb_11_12, rp_11_12, cp_11_12] = calcPairMetrics(11, 12)\r\n[z_11_13, cs_11_13, cl_11_13, cb_11_13, rp_11_13, cp_11_13] = calcPairMetrics(11, 13)\r\n[z_11_14, cs_11_14, cl_11_14, cb_11_14, rp_11_14, cp_11_14] = calcPairMetrics(11, 14)\r\n[z_11_15, cs_11_15, cl_11_15, cb_11_15, rp_11_15, cp_11_15] = calcPairMetrics(11, 15)\r\n[z_11_16, cs_11_16, cl_11_16, cb_11_16, rp_11_16, cp_11_16] = calcPairMetrics(11, 16)\r\n\r\n[z_12_13, cs_12_13, cl_12_13, cb_12_13, rp_12_13, cp_12_13] = calcPairMetrics(12, 13)\r\n[z_12_14, cs_12_14, cl_12_14, cb_12_14, rp_12_14, cp_12_14] = calcPairMetrics(12, 14)\r\n[z_12_15, cs_12_15, cl_12_15, cb_12_15, rp_12_15, cp_12_15] = calcPairMetrics(12, 15)\r\n[z_12_16, cs_12_16, cl_12_16, cb_12_16, rp_12_16, cp_12_16] = calcPairMetrics(12, 16)\r\n\r\n[z_13_14, cs_13_14, cl_13_14, cb_13_14, rp_13_14, cp_13_14] = calcPairMetrics(13, 14)\r\n[z_13_15, cs_13_15, cl_13_15, cb_13_15, rp_13_15, cp_13_15] = calcPairMetrics(13, 15)\r\n[z_13_16, cs_13_16, cl_13_16, cb_13_16, rp_13_16, cp_13_16] = calcPairMetrics(13, 16)\r\n\r\n[z_14_15, cs_14_15, cl_14_15, cb_14_15, rp_14_15, cp_14_15] = calcPairMetrics(14, 15)\r\n[z_14_16, cs_14_16, cl_14_16, cb_14_16, rp_14_16, cp_14_16] = calcPairMetrics(14, 16)\r\n\r\n[z_15_16, cs_15_16, cl_15_16, cb_15_16, rp_15_16, cp_15_16] = calcPairMetrics(15, 16)\r\n\r\n//==============================================================================\r\n// DEEP DIVE CALCULATIONS\r\n//==============================================================================\r\ndeepPrice1Val = getPrice(deepSym1)\r\ndeepPrice2Val = getPrice(deepSym2)\r\ndeepRet1 = getReturn(deepSym1)\r\ndeepRet2 = getReturn(deepSym2)\r\ndeepPerf1 = getPerf(deepSym1)\r\ndeepPerf2 = getPerf(deepSym2)\r\n\r\ndeepRatio = math.log(deepPrice1Val / deepPrice2Val)\r\ndeepZscore = stats.zscore(deepRatio, zscoreLength)\r\ndeepCorrShort = stats.correlation(deepRet1, deepRet2, corrLengthShort)\r\ndeepCorrLong = stats.correlation(deepRet1, deepRet2, corrLengthLong)\r\ndeepCorrBreakdown = deepCorrLong - deepCorrShort\r\ndeepRelPerfDiff = deepPerf1 - deepPerf2\r\n\r\n// Bollinger Bands on ratio\r\ndeepBasis = ta.sma(deepRatio, bbLength)\r\ndeepDev = ta.stdev(deepRatio, bbLength)\r\ndeepUpper = deepBasis + bbMult * deepDev\r\ndeepLower = deepBasis - bbMult * deepDev\r\n\r\n//==============================================================================\r\n// HELPER FUNCTION: Get correlation by pair indices (must be at global scope)\r\n//==============================================================================\r\ngetCorrShort(i, j) =>\r\n    // Ensure consistent ordering (smaller index first) without recursion\r\n    i1 = math.min(i, j)\r\n    j1 = math.max(i, j)\r\n    if i1 == j1\r\n        1.0\r\n    else\r\n        switch\r\n            i1 == 1 and j1 == 2 => cs_1_2\r\n            i1 == 1 and j1 == 3 => cs_1_3\r\n            i1 == 1 and j1 == 4 => cs_1_4\r\n            i1 == 1 and j1 == 5 => cs_1_5\r\n            i1 == 1 and j1 == 6 => cs_1_6\r\n            i1 == 1 and j1 == 7 => cs_1_7\r\n            i1 == 1 and j1 == 8 => cs_1_8\r\n            i1 == 1 and j1 == 9 => cs_1_9\r\n            i1 == 1 and j1 == 10 => cs_1_10\r\n            i1 == 1 and j1 == 11 => cs_1_11\r\n            i1 == 1 and j1 == 12 => cs_1_12\r\n            i1 == 1 and j1 == 13 => cs_1_13\r\n            i1 == 1 and j1 == 14 => cs_1_14\r\n            i1 == 1 and j1 == 15 => cs_1_15\r\n            i1 == 1 and j1 == 16 => cs_1_16\r\n            i1 == 2 and j1 == 3 => cs_2_3\r\n            i1 == 2 and j1 == 4 => cs_2_4\r\n            i1 == 2 and j1 == 5 => cs_2_5\r\n            i1 == 2 and j1 == 6 => cs_2_6\r\n            i1 == 2 and j1 == 7 => cs_2_7\r\n            i1 == 2 and j1 == 8 => cs_2_8\r\n            i1 == 2 and j1 == 9 => cs_2_9\r\n            i1 == 2 and j1 == 10 => cs_2_10\r\n            i1 == 2 and j1 == 11 => cs_2_11\r\n            i1 == 2 and j1 == 12 => cs_2_12\r\n            i1 == 2 and j1 == 13 => cs_2_13\r\n            i1 == 2 and j1 == 14 => cs_2_14\r\n            i1 == 2 and j1 == 15 => cs_2_15\r\n            i1 == 2 and j1 == 16 => cs_2_16\r\n            i1 == 3 and j1 == 4 => cs_3_4\r\n            i1 == 3 and j1 == 5 => cs_3_5\r\n            i1 == 3 and j1 == 6 => cs_3_6\r\n            i1 == 3 and j1 == 7 => cs_3_7\r\n            i1 == 3 and j1 == 8 => cs_3_8\r\n            i1 == 3 and j1 == 9 => cs_3_9\r\n            i1 == 3 and j1 == 10 => cs_3_10\r\n            i1 == 3 and j1 == 11 => cs_3_11\r\n            i1 == 3 and j1 == 12 => cs_3_12\r\n            i1 == 3 and j1 == 13 => cs_3_13\r\n            i1 == 3 and j1 == 14 => cs_3_14\r\n            i1 == 3 and j1 == 15 => cs_3_15\r\n            i1 == 3 and j1 == 16 => cs_3_16\r\n            i1 == 4 and j1 == 5 => cs_4_5\r\n            i1 == 4 and j1 == 6 => cs_4_6\r\n            i1 == 4 and j1 == 7 => cs_4_7\r\n            i1 == 4 and j1 == 8 => cs_4_8\r\n            i1 == 4 and j1 == 9 => cs_4_9\r\n            i1 == 4 and j1 == 10 => cs_4_10\r\n            i1 == 4 and j1 == 11 => cs_4_11\r\n            i1 == 4 and j1 == 12 => cs_4_12\r\n            i1 == 4 and j1 == 13 => cs_4_13\r\n            i1 == 4 and j1 == 14 => cs_4_14\r\n            i1 == 4 and j1 == 15 => cs_4_15\r\n            i1 == 4 and j1 == 16 => cs_4_16\r\n            i1 == 5 and j1 == 6 => cs_5_6\r\n            i1 == 5 and j1 == 7 => cs_5_7\r\n            i1 == 5 and j1 == 8 => cs_5_8\r\n            i1 == 5 and j1 == 9 => cs_5_9\r\n            i1 == 5 and j1 == 10 => cs_5_10\r\n            i1 == 5 and j1 == 11 => cs_5_11\r\n            i1 == 5 and j1 == 12 => cs_5_12\r\n            i1 == 5 and j1 == 13 => cs_5_13\r\n            i1 == 5 and j1 == 14 => cs_5_14\r\n            i1 == 5 and j1 == 15 => cs_5_15\r\n            i1 == 5 and j1 == 16 => cs_5_16\r\n            i1 == 6 and j1 == 7 => cs_6_7\r\n            i1 == 6 and j1 == 8 => cs_6_8\r\n            i1 == 6 and j1 == 9 => cs_6_9\r\n            i1 == 6 and j1 == 10 => cs_6_10\r\n            i1 == 6 and j1 == 11 => cs_6_11\r\n            i1 == 6 and j1 == 12 => cs_6_12\r\n            i1 == 6 and j1 == 13 => cs_6_13\r\n            i1 == 6 and j1 == 14 => cs_6_14\r\n            i1 == 6 and j1 == 15 => cs_6_15\r\n            i1 == 6 and j1 == 16 => cs_6_16\r\n            i1 == 7 and j1 == 8 => cs_7_8\r\n            i1 == 7 and j1 == 9 => cs_7_9\r\n            i1 == 7 and j1 == 10 => cs_7_10\r\n            i1 == 7 and j1 == 11 => cs_7_11\r\n            i1 == 7 and j1 == 12 => cs_7_12\r\n            i1 == 7 and j1 == 13 => cs_7_13\r\n            i1 == 7 and j1 == 14 => cs_7_14\r\n            i1 == 7 and j1 == 15 => cs_7_15\r\n            i1 == 7 and j1 == 16 => cs_7_16\r\n            i1 == 8 and j1 == 9 => cs_8_9\r\n            i1 == 8 and j1 == 10 => cs_8_10\r\n            i1 == 8 and j1 == 11 => cs_8_11\r\n            i1 == 8 and j1 == 12 => cs_8_12\r\n            i1 == 8 and j1 == 13 => cs_8_13\r\n            i1 == 8 and j1 == 14 => cs_8_14\r\n            i1 == 8 and j1 == 15 => cs_8_15\r\n            i1 == 8 and j1 == 16 => cs_8_16\r\n            i1 == 9 and j1 == 10 => cs_9_10\r\n            i1 == 9 and j1 == 11 => cs_9_11\r\n            i1 == 9 and j1 == 12 => cs_9_12\r\n            i1 == 9 and j1 == 13 => cs_9_13\r\n            i1 == 9 and j1 == 14 => cs_9_14\r\n            i1 == 9 and j1 == 15 => cs_9_15\r\n            i1 == 9 and j1 == 16 => cs_9_16\r\n            i1 == 10 and j1 == 11 => cs_10_11\r\n            i1 == 10 and j1 == 12 => cs_10_12\r\n            i1 == 10 and j1 == 13 => cs_10_13\r\n            i1 == 10 and j1 == 14 => cs_10_14\r\n            i1 == 10 and j1 == 15 => cs_10_15\r\n            i1 == 10 and j1 == 16 => cs_10_16\r\n            i1 == 11 and j1 == 12 => cs_11_12\r\n            i1 == 11 and j1 == 13 => cs_11_13\r\n            i1 == 11 and j1 == 14 => cs_11_14\r\n            i1 == 11 and j1 == 15 => cs_11_15\r\n            i1 == 11 and j1 == 16 => cs_11_16\r\n            i1 == 12 and j1 == 13 => cs_12_13\r\n            i1 == 12 and j1 == 14 => cs_12_14\r\n            i1 == 12 and j1 == 15 => cs_12_15\r\n            i1 == 12 and j1 == 16 => cs_12_16\r\n            i1 == 13 and j1 == 14 => cs_13_14\r\n            i1 == 13 and j1 == 15 => cs_13_15\r\n            i1 == 13 and j1 == 16 => cs_13_16\r\n            i1 == 14 and j1 == 15 => cs_14_15\r\n            i1 == 14 and j1 == 16 => cs_14_16\r\n            i1 == 15 and j1 == 16 => cs_15_16\r\n            => 0.0\r\n\r\n//==============================================================================\r\n// HEATMAP (16x16 correlation matrix)\r\n//==============================================================================\r\nvar table heatmapTable = table.new(getTablePos(heatmapPos), 17, 17, bgcolor=color.new(color.black, 80), border_width=1)\r\n\r\nif showHeatmap and barstate.islast\r\n    // Header\r\n    table.cell(heatmapTable, 0, 0, "CORR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    // Column and row headers\r\n    for i = 0 to 15\r\n        symName = array.get(symNames, i)\r\n        table.cell(heatmapTable, i + 1, 0, symName, bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n        table.cell(heatmapTable, 0, i + 1, symName, bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    // Fill matrix\r\n    for i = 1 to 16\r\n        for j = 1 to 16\r\n            corrVal = getCorrShort(i, j)\r\n            cellColor = i == j ? color.new(color.blue, 60) : getCorrColor(corrVal)\r\n            table.cell(heatmapTable, j, i, str.tostring(corrVal, "#.##"), bgcolor=cellColor, text_color=color.white, text_size=getFontSize())\r\n\r\n//==============================================================================\r\n// DIVERGENCE RANKING TABLE\r\n//==============================================================================\r\nvar table rankTable = table.new(getTablePos(rankTablePos), 8, numRankings + 1, bgcolor=color.new(color.black, 80), border_width=1)\r\n\r\nif showRankTable and barstate.islast\r\n    // Create array of SPY pairs only (15 pairs: SPY with each of the other 15 symbols)\r\n    var pairs = array.new<PairData>(15)\r\n\r\n    // Populate pairs array - only SPY pairs\r\n    pairIdx = 0\r\n\r\n    // SPY (symbol 1) pairs with all other symbols\r\n    array.set(pairs, pairIdx, PairData.new(1, 2, array.get(symNames, 0) + "/" + array.get(symNames, 1), z_1_2, cs_1_2, cl_1_2, cb_1_2, rp_1_2, cp_1_2)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 3, array.get(symNames, 0) + "/" + array.get(symNames, 2), z_1_3, cs_1_3, cl_1_3, cb_1_3, rp_1_3, cp_1_3)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 4, array.get(symNames, 0) + "/" + array.get(symNames, 3), z_1_4, cs_1_4, cl_1_4, cb_1_4, rp_1_4, cp_1_4)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 5, array.get(symNames, 0) + "/" + array.get(symNames, 4), z_1_5, cs_1_5, cl_1_5, cb_1_5, rp_1_5, cp_1_5)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 6, array.get(symNames, 0) + "/" + array.get(symNames, 5), z_1_6, cs_1_6, cl_1_6, cb_1_6, rp_1_6, cp_1_6)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 7, array.get(symNames, 0) + "/" + array.get(symNames, 6), z_1_7, cs_1_7, cl_1_7, cb_1_7, rp_1_7, cp_1_7)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 8, array.get(symNames, 0) + "/" + array.get(symNames, 7), z_1_8, cs_1_8, cl_1_8, cb_1_8, rp_1_8, cp_1_8)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 9, array.get(symNames, 0) + "/" + array.get(symNames, 8), z_1_9, cs_1_9, cl_1_9, cb_1_9, rp_1_9, cp_1_9)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 10, array.get(symNames, 0) + "/" + array.get(symNames, 9), z_1_10, cs_1_10, cl_1_10, cb_1_10, rp_1_10, cp_1_10)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 11, array.get(symNames, 0) + "/" + array.get(symNames, 10), z_1_11, cs_1_11, cl_1_11, cb_1_11, rp_1_11, cp_1_11)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 12, array.get(symNames, 0) + "/" + array.get(symNames, 11), z_1_12, cs_1_12, cl_1_12, cb_1_12, rp_1_12, cp_1_12)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 13, array.get(symNames, 0) + "/" + array.get(symNames, 12), z_1_13, cs_1_13, cl_1_13, cb_1_13, rp_1_13, cp_1_13)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 14, array.get(symNames, 0) + "/" + array.get(symNames, 13), z_1_14, cs_1_14, cl_1_14, cb_1_14, rp_1_14, cp_1_14)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 15, array.get(symNames, 0) + "/" + array.get(symNames, 14), z_1_15, cs_1_15, cl_1_15, cb_1_15, rp_1_15, cp_1_15)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 16, array.get(symNames, 0) + "/" + array.get(symNames, 15), z_1_16, cs_1_16, cl_1_16, cb_1_16, rp_1_16, cp_1_16))\r\n\r\n    // Sort by composite score (bubble sort)\r\n    for i = 0 to 13\r\n        for j = 0 to 13 - i\r\n            if array.get(pairs, j).composite < array.get(pairs, j + 1).composite\r\n                temp = array.get(pairs, j)\r\n                array.set(pairs, j, array.get(pairs, j + 1))\r\n                array.set(pairs, j + 1, temp)\r\n\r\n    // Draw table headers\r\n    table.cell(rankTable, 0, 0, "#", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 1, 0, "PAIR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 2, 0, "SECTOR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 3, 0, "Z-SCORE", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 4, 0, "CORR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 5, 0, "PERF%", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 6, 0, "SCORE", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 7, 0, "SIGNAL", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    for i = 0 to numRankings - 1\r\n        pair = array.get(pairs, i)\r\n        sectorName = getSectorName(pair.idx2)\r\n        otherSymbol = str.split(pair.name, "/").get(1)\r\n        signal = pair.zscore > zscoreThreshold ? "LONG " + otherSymbol : pair.zscore < -zscoreThreshold ? "SHORT " + otherSymbol : "-"\r\n        signalColor = pair.zscore > zscoreStrong or pair.zscore < -zscoreStrong ? color.new(color.red, 20) : signal != "-" ? color.new(color.purple, 40) : color.new(color.gray, 80)\r\n\r\n        table.cell(rankTable, 0, i + 1, str.tostring(i + 1), bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 1, i + 1, pair.name, bgcolor=color.new(color.gray, 80), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 2, i + 1, sectorName, bgcolor=color.new(color.gray, 80), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 3, i + 1, str.tostring(pair.zscore, "#.##"), bgcolor=getZscoreColor(pair.zscore), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 4, i + 1, str.tostring(pair.corrShort, "#.##"), bgcolor=getCorrColor(pair.corrShort), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 5, i + 1, str.tostring(pair.relPerfDiff, "#.#"), bgcolor=color.new(math.abs(pair.relPerfDiff) > 5 ? color.orange : color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 6, i + 1, str.tostring(pair.composite, "#.##"), bgcolor=getCompositeColor(pair.composite), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 7, i + 1, signal, bgcolor=signalColor, text_color=color.white, text_size=getFontSize())\r\n\r\n//==============================================================================\r\n// DEEP DIVE PLOTS\r\n//==============================================================================\r\ndeepName1 = array.get(symNames, deepSym1 - 1)\r\ndeepName2 = array.get(symNames, deepSym2 - 1)\r\n\r\n// Dynamic color gradient for z-score with modern vibrant colors\r\ngetZscoreGradient(z) =>\r\n    if z >= zscoreStrong\r\n        color.rgb(220, 38, 127)  // Hot pink for strong signals\r\n    else if z >= zscoreThreshold\r\n        color.rgb(251, 146, 60)  // Vibrant orange\r\n    else if z >= 0.5\r\n        color.rgb(250, 204, 21)  // Bright yellow\r\n    else if z >= -0.5\r\n        color.rgb(148, 163, 184)  // Neutral gray-blue\r\n    else if z >= -zscoreThreshold\r\n        color.rgb(74, 222, 128)  // Bright lime green\r\n    else if z >= -zscoreStrong\r\n        color.rgb(34, 197, 94)  // Vibrant green\r\n    else\r\n        color.rgb(16, 185, 129)  // Deep emerald\r\n\r\n// Main z-score line with gradient color\r\nzscoreColor = getZscoreGradient(deepZscore)\r\nzscorePlot = plot(showDeepDive ? deepZscore : na, "Z-Score", color=zscoreColor, linewidth=3, style=plot.style_line)\r\n\r\n// Threshold reference lines with softer modern colors\r\nhline(zscoreStrong, "Strong Upper", color=color.new(color.rgb(239, 68, 68), 65), linestyle=hline.style_dashed, linewidth=1)\r\nhline(zscoreThreshold, "Upper Threshold", color=color.new(color.rgb(249, 115, 22), 70), linestyle=hline.style_dotted, linewidth=1)\r\nhline(0, "Zero Line", color=color.new(color.rgb(100, 116, 139), 60), linestyle=hline.style_solid, linewidth=2)\r\nhline(-zscoreThreshold, "Lower Threshold", color=color.new(color.rgb(132, 204, 22), 70), linestyle=hline.style_dotted, linewidth=1)\r\nhline(-zscoreStrong, "Strong Lower", color=color.new(color.rgb(34, 197, 94), 65), linestyle=hline.style_dashed, linewidth=1)\r\n\r\n// Create zone fills with gradient transparency for modern look\r\nupperStrongZone = hline(zscoreStrong, linestyle=hline.style_solid, color=na, editable=false)\r\nupperThresholdZone = hline(zscoreThreshold, linestyle=hline.style_solid, color=na, editable=false)\r\nzeroZone = hline(0, linestyle=hline.style_solid, color=na, editable=false)\r\nlowerThresholdZone = hline(-zscoreThreshold, linestyle=hline.style_solid, color=na, editable=false)\r\nlowerStrongZone = hline(-zscoreStrong, linestyle=hline.style_solid, color=na, editable=false)\r\n\r\n// Fill zones with modern gradient backgrounds\r\nfill(upperStrongZone, upperThresholdZone, color=color.new(color.rgb(239, 68, 68), 92), title="Strong Short Zone")\r\nfill(upperThresholdZone, zeroZone, color=color.new(color.rgb(251, 146, 60), 95), title="Short Zone")\r\nfill(zeroZone, lowerThresholdZone, color=color.new(color.rgb(34, 197, 94), 95), title="Long Zone")\r\nfill(lowerThresholdZone, lowerStrongZone, color=color.new(color.rgb(16, 185, 129), 92), title="Strong Long Zone")\r\n\r\n// Correlation plots with modern styling\r\nplot(showDeepDive ? deepCorrShort : na, "Short-Term Corr", color=color.new(color.rgb(59, 130, 246), 30), linewidth=2, style=plot.style_line)\r\nplot(showDeepDive ? deepCorrLong : na, "Long-Term Corr", color=color.new(color.rgb(168, 85, 247), 40), linewidth=2, style=plot.style_line)\r\n\r\n//==============================================================================\r\n// INFO LABEL\r\n//==============================================================================\r\nif showDeepDive and barstate.islast\r\n    signalText = deepZscore > zscoreStrong ? "STRONG SHORT " + deepName1 : deepZscore > zscoreThreshold ? "SHORT " + deepName1 : deepZscore < -zscoreStrong ? "STRONG LONG " + deepName1 : deepZscore < -zscoreThreshold ? "LONG " + deepName1 : "NEUTRAL"\r\n\r\n    infoText = "Deep Dive: " + deepName1 + " / " + deepName2 +\r\n               "\\nZ-Score: " + str.tostring(deepZscore, "#.##") +\r\n               "\\nCorr (S/L): " + str.tostring(deepCorrShort, "#.##") + " / " + str.tostring(deepCorrLong, "#.##") +\r\n               "\\nCorr Breakdown: " + str.tostring(deepCorrBreakdown, "#.##") +\r\n               "\\nRel Perf Diff: " + str.tostring(deepRelPerfDiff, "#.#") + "%" +\r\n               "\\nSignal: " + signalText\r\n\r\n    label.new(bar_index, deepZscore, infoText,\r\n              style=label.style_label_left,\r\n              color=color.new(color.black, 60),\r\n              textcolor=color.white,\r\n              size=size.small)\r\n\r\n//==============================================================================\r\n// ALERTS\r\n//==============================================================================\r\nalertcondition(deepZscore > zscoreThreshold, title="Z-Score Above Threshold", message="{{ticker}}: Z-Score above signal threshold")\r\nalertcondition(deepZscore < -zscoreThreshold, title="Z-Score Below Threshold", message="{{ticker}}: Z-Score below signal threshold")\r\nalertcondition(deepZscore > zscoreStrong, title="Strong Positive Divergence", message="{{ticker}}: Strong positive divergence detected")\r\nalertcondition(deepZscore < -zscoreStrong, title="Strong Negative Divergence", message="{{ticker}}: Strong negative divergence detected")\r\nalertcondition(deepCorrBreakdown > corrBreakdown, title="Correlation Breakdown", message="{{ticker}}: Correlation breakdown detected")\r\n'
[CAPTURE 1] '//@version=6\r\n// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © Henrique Centieiro\r\n\r\nindicator("Sector Divergence Dashboard", overlay=false, max_labels_count=500, max_lines_count=500)\r\n\r\n//==============================================================================\r\n// LIBRARY IMPORT\r\n//==============================================================================\r\nimport HenriqueCentieiro/PineStats/1 as stats\r\n\r\n//==============================================================================\r\n// INPUTS\r\n//==============================================================================\r\n// --- Symbol Selection (16 symbols) ---\r\ngrpSymbols = "═══ SYMBOL SELECTION ═══"\r\nsym1  = input.symbol("AMEX:SPY",  "1. SPY  (S&P 500)",         group=grpSymbols)\r\nsym2  = input.symbol("NASDAQ:QQQ", "2. QQQ  (Nasdaq 100)",     group=grpSymbols)\r\nsym3  = input.symbol("AMEX:IWM",  "3. IWM  (Russell 2000)",    group=grpSymbols)\r\nsym4  = input.symbol("AMEX:DIA",  "4. DIA  (Dow Jones)",       group=grpSymbols)\r\nsym5  = input.symbol("AMEX:XLK",  "5. XLK  (Technology)",      group=grpSymbols)\r\nsym6  = input.symbol("AMEX:XLF",  "6. XLF  (Financials)",      group=grpSymbols)\r\nsym7  = input.symbol("AMEX:XLE",  "7. XLE  (Energy)",          group=grpSymbols)\r\nsym8  = input.symbol("AMEX:XLV",  "8. XLV  (Healthcare)",      group=grpSymbols)\r\nsym9  = input.symbol("AMEX:XLY",  "9. XLY  (Cons. Discret.)",  group=grpSymbols)\r\nsym10 = input.symbol("AMEX:XLP",  "10. XLP (Cons. Staples)",   group=grpSymbols)\r\nsym11 = input.symbol("AMEX:XLI",  "11. XLI (Industrials)",     group=grpSymbols)\r\nsym12 = input.symbol("AMEX:XLU",  "12. XLU (Utilities)",       group=grpSymbols)\r\nsym13 = input.symbol("AMEX:XLB",  "13. XLB (Materials)",       group=grpSymbols)\r\nsym14 = input.symbol("AMEX:XLC",  "14. XLC (Comm. Services)",  group=grpSymbols)\r\nsym15 = input.symbol("AMEX:XLRE", "15. XLRE (Real Estate)",    group=grpSymbols)\r\nsym16 = input.symbol("NASDAQ:TLT", "16. TLT (Long Bonds)",     group=grpSymbols)\r\n\r\n// --- Parameters ---\r\ngrpParams = "═══ PARAMETERS ═══"\r\ncorrLengthShort = input.int(35, "Short-Term Correlation Length", minval=5, group=grpParams, tooltip="Lookback period for recent correlation. Lower values (5-10) detect quick changes, higher values (20-50) smooth out noise")\r\ncorrLengthLong  = input.int(100, "Long-Term Correlation Length", minval=20, group=grpParams, tooltip="Lookback period for stable correlation baseline. Use 50-100 for daily charts, 20-50 for intraday. Higher = more stable reference")\r\nzscoreLength    = input.int(100, "Z-Score Length", minval=10, group=grpParams, tooltip="Lookback period for z-score calculation (mean reversion). Lower values (20-30) = more sensitive signals, higher values (100-150) = fewer but stronger signals")\r\nperfLength      = input.int(300, "Relative Performance Length", minval=5, group=grpParams, tooltip="Period for measuring relative performance difference. Lower values (10-20) track recent momentum, higher values (40-100) show longer trends")\r\nzscoreThreshold = input.float(1.0, "Z-Score Signal Threshold", minval=0.5, step=0.1, group=grpParams, tooltip="Minimum z-score for regular signals. Lower values (0.5-1.0) = more signals, higher values (1.5-2.5) = fewer but higher quality signals")\r\nzscoreStrong    = input.float(2.0, "Z-Score Strong Signal", minval=1.0, step=0.1, group=grpParams, tooltip="Z-score threshold for strong divergence signals. Typical: 2.0 for daily charts, 2.5+ for higher conviction trades")\r\ncorrBreakdown   = input.float(0.3, "Correlation Breakdown Threshold", minval=0.1, step=0.1, group=grpParams, tooltip="Alert when short-term corr drops this much below long-term. Lower values (0.1-0.2) = sensitive to correlation changes, higher values (0.4-0.6) = only major breakdowns")\r\n\r\n// --- Composite Score Weights ---\r\ngrpWeights = "═══ COMPOSITE SCORE WEIGHTS ═══"\r\nweightZscore   = input.float(0.5, "Z-Score Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much z-score contributes to composite ranking (0-1). Higher = prioritize extreme divergences. Default 0.5 balances all factors")\r\nweightCorrBrk  = input.float(0.25, "Correlation Breakdown Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much correlation breakdown affects ranking (0-1). Higher = prioritize pairs where correlation recently dropped. Use 0.3-0.4 for mean reversion focus")\r\nweightRelPerf  = input.float(0.25, "Relative Performance Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much relative performance affects ranking (0-1). Higher = prioritize momentum differences. Use 0.3-0.5 for momentum-based trading")\r\n\r\n// --- Visualization ---\r\ngrpVis = "═══ VISUALIZATION ═══"\r\nshowHeatmap    = input.bool(true, "Show Correlation Heatmap", group=grpVis, tooltip="Display 16x16 matrix showing all pair correlations. Turn off to reduce clutter or improve performance")\r\nshowRankTable  = input.bool(true, "Show Divergence Rankings", group=grpVis, tooltip="Show table of top opportunities ranked by composite score. This is your primary trading watchlist")\r\nshowDeepDive   = input.bool(true, "Show Deep Dive Chart", group=grpVis, tooltip="Display detailed z-score chart for selected pair below. Turn off if only using heatmap/rankings")\r\nnumRankings    = input.int(15, "Number of Rankings to Show", minval=5, maxval=15, group=grpVis, tooltip="How many pairs to display in ranking table. Maximum 15 shows all SPY pairs. Lower values (5-10) show only top opportunities")\r\n\r\n// --- Deep Dive Pair Selection ---\r\ngrpDeep = "═══ DEEP DIVE PAIR ═══"\r\ndeepSym1 = input.int(1, "Deep Dive: Symbol A (1-16)", minval=1, maxval=16, group=grpDeep, tooltip="First symbol for deep dive chart (base). 1=SPY, 2=QQQ, 3=IWM, 4=DIA, 5-15=Sectors, 16=TLT. Typically use broad market index")\r\ndeepSym2 = input.int(7, "Deep Dive: Symbol B (1-16)", minval=1, maxval=16, group=grpDeep, tooltip="Second symbol for deep dive chart (comparison). Select sector to analyze divergence. Default: 7=XLE (Energy)")\r\nbbLength = input.int(20, "Bollinger Band Length", minval=5, group=grpDeep, tooltip="Period for Bollinger Bands on price ratio. Lower values (10-20) = tighter bands, more signals. Higher values (40-60) = wider bands, fewer signals")\r\nbbMult   = input.float(2.0, "Bollinger Band Multiplier", minval=0.5, step=0.1, group=grpDeep, tooltip="Standard deviation multiplier for Bollinger Bands. 2.0 = standard (95% confidence), 2.5-3.0 = conservative (fewer signals), 1.5 = aggressive (more signals)")\r\n\r\n// --- Table Positions & Appearance ---\r\ngrpPos = "═══ TABLE POSITIONS & APPEARANCE ═══"\r\nheatmapPos = input.string("Bottom Left", "Heatmap Position", options=["Top Left", "Top Center", "Top Right", "Middle Left", "Middle Center", "Middle Right", "Bottom Left", "Bottom Center", "Bottom Right"], group=grpPos, tooltip="Where to display the correlation heatmap table on your chart. Adjust to avoid overlapping with price action or other tables")\r\nrankTablePos = input.string("Bottom Right", "Ranking Table Position", options=["Top Left", "Top Center", "Top Right", "Middle Left", "Middle Center", "Middle Right", "Bottom Left", "Bottom Center", "Bottom Right"], group=grpPos, tooltip="Where to display the divergence rankings table. Recommended: opposite corner from heatmap to maximize visibility")\r\nfontSize = input.string("Small", "Font Size", options=["Auto", "Tiny", "Small", "Normal", "Large", "Huge"], group=grpPos, tooltip="Table text size. Tiny/Small work best for displaying all data. Increase if tables are hard to read on your monitor")\r\n\r\n//==============================================================================\r\n// HELPER FUNCTIONS\r\n//==============================================================================\r\ngetTablePos(pos) =>\r\n    switch pos\r\n        "Top Left" => position.top_left\r\n        "Top Center" => position.top_center\r\n        "Top Right" => position.top_right\r\n        "Middle Left" => position.middle_left\r\n        "Middle Center" => position.middle_center\r\n        "Middle Right" => position.middle_right\r\n        "Bottom Left" => position.bottom_left\r\n        "Bottom Center" => position.bottom_center\r\n        "Bottom Right" => position.bottom_right\r\n        => position.top_right\r\n\r\ngetFontSize() =>\r\n    switch fontSize\r\n        "Auto" => size.auto\r\n        "Tiny" => size.tiny\r\n        "Small" => size.small\r\n        "Normal" => size.normal\r\n        "Large" => size.large\r\n        "Huge" => size.huge\r\n        => size.tiny\r\n\r\ngetCorrColor(corr) =>\r\n    if corr >= 0.7\r\n        color.new(color.green, 20)\r\n    else if corr >= 0.4\r\n        color.new(color.lime, 40)\r\n    else if corr >= 0.0\r\n        color.new(color.yellow, 40)\r\n    else if corr >= -0.4\r\n        color.new(color.orange, 40)\r\n    else\r\n        color.new(color.red, 20)\r\n\r\ngetZscoreColor(z) =>\r\n    absZ = math.abs(z)\r\n    if absZ >= 2.5\r\n        color.new(color.red, 0)\r\n    else if absZ >= 1.5\r\n        color.new(color.orange, 0)\r\n    else if absZ >= 1.0\r\n        color.new(color.yellow, 20)\r\n    else\r\n        color.new(color.gray, 40)\r\n\r\ngetCompositeColor(score) =>\r\n    if score >= 0.7\r\n        color.new(color.red, 0)\r\n    else if score >= 0.5\r\n        color.new(color.orange, 10)\r\n    else if score >= 0.3\r\n        color.new(color.yellow, 20)\r\n    else\r\n        color.new(color.gray, 50)\r\n\r\ngetTicker(sym) =>\r\n    parts = str.split(sym, ":")\r\n    array.size(parts) > 1 ? array.get(parts, 1) : sym\r\n\r\ngetSectorName(idx) =>\r\n    switch idx\r\n        1  => "S&P 500"\r\n        2  => "Nasdaq"\r\n        3  => "Small Cap"\r\n        4  => "Dow Jones"\r\n        5  => "Technology"\r\n        6  => "Financials"\r\n        7  => "Energy"\r\n        8  => "Healthcare"\r\n        9  => "Cons. Discret."\r\n        10 => "Cons. Staples"\r\n        11 => "Industrials"\r\n        12 => "Utilities"\r\n        13 => "Materials"\r\n        14 => "Communication"\r\n        15 => "Real Estate"\r\n        16 => "Bonds"\r\n        => "Unknown"\r\n\r\n//==============================================================================\r\n// DATA FETCHING (16 symbols)\r\n//==============================================================================\r\nprice1  = request.security(sym1,  timeframe.period, close)\r\nprice2  = request.security(sym2,  timeframe.period, close)\r\nprice3  = request.security(sym3,  timeframe.period, close)\r\nprice4  = request.security(sym4,  timeframe.period, close)\r\nprice5  = request.security(sym5,  timeframe.period, close)\r\nprice6  = request.security(sym6,  timeframe.period, close)\r\nprice7  = request.security(sym7,  timeframe.period, close)\r\nprice8  = request.security(sym8,  timeframe.period, close)\r\nprice9  = request.security(sym9,  timeframe.period, close)\r\nprice10 = request.security(sym10, timeframe.period, close)\r\nprice11 = request.security(sym11, timeframe.period, close)\r\nprice12 = request.security(sym12, timeframe.period, close)\r\nprice13 = request.security(sym13, timeframe.period, close)\r\nprice14 = request.security(sym14, timeframe.period, close)\r\nprice15 = request.security(sym15, timeframe.period, close)\r\nprice16 = request.security(sym16, timeframe.period, close)\r\n\r\n// Symbol names array\r\nvar symNames = array.new_string(16)\r\nif barstate.isfirst\r\n    array.set(symNames, 0,  getTicker(sym1))\r\n    array.set(symNames, 1,  getTicker(sym2))\r\n    array.set(symNames, 2,  getTicker(sym3))\r\n    array.set(symNames, 3,  getTicker(sym4))\r\n    array.set(symNames, 4,  getTicker(sym5))\r\n    array.set(symNames, 5,  getTicker(sym6))\r\n    array.set(symNames, 6,  getTicker(sym7))\r\n    array.set(symNames, 7,  getTicker(sym8))\r\n    array.set(symNames, 8,  getTicker(sym9))\r\n    array.set(symNames, 9,  getTicker(sym10))\r\n    array.set(symNames, 10, getTicker(sym11))\r\n    array.set(symNames, 11, getTicker(sym12))\r\n    array.set(symNames, 12, getTicker(sym13))\r\n    array.set(symNames, 13, getTicker(sym14))\r\n    array.set(symNames, 14, getTicker(sym15))\r\n    array.set(symNames, 15, getTicker(sym16))\r\n\r\n//==============================================================================\r\n// RETURNS CALCULATION\r\n//==============================================================================\r\nret1  = (price1  - price1[1])  / price1[1]\r\nret2  = (price2  - price2[1])  / price2[1]\r\nret3  = (price3  - price3[1])  / price3[1]\r\nret4  = (price4  - price4[1])  / price4[1]\r\nret5  = (price5  - price5[1])  / price5[1]\r\nret6  = (price6  - price6[1])  / price6[1]\r\nret7  = (price7  - price7[1])  / price7[1]\r\nret8  = (price8  - price8[1])  / price8[1]\r\nret9  = (price9  - price9[1])  / price9[1]\r\nret10 = (price10 - price10[1]) / price10[1]\r\nret11 = (price11 - price11[1]) / price11[1]\r\nret12 = (price12 - price12[1]) / price12[1]\r\nret13 = (price13 - price13[1]) / price13[1]\r\nret14 = (price14 - price14[1]) / price14[1]\r\nret15 = (price15 - price15[1]) / price15[1]\r\nret16 = (price16 - price16[1]) / price16[1]\r\n\r\n//==============================================================================\r\n// RELATIVE PERFORMANCE (Normalized returns over perfLength)\r\n//==============================================================================\r\nperf1  = (price1  - price1[perfLength])  / price1[perfLength]  * 100\r\nperf2  = (price2  - price2[perfLength])  / price2[perfLength]  * 100\r\nperf3  = (price3  - price3[perfLength])  / price3[perfLength]  * 100\r\nperf4  = (price4  - price4[perfLength])  / price4[perfLength]  * 100\r\nperf5  = (price5  - price5[perfLength])  / price5[perfLength]  * 100\r\nperf6  = (price6  - price6[perfLength])  / price6[perfLength]  * 100\r\nperf7  = (price7  - price7[perfLength])  / price7[perfLength]  * 100\r\nperf8  = (price8  - price8[perfLength])  / price8[perfLength]  * 100\r\nperf9  = (price9  - price9[perfLength])  / price9[perfLength]  * 100\r\nperf10 = (price10 - price10[perfLength]) / price10[perfLength] * 100\r\nperf11 = (price11 - price11[perfLength]) / price11[perfLength] * 100\r\nperf12 = (price12 - price12[perfLength]) / price12[perfLength] * 100\r\nperf13 = (price13 - price13[perfLength]) / price13[perfLength] * 100\r\nperf14 = (price14 - price14[perfLength]) / price14[perfLength] * 100\r\nperf15 = (price15 - price15[perfLength]) / price15[perfLength] * 100\r\nperf16 = (price16 - price16[perfLength]) / price16[perfLength] * 100\r\n\r\n//==============================================================================\r\n// PAIR DATA TYPE\r\n//==============================================================================\r\ntype PairData\r\n    int idx1\r\n    int idx2\r\n    string name\r\n    float zscore\r\n    float corrShort\r\n    float corrLong\r\n    float corrBreakdown\r\n    float relPerfDiff\r\n    float composite\r\n\r\n//==============================================================================\r\n// CALCULATE ALL PAIR METRICS\r\n// We need to calculate for key pairs - focusing on first 8 vs all for heatmap efficiency\r\n//==============================================================================\r\n\r\n// Helper to get return by index\r\ngetReturn(idx) =>\r\n    switch idx\r\n        1  => ret1\r\n        2  => ret2\r\n        3  => ret3\r\n        4  => ret4\r\n        5  => ret5\r\n        6  => ret6\r\n        7  => ret7\r\n        8  => ret8\r\n        9  => ret9\r\n        10 => ret10\r\n        11 => ret11\r\n        12 => ret12\r\n        13 => ret13\r\n        14 => ret14\r\n        15 => ret15\r\n        16 => ret16\r\n        => ret1\r\n\r\ngetPrice(idx) =>\r\n    switch idx\r\n        1  => price1\r\n        2  => price2\r\n        3  => price3\r\n        4  => price4\r\n        5  => price5\r\n        6  => price6\r\n        7  => price7\r\n        8  => price8\r\n        9  => price9\r\n        10 => price10\r\n        11 => price11\r\n        12 => price12\r\n        13 => price13\r\n        14 => price14\r\n        15 => price15\r\n        16 => price16\r\n        => price1\r\n\r\ngetPerf(idx) =>\r\n    switch idx\r\n        1  => perf1\r\n        2  => perf2\r\n        3  => perf3\r\n        4  => perf4\r\n        5  => perf5\r\n        6  => perf6\r\n        7  => perf7\r\n        8  => perf8\r\n        9  => perf9\r\n        10 => perf10\r\n        11 => perf11\r\n        12 => perf12\r\n        13 => perf13\r\n        14 => perf14\r\n        15 => perf15\r\n        16 => perf16\r\n        => perf1\r\n\r\n// Calculate metrics for a pair\r\ncalcPairMetrics(idx1, idx2) =>\r\n    r1 = getReturn(idx1)\r\n    r2 = getReturn(idx2)\r\n    p1 = getPrice(idx1)\r\n    p2 = getPrice(idx2)\r\n    pf1 = getPerf(idx1)\r\n    pf2 = getPerf(idx2)\r\n\r\n    // Correlations\r\n    corrS = stats.correlation(r1, r2, corrLengthShort)\r\n    corrL = stats.correlation(r1, r2, corrLengthLong)\r\n\r\n    // Log price ratio and z-score\r\n    ratio = math.log(p1 / p2)\r\n    z = stats.zscore(ratio, zscoreLength)\r\n\r\n    // Correlation breakdown (how much short-term dropped below long-term)\r\n    corrBrk = corrL - corrS\r\n\r\n    // Relative performance difference\r\n    relDiff = pf1 - pf2\r\n\r\n    // Normalize components for composite score\r\n    zNorm = math.min(math.abs(z) / 3.0, 1.0)  // Cap at 3 sigma\r\n    corrBrkNorm = math.min(math.max(corrBrk, 0) / 0.5, 1.0)  // Positive breakdown capped at 0.5\r\n    relDiffNorm = math.min(math.abs(relDiff) / 10.0, 1.0)  // Cap at 10% difference\r\n\r\n    // Composite score\r\n    comp = weightZscore * zNorm + weightCorrBrk * corrBrkNorm + weightRelPerf * relDiffNorm\r\n\r\n    [z, corrS, corrL, corrBrk, relDiff, comp]\r\n\r\n//==============================================================================\r\n// CALCULATE KEY PAIRS FOR RANKING (120 pairs for 16 symbols)\r\n// We\'ll calculate the most important subset for performance\r\n//==============================================================================\r\n\r\n// Calculate all 120 pairs\r\n[z_1_2, cs_1_2, cl_1_2, cb_1_2, rp_1_2, cp_1_2] = calcPairMetrics(1, 2)\r\n[z_1_3, cs_1_3, cl_1_3, cb_1_3, rp_1_3, cp_1_3] = calcPairMetrics(1, 3)\r\n[z_1_4, cs_1_4, cl_1_4, cb_1_4, rp_1_4, cp_1_4] = calcPairMetrics(1, 4)\r\n[z_1_5, cs_1_5, cl_1_5, cb_1_5, rp_1_5, cp_1_5] = calcPairMetrics(1, 5)\r\n[z_1_6, cs_1_6, cl_1_6, cb_1_6, rp_1_6, cp_1_6] = calcPairMetrics(1, 6)\r\n[z_1_7, cs_1_7, cl_1_7, cb_1_7, rp_1_7, cp_1_7] = calcPairMetrics(1, 7)\r\n[z_1_8, cs_1_8, cl_1_8, cb_1_8, rp_1_8, cp_1_8] = calcPairMetrics(1, 8)\r\n[z_1_9, cs_1_9, cl_1_9, cb_1_9, rp_1_9, cp_1_9] = calcPairMetrics(1, 9)\r\n[z_1_10, cs_1_10, cl_1_10, cb_1_10, rp_1_10, cp_1_10] = calcPairMetrics(1, 10)\r\n[z_1_11, cs_1_11, cl_1_11, cb_1_11, rp_1_11, cp_1_11] = calcPairMetrics(1, 11)\r\n[z_1_12, cs_1_12, cl_1_12, cb_1_12, rp_1_12, cp_1_12] = calcPairMetrics(1, 12)\r\n[z_1_13, cs_1_13, cl_1_13, cb_1_13, rp_1_13, cp_1_13] = calcPairMetrics(1, 13)\r\n[z_1_14, cs_1_14, cl_1_14, cb_1_14, rp_1_14, cp_1_14] = calcPairMetrics(1, 14)\r\n[z_1_15, cs_1_15, cl_1_15, cb_1_15, rp_1_15, cp_1_15] = calcPairMetrics(1, 15)\r\n[z_1_16, cs_1_16, cl_1_16, cb_1_16, rp_1_16, cp_1_16] = calcPairMetrics(1, 16)\r\n\r\n[z_2_3, cs_2_3, cl_2_3, cb_2_3, rp_2_3, cp_2_3] = calcPairMetrics(2, 3)\r\n[z_2_4, cs_2_4, cl_2_4, cb_2_4, rp_2_4, cp_2_4] = calcPairMetrics(2, 4)\r\n[z_2_5, cs_2_5, cl_2_5, cb_2_5, rp_2_5, cp_2_5] = calcPairMetrics(2, 5)\r\n[z_2_6, cs_2_6, cl_2_6, cb_2_6, rp_2_6, cp_2_6] = calcPairMetrics(2, 6)\r\n[z_2_7, cs_2_7, cl_2_7, cb_2_7, rp_2_7, cp_2_7] = calcPairMetrics(2, 7)\r\n[z_2_8, cs_2_8, cl_2_8, cb_2_8, rp_2_8, cp_2_8] = calcPairMetrics(2, 8)\r\n[z_2_9, cs_2_9, cl_2_9, cb_2_9, rp_2_9, cp_2_9] = calcPairMetrics(2, 9)\r\n[z_2_10, cs_2_10, cl_2_10, cb_2_10, rp_2_10, cp_2_10] = calcPairMetrics(2, 10)\r\n[z_2_11, cs_2_11, cl_2_11, cb_2_11, rp_2_11, cp_2_11] = calcPairMetrics(2, 11)\r\n[z_2_12, cs_2_12, cl_2_12, cb_2_12, rp_2_12, cp_2_12] = calcPairMetrics(2, 12)\r\n[z_2_13, cs_2_13, cl_2_13, cb_2_13, rp_2_13, cp_2_13] = calcPairMetrics(2, 13)\r\n[z_2_14, cs_2_14, cl_2_14, cb_2_14, rp_2_14, cp_2_14] = calcPairMetrics(2, 14)\r\n[z_2_15, cs_2_15, cl_2_15, cb_2_15, rp_2_15, cp_2_15] = calcPairMetrics(2, 15)\r\n[z_2_16, cs_2_16, cl_2_16, cb_2_16, rp_2_16, cp_2_16] = calcPairMetrics(2, 16)\r\n\r\n[z_3_4, cs_3_4, cl_3_4, cb_3_4, rp_3_4, cp_3_4] = calcPairMetrics(3, 4)\r\n[z_3_5, cs_3_5, cl_3_5, cb_3_5, rp_3_5, cp_3_5] = calcPairMetrics(3, 5)\r\n[z_3_6, cs_3_6, cl_3_6, cb_3_6, rp_3_6, cp_3_6] = calcPairMetrics(3, 6)\r\n[z_3_7, cs_3_7, cl_3_7, cb_3_7, rp_3_7, cp_3_7] = calcPairMetrics(3, 7)\r\n[z_3_8, cs_3_8, cl_3_8, cb_3_8, rp_3_8, cp_3_8] = calcPairMetrics(3, 8)\r\n[z_3_9, cs_3_9, cl_3_9, cb_3_9, rp_3_9, cp_3_9] = calcPairMetrics(3, 9)\r\n[z_3_10, cs_3_10, cl_3_10, cb_3_10, rp_3_10, cp_3_10] = calcPairMetrics(3, 10)\r\n[z_3_11, cs_3_11, cl_3_11, cb_3_11, rp_3_11, cp_3_11] = calcPairMetrics(3, 11)\r\n[z_3_12, cs_3_12, cl_3_12, cb_3_12, rp_3_12, cp_3_12] = calcPairMetrics(3, 12)\r\n[z_3_13, cs_3_13, cl_3_13, cb_3_13, rp_3_13, cp_3_13] = calcPairMetrics(3, 13)\r\n[z_3_14, cs_3_14, cl_3_14, cb_3_14, rp_3_14, cp_3_14] = calcPairMetrics(3, 14)\r\n[z_3_15, cs_3_15, cl_3_15, cb_3_15, rp_3_15, cp_3_15] = calcPairMetrics(3, 15)\r\n[z_3_16, cs_3_16, cl_3_16, cb_3_16, rp_3_16, cp_3_16] = calcPairMetrics(3, 16)\r\n\r\n[z_4_5, cs_4_5, cl_4_5, cb_4_5, rp_4_5, cp_4_5] = calcPairMetrics(4, 5)\r\n[z_4_6, cs_4_6, cl_4_6, cb_4_6, rp_4_6, cp_4_6] = calcPairMetrics(4, 6)\r\n[z_4_7, cs_4_7, cl_4_7, cb_4_7, rp_4_7, cp_4_7] = calcPairMetrics(4, 7)\r\n[z_4_8, cs_4_8, cl_4_8, cb_4_8, rp_4_8, cp_4_8] = calcPairMetrics(4, 8)\r\n[z_4_9, cs_4_9, cl_4_9, cb_4_9, rp_4_9, cp_4_9] = calcPairMetrics(4, 9)\r\n[z_4_10, cs_4_10, cl_4_10, cb_4_10, rp_4_10, cp_4_10] = calcPairMetrics(4, 10)\r\n[z_4_11, cs_4_11, cl_4_11, cb_4_11, rp_4_11, cp_4_11] = calcPairMetrics(4, 11)\r\n[z_4_12, cs_4_12, cl_4_12, cb_4_12, rp_4_12, cp_4_12] = calcPairMetrics(4, 12)\r\n[z_4_13, cs_4_13, cl_4_13, cb_4_13, rp_4_13, cp_4_13] = calcPairMetrics(4, 13)\r\n[z_4_14, cs_4_14, cl_4_14, cb_4_14, rp_4_14, cp_4_14] = calcPairMetrics(4, 14)\r\n[z_4_15, cs_4_15, cl_4_15, cb_4_15, rp_4_15, cp_4_15] = calcPairMetrics(4, 15)\r\n[z_4_16, cs_4_16, cl_4_16, cb_4_16, rp_4_16, cp_4_16] = calcPairMetrics(4, 16)\r\n\r\n[z_5_6, cs_5_6, cl_5_6, cb_5_6, rp_5_6, cp_5_6] = calcPairMetrics(5, 6)\r\n[z_5_7, cs_5_7, cl_5_7, cb_5_7, rp_5_7, cp_5_7] = calcPairMetrics(5, 7)\r\n[z_5_8, cs_5_8, cl_5_8, cb_5_8, rp_5_8, cp_5_8] = calcPairMetrics(5, 8)\r\n[z_5_9, cs_5_9, cl_5_9, cb_5_9, rp_5_9, cp_5_9] = calcPairMetrics(5, 9)\r\n[z_5_10, cs_5_10, cl_5_10, cb_5_10, rp_5_10, cp_5_10] = calcPairMetrics(5, 10)\r\n[z_5_11, cs_5_11, cl_5_11, cb_5_11, rp_5_11, cp_5_11] = calcPairMetrics(5, 11)\r\n[z_5_12, cs_5_12, cl_5_12, cb_5_12, rp_5_12, cp_5_12] = calcPairMetrics(5, 12)\r\n[z_5_13, cs_5_13, cl_5_13, cb_5_13, rp_5_13, cp_5_13] = calcPairMetrics(5, 13)\r\n[z_5_14, cs_5_14, cl_5_14, cb_5_14, rp_5_14, cp_5_14] = calcPairMetrics(5, 14)\r\n[z_5_15, cs_5_15, cl_5_15, cb_5_15, rp_5_15, cp_5_15] = calcPairMetrics(5, 15)\r\n[z_5_16, cs_5_16, cl_5_16, cb_5_16, rp_5_16, cp_5_16] = calcPairMetrics(5, 16)\r\n\r\n[z_6_7, cs_6_7, cl_6_7, cb_6_7, rp_6_7, cp_6_7] = calcPairMetrics(6, 7)\r\n[z_6_8, cs_6_8, cl_6_8, cb_6_8, rp_6_8, cp_6_8] = calcPairMetrics(6, 8)\r\n[z_6_9, cs_6_9, cl_6_9, cb_6_9, rp_6_9, cp_6_9] = calcPairMetrics(6, 9)\r\n[z_6_10, cs_6_10, cl_6_10, cb_6_10, rp_6_10, cp_6_10] = calcPairMetrics(6, 10)\r\n[z_6_11, cs_6_11, cl_6_11, cb_6_11, rp_6_11, cp_6_11] = calcPairMetrics(6, 11)\r\n[z_6_12, cs_6_12, cl_6_12, cb_6_12, rp_6_12, cp_6_12] = calcPairMetrics(6, 12)\r\n[z_6_13, cs_6_13, cl_6_13, cb_6_13, rp_6_13, cp_6_13] = calcPairMetrics(6, 13)\r\n[z_6_14, cs_6_14, cl_6_14, cb_6_14, rp_6_14, cp_6_14] = calcPairMetrics(6, 14)\r\n[z_6_15, cs_6_15, cl_6_15, cb_6_15, rp_6_15, cp_6_15] = calcPairMetrics(6, 15)\r\n[z_6_16, cs_6_16, cl_6_16, cb_6_16, rp_6_16, cp_6_16] = calcPairMetrics(6, 16)\r\n\r\n[z_7_8, cs_7_8, cl_7_8, cb_7_8, rp_7_8, cp_7_8] = calcPairMetrics(7, 8)\r\n[z_7_9, cs_7_9, cl_7_9, cb_7_9, rp_7_9, cp_7_9] = calcPairMetrics(7, 9)\r\n[z_7_10, cs_7_10, cl_7_10, cb_7_10, rp_7_10, cp_7_10] = calcPairMetrics(7, 10)\r\n[z_7_11, cs_7_11, cl_7_11, cb_7_11, rp_7_11, cp_7_11] = calcPairMetrics(7, 11)\r\n[z_7_12, cs_7_12, cl_7_12, cb_7_12, rp_7_12, cp_7_12] = calcPairMetrics(7, 12)\r\n[z_7_13, cs_7_13, cl_7_13, cb_7_13, rp_7_13, cp_7_13] = calcPairMetrics(7, 13)\r\n[z_7_14, cs_7_14, cl_7_14, cb_7_14, rp_7_14, cp_7_14] = calcPairMetrics(7, 14)\r\n[z_7_15, cs_7_15, cl_7_15, cb_7_15, rp_7_15, cp_7_15] = calcPairMetrics(7, 15)\r\n[z_7_16, cs_7_16, cl_7_16, cb_7_16, rp_7_16, cp_7_16] = calcPairMetrics(7, 16)\r\n\r\n[z_8_9, cs_8_9, cl_8_9, cb_8_9, rp_8_9, cp_8_9] = calcPairMetrics(8, 9)\r\n[z_8_10, cs_8_10, cl_8_10, cb_8_10, rp_8_10, cp_8_10] = calcPairMetrics(8, 10)\r\n[z_8_11, cs_8_11, cl_8_11, cb_8_11, rp_8_11, cp_8_11] = calcPairMetrics(8, 11)\r\n[z_8_12, cs_8_12, cl_8_12, cb_8_12, rp_8_12, cp_8_12] = calcPairMetrics(8, 12)\r\n[z_8_13, cs_8_13, cl_8_13, cb_8_13, rp_8_13, cp_8_13] = calcPairMetrics(8, 13)\r\n[z_8_14, cs_8_14, cl_8_14, cb_8_14, rp_8_14, cp_8_14] = calcPairMetrics(8, 14)\r\n[z_8_15, cs_8_15, cl_8_15, cb_8_15, rp_8_15, cp_8_15] = calcPairMetrics(8, 15)\r\n[z_8_16, cs_8_16, cl_8_16, cb_8_16, rp_8_16, cp_8_16] = calcPairMetrics(8, 16)\r\n\r\n[z_9_10, cs_9_10, cl_9_10, cb_9_10, rp_9_10, cp_9_10] = calcPairMetrics(9, 10)\r\n[z_9_11, cs_9_11, cl_9_11, cb_9_11, rp_9_11, cp_9_11] = calcPairMetrics(9, 11)\r\n[z_9_12, cs_9_12, cl_9_12, cb_9_12, rp_9_12, cp_9_12] = calcPairMetrics(9, 12)\r\n[z_9_13, cs_9_13, cl_9_13, cb_9_13, rp_9_13, cp_9_13] = calcPairMetrics(9, 13)\r\n[z_9_14, cs_9_14, cl_9_14, cb_9_14, rp_9_14, cp_9_14] = calcPairMetrics(9, 14)\r\n[z_9_15, cs_9_15, cl_9_15, cb_9_15, rp_9_15, cp_9_15] = calcPairMetrics(9, 15)\r\n[z_9_16, cs_9_16, cl_9_16, cb_9_16, rp_9_16, cp_9_16] = calcPairMetrics(9, 16)\r\n\r\n[z_10_11, cs_10_11, cl_10_11, cb_10_11, rp_10_11, cp_10_11] = calcPairMetrics(10, 11)\r\n[z_10_12, cs_10_12, cl_10_12, cb_10_12, rp_10_12, cp_10_12] = calcPairMetrics(10, 12)\r\n[z_10_13, cs_10_13, cl_10_13, cb_10_13, rp_10_13, cp_10_13] = calcPairMetrics(10, 13)\r\n[z_10_14, cs_10_14, cl_10_14, cb_10_14, rp_10_14, cp_10_14] = calcPairMetrics(10, 14)\r\n[z_10_15, cs_10_15, cl_10_15, cb_10_15, rp_10_15, cp_10_15] = calcPairMetrics(10, 15)\r\n[z_10_16, cs_10_16, cl_10_16, cb_10_16, rp_10_16, cp_10_16] = calcPairMetrics(10, 16)\r\n\r\n[z_11_12, cs_11_12, cl_11_12, cb_11_12, rp_11_12, cp_11_12] = calcPairMetrics(11, 12)\r\n[z_11_13, cs_11_13, cl_11_13, cb_11_13, rp_11_13, cp_11_13] = calcPairMetrics(11, 13)\r\n[z_11_14, cs_11_14, cl_11_14, cb_11_14, rp_11_14, cp_11_14] = calcPairMetrics(11, 14)\r\n[z_11_15, cs_11_15, cl_11_15, cb_11_15, rp_11_15, cp_11_15] = calcPairMetrics(11, 15)\r\n[z_11_16, cs_11_16, cl_11_16, cb_11_16, rp_11_16, cp_11_16] = calcPairMetrics(11, 16)\r\n\r\n[z_12_13, cs_12_13, cl_12_13, cb_12_13, rp_12_13, cp_12_13] = calcPairMetrics(12, 13)\r\n[z_12_14, cs_12_14, cl_12_14, cb_12_14, rp_12_14, cp_12_14] = calcPairMetrics(12, 14)\r\n[z_12_15, cs_12_15, cl_12_15, cb_12_15, rp_12_15, cp_12_15] = calcPairMetrics(12, 15)\r\n[z_12_16, cs_12_16, cl_12_16, cb_12_16, rp_12_16, cp_12_16] = calcPairMetrics(12, 16)\r\n\r\n[z_13_14, cs_13_14, cl_13_14, cb_13_14, rp_13_14, cp_13_14] = calcPairMetrics(13, 14)\r\n[z_13_15, cs_13_15, cl_13_15, cb_13_15, rp_13_15, cp_13_15] = calcPairMetrics(13, 15)\r\n[z_13_16, cs_13_16, cl_13_16, cb_13_16, rp_13_16, cp_13_16] = calcPairMetrics(13, 16)\r\n\r\n[z_14_15, cs_14_15, cl_14_15, cb_14_15, rp_14_15, cp_14_15] = calcPairMetrics(14, 15)\r\n[z_14_16, cs_14_16, cl_14_16, cb_14_16, rp_14_16, cp_14_16] = calcPairMetrics(14, 16)\r\n\r\n[z_15_16, cs_15_16, cl_15_16, cb_15_16, rp_15_16, cp_15_16] = calcPairMetrics(15, 16)\r\n\r\n//==============================================================================\r\n// DEEP DIVE CALCULATIONS\r\n//==============================================================================\r\ndeepPrice1Val = getPrice(deepSym1)\r\ndeepPrice2Val = getPrice(deepSym2)\r\ndeepRet1 = getReturn(deepSym1)\r\ndeepRet2 = getReturn(deepSym2)\r\ndeepPerf1 = getPerf(deepSym1)\r\ndeepPerf2 = getPerf(deepSym2)\r\n\r\ndeepRatio = math.log(deepPrice1Val / deepPrice2Val)\r\ndeepZscore = stats.zscore(deepRatio, zscoreLength)\r\ndeepCorrShort = stats.correlation(deepRet1, deepRet2, corrLengthShort)\r\ndeepCorrLong = stats.correlation(deepRet1, deepRet2, corrLengthLong)\r\ndeepCorrBreakdown = deepCorrLong - deepCorrShort\r\ndeepRelPerfDiff = deepPerf1 - deepPerf2\r\n\r\n// Bollinger Bands on ratio\r\ndeepBasis = ta.sma(deepRatio, bbLength)\r\ndeepDev = ta.stdev(deepRatio, bbLength)\r\ndeepUpper = deepBasis + bbMult * deepDev\r\ndeepLower = deepBasis - bbMult * deepDev\r\n\r\n//==============================================================================\r\n// HELPER FUNCTION: Get correlation by pair indices (must be at global scope)\r\n//==============================================================================\r\ngetCorrShort(i, j) =>\r\n    // Ensure consistent ordering (smaller index first) without recursion\r\n    i1 = math.min(i, j)\r\n    j1 = math.max(i, j)\r\n    if i1 == j1\r\n        1.0\r\n    else\r\n        switch\r\n            i1 == 1 and j1 == 2 => cs_1_2\r\n            i1 == 1 and j1 == 3 => cs_1_3\r\n            i1 == 1 and j1 == 4 => cs_1_4\r\n            i1 == 1 and j1 == 5 => cs_1_5\r\n            i1 == 1 and j1 == 6 => cs_1_6\r\n            i1 == 1 and j1 == 7 => cs_1_7\r\n            i1 == 1 and j1 == 8 => cs_1_8\r\n            i1 == 1 and j1 == 9 => cs_1_9\r\n            i1 == 1 and j1 == 10 => cs_1_10\r\n            i1 == 1 and j1 == 11 => cs_1_11\r\n            i1 == 1 and j1 == 12 => cs_1_12\r\n            i1 == 1 and j1 == 13 => cs_1_13\r\n            i1 == 1 and j1 == 14 => cs_1_14\r\n            i1 == 1 and j1 == 15 => cs_1_15\r\n            i1 == 1 and j1 == 16 => cs_1_16\r\n            i1 == 2 and j1 == 3 => cs_2_3\r\n            i1 == 2 and j1 == 4 => cs_2_4\r\n            i1 == 2 and j1 == 5 => cs_2_5\r\n            i1 == 2 and j1 == 6 => cs_2_6\r\n            i1 == 2 and j1 == 7 => cs_2_7\r\n            i1 == 2 and j1 == 8 => cs_2_8\r\n            i1 == 2 and j1 == 9 => cs_2_9\r\n            i1 == 2 and j1 == 10 => cs_2_10\r\n            i1 == 2 and j1 == 11 => cs_2_11\r\n            i1 == 2 and j1 == 12 => cs_2_12\r\n            i1 == 2 and j1 == 13 => cs_2_13\r\n            i1 == 2 and j1 == 14 => cs_2_14\r\n            i1 == 2 and j1 == 15 => cs_2_15\r\n            i1 == 2 and j1 == 16 => cs_2_16\r\n            i1 == 3 and j1 == 4 => cs_3_4\r\n            i1 == 3 and j1 == 5 => cs_3_5\r\n            i1 == 3 and j1 == 6 => cs_3_6\r\n            i1 == 3 and j1 == 7 => cs_3_7\r\n            i1 == 3 and j1 == 8 => cs_3_8\r\n            i1 == 3 and j1 == 9 => cs_3_9\r\n            i1 == 3 and j1 == 10 => cs_3_10\r\n            i1 == 3 and j1 == 11 => cs_3_11\r\n            i1 == 3 and j1 == 12 => cs_3_12\r\n            i1 == 3 and j1 == 13 => cs_3_13\r\n            i1 == 3 and j1 == 14 => cs_3_14\r\n            i1 == 3 and j1 == 15 => cs_3_15\r\n            i1 == 3 and j1 == 16 => cs_3_16\r\n            i1 == 4 and j1 == 5 => cs_4_5\r\n            i1 == 4 and j1 == 6 => cs_4_6\r\n            i1 == 4 and j1 == 7 => cs_4_7\r\n            i1 == 4 and j1 == 8 => cs_4_8\r\n            i1 == 4 and j1 == 9 => cs_4_9\r\n            i1 == 4 and j1 == 10 => cs_4_10\r\n            i1 == 4 and j1 == 11 => cs_4_11\r\n            i1 == 4 and j1 == 12 => cs_4_12\r\n            i1 == 4 and j1 == 13 => cs_4_13\r\n            i1 == 4 and j1 == 14 => cs_4_14\r\n            i1 == 4 and j1 == 15 => cs_4_15\r\n            i1 == 4 and j1 == 16 => cs_4_16\r\n            i1 == 5 and j1 == 6 => cs_5_6\r\n            i1 == 5 and j1 == 7 => cs_5_7\r\n            i1 == 5 and j1 == 8 => cs_5_8\r\n            i1 == 5 and j1 == 9 => cs_5_9\r\n            i1 == 5 and j1 == 10 => cs_5_10\r\n            i1 == 5 and j1 == 11 => cs_5_11\r\n            i1 == 5 and j1 == 12 => cs_5_12\r\n            i1 == 5 and j1 == 13 => cs_5_13\r\n            i1 == 5 and j1 == 14 => cs_5_14\r\n            i1 == 5 and j1 == 15 => cs_5_15\r\n            i1 == 5 and j1 == 16 => cs_5_16\r\n            i1 == 6 and j1 == 7 => cs_6_7\r\n            i1 == 6 and j1 == 8 => cs_6_8\r\n            i1 == 6 and j1 == 9 => cs_6_9\r\n            i1 == 6 and j1 == 10 => cs_6_10\r\n            i1 == 6 and j1 == 11 => cs_6_11\r\n            i1 == 6 and j1 == 12 => cs_6_12\r\n            i1 == 6 and j1 == 13 => cs_6_13\r\n            i1 == 6 and j1 == 14 => cs_6_14\r\n            i1 == 6 and j1 == 15 => cs_6_15\r\n            i1 == 6 and j1 == 16 => cs_6_16\r\n            i1 == 7 and j1 == 8 => cs_7_8\r\n            i1 == 7 and j1 == 9 => cs_7_9\r\n            i1 == 7 and j1 == 10 => cs_7_10\r\n            i1 == 7 and j1 == 11 => cs_7_11\r\n            i1 == 7 and j1 == 12 => cs_7_12\r\n            i1 == 7 and j1 == 13 => cs_7_13\r\n            i1 == 7 and j1 == 14 => cs_7_14\r\n            i1 == 7 and j1 == 15 => cs_7_15\r\n            i1 == 7 and j1 == 16 => cs_7_16\r\n            i1 == 8 and j1 == 9 => cs_8_9\r\n            i1 == 8 and j1 == 10 => cs_8_10\r\n            i1 == 8 and j1 == 11 => cs_8_11\r\n            i1 == 8 and j1 == 12 => cs_8_12\r\n            i1 == 8 and j1 == 13 => cs_8_13\r\n            i1 == 8 and j1 == 14 => cs_8_14\r\n            i1 == 8 and j1 == 15 => cs_8_15\r\n            i1 == 8 and j1 == 16 => cs_8_16\r\n            i1 == 9 and j1 == 10 => cs_9_10\r\n            i1 == 9 and j1 == 11 => cs_9_11\r\n            i1 == 9 and j1 == 12 => cs_9_12\r\n            i1 == 9 and j1 == 13 => cs_9_13\r\n            i1 == 9 and j1 == 14 => cs_9_14\r\n            i1 == 9 and j1 == 15 => cs_9_15\r\n            i1 == 9 and j1 == 16 => cs_9_16\r\n            i1 == 10 and j1 == 11 => cs_10_11\r\n            i1 == 10 and j1 == 12 => cs_10_12\r\n            i1 == 10 and j1 == 13 => cs_10_13\r\n            i1 == 10 and j1 == 14 => cs_10_14\r\n            i1 == 10 and j1 == 15 => cs_10_15\r\n            i1 == 10 and j1 == 16 => cs_10_16\r\n            i1 == 11 and j1 == 12 => cs_11_12\r\n            i1 == 11 and j1 == 13 => cs_11_13\r\n            i1 == 11 and j1 == 14 => cs_11_14\r\n            i1 == 11 and j1 == 15 => cs_11_15\r\n            i1 == 11 and j1 == 16 => cs_11_16\r\n            i1 == 12 and j1 == 13 => cs_12_13\r\n            i1 == 12 and j1 == 14 => cs_12_14\r\n            i1 == 12 and j1 == 15 => cs_12_15\r\n            i1 == 12 and j1 == 16 => cs_12_16\r\n            i1 == 13 and j1 == 14 => cs_13_14\r\n            i1 == 13 and j1 == 15 => cs_13_15\r\n            i1 == 13 and j1 == 16 => cs_13_16\r\n            i1 == 14 and j1 == 15 => cs_14_15\r\n            i1 == 14 and j1 == 16 => cs_14_16\r\n            i1 == 15 and j1 == 16 => cs_15_16\r\n            => 0.0\r\n\r\n//==============================================================================\r\n// HEATMAP (16x16 correlation matrix)\r\n//==============================================================================\r\nvar table heatmapTable = table.new(getTablePos(heatmapPos), 17, 17, bgcolor=color.new(color.black, 80), border_width=1)\r\n\r\nif showHeatmap and barstate.islast\r\n    // Header\r\n    table.cell(heatmapTable, 0, 0, "CORR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    // Column and row headers\r\n    for i = 0 to 15\r\n        symName = array.get(symNames, i)\r\n        table.cell(heatmapTable, i + 1, 0, symName, bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n        table.cell(heatmapTable, 0, i + 1, symName, bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    // Fill matrix\r\n    for i = 1 to 16\r\n        for j = 1 to 16\r\n            corrVal = getCorrShort(i, j)\r\n            cellColor = i == j ? color.new(color.blue, 60) : getCorrColor(corrVal)\r\n            table.cell(heatmapTable, j, i, str.tostring(corrVal, "#.##"), bgcolor=cellColor, text_color=color.white, text_size=getFontSize())\r\n\r\n//==============================================================================\r\n// DIVERGENCE RANKING TABLE\r\n//==============================================================================\r\nvar table rankTable = table.new(getTablePos(rankTablePos), 8, numRankings + 1, bgcolor=color.new(color.black, 80), border_width=1)\r\n\r\nif showRankTable and barstate.islast\r\n    // Create array of SPY pairs only (15 pairs: SPY with each of the other 15 symbols)\r\n    var pairs = array.new<PairData>(15)\r\n\r\n    // Populate pairs array - only SPY pairs\r\n    pairIdx = 0\r\n\r\n    // SPY (symbol 1) pairs with all other symbols\r\n    array.set(pairs, pairIdx, PairData.new(1, 2, array.get(symNames, 0) + "/" + array.get(symNames, 1), z_1_2, cs_1_2, cl_1_2, cb_1_2, rp_1_2, cp_1_2)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 3, array.get(symNames, 0) + "/" + array.get(symNames, 2), z_1_3, cs_1_3, cl_1_3, cb_1_3, rp_1_3, cp_1_3)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 4, array.get(symNames, 0) + "/" + array.get(symNames, 3), z_1_4, cs_1_4, cl_1_4, cb_1_4, rp_1_4, cp_1_4)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 5, array.get(symNames, 0) + "/" + array.get(symNames, 4), z_1_5, cs_1_5, cl_1_5, cb_1_5, rp_1_5, cp_1_5)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 6, array.get(symNames, 0) + "/" + array.get(symNames, 5), z_1_6, cs_1_6, cl_1_6, cb_1_6, rp_1_6, cp_1_6)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 7, array.get(symNames, 0) + "/" + array.get(symNames, 6), z_1_7, cs_1_7, cl_1_7, cb_1_7, rp_1_7, cp_1_7)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 8, array.get(symNames, 0) + "/" + array.get(symNames, 7), z_1_8, cs_1_8, cl_1_8, cb_1_8, rp_1_8, cp_1_8)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 9, array.get(symNames, 0) + "/" + array.get(symNames, 8), z_1_9, cs_1_9, cl_1_9, cb_1_9, rp_1_9, cp_1_9)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 10, array.get(symNames, 0) + "/" + array.get(symNames, 9), z_1_10, cs_1_10, cl_1_10, cb_1_10, rp_1_10, cp_1_10)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 11, array.get(symNames, 0) + "/" + array.get(symNames, 10), z_1_11, cs_1_11, cl_1_11, cb_1_11, rp_1_11, cp_1_11)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 12, array.get(symNames, 0) + "/" + array.get(symNames, 11), z_1_12, cs_1_12, cl_1_12, cb_1_12, rp_1_12, cp_1_12)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 13, array.get(symNames, 0) + "/" + array.get(symNames, 12), z_1_13, cs_1_13, cl_1_13, cb_1_13, rp_1_13, cp_1_13)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 14, array.get(symNames, 0) + "/" + array.get(symNames, 13), z_1_14, cs_1_14, cl_1_14, cb_1_14, rp_1_14, cp_1_14)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 15, array.get(symNames, 0) + "/" + array.get(symNames, 14), z_1_15, cs_1_15, cl_1_15, cb_1_15, rp_1_15, cp_1_15)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 16, array.get(symNames, 0) + "/" + array.get(symNames, 15), z_1_16, cs_1_16, cl_1_16, cb_1_16, rp_1_16, cp_1_16))\r\n\r\n    // Sort by composite score (bubble sort)\r\n    for i = 0 to 13\r\n        for j = 0 to 13 - i\r\n            if array.get(pairs, j).composite < array.get(pairs, j + 1).composite\r\n                temp = array.get(pairs, j)\r\n                array.set(pairs, j, array.get(pairs, j + 1))\r\n                array.set(pairs, j + 1, temp)\r\n\r\n    // Draw table headers\r\n    table.cell(rankTable, 0, 0, "#", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 1, 0, "PAIR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 2, 0, "SECTOR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 3, 0, "Z-SCORE", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 4, 0, "CORR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 5, 0, "PERF%", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 6, 0, "SCORE", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 7, 0, "SIGNAL", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    for i = 0 to numRankings - 1\r\n        pair = array.get(pairs, i)\r\n        sectorName = getSectorName(pair.idx2)\r\n        otherSymbol = str.split(pair.name, "/").get(1)\r\n        signal = pair.zscore > zscoreThreshold ? "LONG " + otherSymbol : pair.zscore < -zscoreThreshold ? "SHORT " + otherSymbol : "-"\r\n        signalColor = pair.zscore > zscoreStrong or pair.zscore < -zscoreStrong ? color.new(color.red, 20) : signal != "-" ? color.new(color.purple, 40) : color.new(color.gray, 80)\r\n\r\n        table.cell(rankTable, 0, i + 1, str.tostring(i + 1), bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 1, i + 1, pair.name, bgcolor=color.new(color.gray, 80), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 2, i + 1, sectorName, bgcolor=color.new(color.gray, 80), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 3, i + 1, str.tostring(pair.zscore, "#.##"), bgcolor=getZscoreColor(pair.zscore), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 4, i + 1, str.tostring(pair.corrShort, "#.##"), bgcolor=getCorrColor(pair.corrShort), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 5, i + 1, str.tostring(pair.relPerfDiff, "#.#"), bgcolor=color.new(math.abs(pair.relPerfDiff) > 5 ? color.orange : color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 6, i + 1, str.tostring(pair.composite, "#.##"), bgcolor=getCompositeColor(pair.composite), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 7, i + 1, signal, bgcolor=signalColor, text_color=color.white, text_size=getFontSize())\r\n\r\n//==============================================================================\r\n// DEEP DIVE PLOTS\r\n//==============================================================================\r\ndeepName1 = array.get(symNames, deepSym1 - 1)\r\ndeepName2 = array.get(symNames, deepSym2 - 1)\r\n\r\n// Dynamic color gradient for z-score with modern vibrant colors\r\ngetZscoreGradient(z) =>\r\n    if z >= zscoreStrong\r\n        color.rgb(220, 38, 127)  // Hot pink for strong signals\r\n    else if z >= zscoreThreshold\r\n        color.rgb(251, 146, 60)  // Vibrant orange\r\n    else if z >= 0.5\r\n        color.rgb(250, 204, 21)  // Bright yellow\r\n    else if z >= -0.5\r\n        color.rgb(148, 163, 184)  // Neutral gray-blue\r\n    else if z >= -zscoreThreshold\r\n        color.rgb(74, 222, 128)  // Bright lime green\r\n    else if z >= -zscoreStrong\r\n        color.rgb(34, 197, 94)  // Vibrant green\r\n    else\r\n        color.rgb(16, 185, 129)  // Deep emerald\r\n\r\n// Main z-score line with gradient color\r\nzscoreColor = getZscoreGradient(deepZscore)\r\nzscorePlot = plot(showDeepDive ? deepZscore : na, "Z-Score", color=zscoreColor, linewidth=3, style=plot.style_line)\r\n\r\n// Threshold reference lines with softer modern colors\r\nhline(zscoreStrong, "Strong Upper", color=color.new(color.rgb(239, 68, 68), 65), linestyle=hline.style_dashed, linewidth=1)\r\nhline(zscoreThreshold, "Upper Threshold", color=color.new(color.rgb(249, 115, 22), 70), linestyle=hline.style_dotted, linewidth=1)\r\nhline(0, "Zero Line", color=color.new(color.rgb(100, 116, 139), 60), linestyle=hline.style_solid, linewidth=2)\r\nhline(-zscoreThreshold, "Lower Threshold", color=color.new(color.rgb(132, 204, 22), 70), linestyle=hline.style_dotted, linewidth=1)\r\nhline(-zscoreStrong, "Strong Lower", color=color.new(color.rgb(34, 197, 94), 65), linestyle=hline.style_dashed, linewidth=1)\r\n\r\n// Create zone fills with gradient transparency for modern look\r\nupperStrongZone = hline(zscoreStrong, linestyle=hline.style_solid, color=na, editable=false)\r\nupperThresholdZone = hline(zscoreThreshold, linestyle=hline.style_solid, color=na, editable=false)\r\nzeroZone = hline(0, linestyle=hline.style_solid, color=na, editable=false)\r\nlowerThresholdZone = hline(-zscoreThreshold, linestyle=hline.style_solid, color=na, editable=false)\r\nlowerStrongZone = hline(-zscoreStrong, linestyle=hline.style_solid, color=na, editable=false)\r\n\r\n// Fill zones with modern gradient backgrounds\r\nfill(upperStrongZone, upperThresholdZone, color=color.new(color.rgb(239, 68, 68), 92), title="Strong Short Zone")\r\nfill(upperThresholdZone, zeroZone, color=color.new(color.rgb(251, 146, 60), 95), title="Short Zone")\r\nfill(zeroZone, lowerThresholdZone, color=color.new(color.rgb(34, 197, 94), 95), title="Long Zone")\r\nfill(lowerThresholdZone, lowerStrongZone, color=color.new(color.rgb(16, 185, 129), 92), title="Strong Long Zone")\r\n\r\n// Correlation plots with modern styling\r\nplot(showDeepDive ? deepCorrShort : na, "Short-Term Corr", color=color.new(color.rgb(59, 130, 246), 30), linewidth=2, style=plot.style_line)\r\nplot(showDeepDive ? deepCorrLong : na, "Long-Term Corr", color=color.new(color.rgb(168, 85, 247), 40), linewidth=2, style=plot.style_line)\r\n\r\n//==============================================================================\r\n// INFO LABEL\r\n//==============================================================================\r\nif showDeepDive and barstate.islast\r\n    signalText = deepZscore > zscoreStrong ? "STRONG SHORT " + deepName1 : deepZscore > zscoreThreshold ? "SHORT " + deepName1 : deepZscore < -zscoreStrong ? "STRONG LONG " + deepName1 : deepZscore < -zscoreThreshold ? "LONG " + deepName1 : "NEUTRAL"\r\n\r\n    infoText = "Deep Dive: " + deepName1 + " / " + deepName2 +\r\n               "\\nZ-Score: " + str.tostring(deepZscore, "#.##") +\r\n               "\\nCorr (S/L): " + str.tostring(deepCorrShort, "#.##") + " / " + str.tostring(deepCorrLong, "#.##") +\r\n               "\\nCorr Breakdown: " + str.tostring(deepCorrBreakdown, "#.##") +\r\n               "\\nRel Perf Diff: " + str.tostring(deepRelPerfDiff, "#.#") + "%" +\r\n               "\\nSignal: " + signalText\r\n\r\n    label.new(bar_index, deepZscore, infoText,\r\n              style=label.style_label_left,\r\n              color=color.new(color.black, 60),\r\n              textcolor=color.white,\r\n              size=size.small)\r\n\r\n//==============================================================================\r\n// ALERTS\r\n//==============================================================================\r\nalertcondition(deepZscore > zscoreThreshold, title="Z-Score Above Threshold", message="{{ticker}}: Z-Score above signal threshold")\r\nalertcondition(deepZscore < -zscoreThreshold, title="Z-Score Below Threshold", message="{{ticker}}: Z-Score below signal threshold")\r\nalertcondition(deepZscore > zscoreStrong, title="Strong Positive Divergence", message="{{ticker}}: Strong positive divergence detected")\r\nalertcondition(deepZscore < -zscoreStrong, title="Strong Negative Divergence", message="{{ticker}}: Strong negative divergence detected")\r\nalertcondition(deepCorrBreakdown > corrBreakdown, title="Correlation Breakdown", message="{{ticker}}: Correlation breakdown detected")\r\n'
[CAPTURE 2] '//@version=6\r\n// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © Henrique Centieiro\r\n\r\nindicator("Sector Divergence Dashboard", overlay=false, max_labels_count=500, max_lines_count=500)\r\n\r\n//==============================================================================\r\n// LIBRARY IMPORT\r\n//==============================================================================\r\nimport HenriqueCentieiro/PineStats/1 as stats\r\n\r\n//==============================================================================\r\n// INPUTS\r\n//==============================================================================\r\n// --- Symbol Selection (16 symbols) ---\r\ngrpSymbols = "═══ SYMBOL SELECTION ═══"\r\nsym1  = input.symbol("AMEX:SPY",  "1. SPY  (S&P 500)",         group=grpSymbols)\r\nsym2  = input.symbol("NASDAQ:QQQ", "2. QQQ  (Nasdaq 100)",     group=grpSymbols)\r\nsym3  = input.symbol("AMEX:IWM",  "3. IWM  (Russell 2000)",    group=grpSymbols)\r\nsym4  = input.symbol("AMEX:DIA",  "4. DIA  (Dow Jones)",       group=grpSymbols)\r\nsym5  = input.symbol("AMEX:XLK",  "5. XLK  (Technology)",      group=grpSymbols)\r\nsym6  = input.symbol("AMEX:XLF",  "6. XLF  (Financials)",      group=grpSymbols)\r\nsym7  = input.symbol("AMEX:XLE",  "7. XLE  (Energy)",          group=grpSymbols)\r\nsym8  = input.symbol("AMEX:XLV",  "8. XLV  (Healthcare)",      group=grpSymbols)\r\nsym9  = input.symbol("AMEX:XLY",  "9. XLY  (Cons. Discret.)",  group=grpSymbols)\r\nsym10 = input.symbol("AMEX:XLP",  "10. XLP (Cons. Staples)",   group=grpSymbols)\r\nsym11 = input.symbol("AMEX:XLI",  "11. XLI (Industrials)",     group=grpSymbols)\r\nsym12 = input.symbol("AMEX:XLU",  "12. XLU (Utilities)",       group=grpSymbols)\r\nsym13 = input.symbol("AMEX:XLB",  "13. XLB (Materials)",       group=grpSymbols)\r\nsym14 = input.symbol("AMEX:XLC",  "14. XLC (Comm. Services)",  group=grpSymbols)\r\nsym15 = input.symbol("AMEX:XLRE", "15. XLRE (Real Estate)",    group=grpSymbols)\r\nsym16 = input.symbol("NASDAQ:TLT", "16. TLT (Long Bonds)",     group=grpSymbols)\r\n\r\n// --- Parameters ---\r\ngrpParams = "═══ PARAMETERS ═══"\r\ncorrLengthShort = input.int(35, "Short-Term Correlation Length", minval=5, group=grpParams, tooltip="Lookback period for recent correlation. Lower values (5-10) detect quick changes, higher values (20-50) smooth out noise")\r\ncorrLengthLong  = input.int(100, "Long-Term Correlation Length", minval=20, group=grpParams, tooltip="Lookback period for stable correlation baseline. Use 50-100 for daily charts, 20-50 for intraday. Higher = more stable reference")\r\nzscoreLength    = input.int(100, "Z-Score Length", minval=10, group=grpParams, tooltip="Lookback period for z-score calculation (mean reversion). Lower values (20-30) = more sensitive signals, higher values (100-150) = fewer but stronger signals")\r\nperfLength      = input.int(300, "Relative Performance Length", minval=5, group=grpParams, tooltip="Period for measuring relative performance difference. Lower values (10-20) track recent momentum, higher values (40-100) show longer trends")\r\nzscoreThreshold = input.float(1.0, "Z-Score Signal Threshold", minval=0.5, step=0.1, group=grpParams, tooltip="Minimum z-score for regular signals. Lower values (0.5-1.0) = more signals, higher values (1.5-2.5) = fewer but higher quality signals")\r\nzscoreStrong    = input.float(2.0, "Z-Score Strong Signal", minval=1.0, step=0.1, group=grpParams, tooltip="Z-score threshold for strong divergence signals. Typical: 2.0 for daily charts, 2.5+ for higher conviction trades")\r\ncorrBreakdown   = input.float(0.3, "Correlation Breakdown Threshold", minval=0.1, step=0.1, group=grpParams, tooltip="Alert when short-term corr drops this much below long-term. Lower values (0.1-0.2) = sensitive to correlation changes, higher values (0.4-0.6) = only major breakdowns")\r\n\r\n// --- Composite Score Weights ---\r\ngrpWeights = "═══ COMPOSITE SCORE WEIGHTS ═══"\r\nweightZscore   = input.float(0.5, "Z-Score Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much z-score contributes to composite ranking (0-1). Higher = prioritize extreme divergences. Default 0.5 balances all factors")\r\nweightCorrBrk  = input.float(0.25, "Correlation Breakdown Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much correlation breakdown affects ranking (0-1). Higher = prioritize pairs where correlation recently dropped. Use 0.3-0.4 for mean reversion focus")\r\nweightRelPerf  = input.float(0.25, "Relative Performance Weight", minval=0, maxval=1, step=0.1, group=grpWeights, tooltip="How much relative performance affects ranking (0-1). Higher = prioritize momentum differences. Use 0.3-0.5 for momentum-based trading")\r\n\r\n// --- Visualization ---\r\ngrpVis = "═══ VISUALIZATION ═══"\r\nshowHeatmap    = input.bool(true, "Show Correlation Heatmap", group=grpVis, tooltip="Display 16x16 matrix showing all pair correlations. Turn off to reduce clutter or improve performance")\r\nshowRankTable  = input.bool(true, "Show Divergence Rankings", group=grpVis, tooltip="Show table of top opportunities ranked by composite score. This is your primary trading watchlist")\r\nshowDeepDive   = input.bool(true, "Show Deep Dive Chart", group=grpVis, tooltip="Display detailed z-score chart for selected pair below. Turn off if only using heatmap/rankings")\r\nnumRankings    = input.int(15, "Number of Rankings to Show", minval=5, maxval=15, group=grpVis, tooltip="How many pairs to display in ranking table. Maximum 15 shows all SPY pairs. Lower values (5-10) show only top opportunities")\r\n\r\n// --- Deep Dive Pair Selection ---\r\ngrpDeep = "═══ DEEP DIVE PAIR ═══"\r\ndeepSym1 = input.int(1, "Deep Dive: Symbol A (1-16)", minval=1, maxval=16, group=grpDeep, tooltip="First symbol for deep dive chart (base). 1=SPY, 2=QQQ, 3=IWM, 4=DIA, 5-15=Sectors, 16=TLT. Typically use broad market index")\r\ndeepSym2 = input.int(7, "Deep Dive: Symbol B (1-16)", minval=1, maxval=16, group=grpDeep, tooltip="Second symbol for deep dive chart (comparison). Select sector to analyze divergence. Default: 7=XLE (Energy)")\r\nbbLength = input.int(20, "Bollinger Band Length", minval=5, group=grpDeep, tooltip="Period for Bollinger Bands on price ratio. Lower values (10-20) = tighter bands, more signals. Higher values (40-60) = wider bands, fewer signals")\r\nbbMult   = input.float(2.0, "Bollinger Band Multiplier", minval=0.5, step=0.1, group=grpDeep, tooltip="Standard deviation multiplier for Bollinger Bands. 2.0 = standard (95% confidence), 2.5-3.0 = conservative (fewer signals), 1.5 = aggressive (more signals)")\r\n\r\n// --- Table Positions & Appearance ---\r\ngrpPos = "═══ TABLE POSITIONS & APPEARANCE ═══"\r\nheatmapPos = input.string("Bottom Left", "Heatmap Position", options=["Top Left", "Top Center", "Top Right", "Middle Left", "Middle Center", "Middle Right", "Bottom Left", "Bottom Center", "Bottom Right"], group=grpPos, tooltip="Where to display the correlation heatmap table on your chart. Adjust to avoid overlapping with price action or other tables")\r\nrankTablePos = input.string("Bottom Right", "Ranking Table Position", options=["Top Left", "Top Center", "Top Right", "Middle Left", "Middle Center", "Middle Right", "Bottom Left", "Bottom Center", "Bottom Right"], group=grpPos, tooltip="Where to display the divergence rankings table. Recommended: opposite corner from heatmap to maximize visibility")\r\nfontSize = input.string("Small", "Font Size", options=["Auto", "Tiny", "Small", "Normal", "Large", "Huge"], group=grpPos, tooltip="Table text size. Tiny/Small work best for displaying all data. Increase if tables are hard to read on your monitor")\r\n\r\n//==============================================================================\r\n// HELPER FUNCTIONS\r\n//==============================================================================\r\ngetTablePos(pos) =>\r\n    switch pos\r\n        "Top Left" => position.top_left\r\n        "Top Center" => position.top_center\r\n        "Top Right" => position.top_right\r\n        "Middle Left" => position.middle_left\r\n        "Middle Center" => position.middle_center\r\n        "Middle Right" => position.middle_right\r\n        "Bottom Left" => position.bottom_left\r\n        "Bottom Center" => position.bottom_center\r\n        "Bottom Right" => position.bottom_right\r\n        => position.top_right\r\n\r\ngetFontSize() =>\r\n    switch fontSize\r\n        "Auto" => size.auto\r\n        "Tiny" => size.tiny\r\n        "Small" => size.small\r\n        "Normal" => size.normal\r\n        "Large" => size.large\r\n        "Huge" => size.huge\r\n        => size.tiny\r\n\r\ngetCorrColor(corr) =>\r\n    if corr >= 0.7\r\n        color.new(color.green, 20)\r\n    else if corr >= 0.4\r\n        color.new(color.lime, 40)\r\n    else if corr >= 0.0\r\n        color.new(color.yellow, 40)\r\n    else if corr >= -0.4\r\n        color.new(color.orange, 40)\r\n    else\r\n        color.new(color.red, 20)\r\n\r\ngetZscoreColor(z) =>\r\n    absZ = math.abs(z)\r\n    if absZ >= 2.5\r\n        color.new(color.red, 0)\r\n    else if absZ >= 1.5\r\n        color.new(color.orange, 0)\r\n    else if absZ >= 1.0\r\n        color.new(color.yellow, 20)\r\n    else\r\n        color.new(color.gray, 40)\r\n\r\ngetCompositeColor(score) =>\r\n    if score >= 0.7\r\n        color.new(color.red, 0)\r\n    else if score >= 0.5\r\n        color.new(color.orange, 10)\r\n    else if score >= 0.3\r\n        color.new(color.yellow, 20)\r\n    else\r\n        color.new(color.gray, 50)\r\n\r\ngetTicker(sym) =>\r\n    parts = str.split(sym, ":")\r\n    array.size(parts) > 1 ? array.get(parts, 1) : sym\r\n\r\ngetSectorName(idx) =>\r\n    switch idx\r\n        1  => "S&P 500"\r\n        2  => "Nasdaq"\r\n        3  => "Small Cap"\r\n        4  => "Dow Jones"\r\n        5  => "Technology"\r\n        6  => "Financials"\r\n        7  => "Energy"\r\n        8  => "Healthcare"\r\n        9  => "Cons. Discret."\r\n        10 => "Cons. Staples"\r\n        11 => "Industrials"\r\n        12 => "Utilities"\r\n        13 => "Materials"\r\n        14 => "Communication"\r\n        15 => "Real Estate"\r\n        16 => "Bonds"\r\n        => "Unknown"\r\n\r\n//==============================================================================\r\n// DATA FETCHING (16 symbols)\r\n//==============================================================================\r\nprice1  = request.security(sym1,  timeframe.period, close)\r\nprice2  = request.security(sym2,  timeframe.period, close)\r\nprice3  = request.security(sym3,  timeframe.period, close)\r\nprice4  = request.security(sym4,  timeframe.period, close)\r\nprice5  = request.security(sym5,  timeframe.period, close)\r\nprice6  = request.security(sym6,  timeframe.period, close)\r\nprice7  = request.security(sym7,  timeframe.period, close)\r\nprice8  = request.security(sym8,  timeframe.period, close)\r\nprice9  = request.security(sym9,  timeframe.period, close)\r\nprice10 = request.security(sym10, timeframe.period, close)\r\nprice11 = request.security(sym11, timeframe.period, close)\r\nprice12 = request.security(sym12, timeframe.period, close)\r\nprice13 = request.security(sym13, timeframe.period, close)\r\nprice14 = request.security(sym14, timeframe.period, close)\r\nprice15 = request.security(sym15, timeframe.period, close)\r\nprice16 = request.security(sym16, timeframe.period, close)\r\n\r\n// Symbol names array\r\nvar symNames = array.new_string(16)\r\nif barstate.isfirst\r\n    array.set(symNames, 0,  getTicker(sym1))\r\n    array.set(symNames, 1,  getTicker(sym2))\r\n    array.set(symNames, 2,  getTicker(sym3))\r\n    array.set(symNames, 3,  getTicker(sym4))\r\n    array.set(symNames, 4,  getTicker(sym5))\r\n    array.set(symNames, 5,  getTicker(sym6))\r\n    array.set(symNames, 6,  getTicker(sym7))\r\n    array.set(symNames, 7,  getTicker(sym8))\r\n    array.set(symNames, 8,  getTicker(sym9))\r\n    array.set(symNames, 9,  getTicker(sym10))\r\n    array.set(symNames, 10, getTicker(sym11))\r\n    array.set(symNames, 11, getTicker(sym12))\r\n    array.set(symNames, 12, getTicker(sym13))\r\n    array.set(symNames, 13, getTicker(sym14))\r\n    array.set(symNames, 14, getTicker(sym15))\r\n    array.set(symNames, 15, getTicker(sym16))\r\n\r\n//==============================================================================\r\n// RETURNS CALCULATION\r\n//==============================================================================\r\nret1  = (price1  - price1[1])  / price1[1]\r\nret2  = (price2  - price2[1])  / price2[1]\r\nret3  = (price3  - price3[1])  / price3[1]\r\nret4  = (price4  - price4[1])  / price4[1]\r\nret5  = (price5  - price5[1])  / price5[1]\r\nret6  = (price6  - price6[1])  / price6[1]\r\nret7  = (price7  - price7[1])  / price7[1]\r\nret8  = (price8  - price8[1])  / price8[1]\r\nret9  = (price9  - price9[1])  / price9[1]\r\nret10 = (price10 - price10[1]) / price10[1]\r\nret11 = (price11 - price11[1]) / price11[1]\r\nret12 = (price12 - price12[1]) / price12[1]\r\nret13 = (price13 - price13[1]) / price13[1]\r\nret14 = (price14 - price14[1]) / price14[1]\r\nret15 = (price15 - price15[1]) / price15[1]\r\nret16 = (price16 - price16[1]) / price16[1]\r\n\r\n//==============================================================================\r\n// RELATIVE PERFORMANCE (Normalized returns over perfLength)\r\n//==============================================================================\r\nperf1  = (price1  - price1[perfLength])  / price1[perfLength]  * 100\r\nperf2  = (price2  - price2[perfLength])  / price2[perfLength]  * 100\r\nperf3  = (price3  - price3[perfLength])  / price3[perfLength]  * 100\r\nperf4  = (price4  - price4[perfLength])  / price4[perfLength]  * 100\r\nperf5  = (price5  - price5[perfLength])  / price5[perfLength]  * 100\r\nperf6  = (price6  - price6[perfLength])  / price6[perfLength]  * 100\r\nperf7  = (price7  - price7[perfLength])  / price7[perfLength]  * 100\r\nperf8  = (price8  - price8[perfLength])  / price8[perfLength]  * 100\r\nperf9  = (price9  - price9[perfLength])  / price9[perfLength]  * 100\r\nperf10 = (price10 - price10[perfLength]) / price10[perfLength] * 100\r\nperf11 = (price11 - price11[perfLength]) / price11[perfLength] * 100\r\nperf12 = (price12 - price12[perfLength]) / price12[perfLength] * 100\r\nperf13 = (price13 - price13[perfLength]) / price13[perfLength] * 100\r\nperf14 = (price14 - price14[perfLength]) / price14[perfLength] * 100\r\nperf15 = (price15 - price15[perfLength]) / price15[perfLength] * 100\r\nperf16 = (price16 - price16[perfLength]) / price16[perfLength] * 100\r\n\r\n//==============================================================================\r\n// PAIR DATA TYPE\r\n//==============================================================================\r\ntype PairData\r\n    int idx1\r\n    int idx2\r\n    string name\r\n    float zscore\r\n    float corrShort\r\n    float corrLong\r\n    float corrBreakdown\r\n    float relPerfDiff\r\n    float composite\r\n\r\n//==============================================================================\r\n// CALCULATE ALL PAIR METRICS\r\n// We need to calculate for key pairs - focusing on first 8 vs all for heatmap efficiency\r\n//==============================================================================\r\n\r\n// Helper to get return by index\r\ngetReturn(idx) =>\r\n    switch idx\r\n        1  => ret1\r\n        2  => ret2\r\n        3  => ret3\r\n        4  => ret4\r\n        5  => ret5\r\n        6  => ret6\r\n        7  => ret7\r\n        8  => ret8\r\n        9  => ret9\r\n        10 => ret10\r\n        11 => ret11\r\n        12 => ret12\r\n        13 => ret13\r\n        14 => ret14\r\n        15 => ret15\r\n        16 => ret16\r\n        => ret1\r\n\r\ngetPrice(idx) =>\r\n    switch idx\r\n        1  => price1\r\n        2  => price2\r\n        3  => price3\r\n        4  => price4\r\n        5  => price5\r\n        6  => price6\r\n        7  => price7\r\n        8  => price8\r\n        9  => price9\r\n        10 => price10\r\n        11 => price11\r\n        12 => price12\r\n        13 => price13\r\n        14 => price14\r\n        15 => price15\r\n        16 => price16\r\n        => price1\r\n\r\ngetPerf(idx) =>\r\n    switch idx\r\n        1  => perf1\r\n        2  => perf2\r\n        3  => perf3\r\n        4  => perf4\r\n        5  => perf5\r\n        6  => perf6\r\n        7  => perf7\r\n        8  => perf8\r\n        9  => perf9\r\n        10 => perf10\r\n        11 => perf11\r\n        12 => perf12\r\n        13 => perf13\r\n        14 => perf14\r\n        15 => perf15\r\n        16 => perf16\r\n        => perf1\r\n\r\n// Calculate metrics for a pair\r\ncalcPairMetrics(idx1, idx2) =>\r\n    r1 = getReturn(idx1)\r\n    r2 = getReturn(idx2)\r\n    p1 = getPrice(idx1)\r\n    p2 = getPrice(idx2)\r\n    pf1 = getPerf(idx1)\r\n    pf2 = getPerf(idx2)\r\n\r\n    // Correlations\r\n    corrS = stats.correlation(r1, r2, corrLengthShort)\r\n    corrL = stats.correlation(r1, r2, corrLengthLong)\r\n\r\n    // Log price ratio and z-score\r\n    ratio = math.log(p1 / p2)\r\n    z = stats.zscore(ratio, zscoreLength)\r\n\r\n    // Correlation breakdown (how much short-term dropped below long-term)\r\n    corrBrk = corrL - corrS\r\n\r\n    // Relative performance difference\r\n    relDiff = pf1 - pf2\r\n\r\n    // Normalize components for composite score\r\n    zNorm = math.min(math.abs(z) / 3.0, 1.0)  // Cap at 3 sigma\r\n    corrBrkNorm = math.min(math.max(corrBrk, 0) / 0.5, 1.0)  // Positive breakdown capped at 0.5\r\n    relDiffNorm = math.min(math.abs(relDiff) / 10.0, 1.0)  // Cap at 10% difference\r\n\r\n    // Composite score\r\n    comp = weightZscore * zNorm + weightCorrBrk * corrBrkNorm + weightRelPerf * relDiffNorm\r\n\r\n    [z, corrS, corrL, corrBrk, relDiff, comp]\r\n\r\n//==============================================================================\r\n// CALCULATE KEY PAIRS FOR RANKING (120 pairs for 16 symbols)\r\n// We\'ll calculate the most important subset for performance\r\n//==============================================================================\r\n\r\n// Calculate all 120 pairs\r\n[z_1_2, cs_1_2, cl_1_2, cb_1_2, rp_1_2, cp_1_2] = calcPairMetrics(1, 2)\r\n[z_1_3, cs_1_3, cl_1_3, cb_1_3, rp_1_3, cp_1_3] = calcPairMetrics(1, 3)\r\n[z_1_4, cs_1_4, cl_1_4, cb_1_4, rp_1_4, cp_1_4] = calcPairMetrics(1, 4)\r\n[z_1_5, cs_1_5, cl_1_5, cb_1_5, rp_1_5, cp_1_5] = calcPairMetrics(1, 5)\r\n[z_1_6, cs_1_6, cl_1_6, cb_1_6, rp_1_6, cp_1_6] = calcPairMetrics(1, 6)\r\n[z_1_7, cs_1_7, cl_1_7, cb_1_7, rp_1_7, cp_1_7] = calcPairMetrics(1, 7)\r\n[z_1_8, cs_1_8, cl_1_8, cb_1_8, rp_1_8, cp_1_8] = calcPairMetrics(1, 8)\r\n[z_1_9, cs_1_9, cl_1_9, cb_1_9, rp_1_9, cp_1_9] = calcPairMetrics(1, 9)\r\n[z_1_10, cs_1_10, cl_1_10, cb_1_10, rp_1_10, cp_1_10] = calcPairMetrics(1, 10)\r\n[z_1_11, cs_1_11, cl_1_11, cb_1_11, rp_1_11, cp_1_11] = calcPairMetrics(1, 11)\r\n[z_1_12, cs_1_12, cl_1_12, cb_1_12, rp_1_12, cp_1_12] = calcPairMetrics(1, 12)\r\n[z_1_13, cs_1_13, cl_1_13, cb_1_13, rp_1_13, cp_1_13] = calcPairMetrics(1, 13)\r\n[z_1_14, cs_1_14, cl_1_14, cb_1_14, rp_1_14, cp_1_14] = calcPairMetrics(1, 14)\r\n[z_1_15, cs_1_15, cl_1_15, cb_1_15, rp_1_15, cp_1_15] = calcPairMetrics(1, 15)\r\n[z_1_16, cs_1_16, cl_1_16, cb_1_16, rp_1_16, cp_1_16] = calcPairMetrics(1, 16)\r\n\r\n[z_2_3, cs_2_3, cl_2_3, cb_2_3, rp_2_3, cp_2_3] = calcPairMetrics(2, 3)\r\n[z_2_4, cs_2_4, cl_2_4, cb_2_4, rp_2_4, cp_2_4] = calcPairMetrics(2, 4)\r\n[z_2_5, cs_2_5, cl_2_5, cb_2_5, rp_2_5, cp_2_5] = calcPairMetrics(2, 5)\r\n[z_2_6, cs_2_6, cl_2_6, cb_2_6, rp_2_6, cp_2_6] = calcPairMetrics(2, 6)\r\n[z_2_7, cs_2_7, cl_2_7, cb_2_7, rp_2_7, cp_2_7] = calcPairMetrics(2, 7)\r\n[z_2_8, cs_2_8, cl_2_8, cb_2_8, rp_2_8, cp_2_8] = calcPairMetrics(2, 8)\r\n[z_2_9, cs_2_9, cl_2_9, cb_2_9, rp_2_9, cp_2_9] = calcPairMetrics(2, 9)\r\n[z_2_10, cs_2_10, cl_2_10, cb_2_10, rp_2_10, cp_2_10] = calcPairMetrics(2, 10)\r\n[z_2_11, cs_2_11, cl_2_11, cb_2_11, rp_2_11, cp_2_11] = calcPairMetrics(2, 11)\r\n[z_2_12, cs_2_12, cl_2_12, cb_2_12, rp_2_12, cp_2_12] = calcPairMetrics(2, 12)\r\n[z_2_13, cs_2_13, cl_2_13, cb_2_13, rp_2_13, cp_2_13] = calcPairMetrics(2, 13)\r\n[z_2_14, cs_2_14, cl_2_14, cb_2_14, rp_2_14, cp_2_14] = calcPairMetrics(2, 14)\r\n[z_2_15, cs_2_15, cl_2_15, cb_2_15, rp_2_15, cp_2_15] = calcPairMetrics(2, 15)\r\n[z_2_16, cs_2_16, cl_2_16, cb_2_16, rp_2_16, cp_2_16] = calcPairMetrics(2, 16)\r\n\r\n[z_3_4, cs_3_4, cl_3_4, cb_3_4, rp_3_4, cp_3_4] = calcPairMetrics(3, 4)\r\n[z_3_5, cs_3_5, cl_3_5, cb_3_5, rp_3_5, cp_3_5] = calcPairMetrics(3, 5)\r\n[z_3_6, cs_3_6, cl_3_6, cb_3_6, rp_3_6, cp_3_6] = calcPairMetrics(3, 6)\r\n[z_3_7, cs_3_7, cl_3_7, cb_3_7, rp_3_7, cp_3_7] = calcPairMetrics(3, 7)\r\n[z_3_8, cs_3_8, cl_3_8, cb_3_8, rp_3_8, cp_3_8] = calcPairMetrics(3, 8)\r\n[z_3_9, cs_3_9, cl_3_9, cb_3_9, rp_3_9, cp_3_9] = calcPairMetrics(3, 9)\r\n[z_3_10, cs_3_10, cl_3_10, cb_3_10, rp_3_10, cp_3_10] = calcPairMetrics(3, 10)\r\n[z_3_11, cs_3_11, cl_3_11, cb_3_11, rp_3_11, cp_3_11] = calcPairMetrics(3, 11)\r\n[z_3_12, cs_3_12, cl_3_12, cb_3_12, rp_3_12, cp_3_12] = calcPairMetrics(3, 12)\r\n[z_3_13, cs_3_13, cl_3_13, cb_3_13, rp_3_13, cp_3_13] = calcPairMetrics(3, 13)\r\n[z_3_14, cs_3_14, cl_3_14, cb_3_14, rp_3_14, cp_3_14] = calcPairMetrics(3, 14)\r\n[z_3_15, cs_3_15, cl_3_15, cb_3_15, rp_3_15, cp_3_15] = calcPairMetrics(3, 15)\r\n[z_3_16, cs_3_16, cl_3_16, cb_3_16, rp_3_16, cp_3_16] = calcPairMetrics(3, 16)\r\n\r\n[z_4_5, cs_4_5, cl_4_5, cb_4_5, rp_4_5, cp_4_5] = calcPairMetrics(4, 5)\r\n[z_4_6, cs_4_6, cl_4_6, cb_4_6, rp_4_6, cp_4_6] = calcPairMetrics(4, 6)\r\n[z_4_7, cs_4_7, cl_4_7, cb_4_7, rp_4_7, cp_4_7] = calcPairMetrics(4, 7)\r\n[z_4_8, cs_4_8, cl_4_8, cb_4_8, rp_4_8, cp_4_8] = calcPairMetrics(4, 8)\r\n[z_4_9, cs_4_9, cl_4_9, cb_4_9, rp_4_9, cp_4_9] = calcPairMetrics(4, 9)\r\n[z_4_10, cs_4_10, cl_4_10, cb_4_10, rp_4_10, cp_4_10] = calcPairMetrics(4, 10)\r\n[z_4_11, cs_4_11, cl_4_11, cb_4_11, rp_4_11, cp_4_11] = calcPairMetrics(4, 11)\r\n[z_4_12, cs_4_12, cl_4_12, cb_4_12, rp_4_12, cp_4_12] = calcPairMetrics(4, 12)\r\n[z_4_13, cs_4_13, cl_4_13, cb_4_13, rp_4_13, cp_4_13] = calcPairMetrics(4, 13)\r\n[z_4_14, cs_4_14, cl_4_14, cb_4_14, rp_4_14, cp_4_14] = calcPairMetrics(4, 14)\r\n[z_4_15, cs_4_15, cl_4_15, cb_4_15, rp_4_15, cp_4_15] = calcPairMetrics(4, 15)\r\n[z_4_16, cs_4_16, cl_4_16, cb_4_16, rp_4_16, cp_4_16] = calcPairMetrics(4, 16)\r\n\r\n[z_5_6, cs_5_6, cl_5_6, cb_5_6, rp_5_6, cp_5_6] = calcPairMetrics(5, 6)\r\n[z_5_7, cs_5_7, cl_5_7, cb_5_7, rp_5_7, cp_5_7] = calcPairMetrics(5, 7)\r\n[z_5_8, cs_5_8, cl_5_8, cb_5_8, rp_5_8, cp_5_8] = calcPairMetrics(5, 8)\r\n[z_5_9, cs_5_9, cl_5_9, cb_5_9, rp_5_9, cp_5_9] = calcPairMetrics(5, 9)\r\n[z_5_10, cs_5_10, cl_5_10, cb_5_10, rp_5_10, cp_5_10] = calcPairMetrics(5, 10)\r\n[z_5_11, cs_5_11, cl_5_11, cb_5_11, rp_5_11, cp_5_11] = calcPairMetrics(5, 11)\r\n[z_5_12, cs_5_12, cl_5_12, cb_5_12, rp_5_12, cp_5_12] = calcPairMetrics(5, 12)\r\n[z_5_13, cs_5_13, cl_5_13, cb_5_13, rp_5_13, cp_5_13] = calcPairMetrics(5, 13)\r\n[z_5_14, cs_5_14, cl_5_14, cb_5_14, rp_5_14, cp_5_14] = calcPairMetrics(5, 14)\r\n[z_5_15, cs_5_15, cl_5_15, cb_5_15, rp_5_15, cp_5_15] = calcPairMetrics(5, 15)\r\n[z_5_16, cs_5_16, cl_5_16, cb_5_16, rp_5_16, cp_5_16] = calcPairMetrics(5, 16)\r\n\r\n[z_6_7, cs_6_7, cl_6_7, cb_6_7, rp_6_7, cp_6_7] = calcPairMetrics(6, 7)\r\n[z_6_8, cs_6_8, cl_6_8, cb_6_8, rp_6_8, cp_6_8] = calcPairMetrics(6, 8)\r\n[z_6_9, cs_6_9, cl_6_9, cb_6_9, rp_6_9, cp_6_9] = calcPairMetrics(6, 9)\r\n[z_6_10, cs_6_10, cl_6_10, cb_6_10, rp_6_10, cp_6_10] = calcPairMetrics(6, 10)\r\n[z_6_11, cs_6_11, cl_6_11, cb_6_11, rp_6_11, cp_6_11] = calcPairMetrics(6, 11)\r\n[z_6_12, cs_6_12, cl_6_12, cb_6_12, rp_6_12, cp_6_12] = calcPairMetrics(6, 12)\r\n[z_6_13, cs_6_13, cl_6_13, cb_6_13, rp_6_13, cp_6_13] = calcPairMetrics(6, 13)\r\n[z_6_14, cs_6_14, cl_6_14, cb_6_14, rp_6_14, cp_6_14] = calcPairMetrics(6, 14)\r\n[z_6_15, cs_6_15, cl_6_15, cb_6_15, rp_6_15, cp_6_15] = calcPairMetrics(6, 15)\r\n[z_6_16, cs_6_16, cl_6_16, cb_6_16, rp_6_16, cp_6_16] = calcPairMetrics(6, 16)\r\n\r\n[z_7_8, cs_7_8, cl_7_8, cb_7_8, rp_7_8, cp_7_8] = calcPairMetrics(7, 8)\r\n[z_7_9, cs_7_9, cl_7_9, cb_7_9, rp_7_9, cp_7_9] = calcPairMetrics(7, 9)\r\n[z_7_10, cs_7_10, cl_7_10, cb_7_10, rp_7_10, cp_7_10] = calcPairMetrics(7, 10)\r\n[z_7_11, cs_7_11, cl_7_11, cb_7_11, rp_7_11, cp_7_11] = calcPairMetrics(7, 11)\r\n[z_7_12, cs_7_12, cl_7_12, cb_7_12, rp_7_12, cp_7_12] = calcPairMetrics(7, 12)\r\n[z_7_13, cs_7_13, cl_7_13, cb_7_13, rp_7_13, cp_7_13] = calcPairMetrics(7, 13)\r\n[z_7_14, cs_7_14, cl_7_14, cb_7_14, rp_7_14, cp_7_14] = calcPairMetrics(7, 14)\r\n[z_7_15, cs_7_15, cl_7_15, cb_7_15, rp_7_15, cp_7_15] = calcPairMetrics(7, 15)\r\n[z_7_16, cs_7_16, cl_7_16, cb_7_16, rp_7_16, cp_7_16] = calcPairMetrics(7, 16)\r\n\r\n[z_8_9, cs_8_9, cl_8_9, cb_8_9, rp_8_9, cp_8_9] = calcPairMetrics(8, 9)\r\n[z_8_10, cs_8_10, cl_8_10, cb_8_10, rp_8_10, cp_8_10] = calcPairMetrics(8, 10)\r\n[z_8_11, cs_8_11, cl_8_11, cb_8_11, rp_8_11, cp_8_11] = calcPairMetrics(8, 11)\r\n[z_8_12, cs_8_12, cl_8_12, cb_8_12, rp_8_12, cp_8_12] = calcPairMetrics(8, 12)\r\n[z_8_13, cs_8_13, cl_8_13, cb_8_13, rp_8_13, cp_8_13] = calcPairMetrics(8, 13)\r\n[z_8_14, cs_8_14, cl_8_14, cb_8_14, rp_8_14, cp_8_14] = calcPairMetrics(8, 14)\r\n[z_8_15, cs_8_15, cl_8_15, cb_8_15, rp_8_15, cp_8_15] = calcPairMetrics(8, 15)\r\n[z_8_16, cs_8_16, cl_8_16, cb_8_16, rp_8_16, cp_8_16] = calcPairMetrics(8, 16)\r\n\r\n[z_9_10, cs_9_10, cl_9_10, cb_9_10, rp_9_10, cp_9_10] = calcPairMetrics(9, 10)\r\n[z_9_11, cs_9_11, cl_9_11, cb_9_11, rp_9_11, cp_9_11] = calcPairMetrics(9, 11)\r\n[z_9_12, cs_9_12, cl_9_12, cb_9_12, rp_9_12, cp_9_12] = calcPairMetrics(9, 12)\r\n[z_9_13, cs_9_13, cl_9_13, cb_9_13, rp_9_13, cp_9_13] = calcPairMetrics(9, 13)\r\n[z_9_14, cs_9_14, cl_9_14, cb_9_14, rp_9_14, cp_9_14] = calcPairMetrics(9, 14)\r\n[z_9_15, cs_9_15, cl_9_15, cb_9_15, rp_9_15, cp_9_15] = calcPairMetrics(9, 15)\r\n[z_9_16, cs_9_16, cl_9_16, cb_9_16, rp_9_16, cp_9_16] = calcPairMetrics(9, 16)\r\n\r\n[z_10_11, cs_10_11, cl_10_11, cb_10_11, rp_10_11, cp_10_11] = calcPairMetrics(10, 11)\r\n[z_10_12, cs_10_12, cl_10_12, cb_10_12, rp_10_12, cp_10_12] = calcPairMetrics(10, 12)\r\n[z_10_13, cs_10_13, cl_10_13, cb_10_13, rp_10_13, cp_10_13] = calcPairMetrics(10, 13)\r\n[z_10_14, cs_10_14, cl_10_14, cb_10_14, rp_10_14, cp_10_14] = calcPairMetrics(10, 14)\r\n[z_10_15, cs_10_15, cl_10_15, cb_10_15, rp_10_15, cp_10_15] = calcPairMetrics(10, 15)\r\n[z_10_16, cs_10_16, cl_10_16, cb_10_16, rp_10_16, cp_10_16] = calcPairMetrics(10, 16)\r\n\r\n[z_11_12, cs_11_12, cl_11_12, cb_11_12, rp_11_12, cp_11_12] = calcPairMetrics(11, 12)\r\n[z_11_13, cs_11_13, cl_11_13, cb_11_13, rp_11_13, cp_11_13] = calcPairMetrics(11, 13)\r\n[z_11_14, cs_11_14, cl_11_14, cb_11_14, rp_11_14, cp_11_14] = calcPairMetrics(11, 14)\r\n[z_11_15, cs_11_15, cl_11_15, cb_11_15, rp_11_15, cp_11_15] = calcPairMetrics(11, 15)\r\n[z_11_16, cs_11_16, cl_11_16, cb_11_16, rp_11_16, cp_11_16] = calcPairMetrics(11, 16)\r\n\r\n[z_12_13, cs_12_13, cl_12_13, cb_12_13, rp_12_13, cp_12_13] = calcPairMetrics(12, 13)\r\n[z_12_14, cs_12_14, cl_12_14, cb_12_14, rp_12_14, cp_12_14] = calcPairMetrics(12, 14)\r\n[z_12_15, cs_12_15, cl_12_15, cb_12_15, rp_12_15, cp_12_15] = calcPairMetrics(12, 15)\r\n[z_12_16, cs_12_16, cl_12_16, cb_12_16, rp_12_16, cp_12_16] = calcPairMetrics(12, 16)\r\n\r\n[z_13_14, cs_13_14, cl_13_14, cb_13_14, rp_13_14, cp_13_14] = calcPairMetrics(13, 14)\r\n[z_13_15, cs_13_15, cl_13_15, cb_13_15, rp_13_15, cp_13_15] = calcPairMetrics(13, 15)\r\n[z_13_16, cs_13_16, cl_13_16, cb_13_16, rp_13_16, cp_13_16] = calcPairMetrics(13, 16)\r\n\r\n[z_14_15, cs_14_15, cl_14_15, cb_14_15, rp_14_15, cp_14_15] = calcPairMetrics(14, 15)\r\n[z_14_16, cs_14_16, cl_14_16, cb_14_16, rp_14_16, cp_14_16] = calcPairMetrics(14, 16)\r\n\r\n[z_15_16, cs_15_16, cl_15_16, cb_15_16, rp_15_16, cp_15_16] = calcPairMetrics(15, 16)\r\n\r\n//==============================================================================\r\n// DEEP DIVE CALCULATIONS\r\n//==============================================================================\r\ndeepPrice1Val = getPrice(deepSym1)\r\ndeepPrice2Val = getPrice(deepSym2)\r\ndeepRet1 = getReturn(deepSym1)\r\ndeepRet2 = getReturn(deepSym2)\r\ndeepPerf1 = getPerf(deepSym1)\r\ndeepPerf2 = getPerf(deepSym2)\r\n\r\ndeepRatio = math.log(deepPrice1Val / deepPrice2Val)\r\ndeepZscore = stats.zscore(deepRatio, zscoreLength)\r\ndeepCorrShort = stats.correlation(deepRet1, deepRet2, corrLengthShort)\r\ndeepCorrLong = stats.correlation(deepRet1, deepRet2, corrLengthLong)\r\ndeepCorrBreakdown = deepCorrLong - deepCorrShort\r\ndeepRelPerfDiff = deepPerf1 - deepPerf2\r\n\r\n// Bollinger Bands on ratio\r\ndeepBasis = ta.sma(deepRatio, bbLength)\r\ndeepDev = ta.stdev(deepRatio, bbLength)\r\ndeepUpper = deepBasis + bbMult * deepDev\r\ndeepLower = deepBasis - bbMult * deepDev\r\n\r\n//==============================================================================\r\n// HELPER FUNCTION: Get correlation by pair indices (must be at global scope)\r\n//==============================================================================\r\ngetCorrShort(i, j) =>\r\n    // Ensure consistent ordering (smaller index first) without recursion\r\n    i1 = math.min(i, j)\r\n    j1 = math.max(i, j)\r\n    if i1 == j1\r\n        1.0\r\n    else\r\n        switch\r\n            i1 == 1 and j1 == 2 => cs_1_2\r\n            i1 == 1 and j1 == 3 => cs_1_3\r\n            i1 == 1 and j1 == 4 => cs_1_4\r\n            i1 == 1 and j1 == 5 => cs_1_5\r\n            i1 == 1 and j1 == 6 => cs_1_6\r\n            i1 == 1 and j1 == 7 => cs_1_7\r\n            i1 == 1 and j1 == 8 => cs_1_8\r\n            i1 == 1 and j1 == 9 => cs_1_9\r\n            i1 == 1 and j1 == 10 => cs_1_10\r\n            i1 == 1 and j1 == 11 => cs_1_11\r\n            i1 == 1 and j1 == 12 => cs_1_12\r\n            i1 == 1 and j1 == 13 => cs_1_13\r\n            i1 == 1 and j1 == 14 => cs_1_14\r\n            i1 == 1 and j1 == 15 => cs_1_15\r\n            i1 == 1 and j1 == 16 => cs_1_16\r\n            i1 == 2 and j1 == 3 => cs_2_3\r\n            i1 == 2 and j1 == 4 => cs_2_4\r\n            i1 == 2 and j1 == 5 => cs_2_5\r\n            i1 == 2 and j1 == 6 => cs_2_6\r\n            i1 == 2 and j1 == 7 => cs_2_7\r\n            i1 == 2 and j1 == 8 => cs_2_8\r\n            i1 == 2 and j1 == 9 => cs_2_9\r\n            i1 == 2 and j1 == 10 => cs_2_10\r\n            i1 == 2 and j1 == 11 => cs_2_11\r\n            i1 == 2 and j1 == 12 => cs_2_12\r\n            i1 == 2 and j1 == 13 => cs_2_13\r\n            i1 == 2 and j1 == 14 => cs_2_14\r\n            i1 == 2 and j1 == 15 => cs_2_15\r\n            i1 == 2 and j1 == 16 => cs_2_16\r\n            i1 == 3 and j1 == 4 => cs_3_4\r\n            i1 == 3 and j1 == 5 => cs_3_5\r\n            i1 == 3 and j1 == 6 => cs_3_6\r\n            i1 == 3 and j1 == 7 => cs_3_7\r\n            i1 == 3 and j1 == 8 => cs_3_8\r\n            i1 == 3 and j1 == 9 => cs_3_9\r\n            i1 == 3 and j1 == 10 => cs_3_10\r\n            i1 == 3 and j1 == 11 => cs_3_11\r\n            i1 == 3 and j1 == 12 => cs_3_12\r\n            i1 == 3 and j1 == 13 => cs_3_13\r\n            i1 == 3 and j1 == 14 => cs_3_14\r\n            i1 == 3 and j1 == 15 => cs_3_15\r\n            i1 == 3 and j1 == 16 => cs_3_16\r\n            i1 == 4 and j1 == 5 => cs_4_5\r\n            i1 == 4 and j1 == 6 => cs_4_6\r\n            i1 == 4 and j1 == 7 => cs_4_7\r\n            i1 == 4 and j1 == 8 => cs_4_8\r\n            i1 == 4 and j1 == 9 => cs_4_9\r\n            i1 == 4 and j1 == 10 => cs_4_10\r\n            i1 == 4 and j1 == 11 => cs_4_11\r\n            i1 == 4 and j1 == 12 => cs_4_12\r\n            i1 == 4 and j1 == 13 => cs_4_13\r\n            i1 == 4 and j1 == 14 => cs_4_14\r\n            i1 == 4 and j1 == 15 => cs_4_15\r\n            i1 == 4 and j1 == 16 => cs_4_16\r\n            i1 == 5 and j1 == 6 => cs_5_6\r\n            i1 == 5 and j1 == 7 => cs_5_7\r\n            i1 == 5 and j1 == 8 => cs_5_8\r\n            i1 == 5 and j1 == 9 => cs_5_9\r\n            i1 == 5 and j1 == 10 => cs_5_10\r\n            i1 == 5 and j1 == 11 => cs_5_11\r\n            i1 == 5 and j1 == 12 => cs_5_12\r\n            i1 == 5 and j1 == 13 => cs_5_13\r\n            i1 == 5 and j1 == 14 => cs_5_14\r\n            i1 == 5 and j1 == 15 => cs_5_15\r\n            i1 == 5 and j1 == 16 => cs_5_16\r\n            i1 == 6 and j1 == 7 => cs_6_7\r\n            i1 == 6 and j1 == 8 => cs_6_8\r\n            i1 == 6 and j1 == 9 => cs_6_9\r\n            i1 == 6 and j1 == 10 => cs_6_10\r\n            i1 == 6 and j1 == 11 => cs_6_11\r\n            i1 == 6 and j1 == 12 => cs_6_12\r\n            i1 == 6 and j1 == 13 => cs_6_13\r\n            i1 == 6 and j1 == 14 => cs_6_14\r\n            i1 == 6 and j1 == 15 => cs_6_15\r\n            i1 == 6 and j1 == 16 => cs_6_16\r\n            i1 == 7 and j1 == 8 => cs_7_8\r\n            i1 == 7 and j1 == 9 => cs_7_9\r\n            i1 == 7 and j1 == 10 => cs_7_10\r\n            i1 == 7 and j1 == 11 => cs_7_11\r\n            i1 == 7 and j1 == 12 => cs_7_12\r\n            i1 == 7 and j1 == 13 => cs_7_13\r\n            i1 == 7 and j1 == 14 => cs_7_14\r\n            i1 == 7 and j1 == 15 => cs_7_15\r\n            i1 == 7 and j1 == 16 => cs_7_16\r\n            i1 == 8 and j1 == 9 => cs_8_9\r\n            i1 == 8 and j1 == 10 => cs_8_10\r\n            i1 == 8 and j1 == 11 => cs_8_11\r\n            i1 == 8 and j1 == 12 => cs_8_12\r\n            i1 == 8 and j1 == 13 => cs_8_13\r\n            i1 == 8 and j1 == 14 => cs_8_14\r\n            i1 == 8 and j1 == 15 => cs_8_15\r\n            i1 == 8 and j1 == 16 => cs_8_16\r\n            i1 == 9 and j1 == 10 => cs_9_10\r\n            i1 == 9 and j1 == 11 => cs_9_11\r\n            i1 == 9 and j1 == 12 => cs_9_12\r\n            i1 == 9 and j1 == 13 => cs_9_13\r\n            i1 == 9 and j1 == 14 => cs_9_14\r\n            i1 == 9 and j1 == 15 => cs_9_15\r\n            i1 == 9 and j1 == 16 => cs_9_16\r\n            i1 == 10 and j1 == 11 => cs_10_11\r\n            i1 == 10 and j1 == 12 => cs_10_12\r\n            i1 == 10 and j1 == 13 => cs_10_13\r\n            i1 == 10 and j1 == 14 => cs_10_14\r\n            i1 == 10 and j1 == 15 => cs_10_15\r\n            i1 == 10 and j1 == 16 => cs_10_16\r\n            i1 == 11 and j1 == 12 => cs_11_12\r\n            i1 == 11 and j1 == 13 => cs_11_13\r\n            i1 == 11 and j1 == 14 => cs_11_14\r\n            i1 == 11 and j1 == 15 => cs_11_15\r\n            i1 == 11 and j1 == 16 => cs_11_16\r\n            i1 == 12 and j1 == 13 => cs_12_13\r\n            i1 == 12 and j1 == 14 => cs_12_14\r\n            i1 == 12 and j1 == 15 => cs_12_15\r\n            i1 == 12 and j1 == 16 => cs_12_16\r\n            i1 == 13 and j1 == 14 => cs_13_14\r\n            i1 == 13 and j1 == 15 => cs_13_15\r\n            i1 == 13 and j1 == 16 => cs_13_16\r\n            i1 == 14 and j1 == 15 => cs_14_15\r\n            i1 == 14 and j1 == 16 => cs_14_16\r\n            i1 == 15 and j1 == 16 => cs_15_16\r\n            => 0.0\r\n\r\n//==============================================================================\r\n// HEATMAP (16x16 correlation matrix)\r\n//==============================================================================\r\nvar table heatmapTable = table.new(getTablePos(heatmapPos), 17, 17, bgcolor=color.new(color.black, 80), border_width=1)\r\n\r\nif showHeatmap and barstate.islast\r\n    // Header\r\n    table.cell(heatmapTable, 0, 0, "CORR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    // Column and row headers\r\n    for i = 0 to 15\r\n        symName = array.get(symNames, i)\r\n        table.cell(heatmapTable, i + 1, 0, symName, bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n        table.cell(heatmapTable, 0, i + 1, symName, bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    // Fill matrix\r\n    for i = 1 to 16\r\n        for j = 1 to 16\r\n            corrVal = getCorrShort(i, j)\r\n            cellColor = i == j ? color.new(color.blue, 60) : getCorrColor(corrVal)\r\n            table.cell(heatmapTable, j, i, str.tostring(corrVal, "#.##"), bgcolor=cellColor, text_color=color.white, text_size=getFontSize())\r\n\r\n//==============================================================================\r\n// DIVERGENCE RANKING TABLE\r\n//==============================================================================\r\nvar table rankTable = table.new(getTablePos(rankTablePos), 8, numRankings + 1, bgcolor=color.new(color.black, 80), border_width=1)\r\n\r\nif showRankTable and barstate.islast\r\n    // Create array of SPY pairs only (15 pairs: SPY with each of the other 15 symbols)\r\n    var pairs = array.new<PairData>(15)\r\n\r\n    // Populate pairs array - only SPY pairs\r\n    pairIdx = 0\r\n\r\n    // SPY (symbol 1) pairs with all other symbols\r\n    array.set(pairs, pairIdx, PairData.new(1, 2, array.get(symNames, 0) + "/" + array.get(symNames, 1), z_1_2, cs_1_2, cl_1_2, cb_1_2, rp_1_2, cp_1_2)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 3, array.get(symNames, 0) + "/" + array.get(symNames, 2), z_1_3, cs_1_3, cl_1_3, cb_1_3, rp_1_3, cp_1_3)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 4, array.get(symNames, 0) + "/" + array.get(symNames, 3), z_1_4, cs_1_4, cl_1_4, cb_1_4, rp_1_4, cp_1_4)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 5, array.get(symNames, 0) + "/" + array.get(symNames, 4), z_1_5, cs_1_5, cl_1_5, cb_1_5, rp_1_5, cp_1_5)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 6, array.get(symNames, 0) + "/" + array.get(symNames, 5), z_1_6, cs_1_6, cl_1_6, cb_1_6, rp_1_6, cp_1_6)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 7, array.get(symNames, 0) + "/" + array.get(symNames, 6), z_1_7, cs_1_7, cl_1_7, cb_1_7, rp_1_7, cp_1_7)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 8, array.get(symNames, 0) + "/" + array.get(symNames, 7), z_1_8, cs_1_8, cl_1_8, cb_1_8, rp_1_8, cp_1_8)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 9, array.get(symNames, 0) + "/" + array.get(symNames, 8), z_1_9, cs_1_9, cl_1_9, cb_1_9, rp_1_9, cp_1_9)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 10, array.get(symNames, 0) + "/" + array.get(symNames, 9), z_1_10, cs_1_10, cl_1_10, cb_1_10, rp_1_10, cp_1_10)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 11, array.get(symNames, 0) + "/" + array.get(symNames, 10), z_1_11, cs_1_11, cl_1_11, cb_1_11, rp_1_11, cp_1_11)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 12, array.get(symNames, 0) + "/" + array.get(symNames, 11), z_1_12, cs_1_12, cl_1_12, cb_1_12, rp_1_12, cp_1_12)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 13, array.get(symNames, 0) + "/" + array.get(symNames, 12), z_1_13, cs_1_13, cl_1_13, cb_1_13, rp_1_13, cp_1_13)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 14, array.get(symNames, 0) + "/" + array.get(symNames, 13), z_1_14, cs_1_14, cl_1_14, cb_1_14, rp_1_14, cp_1_14)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 15, array.get(symNames, 0) + "/" + array.get(symNames, 14), z_1_15, cs_1_15, cl_1_15, cb_1_15, rp_1_15, cp_1_15)), pairIdx += 1\r\n    array.set(pairs, pairIdx, PairData.new(1, 16, array.get(symNames, 0) + "/" + array.get(symNames, 15), z_1_16, cs_1_16, cl_1_16, cb_1_16, rp_1_16, cp_1_16))\r\n\r\n    // Sort by composite score (bubble sort)\r\n    for i = 0 to 13\r\n        for j = 0 to 13 - i\r\n            if array.get(pairs, j).composite < array.get(pairs, j + 1).composite\r\n                temp = array.get(pairs, j)\r\n                array.set(pairs, j, array.get(pairs, j + 1))\r\n                array.set(pairs, j + 1, temp)\r\n\r\n    // Draw table headers\r\n    table.cell(rankTable, 0, 0, "#", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 1, 0, "PAIR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 2, 0, "SECTOR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 3, 0, "Z-SCORE", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 4, 0, "CORR", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 5, 0, "PERF%", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 6, 0, "SCORE", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n    table.cell(rankTable, 7, 0, "SIGNAL", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n\r\n    for i = 0 to numRankings - 1\r\n        pair = array.get(pairs, i)\r\n        sectorName = getSectorName(pair.idx2)\r\n        otherSymbol = str.split(pair.name, "/").get(1)\r\n        signal = pair.zscore > zscoreThreshold ? "LONG " + otherSymbol : pair.zscore < -zscoreThreshold ? "SHORT " + otherSymbol : "-"\r\n        signalColor = pair.zscore > zscoreStrong or pair.zscore < -zscoreStrong ? color.new(color.red, 20) : signal != "-" ? color.new(color.purple, 40) : color.new(color.gray, 80)\r\n\r\n        table.cell(rankTable, 0, i + 1, str.tostring(i + 1), bgcolor=color.new(color.gray, 70), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 1, i + 1, pair.name, bgcolor=color.new(color.gray, 80), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 2, i + 1, sectorName, bgcolor=color.new(color.gray, 80), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 3, i + 1, str.tostring(pair.zscore, "#.##"), bgcolor=getZscoreColor(pair.zscore), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 4, i + 1, str.tostring(pair.corrShort, "#.##"), bgcolor=getCorrColor(pair.corrShort), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 5, i + 1, str.tostring(pair.relPerfDiff, "#.#"), bgcolor=color.new(math.abs(pair.relPerfDiff) > 5 ? color.orange : color.gray, 50), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 6, i + 1, str.tostring(pair.composite, "#.##"), bgcolor=getCompositeColor(pair.composite), text_color=color.white, text_size=getFontSize())\r\n        table.cell(rankTable, 7, i + 1, signal, bgcolor=signalColor, text_color=color.white, text_size=getFontSize())\r\n\r\n//==============================================================================\r\n// DEEP DIVE PLOTS\r\n//==============================================================================\r\ndeepName1 = array.get(symNames, deepSym1 - 1)\r\ndeepName2 = array.get(symNames, deepSym2 - 1)\r\n\r\n// Dynamic color gradient for z-score with modern vibrant colors\r\ngetZscoreGradient(z) =>\r\n    if z >= zscoreStrong\r\n        color.rgb(220, 38, 127)  // Hot pink for strong signals\r\n    else if z >= zscoreThreshold\r\n        color.rgb(251, 146, 60)  // Vibrant orange\r\n    else if z >= 0.5\r\n        color.rgb(250, 204, 21)  // Bright yellow\r\n    else if z >= -0.5\r\n        color.rgb(148, 163, 184)  // Neutral gray-blue\r\n    else if z >= -zscoreThreshold\r\n        color.rgb(74, 222, 128)  // Bright lime green\r\n    else if z >= -zscoreStrong\r\n        color.rgb(34, 197, 94)  // Vibrant green\r\n    else\r\n        color.rgb(16, 185, 129)  // Deep emerald\r\n\r\n// Main z-score line with gradient color\r\nzscoreColor = getZscoreGradient(deepZscore)\r\nzscorePlot = plot(showDeepDive ? deepZscore : na, "Z-Score", color=zscoreColor, linewidth=3, style=plot.style_line)\r\n\r\n// Threshold reference lines with softer modern colors\r\nhline(zscoreStrong, "Strong Upper", color=color.new(color.rgb(239, 68, 68), 65), linestyle=hline.style_dashed, linewidth=1)\r\nhline(zscoreThreshold, "Upper Threshold", color=color.new(color.rgb(249, 115, 22), 70), linestyle=hline.style_dotted, linewidth=1)\r\nhline(0, "Zero Line", color=color.new(color.rgb(100, 116, 139), 60), linestyle=hline.style_solid, linewidth=2)\r\nhline(-zscoreThreshold, "Lower Threshold", color=color.new(color.rgb(132, 204, 22), 70), linestyle=hline.style_dotted, linewidth=1)\r\nhline(-zscoreStrong, "Strong Lower", color=color.new(color.rgb(34, 197, 94), 65), linestyle=hline.style_dashed, linewidth=1)\r\n\r\n// Create zone fills with gradient transparency for modern look\r\nupperStrongZone = hline(zscoreStrong, linestyle=hline.style_solid, color=na, editable=false)\r\nupperThresholdZone = hline(zscoreThreshold, linestyle=hline.style_solid, color=na, editable=false)\r\nzeroZone = hline(0, linestyle=hline.style_solid, color=na, editable=false)\r\nlowerThresholdZone = hline(-zscoreThreshold, linestyle=hline.style_solid, color=na, editable=false)\r\nlowerStrongZone = hline(-zscoreStrong, linestyle=hline.style_solid, color=na, editable=false)\r\n\r\n// Fill zones with modern gradient backgrounds\r\nfill(upperStrongZone, upperThresholdZone, color=color.new(color.rgb(239, 68, 68), 92), title="Strong Short Zone")\r\nfill(upperThresholdZone, zeroZone, color=color.new(color.rgb(251, 146, 60), 95), title="Short Zone")\r\nfill(zeroZone, lowerThresholdZone, color=color.new(color.rgb(34, 197, 94), 95), title="Long Zone")\r\nfill(lowerThresholdZone, lowerStrongZone, color=color.new(color.rgb(16, 185, 129), 92), title="Strong Long Zone")\r\n\r\n// Correlation plots with modern styling\r\nplot(showDeepDive ? deepCorrShort : na, "Short-Term Corr", color=color.new(color.rgb(59, 130, 246), 30), linewidth=2, style=plot.style_line)\r\nplot(showDeepDive ? deepCorrLong : na, "Long-Term Corr", color=color.new(color.rgb(168, 85, 247), 40), linewidth=2, style=plot.style_line)\r\n\r\n//==============================================================================\r\n// INFO LABEL\r\n//==============================================================================\r\nif showDeepDive and barstate.islast\r\n    signalText = deepZscore > zscoreStrong ? "STRONG SHORT " + deepName1 : deepZscore > zscoreThreshold ? "SHORT " + deepName1 : deepZscore < -zscoreStrong ? "STRONG LONG " + deepName1 : deepZscore < -zscoreThreshold ? "LONG " + deepName1 : "NEUTRAL"\r\n\r\n    infoText = "Deep Dive: " + deepName1 + " / " + deepName2 +\r\n               "\\nZ-Score: " + str.tostring(deepZscore, "#.##") +\r\n               "\\nCorr (S/L): " + str.tostring(deepCorrShort, "#.##") + " / " + str.tostring(deepCorrLong, "#.##") +\r\n               "\\nCorr Breakdown: " + str.tostring(deepCorrBreakdown, "#.##") +\r\n               "\\nRel Perf Diff: " + str.tostring(deepRelPerfDiff, "#.#") + "%" +\r\n               "\\nSignal: " + signalText\r\n\r\n    label.new(bar_index, deepZscore, infoText,\r\n              style=label.style_label_left,\r\n              color=color.new(color.black, 60),\r\n              textcolor=color.white,\r\n              size=size.small)\r\n\r\n//==============================================================================\r\n// ALERTS\r\n//==============================================================================\r\nalertcondition(deepZscore > zscoreThreshold, title="Z-Score Above Threshold", message="{{ticker}}: Z-Score above signal threshold")\r\nalertcondition(deepZscore < -zscoreThreshold, title="Z-Score Below Threshold", message="{{ticker}}: Z-Score below signal threshold")\r\nalertcondition(deepZscore > zscoreStrong, title="Strong Positive Divergence", message="{{ticker}}: Strong positive divergence detected")\r\nalertcondition(deepZscore < -zscoreStrong, title="Strong Negative Divergence", message="{{ticker}}: Strong negative divergence detected")\r\nalertcondition(deepCorrBreakdown > corrBreakdown, title="Correlation Breakdown", message="{{ticker}}: Correlation breakdown detected")\r\n'
[DEBUG] save_script called: script_id=LSlKIAnd title=Sector Divergence Dashboard category=LSlKIAnd force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\LSlKIAnd_Sector_Divergence_Dashboard.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\LSlKIAnd_Sector_Divergence_Dashboard.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 01:50:52 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 01:50:52 GMT' as: 2026-02-09T01:50:52+00:00
[DEBUG] Exact published date for header: 2026-02-09T01:50:52+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/UWH1xgpI-Volume-Range-Anomaly-Breakout-AlgoPoint/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\n// -----------------------------------------------------------------------------\n// | © AlgoPoint                                                               |\n// | Indicator: Volume-Range Anomaly Breakout [AlgoPoint]                      |\n// | Developer: Harmony Algo & AlgoPoint Collaboration                         |\n// -----------------------------------------------------------------------------\nindicator("Volume-Range Anomaly Breakout [AlgoPoint]", overlay=true, max_labels_count = 500)\n\n// ==========================================\n// --- SETTINGS (AYARLAR) ---\n// ==========================================\ngroup_setup = "Detection Settings"\nlookback    = input.int(20, "Lookback Period", minval=5, group=group_setup)\nvol_filter  = input.float(1.5, "Volume Threshold (xAvg)", step=0.1, group=group_setup)\nrange_filter= input.float(0.8, "Range Compression (xAvg)", step=0.1, group=group_setup)\nbreakout_lookback = input.int(5, "Breakout Window", tooltip="Sinyalden sonra kaç bar içinde kırılım gelmeli?", group=group_setup)\n\n// ==========================================\n// --- CORE ENGINE (ANALYSIS) ---\n// ==========================================\n\n// 1. Relative Volume & Range\nvol_mean = ta.sma(volume, lookback)\nrvol = vol_mean != 0 ? volume / vol_mean : 0\n\nrange_size = high - low\nrange_mean = ta.sma(range_size, lookback)\nr_range = range_mean != 0 ? range_size / range_mean : 1.0\n\n// 2. Identification (Whale Activity)\n// High Volume + Low Range = Absorption (Hidden Activity)\nis_whale_candle = rvol > vol_filter and r_range < range_filter\n\n// 3. Direction Bias (Close Location)\n// Closing near High = Bullish Intent, Near Low = Bearish Intent\nclv = range_size != 0 ? ((close - low) - (high - close)) / range_size : 0\nbias = clv > 0 ? 1 : -1\n\n// ==========================================\n// --- STRATEGY ENGINE (EXECUTION) ---\n// ==========================================\n\n// Variables to store the Whale Candle levels\nvar float whale_high = na\nvar float whale_low = na\nvar int bars_since_whale = 0\nvar int active_signal_dir = 0 // 0:None, 1:Long Setup, -1:Short Setup\n\n// Logic Update\nif is_whale_candle\n    whale_high := high\n    whale_low := low\n    bars_since_whale := 0\n    active_signal_dir := bias // Store the intent (1 or -1)\nelse\n    bars_since_whale := bars_since_whale + 1\n\n// Reset setup if too much time passes without a breakout\nif bars_since_whale > breakout_lookback\n    active_signal_dir := 0\n\n// --- TRIGGERS (ENTRY SIGNALS) ---\n\n// Long Trigger: We have a Long Setup AND Price Closes > Whale High\nlong_breakout = active_signal_dir == 1 and close > whale_high and close[1] <= whale_high\n\n// Short Trigger: We have a Short Setup AND Price Closes < Whale Low\nshort_breakout = active_signal_dir == -1 and close < whale_low and close[1] >= whale_low\n\n// Prevent multiple signals for the same setup\nif long_breakout or short_breakout\n    active_signal_dir := 0 // Reset after triggering\n\n// ==========================================\n// --- VISUALIZATION (ON CHART) ---\n// ==========================================\n\n// 1. Bar Coloring (The Setup)\n// Color the Whale Candle Purple to show "Hidden Activity"\nbarcolor(is_whale_candle ? color.new(#9c27b0, 0) : na, title="Whale Candle Color")\n\n// 2. Breakout Signals (The Trigger)\n// plotshape(long_breakout, title="BUY SIGNAL", location=location.belowbar, color=color.green, style=shape.labelup, size=size.small, text="WHALE\\nBREAKOUT", textcolor=color.white)\n// plotshape(short_breakout, title="SELL SIGNAL", location=location.abovebar, color=color.red, style=shape.labeldown, size=size.small, text="WHALE\\nDUMP", textcolor=color.white)\ny1 = low - (ta.atr(30) * 1.8)\ny2 = high + (ta.atr(30) * 1.8)\n\nif (long_breakout)\n    label.new(bar_index , y1, "Institutional Buy", color=#018208, style=label.style_label_up, textcolor=color.white, size=size.small)\nif (short_breakout)\n    label.new(bar_index , y2, "Institutional Sell", color=#d12208, style=label.style_label_down, textcolor=color.white, size=size.small)\n// 3. Dynamic Support/Resistance Lines (Stop Loss Levels)\n// Draw lines from the whale candle to guide the breakout\nvar line res_line = na\nvar line sup_line = na\n\nif is_whale_candle\n    // Remove old lines to keep chart clean\n    line.delete(res_line)\n    line.delete(sup_line)\n    \n    // Create new lines extending for the \'breakout_lookback\' duration\n    res_line := line.new(bar_index, high, bar_index + breakout_lookback, high, color=color.new(color.red, 50), style=line.style_dotted)\n    sup_line := line.new(bar_index, low, bar_index + breakout_lookback, low, color=color.new(color.green, 50), style=line.style_dotted)\n\n// Extend lines if setup is still valid\nif bars_since_whale > 0 and bars_since_whale <= breakout_lookback and active_signal_dir != 0\n    line.set_x2(res_line, bar_index)\n    line.set_x2(sup_line, bar_index)\nelse\n    // Fade lines when setup expires or triggers\n    line.set_color(res_line, color.new(color.red, 100))\n    line.set_color(sup_line, color.new(color.green, 100))\n\n// ==========================================\n// --- ALERTS ---\n// ==========================================\n\nalertcondition(long_breakout, title="🚀 Whale BUY Breakout", message="Whale Pump")\n\nalertcondition(short_breakout, title="🩸 Whale SELL Breakout", message="Whale Dump")'
[CAPTURE 1] '//@version=5\n// -----------------------------------------------------------------------------\n// | © AlgoPoint                                                               |\n// | Indicator: Volume-Range Anomaly Breakout [AlgoPoint]                      |\n// | Developer: Harmony Algo & AlgoPoint Collaboration                         |\n// -----------------------------------------------------------------------------\nindicator("Volume-Range Anomaly Breakout [AlgoPoint]", overlay=true, max_labels_count = 500)\n\n// ==========================================\n// --- SETTINGS (AYARLAR) ---\n// ==========================================\ngroup_setup = "Detection Settings"\nlookback    = input.int(20, "Lookback Period", minval=5, group=group_setup)\nvol_filter  = input.float(1.5, "Volume Threshold (xAvg)", step=0.1, group=group_setup)\nrange_filter= input.float(0.8, "Range Compression (xAvg)", step=0.1, group=group_setup)\nbreakout_lookback = input.int(5, "Breakout Window", tooltip="Sinyalden sonra kaç bar içinde kırılım gelmeli?", group=group_setup)\n\n// ==========================================\n// --- CORE ENGINE (ANALYSIS) ---\n// ==========================================\n\n// 1. Relative Volume & Range\nvol_mean = ta.sma(volume, lookback)\nrvol = vol_mean != 0 ? volume / vol_mean : 0\n\nrange_size = high - low\nrange_mean = ta.sma(range_size, lookback)\nr_range = range_mean != 0 ? range_size / range_mean : 1.0\n\n// 2. Identification (Whale Activity)\n// High Volume + Low Range = Absorption (Hidden Activity)\nis_whale_candle = rvol > vol_filter and r_range < range_filter\n\n// 3. Direction Bias (Close Location)\n// Closing near High = Bullish Intent, Near Low = Bearish Intent\nclv = range_size != 0 ? ((close - low) - (high - close)) / range_size : 0\nbias = clv > 0 ? 1 : -1\n\n// ==========================================\n// --- STRATEGY ENGINE (EXECUTION) ---\n// ==========================================\n\n// Variables to store the Whale Candle levels\nvar float whale_high = na\nvar float whale_low = na\nvar int bars_since_whale = 0\nvar int active_signal_dir = 0 // 0:None, 1:Long Setup, -1:Short Setup\n\n// Logic Update\nif is_whale_candle\n    whale_high := high\n    whale_low := low\n    bars_since_whale := 0\n    active_signal_dir := bias // Store the intent (1 or -1)\nelse\n    bars_since_whale := bars_since_whale + 1\n\n// Reset setup if too much time passes without a breakout\nif bars_since_whale > breakout_lookback\n    active_signal_dir := 0\n\n// --- TRIGGERS (ENTRY SIGNALS) ---\n\n// Long Trigger: We have a Long Setup AND Price Closes > Whale High\nlong_breakout = active_signal_dir == 1 and close > whale_high and close[1] <= whale_high\n\n// Short Trigger: We have a Short Setup AND Price Closes < Whale Low\nshort_breakout = active_signal_dir == -1 and close < whale_low and close[1] >= whale_low\n\n// Prevent multiple signals for the same setup\nif long_breakout or short_breakout\n    active_signal_dir := 0 // Reset after triggering\n\n// ==========================================\n// --- VISUALIZATION (ON CHART) ---\n// ==========================================\n\n// 1. Bar Coloring (The Setup)\n// Color the Whale Candle Purple to show "Hidden Activity"\nbarcolor(is_whale_candle ? color.new(#9c27b0, 0) : na, title="Whale Candle Color")\n\n// 2. Breakout Signals (The Trigger)\n// plotshape(long_breakout, title="BUY SIGNAL", location=location.belowbar, color=color.green, style=shape.labelup, size=size.small, text="WHALE\\nBREAKOUT", textcolor=color.white)\n// plotshape(short_breakout, title="SELL SIGNAL", location=location.abovebar, color=color.red, style=shape.labeldown, size=size.small, text="WHALE\\nDUMP", textcolor=color.white)\ny1 = low - (ta.atr(30) * 1.8)\ny2 = high + (ta.atr(30) * 1.8)\n\nif (long_breakout)\n    label.new(bar_index , y1, "Institutional Buy", color=#018208, style=label.style_label_up, textcolor=color.white, size=size.small)\nif (short_breakout)\n    label.new(bar_index , y2, "Institutional Sell", color=#d12208, style=label.style_label_down, textcolor=color.white, size=size.small)\n// 3. Dynamic Support/Resistance Lines (Stop Loss Levels)\n// Draw lines from the whale candle to guide the breakout\nvar line res_line = na\nvar line sup_line = na\n\nif is_whale_candle\n    // Remove old lines to keep chart clean\n    line.delete(res_line)\n    line.delete(sup_line)\n    \n    // Create new lines extending for the \'breakout_lookback\' duration\n    res_line := line.new(bar_index, high, bar_index + breakout_lookback, high, color=color.new(color.red, 50), style=line.style_dotted)\n    sup_line := line.new(bar_index, low, bar_index + breakout_lookback, low, color=color.new(color.green, 50), style=line.style_dotted)\n\n// Extend lines if setup is still valid\nif bars_since_whale > 0 and bars_since_whale <= breakout_lookback and active_signal_dir != 0\n    line.set_x2(res_line, bar_index)\n    line.set_x2(sup_line, bar_index)\nelse\n    // Fade lines when setup expires or triggers\n    line.set_color(res_line, color.new(color.red, 100))\n    line.set_color(sup_line, color.new(color.green, 100))\n\n// ==========================================\n// --- ALERTS ---\n// ==========================================\n\nalertcondition(long_breakout, title="🚀 Whale BUY Breakout", message="Whale Pump")\n\nalertcondition(short_breakout, title="🩸 Whale SELL Breakout", message="Whale Dump")'
[CAPTURE 2] '//@version=5\n// -----------------------------------------------------------------------------\n// | © AlgoPoint                                                               |\n// | Indicator: Volume-Range Anomaly Breakout [AlgoPoint]                      |\n// | Developer: Harmony Algo & AlgoPoint Collaboration                         |\n// -----------------------------------------------------------------------------\nindicator("Volume-Range Anomaly Breakout [AlgoPoint]", overlay=true, max_labels_count = 500)\n\n// ==========================================\n// --- SETTINGS (AYARLAR) ---\n// ==========================================\ngroup_setup = "Detection Settings"\nlookback    = input.int(20, "Lookback Period", minval=5, group=group_setup)\nvol_filter  = input.float(1.5, "Volume Threshold (xAvg)", step=0.1, group=group_setup)\nrange_filter= input.float(0.8, "Range Compression (xAvg)", step=0.1, group=group_setup)\nbreakout_lookback = input.int(5, "Breakout Window", tooltip="Sinyalden sonra kaç bar içinde kırılım gelmeli?", group=group_setup)\n\n// ==========================================\n// --- CORE ENGINE (ANALYSIS) ---\n// ==========================================\n\n// 1. Relative Volume & Range\nvol_mean = ta.sma(volume, lookback)\nrvol = vol_mean != 0 ? volume / vol_mean : 0\n\nrange_size = high - low\nrange_mean = ta.sma(range_size, lookback)\nr_range = range_mean != 0 ? range_size / range_mean : 1.0\n\n// 2. Identification (Whale Activity)\n// High Volume + Low Range = Absorption (Hidden Activity)\nis_whale_candle = rvol > vol_filter and r_range < range_filter\n\n// 3. Direction Bias (Close Location)\n// Closing near High = Bullish Intent, Near Low = Bearish Intent\nclv = range_size != 0 ? ((close - low) - (high - close)) / range_size : 0\nbias = clv > 0 ? 1 : -1\n\n// ==========================================\n// --- STRATEGY ENGINE (EXECUTION) ---\n// ==========================================\n\n// Variables to store the Whale Candle levels\nvar float whale_high = na\nvar float whale_low = na\nvar int bars_since_whale = 0\nvar int active_signal_dir = 0 // 0:None, 1:Long Setup, -1:Short Setup\n\n// Logic Update\nif is_whale_candle\n    whale_high := high\n    whale_low := low\n    bars_since_whale := 0\n    active_signal_dir := bias // Store the intent (1 or -1)\nelse\n    bars_since_whale := bars_since_whale + 1\n\n// Reset setup if too much time passes without a breakout\nif bars_since_whale > breakout_lookback\n    active_signal_dir := 0\n\n// --- TRIGGERS (ENTRY SIGNALS) ---\n\n// Long Trigger: We have a Long Setup AND Price Closes > Whale High\nlong_breakout = active_signal_dir == 1 and close > whale_high and close[1] <= whale_high\n\n// Short Trigger: We have a Short Setup AND Price Closes < Whale Low\nshort_breakout = active_signal_dir == -1 and close < whale_low and close[1] >= whale_low\n\n// Prevent multiple signals for the same setup\nif long_breakout or short_breakout\n    active_signal_dir := 0 // Reset after triggering\n\n// ==========================================\n// --- VISUALIZATION (ON CHART) ---\n// ==========================================\n\n// 1. Bar Coloring (The Setup)\n// Color the Whale Candle Purple to show "Hidden Activity"\nbarcolor(is_whale_candle ? color.new(#9c27b0, 0) : na, title="Whale Candle Color")\n\n// 2. Breakout Signals (The Trigger)\n// plotshape(long_breakout, title="BUY SIGNAL", location=location.belowbar, color=color.green, style=shape.labelup, size=size.small, text="WHALE\\nBREAKOUT", textcolor=color.white)\n// plotshape(short_breakout, title="SELL SIGNAL", location=location.abovebar, color=color.red, style=shape.labeldown, size=size.small, text="WHALE\\nDUMP", textcolor=color.white)\ny1 = low - (ta.atr(30) * 1.8)\ny2 = high + (ta.atr(30) * 1.8)\n\nif (long_breakout)\n    label.new(bar_index , y1, "Institutional Buy", color=#018208, style=label.style_label_up, textcolor=color.white, size=size.small)\nif (short_breakout)\n    label.new(bar_index , y2, "Institutional Sell", color=#d12208, style=label.style_label_down, textcolor=color.white, size=size.small)\n// 3. Dynamic Support/Resistance Lines (Stop Loss Levels)\n// Draw lines from the whale candle to guide the breakout\nvar line res_line = na\nvar line sup_line = na\n\nif is_whale_candle\n    // Remove old lines to keep chart clean\n    line.delete(res_line)\n    line.delete(sup_line)\n    \n    // Create new lines extending for the \'breakout_lookback\' duration\n    res_line := line.new(bar_index, high, bar_index + breakout_lookback, high, color=color.new(color.red, 50), style=line.style_dotted)\n    sup_line := line.new(bar_index, low, bar_index + breakout_lookback, low, color=color.new(color.green, 50), style=line.style_dotted)\n\n// Extend lines if setup is still valid\nif bars_since_whale > 0 and bars_since_whale <= breakout_lookback and active_signal_dir != 0\n    line.set_x2(res_line, bar_index)\n    line.set_x2(sup_line, bar_index)\nelse\n    // Fade lines when setup expires or triggers\n    line.set_color(res_line, color.new(color.red, 100))\n    line.set_color(sup_line, color.new(color.green, 100))\n\n// ==========================================\n// --- ALERTS ---\n// ==========================================\n\nalertcondition(long_breakout, title="🚀 Whale BUY Breakout", message="Whale Pump")\n\nalertcondition(short_breakout, title="🩸 Whale SELL Breakout", message="Whale Dump")'
[DEBUG] save_script called: script_id=UWH1xgpI title=Volume-Range Anomaly Breakout [AlgoPoint] category=UWH1xgpI force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\UWH1xgpI_Volume-Range_Anomaly_Breakout_AlgoPoint.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\UWH1xgpI_Volume-Range_Anomaly_Breakout_AlgoPoint.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 01:28:29 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 01:28:29 GMT' as: 2026-02-09T01:28:29+00:00
[DEBUG] Exact published date for header: 2026-02-09T01:28:29+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/i3PggCBW-BTC-vs-M2-Global-Index-MIT/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\nindicator(\'BTC M2 Global Deviation[MIT]\', \r\n     overlay=false, \r\n     scale=scale.left)   // ← 已修复：改成 scale.left\r\n\r\n// ================== 输入参数 ==================\r\noffsetOption = input.string("108 Days", options=["108 Days", "78 Days"], title="Offset:")\r\noffsetValue  = offsetOption == "108 Days" ? 108 : 78\r\n\r\nerweitert = input.bool(false, title="Include extended currencies?", \r\n     tooltip="Standard: USA, China, Eurozone, Japan, UK\\nExtended: + Switzerland, Canada, India, Russia, Brazil, Korea, Mexico, South Africa")\r\n\r\nnormLength = input.int(200, "归一化周期（天）", minval=50, maxval=500)\r\nshowNormLines = input.bool(true,  "显示归一化后的M2和BTC曲线")\r\nshowDeviation = input.bool(true,  "显示偏差 (M2 - BTC)")\r\ndevStyle      = input.string("Columns", "偏差显示样式", options=["Columns", "Area", "Line"])\r\n\r\n// ================== 数据获取 ==================\r\ncnm2   = request.security("ECONOMICS:CNM2",   "D", close)\r\ncnyusd = request.security("FX_IDC:CNYUSD",    "D", close)\r\nusm2   = request.security("ECONOMICS:USM2",   "D", close)\r\neum2   = request.security("ECONOMICS:EUM2",   "D", close)\r\neurusd = request.security("FX:EURUSD",        "D", close)\r\njpm2   = request.security("ECONOMICS:JPM2",   "D", close)\r\njpyusd = request.security("FX_IDC:JPYUSD",    "D", close)\r\ngbm2   = request.security("ECONOMICS:GBM2",   "D", close)\r\ngbpusd = request.security("FX:GBPUSD",        "D", close)\r\n\r\n// 扩展货币组\r\nchm2   = request.security("ECONOMICS:CHM2",   "D", close)\r\nchfusd = request.security("FX_IDC:CHFUSD",    "D", close)\r\ncam2   = request.security("ECONOMICS:CAM2",   "D", close)\r\ncadusd = request.security("FX_IDC:CADUSD",    "D", close)\r\ninm2   = request.security("ECONOMICS:INM2",   "D", close)\r\ninrusd = request.security("FX_IDC:INRUSD",    "D", close)\r\nrum2   = request.security("ECONOMICS:RUM2",   "D", close)\r\nrublusd= request.security("FX_IDC:RUBUSD",    "D", close)\r\nbrm2   = request.security("ECONOMICS:BRM2",   "D", close)\r\nbrlusd = request.security("FX_IDC:BRLUSD",    "D", close)\r\nkrm2   = request.security("ECONOMICS:KRM2",   "D", close)\r\nkrwusd = request.security("FX_IDC:KRWUSD",    "D", close)\r\nmxm2   = request.security("ECONOMICS:MXM2",   "D", close)\r\nmxnusd = request.security("FX_IDC:MXNUSD",    "D", close)\r\nsam2   = request.security("ECONOMICS:SAM2",   "D", close)\r\nzarusd = request.security("FX_IDC:ZARUSD",    "D", close)\r\n\r\n// 计算 M2 Total\r\nbasisTotal = cnm2 * cnyusd + usm2 + eum2 * eurusd + jpm2 * jpyusd + gbm2 * gbpusd\r\nerweitertTotal = basisTotal + chm2*chfusd + cam2*cadusd + inm2*inrusd + rum2*rublusd + \r\n                 brm2*brlusd + krm2*krwusd + mxm2*mxnusd + sam2*zarusd\r\n\r\ntotal = erweitert ? erweitertTotal : basisTotal\r\n\r\n// BTC\r\nbtc = request.security("BINANCE:BTCUSDT", timeframe.period, close)\r\n\r\n// ================== 归一化处理 ==================\r\nnormM2  = total / ta.sma(total, normLength)\r\nnormBTC = btc   / ta.sma(btc,   normLength)\r\ndeviation = normM2 - normBTC\r\n\r\n// 偏差颜色\r\ndevColor = deviation > 0 ? color.new(color.lime, 0) : color.new(color.red, 0)\r\n\r\n// ================== 绘图 ==================\r\n// 归一化曲线\r\nplot(showNormLines ? normM2  : na, "Normalized M2",  color=color.yellow, linewidth=3, offset=offsetValue)\r\nplot(showNormLines ? normBTC : na, "Normalized BTC", color=color.white,  linewidth=2, offset=offsetValue)\r\n\r\n// 偏差（全局绘制）\r\ndevPlotStyle = devStyle == "Columns" ? plot.style_columns :\r\n               devStyle == "Area"    ? plot.style_area    : plot.style_line\r\n\r\ndevLineWidth = devStyle == "Columns" ? 3 : 2\r\n\r\nplot(showDeviation ? deviation : na, \r\n     "M2 vs BTC deviation", \r\n     color=devColor, \r\n     style=devPlotStyle, \r\n     linewidth=devLineWidth)\r\n\r\n// 参考线\r\nhline(1.0, "归一化基准线", color=color.gray, linestyle=hline.style_dashed)\r\nhline(0.0, "偏差零轴",     color=color.gray, linestyle=hline.style_dotted)\r\n\r\n// 最后一个K线标签\r\nif barstate.islast\r\n    label.new(bar_index, normM2, \r\n         "Norm M2: " + str.format("{0,number,#.##}", normM2) + \r\n         "\\nNorm BTC: " + str.format("{0,number,#.##}", normBTC) +\r\n         "\\Deviation: " + str.format("{0,number,+0.##}", deviation),\r\n         style = label.style_label_left,\r\n         color = color.new(color.blue, 70),\r\n         textcolor = color.white,\r\n         size  = size.small)'
[CAPTURE 1] '//@version=6\r\nindicator(\'BTC M2 Global Deviation[MIT]\', \r\n     overlay=false, \r\n     scale=scale.left)   // ← 已修复：改成 scale.left\r\n\r\n// ================== 输入参数 ==================\r\noffsetOption = input.string("108 Days", options=["108 Days", "78 Days"], title="Offset:")\r\noffsetValue  = offsetOption == "108 Days" ? 108 : 78\r\n\r\nerweitert = input.bool(false, title="Include extended currencies?", \r\n     tooltip="Standard: USA, China, Eurozone, Japan, UK\\nExtended: + Switzerland, Canada, India, Russia, Brazil, Korea, Mexico, South Africa")\r\n\r\nnormLength = input.int(200, "归一化周期（天）", minval=50, maxval=500)\r\nshowNormLines = input.bool(true,  "显示归一化后的M2和BTC曲线")\r\nshowDeviation = input.bool(true,  "显示偏差 (M2 - BTC)")\r\ndevStyle      = input.string("Columns", "偏差显示样式", options=["Columns", "Area", "Line"])\r\n\r\n// ================== 数据获取 ==================\r\ncnm2   = request.security("ECONOMICS:CNM2",   "D", close)\r\ncnyusd = request.security("FX_IDC:CNYUSD",    "D", close)\r\nusm2   = request.security("ECONOMICS:USM2",   "D", close)\r\neum2   = request.security("ECONOMICS:EUM2",   "D", close)\r\neurusd = request.security("FX:EURUSD",        "D", close)\r\njpm2   = request.security("ECONOMICS:JPM2",   "D", close)\r\njpyusd = request.security("FX_IDC:JPYUSD",    "D", close)\r\ngbm2   = request.security("ECONOMICS:GBM2",   "D", close)\r\ngbpusd = request.security("FX:GBPUSD",        "D", close)\r\n\r\n// 扩展货币组\r\nchm2   = request.security("ECONOMICS:CHM2",   "D", close)\r\nchfusd = request.security("FX_IDC:CHFUSD",    "D", close)\r\ncam2   = request.security("ECONOMICS:CAM2",   "D", close)\r\ncadusd = request.security("FX_IDC:CADUSD",    "D", close)\r\ninm2   = request.security("ECONOMICS:INM2",   "D", close)\r\ninrusd = request.security("FX_IDC:INRUSD",    "D", close)\r\nrum2   = request.security("ECONOMICS:RUM2",   "D", close)\r\nrublusd= request.security("FX_IDC:RUBUSD",    "D", close)\r\nbrm2   = request.security("ECONOMICS:BRM2",   "D", close)\r\nbrlusd = request.security("FX_IDC:BRLUSD",    "D", close)\r\nkrm2   = request.security("ECONOMICS:KRM2",   "D", close)\r\nkrwusd = request.security("FX_IDC:KRWUSD",    "D", close)\r\nmxm2   = request.security("ECONOMICS:MXM2",   "D", close)\r\nmxnusd = request.security("FX_IDC:MXNUSD",    "D", close)\r\nsam2   = request.security("ECONOMICS:SAM2",   "D", close)\r\nzarusd = request.security("FX_IDC:ZARUSD",    "D", close)\r\n\r\n// 计算 M2 Total\r\nbasisTotal = cnm2 * cnyusd + usm2 + eum2 * eurusd + jpm2 * jpyusd + gbm2 * gbpusd\r\nerweitertTotal = basisTotal + chm2*chfusd + cam2*cadusd + inm2*inrusd + rum2*rublusd + \r\n                 brm2*brlusd + krm2*krwusd + mxm2*mxnusd + sam2*zarusd\r\n\r\ntotal = erweitert ? erweitertTotal : basisTotal\r\n\r\n// BTC\r\nbtc = request.security("BINANCE:BTCUSDT", timeframe.period, close)\r\n\r\n// ================== 归一化处理 ==================\r\nnormM2  = total / ta.sma(total, normLength)\r\nnormBTC = btc   / ta.sma(btc,   normLength)\r\ndeviation = normM2 - normBTC\r\n\r\n// 偏差颜色\r\ndevColor = deviation > 0 ? color.new(color.lime, 0) : color.new(color.red, 0)\r\n\r\n// ================== 绘图 ==================\r\n// 归一化曲线\r\nplot(showNormLines ? normM2  : na, "Normalized M2",  color=color.yellow, linewidth=3, offset=offsetValue)\r\nplot(showNormLines ? normBTC : na, "Normalized BTC", color=color.white,  linewidth=2, offset=offsetValue)\r\n\r\n// 偏差（全局绘制）\r\ndevPlotStyle = devStyle == "Columns" ? plot.style_columns :\r\n               devStyle == "Area"    ? plot.style_area    : plot.style_line\r\n\r\ndevLineWidth = devStyle == "Columns" ? 3 : 2\r\n\r\nplot(showDeviation ? deviation : na, \r\n     "M2 vs BTC deviation", \r\n     color=devColor, \r\n     style=devPlotStyle, \r\n     linewidth=devLineWidth)\r\n\r\n// 参考线\r\nhline(1.0, "归一化基准线", color=color.gray, linestyle=hline.style_dashed)\r\nhline(0.0, "偏差零轴",     color=color.gray, linestyle=hline.style_dotted)\r\n\r\n// 最后一个K线标签\r\nif barstate.islast\r\n    label.new(bar_index, normM2, \r\n         "Norm M2: " + str.format("{0,number,#.##}", normM2) + \r\n         "\\nNorm BTC: " + str.format("{0,number,#.##}", normBTC) +\r\n         "\\Deviation: " + str.format("{0,number,+0.##}", deviation),\r\n         style = label.style_label_left,\r\n         color = color.new(color.blue, 70),\r\n         textcolor = color.white,\r\n         size  = size.small)'
[CAPTURE 2] '//@version=6\r\nindicator(\'BTC M2 Global Deviation[MIT]\', \r\n     overlay=false, \r\n     scale=scale.left)   // ← 已修复：改成 scale.left\r\n\r\n// ================== 输入参数 ==================\r\noffsetOption = input.string("108 Days", options=["108 Days", "78 Days"], title="Offset:")\r\noffsetValue  = offsetOption == "108 Days" ? 108 : 78\r\n\r\nerweitert = input.bool(false, title="Include extended currencies?", \r\n     tooltip="Standard: USA, China, Eurozone, Japan, UK\\nExtended: + Switzerland, Canada, India, Russia, Brazil, Korea, Mexico, South Africa")\r\n\r\nnormLength = input.int(200, "归一化周期（天）", minval=50, maxval=500)\r\nshowNormLines = input.bool(true,  "显示归一化后的M2和BTC曲线")\r\nshowDeviation = input.bool(true,  "显示偏差 (M2 - BTC)")\r\ndevStyle      = input.string("Columns", "偏差显示样式", options=["Columns", "Area", "Line"])\r\n\r\n// ================== 数据获取 ==================\r\ncnm2   = request.security("ECONOMICS:CNM2",   "D", close)\r\ncnyusd = request.security("FX_IDC:CNYUSD",    "D", close)\r\nusm2   = request.security("ECONOMICS:USM2",   "D", close)\r\neum2   = request.security("ECONOMICS:EUM2",   "D", close)\r\neurusd = request.security("FX:EURUSD",        "D", close)\r\njpm2   = request.security("ECONOMICS:JPM2",   "D", close)\r\njpyusd = request.security("FX_IDC:JPYUSD",    "D", close)\r\ngbm2   = request.security("ECONOMICS:GBM2",   "D", close)\r\ngbpusd = request.security("FX:GBPUSD",        "D", close)\r\n\r\n// 扩展货币组\r\nchm2   = request.security("ECONOMICS:CHM2",   "D", close)\r\nchfusd = request.security("FX_IDC:CHFUSD",    "D", close)\r\ncam2   = request.security("ECONOMICS:CAM2",   "D", close)\r\ncadusd = request.security("FX_IDC:CADUSD",    "D", close)\r\ninm2   = request.security("ECONOMICS:INM2",   "D", close)\r\ninrusd = request.security("FX_IDC:INRUSD",    "D", close)\r\nrum2   = request.security("ECONOMICS:RUM2",   "D", close)\r\nrublusd= request.security("FX_IDC:RUBUSD",    "D", close)\r\nbrm2   = request.security("ECONOMICS:BRM2",   "D", close)\r\nbrlusd = request.security("FX_IDC:BRLUSD",    "D", close)\r\nkrm2   = request.security("ECONOMICS:KRM2",   "D", close)\r\nkrwusd = request.security("FX_IDC:KRWUSD",    "D", close)\r\nmxm2   = request.security("ECONOMICS:MXM2",   "D", close)\r\nmxnusd = request.security("FX_IDC:MXNUSD",    "D", close)\r\nsam2   = request.security("ECONOMICS:SAM2",   "D", close)\r\nzarusd = request.security("FX_IDC:ZARUSD",    "D", close)\r\n\r\n// 计算 M2 Total\r\nbasisTotal = cnm2 * cnyusd + usm2 + eum2 * eurusd + jpm2 * jpyusd + gbm2 * gbpusd\r\nerweitertTotal = basisTotal + chm2*chfusd + cam2*cadusd + inm2*inrusd + rum2*rublusd + \r\n                 brm2*brlusd + krm2*krwusd + mxm2*mxnusd + sam2*zarusd\r\n\r\ntotal = erweitert ? erweitertTotal : basisTotal\r\n\r\n// BTC\r\nbtc = request.security("BINANCE:BTCUSDT", timeframe.period, close)\r\n\r\n// ================== 归一化处理 ==================\r\nnormM2  = total / ta.sma(total, normLength)\r\nnormBTC = btc   / ta.sma(btc,   normLength)\r\ndeviation = normM2 - normBTC\r\n\r\n// 偏差颜色\r\ndevColor = deviation > 0 ? color.new(color.lime, 0) : color.new(color.red, 0)\r\n\r\n// ================== 绘图 ==================\r\n// 归一化曲线\r\nplot(showNormLines ? normM2  : na, "Normalized M2",  color=color.yellow, linewidth=3, offset=offsetValue)\r\nplot(showNormLines ? normBTC : na, "Normalized BTC", color=color.white,  linewidth=2, offset=offsetValue)\r\n\r\n// 偏差（全局绘制）\r\ndevPlotStyle = devStyle == "Columns" ? plot.style_columns :\r\n               devStyle == "Area"    ? plot.style_area    : plot.style_line\r\n\r\ndevLineWidth = devStyle == "Columns" ? 3 : 2\r\n\r\nplot(showDeviation ? deviation : na, \r\n     "M2 vs BTC deviation", \r\n     color=devColor, \r\n     style=devPlotStyle, \r\n     linewidth=devLineWidth)\r\n\r\n// 参考线\r\nhline(1.0, "归一化基准线", color=color.gray, linestyle=hline.style_dashed)\r\nhline(0.0, "偏差零轴",     color=color.gray, linestyle=hline.style_dotted)\r\n\r\n// 最后一个K线标签\r\nif barstate.islast\r\n    label.new(bar_index, normM2, \r\n         "Norm M2: " + str.format("{0,number,#.##}", normM2) + \r\n         "\\nNorm BTC: " + str.format("{0,number,#.##}", normBTC) +\r\n         "\\Deviation: " + str.format("{0,number,+0.##}", deviation),\r\n         style = label.style_label_left,\r\n         color = color.new(color.blue, 70),\r\n         textcolor = color.white,\r\n         size  = size.small)'
[DEBUG] save_script called: script_id=i3PggCBW title=BTC vs M2 Global Index[MIT] category=i3PggCBW force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\i3PggCBW_BTC_vs_M2_Global_IndexMIT.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\i3PggCBW_BTC_vs_M2_Global_IndexMIT.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 01:20:05 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 01:20:05 GMT' as: 2026-02-09T01:20:05+00:00
[DEBUG] Exact published date for header: 2026-02-09T01:20:05+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/izjSolIv-Stabilized-EFI-HMA-alejandromasari/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
//@version=6indicator("Stabilized EFI-HMA [Custom]", overlay=true)// --- Inputs ---src = input(close, title="Source")hm
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator("Stabilized EFI-HMA [Custom]", overlay=true)\n\n// --- Inputs ---\nsrc = input(close, title="Source")\nhma_len = input.int(9, title="HMA Length", minval=1)\nefi_len = input.int(13, title="EFI Length", minval=1)\n\n// --- Calculations ---\n// Hull Moving Average Calculation: \n// HMA = WMA(2 * WMA(n/2) - WMA(n), sqrt(n))\nhma_val = ta.hma(src, hma_len)\n\n// Elder Force Index (13) Calculation:\n// EFI = (Close - Close[1]) * Volume\nefi_val = ta.ema(ta.change(src) * volume, efi_len)\n\n// --- Logic ---\n// 1. Accumulation: HMA sloping up AND EFI is positive\nis_accum = (hma_val > hma_val[1]) and (efi_val > 0)\n// 2. Distribution: HMA sloping down AND EFI is negative\nis_dist  = (hma_val < hma_val[1]) and (efi_val < 0)\n\n// --- Visuals ---\n// Green = Accumulation | Red = Distribution | Gray = Neutral/Noise\nline_color = is_accum ? color.lime : is_dist ? color.red : color.gray\nplot(hma_val, color=line_color, linewidth=3, title="Stabilized HMA")\n\n// Barcolor option for visual clarity\nbarcolor(line_color)'
[CAPTURE 1] '//@version=6\nindicator("Stabilized EFI-HMA [Custom]", overlay=true)\n\n// --- Inputs ---\nsrc = input(close, title="Source")\nhma_len = input.int(9, title="HMA Length", minval=1)\nefi_len = input.int(13, title="EFI Length", minval=1)\n\n// --- Calculations ---\n// Hull Moving Average Calculation: \n// HMA = WMA(2 * WMA(n/2) - WMA(n), sqrt(n))\nhma_val = ta.hma(src, hma_len)\n\n// Elder Force Index (13) Calculation:\n// EFI = (Close - Close[1]) * Volume\nefi_val = ta.ema(ta.change(src) * volume, efi_len)\n\n// --- Logic ---\n// 1. Accumulation: HMA sloping up AND EFI is positive\nis_accum = (hma_val > hma_val[1]) and (efi_val > 0)\n// 2. Distribution: HMA sloping down AND EFI is negative\nis_dist  = (hma_val < hma_val[1]) and (efi_val < 0)\n\n// --- Visuals ---\n// Green = Accumulation | Red = Distribution | Gray = Neutral/Noise\nline_color = is_accum ? color.lime : is_dist ? color.red : color.gray\nplot(hma_val, color=line_color, linewidth=3, title="Stabilized HMA")\n\n// Barcolor option for visual clarity\nbarcolor(line_color)'
[CAPTURE 2] '//@version=6\nindicator("Stabilized EFI-HMA [Custom]", overlay=true)\n\n// --- Inputs ---\nsrc = input(close, title="Source")\nhma_len = input.int(9, title="HMA Length", minval=1)\nefi_len = input.int(13, title="EFI Length", minval=1)\n\n// --- Calculations ---\n// Hull Moving Average Calculation: \n// HMA = WMA(2 * WMA(n/2) - WMA(n), sqrt(n))\nhma_val = ta.hma(src, hma_len)\n\n// Elder Force Index (13) Calculation:\n// EFI = (Close - Close[1]) * Volume\nefi_val = ta.ema(ta.change(src) * volume, efi_len)\n\n// --- Logic ---\n// 1. Accumulation: HMA sloping up AND EFI is positive\nis_accum = (hma_val > hma_val[1]) and (efi_val > 0)\n// 2. Distribution: HMA sloping down AND EFI is negative\nis_dist  = (hma_val < hma_val[1]) and (efi_val < 0)\n\n// --- Visuals ---\n// Green = Accumulation | Red = Distribution | Gray = Neutral/Noise\nline_color = is_accum ? color.lime : is_dist ? color.red : color.gray\nplot(hma_val, color=line_color, linewidth=3, title="Stabilized HMA")\n\n// Barcolor option for visual clarity\nbarcolor(line_color)'
[DEBUG] save_script called: script_id=izjSolIv title=Stabilized EFI-HMA [alejandromasari] category=izjSolIv force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\izjSolIv_Stabilized_EFI-HMA_alejandromasari.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\izjSolIv_Stabilized_EFI-HMA_alejandromasari.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 01:17:50 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 01:17:50 GMT' as: 2026-02-09T01:17:50+00:00
[DEBUG] Exact published date for header: 2026-02-09T01:17:50+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/IwMWEik2-ahDirtCuhzzz-15m-NY-ORB/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\r\nindicator("[ahDirtCuhzzz] 15m NY ORB", overlay=true, max_lines_count=500, max_labels_count=500)\r\n\r\n// -------- INPUTS --------\r\norbSession    = input.session("0930-0945", "NY ORB Session")\r\ncutoffSession = input.session("0930-1600", "ORB Cutoff")\r\nlookbackDays  = input.int(1, "ORB Lookback Days", minval=1, maxval=20)\r\n\r\nshowMid = input.bool(true, "Show 50% Mid")\r\n\r\ncolHigh = input.color(color.lime, "ORB High")\r\ncolLow  = input.color(color.red,  "ORB Low")\r\ncolMid  = input.color(color.gray, "ORB Mid")\r\n\r\ngrp_lbl = "Labels"\r\nlabel_size_in  = input.string(defval=\'Small\', title=\'Label Size\', options=[\'Tiny\', \'Small\', \'Normal\', \'Large\'], group=grp_lbl)\r\n\r\n// -------- HELPERS --------\r\nget_label_size(s) =>\r\n    switch s\r\n        \'Tiny\'   => size.tiny\r\n        \'Small\'  => size.small\r\n        \'Normal\' => size.normal\r\n        \'Large\'  => size.large\r\n        => size.small\r\n\r\n// -------- TIME --------\r\ninORB  = not na(time(timeframe.period, orbSession, "America/New_York"))\r\ninCut  = not na(time(timeframe.period, cutoffSession, "America/New_York"))\r\nnewDay = ta.change(time("D", "America/New_York")) != 0\r\n\r\n// -------- STORAGE --------\r\nvar float orbH = na\r\nvar float orbL = na\r\nvar float finalOrbH = na\r\nvar float finalOrbL = na\r\nvar bool orbLocked = false\r\n\r\nvar line[] hiLines  = array.new_line()\r\nvar line[] loLines  = array.new_line()\r\nvar line[] midLines = array.new_line()\r\n\r\nvar label[] hiLabs  = array.new_label()\r\nvar label[] loLabs  = array.new_label()\r\nvar label[] midLabs = array.new_label()\r\n\r\n// -------- RESET --------\r\nif newDay\r\n    orbH := na\r\n    orbL := na\r\n    finalOrbH := na\r\n    finalOrbL := na\r\n    orbLocked := false\r\n\r\n// -------- BUILD ORB (during ORB session) --------\r\nif inORB\r\n    orbH := na(orbH) ? high : math.max(orbH, high)\r\n    orbL := na(orbL) ? low  : math.min(orbL, low)\r\n    \r\n    if not inORB[1] or inORB\r\n        finalOrbH := orbH\r\n        finalOrbL := orbL\r\n\r\n// -------- LOCK VALUES when ORB session ends --------\r\norbSessionEnd = inORB[1] and not inORB\r\n\r\nif orbSessionEnd\r\n    orbLocked := true\r\n\r\n// Use final values if locked, otherwise use current\r\ndisplayH = orbLocked ? finalOrbH : orbH\r\ndisplayL = orbLocked ? finalOrbL : orbL\r\ndisplayMid = not na(displayH) and not na(displayL) ? (displayH + displayL) / 2 : na\r\n\r\norbStart = inORB and not inORB[1]\r\nstring lbl_sz = get_label_size(label_size_in)\r\n\r\n// -------- DRAW --------\r\nif orbStart and not na(orbH)\r\n    hLine = line.new(bar_index, orbH, bar_index, orbH, width=2, color=colHigh)\r\n    lLine = line.new(bar_index, orbL, bar_index, orbL, width=2, color=colLow)\r\n    array.push(hiLines, hLine)\r\n    array.push(loLines, lLine)\r\n\r\n    if showMid\r\n        mLine = line.new(bar_index, displayMid, bar_index, displayMid, style=line.style_dotted, color=colMid)\r\n        array.push(midLines, mLine)\r\n\r\n    hLab = label.new(bar_index, orbH, "15m ORB High " + str.tostring(orbH, format.mintick),\r\n         xloc=xloc.bar_index, style=label.style_label_left,\r\n         color=color.new(color.black, 100), textcolor=colHigh, size=lbl_sz)\r\n    lLab = label.new(bar_index, orbL, "15m ORB Low " + str.tostring(orbL, format.mintick),\r\n         xloc=xloc.bar_index, style=label.style_label_left,\r\n         color=color.new(color.black, 100), textcolor=colLow, size=lbl_sz)\r\n    array.push(hiLabs, hLab)\r\n    array.push(loLabs, lLab)\r\n\r\n    if showMid\r\n        mLab = label.new(bar_index, displayMid, "15m ORB 50% " + str.tostring(displayMid, format.mintick),\r\n             xloc=xloc.bar_index, style=label.style_label_left,\r\n             color=color.new(color.black, 100), textcolor=colMid, size=lbl_sz)\r\n        array.push(midLabs, mLab)\r\n\r\n// -------- UPDATE DURING ORB SESSION --------\r\nif inORB and array.size(hiLines) > 0\r\n    lastH = array.get(hiLines, array.size(hiLines)-1)\r\n    lastL = array.get(loLines, array.size(loLines)-1)\r\n    \r\n    line.set_x2(lastH, bar_index)\r\n    line.set_y1(lastH, orbH)\r\n    line.set_y2(lastH, orbH)\r\n    \r\n    line.set_x2(lastL, bar_index)\r\n    line.set_y1(lastL, orbL)\r\n    line.set_y2(lastL, orbL)\r\n    \r\n    lastHL = array.get(hiLabs, array.size(hiLabs)-1)\r\n    lastLL = array.get(loLabs, array.size(loLabs)-1)\r\n    label.set_x(lastHL, bar_index)\r\n    label.set_y(lastHL, orbH)\r\n    label.set_text(lastHL, "15m ORB High " + str.tostring(orbH, format.mintick))\r\n    label.set_x(lastLL, bar_index)\r\n    label.set_y(lastLL, orbL)\r\n    label.set_text(lastLL, "15m ORB Low " + str.tostring(orbL, format.mintick))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        lastM = array.get(midLines, array.size(midLines)-1)\r\n        line.set_x2(lastM, bar_index)\r\n        line.set_y1(lastM, displayMid)\r\n        line.set_y2(lastM, displayMid)\r\n        \r\n        lastML = array.get(midLabs, array.size(midLabs)-1)\r\n        label.set_x(lastML, bar_index)\r\n        label.set_y(lastML, displayMid)\r\n        label.set_text(lastML, "15m ORB 50% " + str.tostring(displayMid, format.mintick))\r\n\r\n// -------- EXTEND AFTER ORB SESSION --------\r\nif orbLocked and inCut and array.size(hiLines) > 0\r\n    lastH = array.get(hiLines, array.size(hiLines)-1)\r\n    lastL = array.get(loLines, array.size(loLines)-1)\r\n    \r\n    line.set_x2(lastH, bar_index)\r\n    line.set_x2(lastL, bar_index)\r\n\r\n    lastHL = array.get(hiLabs, array.size(hiLabs)-1)\r\n    lastLL = array.get(loLabs, array.size(loLabs)-1)\r\n    \r\n    label.set_x(lastHL, bar_index)\r\n    label.set_x(lastLL, bar_index)\r\n    label.set_y(lastHL, displayH)\r\n    label.set_y(lastLL, displayL)\r\n    label.set_text(lastHL, "15m ORB High " + str.tostring(displayH, format.mintick))\r\n    label.set_text(lastLL, "15m ORB Low " + str.tostring(displayL, format.mintick))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        lastM = array.get(midLines, array.size(midLines)-1)\r\n        line.set_x2(lastM, bar_index)\r\n\r\n        lastML = array.get(midLabs, array.size(midLabs)-1)\r\n        label.set_x(lastML, bar_index)\r\n        label.set_y(lastML, displayMid)\r\n        label.set_text(lastML, "15m ORB 50% " + str.tostring(displayMid, format.mintick))\r\n\r\n// -------- CLEANUP --------\r\nwhile array.size(hiLines) > lookbackDays\r\n    line.delete(array.shift(hiLines))\r\n    line.delete(array.shift(loLines))\r\n    label.delete(array.shift(hiLabs))\r\n    label.delete(array.shift(loLabs))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        line.delete(array.shift(midLines))\r\n        label.delete(array.shift(midLabs))\r\n'
[CAPTURE 1] '//@version=6\r\nindicator("[ahDirtCuhzzz] 15m NY ORB", overlay=true, max_lines_count=500, max_labels_count=500)\r\n\r\n// -------- INPUTS --------\r\norbSession    = input.session("0930-0945", "NY ORB Session")\r\ncutoffSession = input.session("0930-1600", "ORB Cutoff")\r\nlookbackDays  = input.int(1, "ORB Lookback Days", minval=1, maxval=20)\r\n\r\nshowMid = input.bool(true, "Show 50% Mid")\r\n\r\ncolHigh = input.color(color.lime, "ORB High")\r\ncolLow  = input.color(color.red,  "ORB Low")\r\ncolMid  = input.color(color.gray, "ORB Mid")\r\n\r\ngrp_lbl = "Labels"\r\nlabel_size_in  = input.string(defval=\'Small\', title=\'Label Size\', options=[\'Tiny\', \'Small\', \'Normal\', \'Large\'], group=grp_lbl)\r\n\r\n// -------- HELPERS --------\r\nget_label_size(s) =>\r\n    switch s\r\n        \'Tiny\'   => size.tiny\r\n        \'Small\'  => size.small\r\n        \'Normal\' => size.normal\r\n        \'Large\'  => size.large\r\n        => size.small\r\n\r\n// -------- TIME --------\r\ninORB  = not na(time(timeframe.period, orbSession, "America/New_York"))\r\ninCut  = not na(time(timeframe.period, cutoffSession, "America/New_York"))\r\nnewDay = ta.change(time("D", "America/New_York")) != 0\r\n\r\n// -------- STORAGE --------\r\nvar float orbH = na\r\nvar float orbL = na\r\nvar float finalOrbH = na\r\nvar float finalOrbL = na\r\nvar bool orbLocked = false\r\n\r\nvar line[] hiLines  = array.new_line()\r\nvar line[] loLines  = array.new_line()\r\nvar line[] midLines = array.new_line()\r\n\r\nvar label[] hiLabs  = array.new_label()\r\nvar label[] loLabs  = array.new_label()\r\nvar label[] midLabs = array.new_label()\r\n\r\n// -------- RESET --------\r\nif newDay\r\n    orbH := na\r\n    orbL := na\r\n    finalOrbH := na\r\n    finalOrbL := na\r\n    orbLocked := false\r\n\r\n// -------- BUILD ORB (during ORB session) --------\r\nif inORB\r\n    orbH := na(orbH) ? high : math.max(orbH, high)\r\n    orbL := na(orbL) ? low  : math.min(orbL, low)\r\n    \r\n    if not inORB[1] or inORB\r\n        finalOrbH := orbH\r\n        finalOrbL := orbL\r\n\r\n// -------- LOCK VALUES when ORB session ends --------\r\norbSessionEnd = inORB[1] and not inORB\r\n\r\nif orbSessionEnd\r\n    orbLocked := true\r\n\r\n// Use final values if locked, otherwise use current\r\ndisplayH = orbLocked ? finalOrbH : orbH\r\ndisplayL = orbLocked ? finalOrbL : orbL\r\ndisplayMid = not na(displayH) and not na(displayL) ? (displayH + displayL) / 2 : na\r\n\r\norbStart = inORB and not inORB[1]\r\nstring lbl_sz = get_label_size(label_size_in)\r\n\r\n// -------- DRAW --------\r\nif orbStart and not na(orbH)\r\n    hLine = line.new(bar_index, orbH, bar_index, orbH, width=2, color=colHigh)\r\n    lLine = line.new(bar_index, orbL, bar_index, orbL, width=2, color=colLow)\r\n    array.push(hiLines, hLine)\r\n    array.push(loLines, lLine)\r\n\r\n    if showMid\r\n        mLine = line.new(bar_index, displayMid, bar_index, displayMid, style=line.style_dotted, color=colMid)\r\n        array.push(midLines, mLine)\r\n\r\n    hLab = label.new(bar_index, orbH, "15m ORB High " + str.tostring(orbH, format.mintick),\r\n         xloc=xloc.bar_index, style=label.style_label_left,\r\n         color=color.new(color.black, 100), textcolor=colHigh, size=lbl_sz)\r\n    lLab = label.new(bar_index, orbL, "15m ORB Low " + str.tostring(orbL, format.mintick),\r\n         xloc=xloc.bar_index, style=label.style_label_left,\r\n         color=color.new(color.black, 100), textcolor=colLow, size=lbl_sz)\r\n    array.push(hiLabs, hLab)\r\n    array.push(loLabs, lLab)\r\n\r\n    if showMid\r\n        mLab = label.new(bar_index, displayMid, "15m ORB 50% " + str.tostring(displayMid, format.mintick),\r\n             xloc=xloc.bar_index, style=label.style_label_left,\r\n             color=color.new(color.black, 100), textcolor=colMid, size=lbl_sz)\r\n        array.push(midLabs, mLab)\r\n\r\n// -------- UPDATE DURING ORB SESSION --------\r\nif inORB and array.size(hiLines) > 0\r\n    lastH = array.get(hiLines, array.size(hiLines)-1)\r\n    lastL = array.get(loLines, array.size(loLines)-1)\r\n    \r\n    line.set_x2(lastH, bar_index)\r\n    line.set_y1(lastH, orbH)\r\n    line.set_y2(lastH, orbH)\r\n    \r\n    line.set_x2(lastL, bar_index)\r\n    line.set_y1(lastL, orbL)\r\n    line.set_y2(lastL, orbL)\r\n    \r\n    lastHL = array.get(hiLabs, array.size(hiLabs)-1)\r\n    lastLL = array.get(loLabs, array.size(loLabs)-1)\r\n    label.set_x(lastHL, bar_index)\r\n    label.set_y(lastHL, orbH)\r\n    label.set_text(lastHL, "15m ORB High " + str.tostring(orbH, format.mintick))\r\n    label.set_x(lastLL, bar_index)\r\n    label.set_y(lastLL, orbL)\r\n    label.set_text(lastLL, "15m ORB Low " + str.tostring(orbL, format.mintick))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        lastM = array.get(midLines, array.size(midLines)-1)\r\n        line.set_x2(lastM, bar_index)\r\n        line.set_y1(lastM, displayMid)\r\n        line.set_y2(lastM, displayMid)\r\n        \r\n        lastML = array.get(midLabs, array.size(midLabs)-1)\r\n        label.set_x(lastML, bar_index)\r\n        label.set_y(lastML, displayMid)\r\n        label.set_text(lastML, "15m ORB 50% " + str.tostring(displayMid, format.mintick))\r\n\r\n// -------- EXTEND AFTER ORB SESSION --------\r\nif orbLocked and inCut and array.size(hiLines) > 0\r\n    lastH = array.get(hiLines, array.size(hiLines)-1)\r\n    lastL = array.get(loLines, array.size(loLines)-1)\r\n    \r\n    line.set_x2(lastH, bar_index)\r\n    line.set_x2(lastL, bar_index)\r\n\r\n    lastHL = array.get(hiLabs, array.size(hiLabs)-1)\r\n    lastLL = array.get(loLabs, array.size(loLabs)-1)\r\n    \r\n    label.set_x(lastHL, bar_index)\r\n    label.set_x(lastLL, bar_index)\r\n    label.set_y(lastHL, displayH)\r\n    label.set_y(lastLL, displayL)\r\n    label.set_text(lastHL, "15m ORB High " + str.tostring(displayH, format.mintick))\r\n    label.set_text(lastLL, "15m ORB Low " + str.tostring(displayL, format.mintick))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        lastM = array.get(midLines, array.size(midLines)-1)\r\n        line.set_x2(lastM, bar_index)\r\n\r\n        lastML = array.get(midLabs, array.size(midLabs)-1)\r\n        label.set_x(lastML, bar_index)\r\n        label.set_y(lastML, displayMid)\r\n        label.set_text(lastML, "15m ORB 50% " + str.tostring(displayMid, format.mintick))\r\n\r\n// -------- CLEANUP --------\r\nwhile array.size(hiLines) > lookbackDays\r\n    line.delete(array.shift(hiLines))\r\n    line.delete(array.shift(loLines))\r\n    label.delete(array.shift(hiLabs))\r\n    label.delete(array.shift(loLabs))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        line.delete(array.shift(midLines))\r\n        label.delete(array.shift(midLabs))\r\n'
[CAPTURE 2] '//@version=6\r\nindicator("[ahDirtCuhzzz] 15m NY ORB", overlay=true, max_lines_count=500, max_labels_count=500)\r\n\r\n// -------- INPUTS --------\r\norbSession    = input.session("0930-0945", "NY ORB Session")\r\ncutoffSession = input.session("0930-1600", "ORB Cutoff")\r\nlookbackDays  = input.int(1, "ORB Lookback Days", minval=1, maxval=20)\r\n\r\nshowMid = input.bool(true, "Show 50% Mid")\r\n\r\ncolHigh = input.color(color.lime, "ORB High")\r\ncolLow  = input.color(color.red,  "ORB Low")\r\ncolMid  = input.color(color.gray, "ORB Mid")\r\n\r\ngrp_lbl = "Labels"\r\nlabel_size_in  = input.string(defval=\'Small\', title=\'Label Size\', options=[\'Tiny\', \'Small\', \'Normal\', \'Large\'], group=grp_lbl)\r\n\r\n// -------- HELPERS --------\r\nget_label_size(s) =>\r\n    switch s\r\n        \'Tiny\'   => size.tiny\r\n        \'Small\'  => size.small\r\n        \'Normal\' => size.normal\r\n        \'Large\'  => size.large\r\n        => size.small\r\n\r\n// -------- TIME --------\r\ninORB  = not na(time(timeframe.period, orbSession, "America/New_York"))\r\ninCut  = not na(time(timeframe.period, cutoffSession, "America/New_York"))\r\nnewDay = ta.change(time("D", "America/New_York")) != 0\r\n\r\n// -------- STORAGE --------\r\nvar float orbH = na\r\nvar float orbL = na\r\nvar float finalOrbH = na\r\nvar float finalOrbL = na\r\nvar bool orbLocked = false\r\n\r\nvar line[] hiLines  = array.new_line()\r\nvar line[] loLines  = array.new_line()\r\nvar line[] midLines = array.new_line()\r\n\r\nvar label[] hiLabs  = array.new_label()\r\nvar label[] loLabs  = array.new_label()\r\nvar label[] midLabs = array.new_label()\r\n\r\n// -------- RESET --------\r\nif newDay\r\n    orbH := na\r\n    orbL := na\r\n    finalOrbH := na\r\n    finalOrbL := na\r\n    orbLocked := false\r\n\r\n// -------- BUILD ORB (during ORB session) --------\r\nif inORB\r\n    orbH := na(orbH) ? high : math.max(orbH, high)\r\n    orbL := na(orbL) ? low  : math.min(orbL, low)\r\n    \r\n    if not inORB[1] or inORB\r\n        finalOrbH := orbH\r\n        finalOrbL := orbL\r\n\r\n// -------- LOCK VALUES when ORB session ends --------\r\norbSessionEnd = inORB[1] and not inORB\r\n\r\nif orbSessionEnd\r\n    orbLocked := true\r\n\r\n// Use final values if locked, otherwise use current\r\ndisplayH = orbLocked ? finalOrbH : orbH\r\ndisplayL = orbLocked ? finalOrbL : orbL\r\ndisplayMid = not na(displayH) and not na(displayL) ? (displayH + displayL) / 2 : na\r\n\r\norbStart = inORB and not inORB[1]\r\nstring lbl_sz = get_label_size(label_size_in)\r\n\r\n// -------- DRAW --------\r\nif orbStart and not na(orbH)\r\n    hLine = line.new(bar_index, orbH, bar_index, orbH, width=2, color=colHigh)\r\n    lLine = line.new(bar_index, orbL, bar_index, orbL, width=2, color=colLow)\r\n    array.push(hiLines, hLine)\r\n    array.push(loLines, lLine)\r\n\r\n    if showMid\r\n        mLine = line.new(bar_index, displayMid, bar_index, displayMid, style=line.style_dotted, color=colMid)\r\n        array.push(midLines, mLine)\r\n\r\n    hLab = label.new(bar_index, orbH, "15m ORB High " + str.tostring(orbH, format.mintick),\r\n         xloc=xloc.bar_index, style=label.style_label_left,\r\n         color=color.new(color.black, 100), textcolor=colHigh, size=lbl_sz)\r\n    lLab = label.new(bar_index, orbL, "15m ORB Low " + str.tostring(orbL, format.mintick),\r\n         xloc=xloc.bar_index, style=label.style_label_left,\r\n         color=color.new(color.black, 100), textcolor=colLow, size=lbl_sz)\r\n    array.push(hiLabs, hLab)\r\n    array.push(loLabs, lLab)\r\n\r\n    if showMid\r\n        mLab = label.new(bar_index, displayMid, "15m ORB 50% " + str.tostring(displayMid, format.mintick),\r\n             xloc=xloc.bar_index, style=label.style_label_left,\r\n             color=color.new(color.black, 100), textcolor=colMid, size=lbl_sz)\r\n        array.push(midLabs, mLab)\r\n\r\n// -------- UPDATE DURING ORB SESSION --------\r\nif inORB and array.size(hiLines) > 0\r\n    lastH = array.get(hiLines, array.size(hiLines)-1)\r\n    lastL = array.get(loLines, array.size(loLines)-1)\r\n    \r\n    line.set_x2(lastH, bar_index)\r\n    line.set_y1(lastH, orbH)\r\n    line.set_y2(lastH, orbH)\r\n    \r\n    line.set_x2(lastL, bar_index)\r\n    line.set_y1(lastL, orbL)\r\n    line.set_y2(lastL, orbL)\r\n    \r\n    lastHL = array.get(hiLabs, array.size(hiLabs)-1)\r\n    lastLL = array.get(loLabs, array.size(loLabs)-1)\r\n    label.set_x(lastHL, bar_index)\r\n    label.set_y(lastHL, orbH)\r\n    label.set_text(lastHL, "15m ORB High " + str.tostring(orbH, format.mintick))\r\n    label.set_x(lastLL, bar_index)\r\n    label.set_y(lastLL, orbL)\r\n    label.set_text(lastLL, "15m ORB Low " + str.tostring(orbL, format.mintick))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        lastM = array.get(midLines, array.size(midLines)-1)\r\n        line.set_x2(lastM, bar_index)\r\n        line.set_y1(lastM, displayMid)\r\n        line.set_y2(lastM, displayMid)\r\n        \r\n        lastML = array.get(midLabs, array.size(midLabs)-1)\r\n        label.set_x(lastML, bar_index)\r\n        label.set_y(lastML, displayMid)\r\n        label.set_text(lastML, "15m ORB 50% " + str.tostring(displayMid, format.mintick))\r\n\r\n// -------- EXTEND AFTER ORB SESSION --------\r\nif orbLocked and inCut and array.size(hiLines) > 0\r\n    lastH = array.get(hiLines, array.size(hiLines)-1)\r\n    lastL = array.get(loLines, array.size(loLines)-1)\r\n    \r\n    line.set_x2(lastH, bar_index)\r\n    line.set_x2(lastL, bar_index)\r\n\r\n    lastHL = array.get(hiLabs, array.size(hiLabs)-1)\r\n    lastLL = array.get(loLabs, array.size(loLabs)-1)\r\n    \r\n    label.set_x(lastHL, bar_index)\r\n    label.set_x(lastLL, bar_index)\r\n    label.set_y(lastHL, displayH)\r\n    label.set_y(lastLL, displayL)\r\n    label.set_text(lastHL, "15m ORB High " + str.tostring(displayH, format.mintick))\r\n    label.set_text(lastLL, "15m ORB Low " + str.tostring(displayL, format.mintick))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        lastM = array.get(midLines, array.size(midLines)-1)\r\n        line.set_x2(lastM, bar_index)\r\n\r\n        lastML = array.get(midLabs, array.size(midLabs)-1)\r\n        label.set_x(lastML, bar_index)\r\n        label.set_y(lastML, displayMid)\r\n        label.set_text(lastML, "15m ORB 50% " + str.tostring(displayMid, format.mintick))\r\n\r\n// -------- CLEANUP --------\r\nwhile array.size(hiLines) > lookbackDays\r\n    line.delete(array.shift(hiLines))\r\n    line.delete(array.shift(loLines))\r\n    label.delete(array.shift(hiLabs))\r\n    label.delete(array.shift(loLabs))\r\n\r\n    if showMid and array.size(midLines) > 0\r\n        line.delete(array.shift(midLines))\r\n        label.delete(array.shift(midLabs))\r\n'
[DEBUG] save_script called: script_id=IwMWEik2 title=[ahDirtCuhzzz] 15m NY ORB category=IwMWEik2 force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\IwMWEik2_ahDirtCuhzzz_15m_NY_ORB.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\IwMWEik2_ahDirtCuhzzz_15m_NY_ORB.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 00:24:53 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 00:24:53 GMT' as: 2026-02-09T00:24:53+00:00
[DEBUG] Exact published date for header: 2026-02-09T00:24:53+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/66mGO32j-Expectancy-Reality-Check/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\n// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\n// @SystemsOverFeelings\nindicator("Expectancy Reality Check — SystemsOverFeelings", overlay=false, max_labels_count=50)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Concept (R-units)\n// EV (R/trade) = p*RRR - (1-p)*1 - costsR\n// Break-even p = (1 + costsR) / (1 + RRR)\n//\n// Risk-of-ruin proxy (fixed fractional):\n// Approximate via Lundberg root r in (0,1):\n// Solve: p*r^RRR + (1-p)*r^-1 = 1, then RoR ≈ r^(1/riskFrac)\n// (Only shown when EV > 0)\n//──────────────────────────────────────────────────────────────────────────────\n\n//──────────────────────────────────────────────────────────────────────────────\n// Inputs\n//──────────────────────────────────────────────────────────────────────────────\nvar string gMain = "Assumptions"\nwinRatePct  = input.float(40.0, "Win rate (%)", minval=0.0, maxval=100.0, step=0.5, group=gMain)\nrrr         = input.float(2.0,  "Reward-to-Risk (RRR)", minval=0.05, step=0.05, group=gMain)\ncostsR      = input.float(0.05, "Costs per trade (in R)", minval=0.0, step=0.01, tooltip="Commission+slippage expressed in R. Example: 0.05 means -0.05R per trade.", group=gMain)\nriskPct     = input.float(1.0,  "Risk per trade (%)", minval=0.1, maxval=10.0, step=0.1, tooltip="Used only for the ruin-risk proxy.", group=gMain)\ntradesMonth = input.int(40,     "Trades per month", minval=1, maxval=500, group=gMain)\n\nvar string gStats = "Confidence"\nconfLevel = input.string("95%", "Confidence level", options=["90%", "95%", "99%"], group=gStats)\nmarginPct = input.float(5.0, "Desired win-rate margin (±%)", minval=1.0, maxval=20.0, step=0.5, tooltip="How tight you want your win-rate estimate (e.g., ±5%).", group=gStats)\n\nvar string gUI = "Display"\nshowEVLine = input.bool(false, "Show EV line (static)", group=gUI)\nshowLabel  = input.bool(true, "Show minimal label", group=gUI)\n\ncolGood = input.color(color.rgb(0, 255, 140), "Positive", group=gUI)\ncolBad  = input.color(color.rgb(255, 60, 60),  "Negative", group=gUI)\ncolMid  = input.color(color.rgb(90, 180, 255), "Neutral", group=gUI)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Helpers\n//──────────────────────────────────────────────────────────────────────────────\nf_clamp(float x, float a, float b) =>\n    math.max(a, math.min(b, x))\n\nf_z(string cl) =>\n    cl == "90%" ? 1.645 : cl == "99%" ? 2.576 : 1.96\n\nf_fmtPct(float x) =>\n    str.tostring(x, "#.0") + "%"\n\nf_fmtR(float x) =>\n    str.tostring(x, "#.###") + " R"\n\nf_cellBg(float score01) =>\n    (\n        score01 >= 0.5\n            ? color.from_gradient(score01, 0.5, 1.0, colMid, colGood)\n            : color.from_gradient(score01, 0.0, 0.5, colBad, colMid)\n    )\n\n// Solve ruin root r in (0,1) for: p*r^b + (1-p)*r^-1 = 1\nf_ruinRoot(float p, float b) =>\n    q = 1.0 - p\n    if p <= 0 or b <= 0\n        na\n    else\n        lo = 1e-6\n        hi = 0.999999\n        f_lo = p * math.pow(lo, b) + q * math.pow(lo, -1.0) - 1.0\n        f_hi = p * math.pow(hi, b) + q * math.pow(hi, -1.0) - 1.0\n        if na(f_lo) or na(f_hi) or f_lo <= 0\n            na\n        else\n            r = hi\n            for _ = 0 to 60\n                mid = (lo + hi) * 0.5\n                f_mid = p * math.pow(mid, b) + q * math.pow(mid, -1.0) - 1.0\n                if f_mid > 0\n                    lo := mid\n                else\n                    hi := mid\n                r := hi\n            r\n\n//──────────────────────────────────────────────────────────────────────────────\n// Core calculations\n//──────────────────────────────────────────────────────────────────────────────\np = f_clamp(winRatePct / 100.0, 0.0, 1.0)\nq = 1.0 - p\n\nevR      = (p * rrr) - (q * 1.0) - costsR\nevMonthR = evR * tradesMonth\n\nbeP   = (1.0 + costsR) / (1.0 + rrr)\nbePct = beP * 100.0\n\nedgeWinRatePts = winRatePct - bePct\n\nriskFrac = f_clamp(riskPct / 100.0, 0.001, 0.2)\nNunits   = 1.0 / riskFrac\n\nrRoot  = evR > 0 ? f_ruinRoot(p, rrr) : na\nror    = (evR <= 0 or na(rRoot)) ? 1.0 : math.pow(rRoot, Nunits)\nrorPct = f_clamp(ror * 100.0, 0.0, 100.0)\n\nz = f_z(confLevel)\ne = f_clamp(marginPct / 100.0, 0.001, 0.5)\nnNeeded      = math.ceil((z * z) * (p * (1.0 - p)) / (e * e))\nnNeededWorst = math.ceil((z * z) * 0.25 / (e * e))\n\n// Display string for ruin risk (prevents “0.0%” looking like certainty)\nrorTxt = evR <= 0 ? "≈ 100% (no edge)" : (rorPct < 0.1 ? "<0.1%" : f_fmtPct(rorPct))\n\n// “Goodness” colors\nevScore01   = f_clamp(0.5 + evR, 0.0, 1.0)                   // rough mapping\nedgeScore01 = f_clamp(0.5 + (edgeWinRatePts / 20.0), 0.0, 1.0)\nrorScore01  = 1.0 - (rorPct / 100.0)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Optional minimal plot (static; OFF by default)\n//──────────────────────────────────────────────────────────────────────────────\nplot(showEVLine ? evR : na, "EV (R/trade)", color=evR >= 0 ? colGood : colBad, linewidth=2)\nhline(showEVLine ? 0 : na, "EV = 0", color=color.new(color.gray, 75), linestyle=hline.style_dotted)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Dashboard (table) — primary output\n//──────────────────────────────────────────────────────────────────────────────\nvar table dash = table.new(position.top_right, 2, 9, border_width=1)\n\nbgHdr = color.new(color.black, 0)\ntx    = color.white\n\nif barstate.islast\n    // Header\n    table.cell(dash, 0, 0, "Expectancy Reality Check", text_color=tx, bgcolor=bgHdr, text_size=size.small)\n    table.cell(dash, 1, 0, syminfo.ticker + " (" + timeframe.period + ")", text_color=color.new(tx, 20), bgcolor=bgHdr, text_size=size.tiny)\n\n    // Assumptions\n    table.cell(dash, 0, 1, "Assumed WR / RRR", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 1, f_fmtPct(winRatePct) + " / " + str.tostring(rrr, "#.##") + "R", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n    table.cell(dash, 0, 2, "Costs (R) / Trades", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 2, f_fmtR(costsR) + " / " + str.tostring(tradesMonth) + "/mo", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n    // Core outputs\n    table.cell(dash, 0, 3, "EV (R/trade)", text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n    table.cell(dash, 1, 3, f_fmtR(evR), text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n\n    table.cell(dash, 0, 4, "EV (R/month)", text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n    table.cell(dash, 1, 4, f_fmtR(evMonthR), text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n\n    table.cell(dash, 0, 5, "Break-even WR", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n    table.cell(dash, 1, 5, f_fmtPct(bePct), text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n\n    table.cell(dash, 0, 6, "Edge vs BE (pp)", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n    table.cell(dash, 1, 6, str.tostring(edgeWinRatePts, "#.1") + " pp", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n\n    // Ruin risk proxy (renamed for clarity)\n    rorBg = f_cellBg(rorScore01)\n    table.cell(dash, 0, 7, "Ruin risk (proxy)", text_color=tx, bgcolor=rorBg, text_size=size.small)\n    table.cell(dash, 1, 7, rorTxt, text_color=tx, bgcolor=rorBg, text_size=size.small)\n\n    // Sample size\n    table.cell(dash, 0, 8, "Trades needed (±" + f_fmtPct(marginPct) + " @ " + confLevel + ")", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 8, str.tostring(nNeeded) + " (worst: " + str.tostring(nNeededWorst) + ")", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Minimal label (3 numbers; no extra diagnostics)\n//──────────────────────────────────────────────────────────────────────────────\nvar label lbl = na\nif showLabel and barstate.islast\n    label.delete(lbl)\n    txtLbl = "EV: " + f_fmtR(evR) + " | BE: " + f_fmtPct(bePct) + " | Ruin: " + rorTxt\n    yLbl = showEVLine ? evR : 0\n    lbl := label.new(bar_index, yLbl, txtLbl, style=label.style_label_left, textcolor=tx, color=color.new(color.black, 15))\n'
[CAPTURE 1] '//@version=6\n// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\n// @SystemsOverFeelings\nindicator("Expectancy Reality Check — SystemsOverFeelings", overlay=false, max_labels_count=50)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Concept (R-units)\n// EV (R/trade) = p*RRR - (1-p)*1 - costsR\n// Break-even p = (1 + costsR) / (1 + RRR)\n//\n// Risk-of-ruin proxy (fixed fractional):\n// Approximate via Lundberg root r in (0,1):\n// Solve: p*r^RRR + (1-p)*r^-1 = 1, then RoR ≈ r^(1/riskFrac)\n// (Only shown when EV > 0)\n//──────────────────────────────────────────────────────────────────────────────\n\n//──────────────────────────────────────────────────────────────────────────────\n// Inputs\n//──────────────────────────────────────────────────────────────────────────────\nvar string gMain = "Assumptions"\nwinRatePct  = input.float(40.0, "Win rate (%)", minval=0.0, maxval=100.0, step=0.5, group=gMain)\nrrr         = input.float(2.0,  "Reward-to-Risk (RRR)", minval=0.05, step=0.05, group=gMain)\ncostsR      = input.float(0.05, "Costs per trade (in R)", minval=0.0, step=0.01, tooltip="Commission+slippage expressed in R. Example: 0.05 means -0.05R per trade.", group=gMain)\nriskPct     = input.float(1.0,  "Risk per trade (%)", minval=0.1, maxval=10.0, step=0.1, tooltip="Used only for the ruin-risk proxy.", group=gMain)\ntradesMonth = input.int(40,     "Trades per month", minval=1, maxval=500, group=gMain)\n\nvar string gStats = "Confidence"\nconfLevel = input.string("95%", "Confidence level", options=["90%", "95%", "99%"], group=gStats)\nmarginPct = input.float(5.0, "Desired win-rate margin (±%)", minval=1.0, maxval=20.0, step=0.5, tooltip="How tight you want your win-rate estimate (e.g., ±5%).", group=gStats)\n\nvar string gUI = "Display"\nshowEVLine = input.bool(false, "Show EV line (static)", group=gUI)\nshowLabel  = input.bool(true, "Show minimal label", group=gUI)\n\ncolGood = input.color(color.rgb(0, 255, 140), "Positive", group=gUI)\ncolBad  = input.color(color.rgb(255, 60, 60),  "Negative", group=gUI)\ncolMid  = input.color(color.rgb(90, 180, 255), "Neutral", group=gUI)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Helpers\n//──────────────────────────────────────────────────────────────────────────────\nf_clamp(float x, float a, float b) =>\n    math.max(a, math.min(b, x))\n\nf_z(string cl) =>\n    cl == "90%" ? 1.645 : cl == "99%" ? 2.576 : 1.96\n\nf_fmtPct(float x) =>\n    str.tostring(x, "#.0") + "%"\n\nf_fmtR(float x) =>\n    str.tostring(x, "#.###") + " R"\n\nf_cellBg(float score01) =>\n    (\n        score01 >= 0.5\n            ? color.from_gradient(score01, 0.5, 1.0, colMid, colGood)\n            : color.from_gradient(score01, 0.0, 0.5, colBad, colMid)\n    )\n\n// Solve ruin root r in (0,1) for: p*r^b + (1-p)*r^-1 = 1\nf_ruinRoot(float p, float b) =>\n    q = 1.0 - p\n    if p <= 0 or b <= 0\n        na\n    else\n        lo = 1e-6\n        hi = 0.999999\n        f_lo = p * math.pow(lo, b) + q * math.pow(lo, -1.0) - 1.0\n        f_hi = p * math.pow(hi, b) + q * math.pow(hi, -1.0) - 1.0\n        if na(f_lo) or na(f_hi) or f_lo <= 0\n            na\n        else\n            r = hi\n            for _ = 0 to 60\n                mid = (lo + hi) * 0.5\n                f_mid = p * math.pow(mid, b) + q * math.pow(mid, -1.0) - 1.0\n                if f_mid > 0\n                    lo := mid\n                else\n                    hi := mid\n                r := hi\n            r\n\n//──────────────────────────────────────────────────────────────────────────────\n// Core calculations\n//──────────────────────────────────────────────────────────────────────────────\np = f_clamp(winRatePct / 100.0, 0.0, 1.0)\nq = 1.0 - p\n\nevR      = (p * rrr) - (q * 1.0) - costsR\nevMonthR = evR * tradesMonth\n\nbeP   = (1.0 + costsR) / (1.0 + rrr)\nbePct = beP * 100.0\n\nedgeWinRatePts = winRatePct - bePct\n\nriskFrac = f_clamp(riskPct / 100.0, 0.001, 0.2)\nNunits   = 1.0 / riskFrac\n\nrRoot  = evR > 0 ? f_ruinRoot(p, rrr) : na\nror    = (evR <= 0 or na(rRoot)) ? 1.0 : math.pow(rRoot, Nunits)\nrorPct = f_clamp(ror * 100.0, 0.0, 100.0)\n\nz = f_z(confLevel)\ne = f_clamp(marginPct / 100.0, 0.001, 0.5)\nnNeeded      = math.ceil((z * z) * (p * (1.0 - p)) / (e * e))\nnNeededWorst = math.ceil((z * z) * 0.25 / (e * e))\n\n// Display string for ruin risk (prevents “0.0%” looking like certainty)\nrorTxt = evR <= 0 ? "≈ 100% (no edge)" : (rorPct < 0.1 ? "<0.1%" : f_fmtPct(rorPct))\n\n// “Goodness” colors\nevScore01   = f_clamp(0.5 + evR, 0.0, 1.0)                   // rough mapping\nedgeScore01 = f_clamp(0.5 + (edgeWinRatePts / 20.0), 0.0, 1.0)\nrorScore01  = 1.0 - (rorPct / 100.0)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Optional minimal plot (static; OFF by default)\n//──────────────────────────────────────────────────────────────────────────────\nplot(showEVLine ? evR : na, "EV (R/trade)", color=evR >= 0 ? colGood : colBad, linewidth=2)\nhline(showEVLine ? 0 : na, "EV = 0", color=color.new(color.gray, 75), linestyle=hline.style_dotted)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Dashboard (table) — primary output\n//──────────────────────────────────────────────────────────────────────────────\nvar table dash = table.new(position.top_right, 2, 9, border_width=1)\n\nbgHdr = color.new(color.black, 0)\ntx    = color.white\n\nif barstate.islast\n    // Header\n    table.cell(dash, 0, 0, "Expectancy Reality Check", text_color=tx, bgcolor=bgHdr, text_size=size.small)\n    table.cell(dash, 1, 0, syminfo.ticker + " (" + timeframe.period + ")", text_color=color.new(tx, 20), bgcolor=bgHdr, text_size=size.tiny)\n\n    // Assumptions\n    table.cell(dash, 0, 1, "Assumed WR / RRR", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 1, f_fmtPct(winRatePct) + " / " + str.tostring(rrr, "#.##") + "R", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n    table.cell(dash, 0, 2, "Costs (R) / Trades", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 2, f_fmtR(costsR) + " / " + str.tostring(tradesMonth) + "/mo", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n    // Core outputs\n    table.cell(dash, 0, 3, "EV (R/trade)", text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n    table.cell(dash, 1, 3, f_fmtR(evR), text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n\n    table.cell(dash, 0, 4, "EV (R/month)", text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n    table.cell(dash, 1, 4, f_fmtR(evMonthR), text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n\n    table.cell(dash, 0, 5, "Break-even WR", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n    table.cell(dash, 1, 5, f_fmtPct(bePct), text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n\n    table.cell(dash, 0, 6, "Edge vs BE (pp)", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n    table.cell(dash, 1, 6, str.tostring(edgeWinRatePts, "#.1") + " pp", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n\n    // Ruin risk proxy (renamed for clarity)\n    rorBg = f_cellBg(rorScore01)\n    table.cell(dash, 0, 7, "Ruin risk (proxy)", text_color=tx, bgcolor=rorBg, text_size=size.small)\n    table.cell(dash, 1, 7, rorTxt, text_color=tx, bgcolor=rorBg, text_size=size.small)\n\n    // Sample size\n    table.cell(dash, 0, 8, "Trades needed (±" + f_fmtPct(marginPct) + " @ " + confLevel + ")", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 8, str.tostring(nNeeded) + " (worst: " + str.tostring(nNeededWorst) + ")", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Minimal label (3 numbers; no extra diagnostics)\n//──────────────────────────────────────────────────────────────────────────────\nvar label lbl = na\nif showLabel and barstate.islast\n    label.delete(lbl)\n    txtLbl = "EV: " + f_fmtR(evR) + " | BE: " + f_fmtPct(bePct) + " | Ruin: " + rorTxt\n    yLbl = showEVLine ? evR : 0\n    lbl := label.new(bar_index, yLbl, txtLbl, style=label.style_label_left, textcolor=tx, color=color.new(color.black, 15))\n'
[CAPTURE 2] '//@version=6\n// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\n// @SystemsOverFeelings\nindicator("Expectancy Reality Check — SystemsOverFeelings", overlay=false, max_labels_count=50)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Concept (R-units)\n// EV (R/trade) = p*RRR - (1-p)*1 - costsR\n// Break-even p = (1 + costsR) / (1 + RRR)\n//\n// Risk-of-ruin proxy (fixed fractional):\n// Approximate via Lundberg root r in (0,1):\n// Solve: p*r^RRR + (1-p)*r^-1 = 1, then RoR ≈ r^(1/riskFrac)\n// (Only shown when EV > 0)\n//──────────────────────────────────────────────────────────────────────────────\n\n//──────────────────────────────────────────────────────────────────────────────\n// Inputs\n//──────────────────────────────────────────────────────────────────────────────\nvar string gMain = "Assumptions"\nwinRatePct  = input.float(40.0, "Win rate (%)", minval=0.0, maxval=100.0, step=0.5, group=gMain)\nrrr         = input.float(2.0,  "Reward-to-Risk (RRR)", minval=0.05, step=0.05, group=gMain)\ncostsR      = input.float(0.05, "Costs per trade (in R)", minval=0.0, step=0.01, tooltip="Commission+slippage expressed in R. Example: 0.05 means -0.05R per trade.", group=gMain)\nriskPct     = input.float(1.0,  "Risk per trade (%)", minval=0.1, maxval=10.0, step=0.1, tooltip="Used only for the ruin-risk proxy.", group=gMain)\ntradesMonth = input.int(40,     "Trades per month", minval=1, maxval=500, group=gMain)\n\nvar string gStats = "Confidence"\nconfLevel = input.string("95%", "Confidence level", options=["90%", "95%", "99%"], group=gStats)\nmarginPct = input.float(5.0, "Desired win-rate margin (±%)", minval=1.0, maxval=20.0, step=0.5, tooltip="How tight you want your win-rate estimate (e.g., ±5%).", group=gStats)\n\nvar string gUI = "Display"\nshowEVLine = input.bool(false, "Show EV line (static)", group=gUI)\nshowLabel  = input.bool(true, "Show minimal label", group=gUI)\n\ncolGood = input.color(color.rgb(0, 255, 140), "Positive", group=gUI)\ncolBad  = input.color(color.rgb(255, 60, 60),  "Negative", group=gUI)\ncolMid  = input.color(color.rgb(90, 180, 255), "Neutral", group=gUI)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Helpers\n//──────────────────────────────────────────────────────────────────────────────\nf_clamp(float x, float a, float b) =>\n    math.max(a, math.min(b, x))\n\nf_z(string cl) =>\n    cl == "90%" ? 1.645 : cl == "99%" ? 2.576 : 1.96\n\nf_fmtPct(float x) =>\n    str.tostring(x, "#.0") + "%"\n\nf_fmtR(float x) =>\n    str.tostring(x, "#.###") + " R"\n\nf_cellBg(float score01) =>\n    (\n        score01 >= 0.5\n            ? color.from_gradient(score01, 0.5, 1.0, colMid, colGood)\n            : color.from_gradient(score01, 0.0, 0.5, colBad, colMid)\n    )\n\n// Solve ruin root r in (0,1) for: p*r^b + (1-p)*r^-1 = 1\nf_ruinRoot(float p, float b) =>\n    q = 1.0 - p\n    if p <= 0 or b <= 0\n        na\n    else\n        lo = 1e-6\n        hi = 0.999999\n        f_lo = p * math.pow(lo, b) + q * math.pow(lo, -1.0) - 1.0\n        f_hi = p * math.pow(hi, b) + q * math.pow(hi, -1.0) - 1.0\n        if na(f_lo) or na(f_hi) or f_lo <= 0\n            na\n        else\n            r = hi\n            for _ = 0 to 60\n                mid = (lo + hi) * 0.5\n                f_mid = p * math.pow(mid, b) + q * math.pow(mid, -1.0) - 1.0\n                if f_mid > 0\n                    lo := mid\n                else\n                    hi := mid\n                r := hi\n            r\n\n//──────────────────────────────────────────────────────────────────────────────\n// Core calculations\n//──────────────────────────────────────────────────────────────────────────────\np = f_clamp(winRatePct / 100.0, 0.0, 1.0)\nq = 1.0 - p\n\nevR      = (p * rrr) - (q * 1.0) - costsR\nevMonthR = evR * tradesMonth\n\nbeP   = (1.0 + costsR) / (1.0 + rrr)\nbePct = beP * 100.0\n\nedgeWinRatePts = winRatePct - bePct\n\nriskFrac = f_clamp(riskPct / 100.0, 0.001, 0.2)\nNunits   = 1.0 / riskFrac\n\nrRoot  = evR > 0 ? f_ruinRoot(p, rrr) : na\nror    = (evR <= 0 or na(rRoot)) ? 1.0 : math.pow(rRoot, Nunits)\nrorPct = f_clamp(ror * 100.0, 0.0, 100.0)\n\nz = f_z(confLevel)\ne = f_clamp(marginPct / 100.0, 0.001, 0.5)\nnNeeded      = math.ceil((z * z) * (p * (1.0 - p)) / (e * e))\nnNeededWorst = math.ceil((z * z) * 0.25 / (e * e))\n\n// Display string for ruin risk (prevents “0.0%” looking like certainty)\nrorTxt = evR <= 0 ? "≈ 100% (no edge)" : (rorPct < 0.1 ? "<0.1%" : f_fmtPct(rorPct))\n\n// “Goodness” colors\nevScore01   = f_clamp(0.5 + evR, 0.0, 1.0)                   // rough mapping\nedgeScore01 = f_clamp(0.5 + (edgeWinRatePts / 20.0), 0.0, 1.0)\nrorScore01  = 1.0 - (rorPct / 100.0)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Optional minimal plot (static; OFF by default)\n//──────────────────────────────────────────────────────────────────────────────\nplot(showEVLine ? evR : na, "EV (R/trade)", color=evR >= 0 ? colGood : colBad, linewidth=2)\nhline(showEVLine ? 0 : na, "EV = 0", color=color.new(color.gray, 75), linestyle=hline.style_dotted)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Dashboard (table) — primary output\n//──────────────────────────────────────────────────────────────────────────────\nvar table dash = table.new(position.top_right, 2, 9, border_width=1)\n\nbgHdr = color.new(color.black, 0)\ntx    = color.white\n\nif barstate.islast\n    // Header\n    table.cell(dash, 0, 0, "Expectancy Reality Check", text_color=tx, bgcolor=bgHdr, text_size=size.small)\n    table.cell(dash, 1, 0, syminfo.ticker + " (" + timeframe.period + ")", text_color=color.new(tx, 20), bgcolor=bgHdr, text_size=size.tiny)\n\n    // Assumptions\n    table.cell(dash, 0, 1, "Assumed WR / RRR", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 1, f_fmtPct(winRatePct) + " / " + str.tostring(rrr, "#.##") + "R", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n    table.cell(dash, 0, 2, "Costs (R) / Trades", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 2, f_fmtR(costsR) + " / " + str.tostring(tradesMonth) + "/mo", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n    // Core outputs\n    table.cell(dash, 0, 3, "EV (R/trade)", text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n    table.cell(dash, 1, 3, f_fmtR(evR), text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n\n    table.cell(dash, 0, 4, "EV (R/month)", text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n    table.cell(dash, 1, 4, f_fmtR(evMonthR), text_color=tx, bgcolor=f_cellBg(evScore01), text_size=size.small)\n\n    table.cell(dash, 0, 5, "Break-even WR", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n    table.cell(dash, 1, 5, f_fmtPct(bePct), text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n\n    table.cell(dash, 0, 6, "Edge vs BE (pp)", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n    table.cell(dash, 1, 6, str.tostring(edgeWinRatePts, "#.1") + " pp", text_color=tx, bgcolor=f_cellBg(edgeScore01), text_size=size.small)\n\n    // Ruin risk proxy (renamed for clarity)\n    rorBg = f_cellBg(rorScore01)\n    table.cell(dash, 0, 7, "Ruin risk (proxy)", text_color=tx, bgcolor=rorBg, text_size=size.small)\n    table.cell(dash, 1, 7, rorTxt, text_color=tx, bgcolor=rorBg, text_size=size.small)\n\n    // Sample size\n    table.cell(dash, 0, 8, "Trades needed (±" + f_fmtPct(marginPct) + " @ " + confLevel + ")", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n    table.cell(dash, 1, 8, str.tostring(nNeeded) + " (worst: " + str.tostring(nNeededWorst) + ")", text_color=tx, bgcolor=bgHdr, text_size=size.tiny)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Minimal label (3 numbers; no extra diagnostics)\n//──────────────────────────────────────────────────────────────────────────────\nvar label lbl = na\nif showLabel and barstate.islast\n    label.delete(lbl)\n    txtLbl = "EV: " + f_fmtR(evR) + " | BE: " + f_fmtPct(bePct) + " | Ruin: " + rorTxt\n    yLbl = showEVLine ? evR : 0\n    lbl := label.new(bar_index, yLbl, txtLbl, style=label.style_label_left, textcolor=tx, color=color.new(color.black, 15))\n'
[DEBUG] save_script called: script_id=66mGO32j title=Expectancy Reality Check category=66mGO32j force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\66mGO32j_Expectancy_Reality_Check.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\66mGO32j_Expectancy_Reality_Check.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 00:12:32 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 00:12:32 GMT' as: 2026-02-09T00:12:32+00:00
[DEBUG] Exact published date for header: 2026-02-09T00:12:32+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/yf10v9sf-rsi-divergence-v6/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0//@
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0\n//@version=6\nindicator("RSI Divergence (Close inside Band) v6", overlay=false)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Inputs\nrsiLen   = input.int(14, "RSI Length", minval=1)\n\nlvlLow   = input.float(20, "Level Low",  minval=0, maxval=100)\nlvlMid   = input.float(50, "Level Mid",  minval=0, maxval=100)\nlvlHigh  = input.float(80, "Level High", minval=0, maxval=100)\n\nshowBand = input.bool(true, "Show High/Low Band")\n\ncolClose = input.color(color.aqua,  "RSI Close Color")\ncolBand  = input.color(color.white, "Band Color")\n\nwClose   = input.int(1, "RSI Close Width", minval=1, maxval=5)\nwBand    = input.int(1, "Band Width", minval=1, maxval=5)\n\n//──────────────────────────────────────────────────────────────────────────────\n// RSI calculations\nrsiClose = ta.rsi(close, rsiLen)\nrsiHigh  = ta.rsi(high,  rsiLen)\nrsiLow   = ta.rsi(low,   rsiLen)\n\n// Band that ALWAYS contains RSI Close\nrsiUpper = math.max(rsiHigh, math.max(rsiLow, rsiClose))\nrsiLower = math.min(rsiHigh, math.min(rsiLow, rsiClose))\n\n//──────────────────────────────────────────────────────────────────────────────\n// Levels\nhline(lvlLow,  "Low",  color=color.gray, linestyle=hline.style_dotted)\nhline(lvlMid,  "Mid",  color=color.gray, linestyle=hline.style_dotted)\nhline(lvlHigh, "High", color=color.gray, linestyle=hline.style_dotted)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Plots\nplot(rsiClose, title="RSI Close", color=colClose, linewidth=wClose)\nplot(showBand ? rsiUpper : na, title="RSI Upper", color=colBand, linewidth=wBand)\nplot(showBand ? rsiLower : na, title="RSI Lower", color=colBand, linewidth=wBand)\n'
[CAPTURE 1] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0\n//@version=6\nindicator("RSI Divergence (Close inside Band) v6", overlay=false)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Inputs\nrsiLen   = input.int(14, "RSI Length", minval=1)\n\nlvlLow   = input.float(20, "Level Low",  minval=0, maxval=100)\nlvlMid   = input.float(50, "Level Mid",  minval=0, maxval=100)\nlvlHigh  = input.float(80, "Level High", minval=0, maxval=100)\n\nshowBand = input.bool(true, "Show High/Low Band")\n\ncolClose = input.color(color.aqua,  "RSI Close Color")\ncolBand  = input.color(color.white, "Band Color")\n\nwClose   = input.int(1, "RSI Close Width", minval=1, maxval=5)\nwBand    = input.int(1, "Band Width", minval=1, maxval=5)\n\n//──────────────────────────────────────────────────────────────────────────────\n// RSI calculations\nrsiClose = ta.rsi(close, rsiLen)\nrsiHigh  = ta.rsi(high,  rsiLen)\nrsiLow   = ta.rsi(low,   rsiLen)\n\n// Band that ALWAYS contains RSI Close\nrsiUpper = math.max(rsiHigh, math.max(rsiLow, rsiClose))\nrsiLower = math.min(rsiHigh, math.min(rsiLow, rsiClose))\n\n//──────────────────────────────────────────────────────────────────────────────\n// Levels\nhline(lvlLow,  "Low",  color=color.gray, linestyle=hline.style_dotted)\nhline(lvlMid,  "Mid",  color=color.gray, linestyle=hline.style_dotted)\nhline(lvlHigh, "High", color=color.gray, linestyle=hline.style_dotted)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Plots\nplot(rsiClose, title="RSI Close", color=colClose, linewidth=wClose)\nplot(showBand ? rsiUpper : na, title="RSI Upper", color=colBand, linewidth=wBand)\nplot(showBand ? rsiLower : na, title="RSI Lower", color=colBand, linewidth=wBand)\n'
[CAPTURE 2] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0\n//@version=6\nindicator("RSI Divergence (Close inside Band) v6", overlay=false)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Inputs\nrsiLen   = input.int(14, "RSI Length", minval=1)\n\nlvlLow   = input.float(20, "Level Low",  minval=0, maxval=100)\nlvlMid   = input.float(50, "Level Mid",  minval=0, maxval=100)\nlvlHigh  = input.float(80, "Level High", minval=0, maxval=100)\n\nshowBand = input.bool(true, "Show High/Low Band")\n\ncolClose = input.color(color.aqua,  "RSI Close Color")\ncolBand  = input.color(color.white, "Band Color")\n\nwClose   = input.int(1, "RSI Close Width", minval=1, maxval=5)\nwBand    = input.int(1, "Band Width", minval=1, maxval=5)\n\n//──────────────────────────────────────────────────────────────────────────────\n// RSI calculations\nrsiClose = ta.rsi(close, rsiLen)\nrsiHigh  = ta.rsi(high,  rsiLen)\nrsiLow   = ta.rsi(low,   rsiLen)\n\n// Band that ALWAYS contains RSI Close\nrsiUpper = math.max(rsiHigh, math.max(rsiLow, rsiClose))\nrsiLower = math.min(rsiHigh, math.min(rsiLow, rsiClose))\n\n//──────────────────────────────────────────────────────────────────────────────\n// Levels\nhline(lvlLow,  "Low",  color=color.gray, linestyle=hline.style_dotted)\nhline(lvlMid,  "Mid",  color=color.gray, linestyle=hline.style_dotted)\nhline(lvlHigh, "High", color=color.gray, linestyle=hline.style_dotted)\n\n//──────────────────────────────────────────────────────────────────────────────\n// Plots\nplot(rsiClose, title="RSI Close", color=colClose, linewidth=wClose)\nplot(showBand ? rsiUpper : na, title="RSI Upper", color=colBand, linewidth=wBand)\nplot(showBand ? rsiLower : na, title="RSI Lower", color=colBand, linewidth=wBand)\n'
[DEBUG] save_script called: script_id=yf10v9sf title=RSI Divergence v6 category=yf10v9sf force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\yf10v9sf_RSI_Divergence_v6.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\yf10v9sf_RSI_Divergence_v6.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 00:06:10 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 00:06:10 GMT' as: 2026-02-09T00:06:10+00:00
[DEBUG] Exact published date for header: 2026-02-09T00:06:10+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/jg9avsL7-Elliot-wave-labeling-layers/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
//@version=6indicator("Elliot wave labeling layers", overlay=true)var table t = table.new(position.top_right, 1, 7, border_width = 
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator("Elliot wave labeling layers", overlay=true)\n\nvar table t = table.new(position.top_right, 1, 7, border_width = 1)\n\nif barstate.isfirst\n    table.cell(t, 0, 0, " 1a ①   Blue    Primary - Years",\n        text_color=color.rgb(41, 98, 255), text_halign=text.align_left)\n\n    table.cell(t, 0, 1, " 1b (1)  Red   Intermediate - Months",\n        text_color=color.rgb(214, 30, 30), text_halign=text.align_left)\n\n    table.cell(t, 0, 2, " 1c  1   Green   Minor - Weeks",\n        text_color=color.rgb(54, 153, 59), text_halign=text.align_left)\n\n    table.cell(t, 0, 3, " 2a ⓘ  Orange  Micro - Days",\n        text_color=color.rgb(245, 124, 0), text_halign=text.align_left)\n\n    table.cell(t, 0, 4, " 2b (i)  Purple  Submicro - Hours",\n        text_color=color.rgb(118, 46, 163), text_halign=text.align_left)\n\n    table.cell(t, 0, 5, " 2c  i    Pink  Miniscule - Minutes",\n        text_color=color.rgb(204, 61, 118), text_halign=text.align_left)\n\n    table.cell(t, 0, 6, " 3    I  Major Cycle - 3 to 5 Years",\n        text_color=color.rgb(24, 5, 5), text_halign=text.align_left)'
[CAPTURE 1] '//@version=6\nindicator("Elliot wave labeling layers", overlay=true)\n\nvar table t = table.new(position.top_right, 1, 7, border_width = 1)\n\nif barstate.isfirst\n    table.cell(t, 0, 0, " 1a ①   Blue    Primary - Years",\n        text_color=color.rgb(41, 98, 255), text_halign=text.align_left)\n\n    table.cell(t, 0, 1, " 1b (1)  Red   Intermediate - Months",\n        text_color=color.rgb(214, 30, 30), text_halign=text.align_left)\n\n    table.cell(t, 0, 2, " 1c  1   Green   Minor - Weeks",\n        text_color=color.rgb(54, 153, 59), text_halign=text.align_left)\n\n    table.cell(t, 0, 3, " 2a ⓘ  Orange  Micro - Days",\n        text_color=color.rgb(245, 124, 0), text_halign=text.align_left)\n\n    table.cell(t, 0, 4, " 2b (i)  Purple  Submicro - Hours",\n        text_color=color.rgb(118, 46, 163), text_halign=text.align_left)\n\n    table.cell(t, 0, 5, " 2c  i    Pink  Miniscule - Minutes",\n        text_color=color.rgb(204, 61, 118), text_halign=text.align_left)\n\n    table.cell(t, 0, 6, " 3    I  Major Cycle - 3 to 5 Years",\n        text_color=color.rgb(24, 5, 5), text_halign=text.align_left)'
[CAPTURE 2] '//@version=6\nindicator("Elliot wave labeling layers", overlay=true)\n\nvar table t = table.new(position.top_right, 1, 7, border_width = 1)\n\nif barstate.isfirst\n    table.cell(t, 0, 0, " 1a ①   Blue    Primary - Years",\n        text_color=color.rgb(41, 98, 255), text_halign=text.align_left)\n\n    table.cell(t, 0, 1, " 1b (1)  Red   Intermediate - Months",\n        text_color=color.rgb(214, 30, 30), text_halign=text.align_left)\n\n    table.cell(t, 0, 2, " 1c  1   Green   Minor - Weeks",\n        text_color=color.rgb(54, 153, 59), text_halign=text.align_left)\n\n    table.cell(t, 0, 3, " 2a ⓘ  Orange  Micro - Days",\n        text_color=color.rgb(245, 124, 0), text_halign=text.align_left)\n\n    table.cell(t, 0, 4, " 2b (i)  Purple  Submicro - Hours",\n        text_color=color.rgb(118, 46, 163), text_halign=text.align_left)\n\n    table.cell(t, 0, 5, " 2c  i    Pink  Miniscule - Minutes",\n        text_color=color.rgb(204, 61, 118), text_halign=text.align_left)\n\n    table.cell(t, 0, 6, " 3    I  Major Cycle - 3 to 5 Years",\n        text_color=color.rgb(24, 5, 5), text_halign=text.align_left)'
[DEBUG] save_script called: script_id=jg9avsL7 title=Elliot wave labeling layers category=jg9avsL7 force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\jg9avsL7_Elliot_wave_labeling_layers.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\jg9avsL7_Elliot_wave_labeling_layers.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 00:50:13 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 00:50:13 GMT' as: 2026-02-09T00:50:13+00:00
[DEBUG] Exact published date for header: 2026-02-09T00:50:13+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/q6qYB7ZB-Bookmap-Footprint-Imbalance-Bubbles/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © drop_trades\r\n\r\n//@version=6\r\nindicator("Footprint Imbalance Bubbles (Bookmap)", "Bubbles", overlay=true, max_labels_count=500)\r\n\r\n// --- 1. Settings ---\r\ngroup_general = "General Settings"\r\nticksPerRow    = input.int(5, "Ticks per Row", minval=1, group=group_general, tooltip="Aggregates price ticks. 1 = detailed, 5+ = clustered")\r\nshowPOC        = input.bool(false, "Show POC Line", group=group_general)\r\n\r\ngroup_filters = "Bubble Filters"\r\nimbalanceRatio = input.float(3.0, "Imbalance Ratio", minval=1.0, step=0.1, group=group_filters, tooltip="Buy Vol must be X times Sell Vol (or vice versa)")\r\nminVolFilter   = input.int(20, "Min Volume Filter (Starts Tiny)", minval=1, group=group_filters, tooltip="Total volume required to spawn the smallest bubble.")\r\nminDeltaFilter = input.int(5, "Min Delta Filter", minval=0, group=group_filters, tooltip="Net Delta (Buy-Sell) must be at least this value (absolute)")\r\n\r\n// --- Visual Groups Split ---\r\ngroup_vis_main  = "Visual Settings: Main"\r\nvolVisualMode   = input.string("Size Scaling", "Volume Indicator Mode", options=["Size Scaling", "Transparency Scaling"], group=group_vis_main, tooltip="Choose which mode determines how volume is displayed")\r\ncolBull         = input.color(color.teal, "Buyer Color", group=group_vis_main)\r\ncolBear         = input.color(color.red, "Seller Color", group=group_vis_main)\r\n\r\ngroup_vis_size  = "Visual Settings: Size Scaling Mode"\r\nautoScale       = input.bool(true, "Auto-Scale Max Volume", group=group_vis_size, tooltip="If checked, the script ignores the manual Max Volume and uses the largest bubble currently on screen to scale the others.")\r\nmaxVolHuge      = input.int(500, "Manual Max Volume", minval=1, group=group_vis_size, tooltip="Only used if Auto-Scale is OFF. Volume required to reach the largest bubble size.")\r\nsizeFixedTransp = input.int(60, "Fixed Transparency", minval=0, maxval=100, group=group_vis_size, tooltip="Constant transparency used when size varies.")\r\n\r\ngroup_vis_trans = "Visual Settings: Transparency Scaling Mode"\r\ntranspFixedSize = input.string(size.small, "Fixed Bubble Size", options=[size.tiny, size.small, size.normal, size.large, size.huge], group=group_vis_trans, tooltip="Constant size used when transparency varies.")\r\ntranspStart     = input.int(80, "Start Transparency (Low Vol)", minval=0, maxval=100, group=group_vis_trans, tooltip="Very transparent for low volume.")\r\ntranspEnd       = input.int(10, "End Transparency (High Vol)", minval=0, maxval=100, group=group_vis_trans, tooltip="Solid/Opaque for high volume.")\r\n\r\n// --- 2. State & Cache (For Auto-Scaling) ---\r\n// We must store the label references and their volumes to update them dynamically\r\nvar label[] cache_lbl     = array.new_label()\r\nvar float[] cache_vol     = array.new_float()\r\nvar bool[]  cache_is_bull = array.new_bool()\r\n\r\n// Request Footprint Data\r\nfootprintData = request.footprint(ticksPerRow, 70, 300)\r\n\r\n// --- 3. Helper Functions ---\r\ngetPrice(rowObj) =>\r\n    na(rowObj) ? na : volume_row.down_price(rowObj)\r\n\r\n// Helper to calculate Bubble Size based on current Range\r\ncalcSize(vol, minV, maxV) =>\r\n    safeMax = maxV > minV ? maxV : minV + 100\r\n    rangeV  = safeMax - minV\r\n    sz      = size.tiny\r\n    if vol >= minV + (rangeV * 0.15)\r\n        sz := size.small\r\n    if vol >= minV + (rangeV * 0.40)\r\n        sz := size.normal\r\n    if vol >= minV + (rangeV * 0.70)\r\n        sz := size.large\r\n    if vol >= safeMax\r\n        sz := size.huge\r\n    sz\r\n\r\n// Helper to calculate Transparency based on current Range\r\ncalcTransp(vol, minV, maxV, tStart, tEnd) =>\r\n    safeMax = maxV > minV ? maxV : minV + 100\r\n    rangeV  = safeMax - minV\r\n    \r\n    // Normalize strength 0.0 to 1.0\r\n    strength = (vol - minV) / rangeV\r\n    if strength > 1.0 \r\n        strength := 1.0\r\n    if strength < 0.0\r\n        strength := 0.0\r\n    \r\n    tDiff = tStart - tEnd\r\n    int(tStart - (tDiff * strength))\r\n\r\n// --- 4. Main Bubble Generation Logic ---\r\nif not na(footprintData) and array.size(footprint.rows(footprintData)) > 0\r\n    \r\n    rowsArray = footprint.rows(footprintData)\r\n    int rowCount = array.size(rowsArray)\r\n    \r\n    for i = 0 to rowCount - 1\r\n        volume_row row = array.get(rowsArray, i)\r\n        \r\n        float buyVol  = volume_row.buy_volume(row)\r\n        float sellVol = volume_row.sell_volume(row)\r\n        float price   = getPrice(row) \r\n        \r\n        float totalRowVol = buyVol + sellVol\r\n        float netDelta    = buyVol - sellVol\r\n        float absDelta    = math.abs(netDelta)\r\n        \r\n        // --- Filter Logic ---\r\n        if totalRowVol >= minVolFilter and absDelta >= minDeltaFilter\r\n            \r\n            float buyRatio  = sellVol > 0 ? buyVol / sellVol : buyVol \r\n            float sellRatio = buyVol > 0 ? sellVol / buyVol : sellVol \r\n            \r\n            bool isBuyImbalance  = buyRatio >= imbalanceRatio\r\n            bool isSellImbalance = sellRatio >= imbalanceRatio\r\n            \r\n            if isBuyImbalance or isSellImbalance\r\n                // Create Bubble (Initial State)\r\n                // We create it with "tiny" size initially; it gets resized at the end of the script if Auto is On\r\n                lbl = label.new(\r\n                     x=bar_index, \r\n                     y=price, \r\n                     text="", \r\n                     style=label.style_circle,\r\n                     color=color.new(isBuyImbalance ? colBull : colBear, sizeFixedTransp),\r\n                     size=size.tiny,\r\n                     tooltip=(isBuyImbalance ? "Aggressive Buy" : "Aggressive Sell") + "\\nPrice: " + str.tostring(price) + "\\nVol: " + str.tostring(totalRowVol) + "\\nDelta: " + str.tostring(netDelta)\r\n                     )\r\n                \r\n                // Add to Cache\r\n                array.push(cache_lbl, lbl)\r\n                array.push(cache_vol, totalRowVol)\r\n                array.push(cache_is_bull, isBuyImbalance)\r\n                \r\n                // Maintain Cache Limit (fifo)\r\n                // We manually delete old labels to keep sync with our data arrays\r\n                if array.size(cache_lbl) > 500\r\n                    oldLbl = array.shift(cache_lbl)\r\n                    label.delete(oldLbl)\r\n                    array.shift(cache_vol)\r\n                    array.shift(cache_is_bull)\r\n\r\n// --- 5. Auto-Scaling & Redraw Logic ---\r\n// This runs on every bar update. We check the cache and update ALL visible bubbles.\r\nif array.size(cache_vol) > 0\r\n    \r\n    // Determine the Max Volume for the scale\r\n    float currentMax = maxVolHuge // Default to manual\r\n    if autoScale\r\n        // Find the absolute largest bubble currently stored in the cache\r\n        currentMax := array.max(cache_vol)\r\n    \r\n    // Update Loop: Apply new scale to all cached bubbles\r\n    // We only need to do this loop if AutoScale is ON or if we want to support dynamic transparency\r\n    if autoScale or volVisualMode == "Transparency Scaling"\r\n        for i = 0 to array.size(cache_lbl) - 1\r\n            lblVal  = array.get(cache_lbl, i)\r\n            volVal  = array.get(cache_vol, i)\r\n            isBull  = array.get(cache_is_bull, i)\r\n            \r\n            if volVisualMode == "Size Scaling"\r\n                // Update Size\r\n                newSz = calcSize(volVal, minVolFilter, currentMax)\r\n                label.set_size(lblVal, newSz)\r\n                // Ensure Transparency is fixed\r\n                label.set_color(lblVal, color.new(isBull ? colBull : colBear, sizeFixedTransp))\r\n                \r\n            else \r\n                // Update Transparency\r\n                newTransp = calcTransp(volVal, minVolFilter, currentMax, transpStart, transpEnd)\r\n                label.set_color(lblVal, color.new(isBull ? colBull : colBear, newTransp))\r\n                // Ensure Size is fixed\r\n                label.set_size(lblVal, transpFixedSize)\r\n\r\n// --- 6. Plot POC ---\r\nfloat pocLevel = na\r\nif showPOC and not na(footprintData)\r\n    pocLevel := getPrice(footprint.poc(footprintData))\r\n\r\nplot(pocLevel, "POC", color=color.gray, linewidth=1, style=plot.style_stepline)'
[CAPTURE 1] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © drop_trades\r\n\r\n//@version=6\r\nindicator("Footprint Imbalance Bubbles (Bookmap)", "Bubbles", overlay=true, max_labels_count=500)\r\n\r\n// --- 1. Settings ---\r\ngroup_general = "General Settings"\r\nticksPerRow    = input.int(5, "Ticks per Row", minval=1, group=group_general, tooltip="Aggregates price ticks. 1 = detailed, 5+ = clustered")\r\nshowPOC        = input.bool(false, "Show POC Line", group=group_general)\r\n\r\ngroup_filters = "Bubble Filters"\r\nimbalanceRatio = input.float(3.0, "Imbalance Ratio", minval=1.0, step=0.1, group=group_filters, tooltip="Buy Vol must be X times Sell Vol (or vice versa)")\r\nminVolFilter   = input.int(20, "Min Volume Filter (Starts Tiny)", minval=1, group=group_filters, tooltip="Total volume required to spawn the smallest bubble.")\r\nminDeltaFilter = input.int(5, "Min Delta Filter", minval=0, group=group_filters, tooltip="Net Delta (Buy-Sell) must be at least this value (absolute)")\r\n\r\n// --- Visual Groups Split ---\r\ngroup_vis_main  = "Visual Settings: Main"\r\nvolVisualMode   = input.string("Size Scaling", "Volume Indicator Mode", options=["Size Scaling", "Transparency Scaling"], group=group_vis_main, tooltip="Choose which mode determines how volume is displayed")\r\ncolBull         = input.color(color.teal, "Buyer Color", group=group_vis_main)\r\ncolBear         = input.color(color.red, "Seller Color", group=group_vis_main)\r\n\r\ngroup_vis_size  = "Visual Settings: Size Scaling Mode"\r\nautoScale       = input.bool(true, "Auto-Scale Max Volume", group=group_vis_size, tooltip="If checked, the script ignores the manual Max Volume and uses the largest bubble currently on screen to scale the others.")\r\nmaxVolHuge      = input.int(500, "Manual Max Volume", minval=1, group=group_vis_size, tooltip="Only used if Auto-Scale is OFF. Volume required to reach the largest bubble size.")\r\nsizeFixedTransp = input.int(60, "Fixed Transparency", minval=0, maxval=100, group=group_vis_size, tooltip="Constant transparency used when size varies.")\r\n\r\ngroup_vis_trans = "Visual Settings: Transparency Scaling Mode"\r\ntranspFixedSize = input.string(size.small, "Fixed Bubble Size", options=[size.tiny, size.small, size.normal, size.large, size.huge], group=group_vis_trans, tooltip="Constant size used when transparency varies.")\r\ntranspStart     = input.int(80, "Start Transparency (Low Vol)", minval=0, maxval=100, group=group_vis_trans, tooltip="Very transparent for low volume.")\r\ntranspEnd       = input.int(10, "End Transparency (High Vol)", minval=0, maxval=100, group=group_vis_trans, tooltip="Solid/Opaque for high volume.")\r\n\r\n// --- 2. State & Cache (For Auto-Scaling) ---\r\n// We must store the label references and their volumes to update them dynamically\r\nvar label[] cache_lbl     = array.new_label()\r\nvar float[] cache_vol     = array.new_float()\r\nvar bool[]  cache_is_bull = array.new_bool()\r\n\r\n// Request Footprint Data\r\nfootprintData = request.footprint(ticksPerRow, 70, 300)\r\n\r\n// --- 3. Helper Functions ---\r\ngetPrice(rowObj) =>\r\n    na(rowObj) ? na : volume_row.down_price(rowObj)\r\n\r\n// Helper to calculate Bubble Size based on current Range\r\ncalcSize(vol, minV, maxV) =>\r\n    safeMax = maxV > minV ? maxV : minV + 100\r\n    rangeV  = safeMax - minV\r\n    sz      = size.tiny\r\n    if vol >= minV + (rangeV * 0.15)\r\n        sz := size.small\r\n    if vol >= minV + (rangeV * 0.40)\r\n        sz := size.normal\r\n    if vol >= minV + (rangeV * 0.70)\r\n        sz := size.large\r\n    if vol >= safeMax\r\n        sz := size.huge\r\n    sz\r\n\r\n// Helper to calculate Transparency based on current Range\r\ncalcTransp(vol, minV, maxV, tStart, tEnd) =>\r\n    safeMax = maxV > minV ? maxV : minV + 100\r\n    rangeV  = safeMax - minV\r\n    \r\n    // Normalize strength 0.0 to 1.0\r\n    strength = (vol - minV) / rangeV\r\n    if strength > 1.0 \r\n        strength := 1.0\r\n    if strength < 0.0\r\n        strength := 0.0\r\n    \r\n    tDiff = tStart - tEnd\r\n    int(tStart - (tDiff * strength))\r\n\r\n// --- 4. Main Bubble Generation Logic ---\r\nif not na(footprintData) and array.size(footprint.rows(footprintData)) > 0\r\n    \r\n    rowsArray = footprint.rows(footprintData)\r\n    int rowCount = array.size(rowsArray)\r\n    \r\n    for i = 0 to rowCount - 1\r\n        volume_row row = array.get(rowsArray, i)\r\n        \r\n        float buyVol  = volume_row.buy_volume(row)\r\n        float sellVol = volume_row.sell_volume(row)\r\n        float price   = getPrice(row) \r\n        \r\n        float totalRowVol = buyVol + sellVol\r\n        float netDelta    = buyVol - sellVol\r\n        float absDelta    = math.abs(netDelta)\r\n        \r\n        // --- Filter Logic ---\r\n        if totalRowVol >= minVolFilter and absDelta >= minDeltaFilter\r\n            \r\n            float buyRatio  = sellVol > 0 ? buyVol / sellVol : buyVol \r\n            float sellRatio = buyVol > 0 ? sellVol / buyVol : sellVol \r\n            \r\n            bool isBuyImbalance  = buyRatio >= imbalanceRatio\r\n            bool isSellImbalance = sellRatio >= imbalanceRatio\r\n            \r\n            if isBuyImbalance or isSellImbalance\r\n                // Create Bubble (Initial State)\r\n                // We create it with "tiny" size initially; it gets resized at the end of the script if Auto is On\r\n                lbl = label.new(\r\n                     x=bar_index, \r\n                     y=price, \r\n                     text="", \r\n                     style=label.style_circle,\r\n                     color=color.new(isBuyImbalance ? colBull : colBear, sizeFixedTransp),\r\n                     size=size.tiny,\r\n                     tooltip=(isBuyImbalance ? "Aggressive Buy" : "Aggressive Sell") + "\\nPrice: " + str.tostring(price) + "\\nVol: " + str.tostring(totalRowVol) + "\\nDelta: " + str.tostring(netDelta)\r\n                     )\r\n                \r\n                // Add to Cache\r\n                array.push(cache_lbl, lbl)\r\n                array.push(cache_vol, totalRowVol)\r\n                array.push(cache_is_bull, isBuyImbalance)\r\n                \r\n                // Maintain Cache Limit (fifo)\r\n                // We manually delete old labels to keep sync with our data arrays\r\n                if array.size(cache_lbl) > 500\r\n                    oldLbl = array.shift(cache_lbl)\r\n                    label.delete(oldLbl)\r\n                    array.shift(cache_vol)\r\n                    array.shift(cache_is_bull)\r\n\r\n// --- 5. Auto-Scaling & Redraw Logic ---\r\n// This runs on every bar update. We check the cache and update ALL visible bubbles.\r\nif array.size(cache_vol) > 0\r\n    \r\n    // Determine the Max Volume for the scale\r\n    float currentMax = maxVolHuge // Default to manual\r\n    if autoScale\r\n        // Find the absolute largest bubble currently stored in the cache\r\n        currentMax := array.max(cache_vol)\r\n    \r\n    // Update Loop: Apply new scale to all cached bubbles\r\n    // We only need to do this loop if AutoScale is ON or if we want to support dynamic transparency\r\n    if autoScale or volVisualMode == "Transparency Scaling"\r\n        for i = 0 to array.size(cache_lbl) - 1\r\n            lblVal  = array.get(cache_lbl, i)\r\n            volVal  = array.get(cache_vol, i)\r\n            isBull  = array.get(cache_is_bull, i)\r\n            \r\n            if volVisualMode == "Size Scaling"\r\n                // Update Size\r\n                newSz = calcSize(volVal, minVolFilter, currentMax)\r\n                label.set_size(lblVal, newSz)\r\n                // Ensure Transparency is fixed\r\n                label.set_color(lblVal, color.new(isBull ? colBull : colBear, sizeFixedTransp))\r\n                \r\n            else \r\n                // Update Transparency\r\n                newTransp = calcTransp(volVal, minVolFilter, currentMax, transpStart, transpEnd)\r\n                label.set_color(lblVal, color.new(isBull ? colBull : colBear, newTransp))\r\n                // Ensure Size is fixed\r\n                label.set_size(lblVal, transpFixedSize)\r\n\r\n// --- 6. Plot POC ---\r\nfloat pocLevel = na\r\nif showPOC and not na(footprintData)\r\n    pocLevel := getPrice(footprint.poc(footprintData))\r\n\r\nplot(pocLevel, "POC", color=color.gray, linewidth=1, style=plot.style_stepline)'
[CAPTURE 2] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © drop_trades\r\n\r\n//@version=6\r\nindicator("Footprint Imbalance Bubbles (Bookmap)", "Bubbles", overlay=true, max_labels_count=500)\r\n\r\n// --- 1. Settings ---\r\ngroup_general = "General Settings"\r\nticksPerRow    = input.int(5, "Ticks per Row", minval=1, group=group_general, tooltip="Aggregates price ticks. 1 = detailed, 5+ = clustered")\r\nshowPOC        = input.bool(false, "Show POC Line", group=group_general)\r\n\r\ngroup_filters = "Bubble Filters"\r\nimbalanceRatio = input.float(3.0, "Imbalance Ratio", minval=1.0, step=0.1, group=group_filters, tooltip="Buy Vol must be X times Sell Vol (or vice versa)")\r\nminVolFilter   = input.int(20, "Min Volume Filter (Starts Tiny)", minval=1, group=group_filters, tooltip="Total volume required to spawn the smallest bubble.")\r\nminDeltaFilter = input.int(5, "Min Delta Filter", minval=0, group=group_filters, tooltip="Net Delta (Buy-Sell) must be at least this value (absolute)")\r\n\r\n// --- Visual Groups Split ---\r\ngroup_vis_main  = "Visual Settings: Main"\r\nvolVisualMode   = input.string("Size Scaling", "Volume Indicator Mode", options=["Size Scaling", "Transparency Scaling"], group=group_vis_main, tooltip="Choose which mode determines how volume is displayed")\r\ncolBull         = input.color(color.teal, "Buyer Color", group=group_vis_main)\r\ncolBear         = input.color(color.red, "Seller Color", group=group_vis_main)\r\n\r\ngroup_vis_size  = "Visual Settings: Size Scaling Mode"\r\nautoScale       = input.bool(true, "Auto-Scale Max Volume", group=group_vis_size, tooltip="If checked, the script ignores the manual Max Volume and uses the largest bubble currently on screen to scale the others.")\r\nmaxVolHuge      = input.int(500, "Manual Max Volume", minval=1, group=group_vis_size, tooltip="Only used if Auto-Scale is OFF. Volume required to reach the largest bubble size.")\r\nsizeFixedTransp = input.int(60, "Fixed Transparency", minval=0, maxval=100, group=group_vis_size, tooltip="Constant transparency used when size varies.")\r\n\r\ngroup_vis_trans = "Visual Settings: Transparency Scaling Mode"\r\ntranspFixedSize = input.string(size.small, "Fixed Bubble Size", options=[size.tiny, size.small, size.normal, size.large, size.huge], group=group_vis_trans, tooltip="Constant size used when transparency varies.")\r\ntranspStart     = input.int(80, "Start Transparency (Low Vol)", minval=0, maxval=100, group=group_vis_trans, tooltip="Very transparent for low volume.")\r\ntranspEnd       = input.int(10, "End Transparency (High Vol)", minval=0, maxval=100, group=group_vis_trans, tooltip="Solid/Opaque for high volume.")\r\n\r\n// --- 2. State & Cache (For Auto-Scaling) ---\r\n// We must store the label references and their volumes to update them dynamically\r\nvar label[] cache_lbl     = array.new_label()\r\nvar float[] cache_vol     = array.new_float()\r\nvar bool[]  cache_is_bull = array.new_bool()\r\n\r\n// Request Footprint Data\r\nfootprintData = request.footprint(ticksPerRow, 70, 300)\r\n\r\n// --- 3. Helper Functions ---\r\ngetPrice(rowObj) =>\r\n    na(rowObj) ? na : volume_row.down_price(rowObj)\r\n\r\n// Helper to calculate Bubble Size based on current Range\r\ncalcSize(vol, minV, maxV) =>\r\n    safeMax = maxV > minV ? maxV : minV + 100\r\n    rangeV  = safeMax - minV\r\n    sz      = size.tiny\r\n    if vol >= minV + (rangeV * 0.15)\r\n        sz := size.small\r\n    if vol >= minV + (rangeV * 0.40)\r\n        sz := size.normal\r\n    if vol >= minV + (rangeV * 0.70)\r\n        sz := size.large\r\n    if vol >= safeMax\r\n        sz := size.huge\r\n    sz\r\n\r\n// Helper to calculate Transparency based on current Range\r\ncalcTransp(vol, minV, maxV, tStart, tEnd) =>\r\n    safeMax = maxV > minV ? maxV : minV + 100\r\n    rangeV  = safeMax - minV\r\n    \r\n    // Normalize strength 0.0 to 1.0\r\n    strength = (vol - minV) / rangeV\r\n    if strength > 1.0 \r\n        strength := 1.0\r\n    if strength < 0.0\r\n        strength := 0.0\r\n    \r\n    tDiff = tStart - tEnd\r\n    int(tStart - (tDiff * strength))\r\n\r\n// --- 4. Main Bubble Generation Logic ---\r\nif not na(footprintData) and array.size(footprint.rows(footprintData)) > 0\r\n    \r\n    rowsArray = footprint.rows(footprintData)\r\n    int rowCount = array.size(rowsArray)\r\n    \r\n    for i = 0 to rowCount - 1\r\n        volume_row row = array.get(rowsArray, i)\r\n        \r\n        float buyVol  = volume_row.buy_volume(row)\r\n        float sellVol = volume_row.sell_volume(row)\r\n        float price   = getPrice(row) \r\n        \r\n        float totalRowVol = buyVol + sellVol\r\n        float netDelta    = buyVol - sellVol\r\n        float absDelta    = math.abs(netDelta)\r\n        \r\n        // --- Filter Logic ---\r\n        if totalRowVol >= minVolFilter and absDelta >= minDeltaFilter\r\n            \r\n            float buyRatio  = sellVol > 0 ? buyVol / sellVol : buyVol \r\n            float sellRatio = buyVol > 0 ? sellVol / buyVol : sellVol \r\n            \r\n            bool isBuyImbalance  = buyRatio >= imbalanceRatio\r\n            bool isSellImbalance = sellRatio >= imbalanceRatio\r\n            \r\n            if isBuyImbalance or isSellImbalance\r\n                // Create Bubble (Initial State)\r\n                // We create it with "tiny" size initially; it gets resized at the end of the script if Auto is On\r\n                lbl = label.new(\r\n                     x=bar_index, \r\n                     y=price, \r\n                     text="", \r\n                     style=label.style_circle,\r\n                     color=color.new(isBuyImbalance ? colBull : colBear, sizeFixedTransp),\r\n                     size=size.tiny,\r\n                     tooltip=(isBuyImbalance ? "Aggressive Buy" : "Aggressive Sell") + "\\nPrice: " + str.tostring(price) + "\\nVol: " + str.tostring(totalRowVol) + "\\nDelta: " + str.tostring(netDelta)\r\n                     )\r\n                \r\n                // Add to Cache\r\n                array.push(cache_lbl, lbl)\r\n                array.push(cache_vol, totalRowVol)\r\n                array.push(cache_is_bull, isBuyImbalance)\r\n                \r\n                // Maintain Cache Limit (fifo)\r\n                // We manually delete old labels to keep sync with our data arrays\r\n                if array.size(cache_lbl) > 500\r\n                    oldLbl = array.shift(cache_lbl)\r\n                    label.delete(oldLbl)\r\n                    array.shift(cache_vol)\r\n                    array.shift(cache_is_bull)\r\n\r\n// --- 5. Auto-Scaling & Redraw Logic ---\r\n// This runs on every bar update. We check the cache and update ALL visible bubbles.\r\nif array.size(cache_vol) > 0\r\n    \r\n    // Determine the Max Volume for the scale\r\n    float currentMax = maxVolHuge // Default to manual\r\n    if autoScale\r\n        // Find the absolute largest bubble currently stored in the cache\r\n        currentMax := array.max(cache_vol)\r\n    \r\n    // Update Loop: Apply new scale to all cached bubbles\r\n    // We only need to do this loop if AutoScale is ON or if we want to support dynamic transparency\r\n    if autoScale or volVisualMode == "Transparency Scaling"\r\n        for i = 0 to array.size(cache_lbl) - 1\r\n            lblVal  = array.get(cache_lbl, i)\r\n            volVal  = array.get(cache_vol, i)\r\n            isBull  = array.get(cache_is_bull, i)\r\n            \r\n            if volVisualMode == "Size Scaling"\r\n                // Update Size\r\n                newSz = calcSize(volVal, minVolFilter, currentMax)\r\n                label.set_size(lblVal, newSz)\r\n                // Ensure Transparency is fixed\r\n                label.set_color(lblVal, color.new(isBull ? colBull : colBear, sizeFixedTransp))\r\n                \r\n            else \r\n                // Update Transparency\r\n                newTransp = calcTransp(volVal, minVolFilter, currentMax, transpStart, transpEnd)\r\n                label.set_color(lblVal, color.new(isBull ? colBull : colBear, newTransp))\r\n                // Ensure Size is fixed\r\n                label.set_size(lblVal, transpFixedSize)\r\n\r\n// --- 6. Plot POC ---\r\nfloat pocLevel = na\r\nif showPOC and not na(footprintData)\r\n    pocLevel := getPrice(footprint.poc(footprintData))\r\n\r\nplot(pocLevel, "POC", color=color.gray, linewidth=1, style=plot.style_stepline)'
[DEBUG] save_script called: script_id=q6qYB7ZB title=Bookmap Footprint Imbalance Bubbles category=q6qYB7ZB force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\q6qYB7ZB_Bookmap_Footprint_Imbalance_Bubbles.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\q6qYB7ZB_Bookmap_Footprint_Imbalance_Bubbles.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 23:57:57 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 23:57:57 GMT' as: 2026-02-08T23:57:57+00:00
[DEBUG] Exact published date for header: 2026-02-08T23:57:57+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/eeIraeIq-MA-Labels-v8/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © nipoch\r\n\r\n//@version=6\r\nindicator("MA Labels v8", overlay=true)\r\n\r\n// --- DISPLAY SETTINGS ---\r\ngrp_display = "Display Settings"\r\nlbl_style = input.string("Text Only", "Chart Label Style", options=["Text Only", "Bubble"], group=grp_display, tooltip="Text Only: Transparent background, Colored text.\\nBubble: Colored background, White text.")\r\nlbl_offset = input.int(3, "Chart Label Offset", minval=0, group=grp_display, tooltip="Distance from the last bar to the chart label.")\r\nshow_scale_labels = input.bool(false, "Show Labels on Price Scale", group=grp_display, tooltip="Displays a label on the right Y-axis scale (price ruler) with a tracking line.")\r\nshow_current_tf = input.bool(false, "Show current timeframe", group=grp_display, tooltip="If disabled, current timeframe MA will be hidden.")\r\n\r\n// --- MONO COLOR SETTINGS ---\r\ngrp_mono = "Mono Color Settings"\r\nmono_enabled = input.bool(false, "Enable Mono Color", group=grp_mono, tooltip="If enabled, overrides individual MA colors with the single color below.")\r\nmono_color = input.color(color.gray, "Mono Color", group=grp_mono)\r\n\r\n// --- MA SETTINGS ---\r\n// MA 1 (15m)\r\ngrp_ma1 = "MA 1 (15m)"\r\nma1_enabled = input.bool(true, "Enabled", group=grp_ma1)\r\nma1_ind_color = input.color(color.blue, "Color", group=grp_ma1)\r\nma1_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma1)\r\nma1_length = input.int(200, "Length", group=grp_ma1)\r\nma1_tf = input.timeframe("15", "Timeframe", group=grp_ma1)\r\n\r\n// MA 2 (1h)\r\ngrp_ma2 = "MA 2 (1h)"\r\nma2_enabled = input.bool(true, "Enabled", group=grp_ma2)\r\nma2_ind_color = input.color(color.orange, "Color", group=grp_ma2)\r\nma2_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma2)\r\nma2_length = input.int(200, "Length", group=grp_ma2)\r\nma2_tf = input.timeframe("60", "Timeframe", group=grp_ma2)\r\n\r\n// MA 3 (4h)\r\ngrp_ma3 = "MA 3 (4h)"\r\nma3_enabled = input.bool(true, "Enabled", group=grp_ma3)\r\nma3_ind_color = input.color(color.green, "Color", group=grp_ma3)\r\nma3_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma3)\r\nma3_length = input.int(200, "Length", group=grp_ma3)\r\nma3_tf = input.timeframe("240", "Timeframe", group=grp_ma3)\r\n\r\n// MA 4 (12h)\r\ngrp_ma4 = "MA 4 (12h)"\r\nma4_enabled = input.bool(true, "Enabled", group=grp_ma4)\r\nma4_ind_color = input.color(color.red, "Color", group=grp_ma4)\r\nma4_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma4)\r\nma4_length = input.int(200, "Length", group=grp_ma4)\r\nma4_tf = input.timeframe("720", "Timeframe", group=grp_ma4)\r\n\r\n// MA 5 (2d)\r\ngrp_ma5 = "MA 5 (2d)"\r\nma5_enabled = input.bool(true, "Enabled", group=grp_ma5)\r\nma5_ind_color = input.color(color.purple, "Color", group=grp_ma5)\r\nma5_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma5)\r\nma5_length = input.int(200, "Length", group=grp_ma5)\r\nma5_tf = input.timeframe("2D", "Timeframe", group=grp_ma5)\r\n\r\n// MA 6 (Weekly)\r\ngrp_ma6 = "MA 6 (Weekly)"\r\nma6_enabled = input.bool(true, "Enabled", group=grp_ma6)\r\nma6_ind_color = input.color(color.teal, "Color", group=grp_ma6)\r\nma6_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma6)\r\nma6_length = input.int(200, "Length", group=grp_ma6)\r\nma6_tf = input.timeframe("1W", "Timeframe", group=grp_ma6)\r\n\r\n// --- FUNCTIONS ---\r\n\r\n// Determine final color (Mono vs Individual)\r\ngetFinalColor(indColor) =>\r\n    mono_enabled ? mono_color : indColor\r\n\r\n// Calculates MA based on type\r\ncalcMA(length, maType) =>\r\n    maType == "EMA" ? ta.ema(close, length) : ta.sma(close, length)\r\n\r\n// Dynamically formats the timeframe string into a readable label\r\nformatTimeframe(tf) =>\r\n    if str.contains(tf, "D") or str.contains(tf, "W") or str.contains(tf, "M") or str.contains(tf, "S")\r\n        tf\r\n    else\r\n        mins = str.tonumber(tf)\r\n        if not na(mins)\r\n            if mins >= 60 and mins % 60 == 0\r\n                str.tostring(mins / 60) + "h"\r\n            else\r\n                str.tostring(mins) + "m"\r\n        else\r\n            tf\r\n\r\n// Helper to determine Style and Color for Chart Labels\r\ngetLabelSettings(targetColor) =>\r\n    // Logic:\r\n    // If Text Only: BG is Transparent, Text is targetColor\r\n    // If Bubble:    BG is targetColor, Text is ALWAYS WHITE\r\n    if lbl_style == "Text Only"\r\n        [color.new(color.white, 100), targetColor, label.style_label_left]\r\n    else\r\n        [targetColor, color.white, label.style_label_left]\r\n\r\n// Helper to check if MA should be displayed\r\nshouldDisplay(enabled, tf) =>\r\n    enabled and (show_current_tf or (timeframe.in_seconds(tf) != timeframe.in_seconds(timeframe.period)))\r\n\r\n// --- CALCULATIONS ---\r\nma1_val = shouldDisplay(ma1_enabled, ma1_tf) ? request.security(syminfo.tickerid, ma1_tf, calcMA(ma1_length, ma1_type)) : na\r\nma2_val = shouldDisplay(ma2_enabled, ma2_tf) ? request.security(syminfo.tickerid, ma2_tf, calcMA(ma2_length, ma2_type)) : na\r\nma3_val = shouldDisplay(ma3_enabled, ma3_tf) ? request.security(syminfo.tickerid, ma3_tf, calcMA(ma3_length, ma3_type)) : na\r\nma4_val = shouldDisplay(ma4_enabled, ma4_tf) ? request.security(syminfo.tickerid, ma4_tf, calcMA(ma4_length, ma4_type)) : na\r\nma5_val = shouldDisplay(ma5_enabled, ma5_tf) ? request.security(syminfo.tickerid, ma5_tf, calcMA(ma5_length, ma5_type)) : na\r\nma6_val = shouldDisplay(ma6_enabled, ma6_tf) ? request.security(syminfo.tickerid, ma6_tf, calcMA(ma6_length, ma6_type)) : na\r\n\r\n// --- RESOLVE COLORS ---\r\nc1 = getFinalColor(ma1_ind_color)\r\nc2 = getFinalColor(ma2_ind_color)\r\nc3 = getFinalColor(ma3_ind_color)\r\nc4 = getFinalColor(ma4_ind_color)\r\nc5 = getFinalColor(ma5_ind_color)\r\nc6 = getFinalColor(ma6_ind_color)\r\n\r\n// --- SCALE LABELS (PLOT) ---\r\nplot(ma1_val, "MA 1 Scale", color=c1, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma2_val, "MA 2 Scale", color=c2, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma3_val, "MA 3 Scale", color=c3, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma4_val, "MA 4 Scale", color=c4, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma5_val, "MA 5 Scale", color=c5, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma6_val, "MA 6 Scale", color=c6, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\n\r\n// --- CHART LABELS (TEXT/BUBBLE) ---\r\nvar label lbl1 = na\r\nvar label lbl2 = na\r\nvar label lbl3 = na\r\nvar label lbl4 = na\r\nvar label lbl5 = na\r\nvar label lbl6 = na\r\n\r\nif barstate.islast\r\n    label.delete(lbl1)\r\n    label.delete(lbl2)\r\n    label.delete(lbl3)\r\n    label.delete(lbl4)\r\n    label.delete(lbl5)\r\n    label.delete(lbl6)\r\n    \r\n    x_pos = bar_index + lbl_offset\r\n    \r\n    if not na(ma1_val)\r\n        [bg, txt, sty] = getLabelSettings(c1)\r\n        lbl1 := label.new(x_pos, ma1_val, formatTimeframe(ma1_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n        \r\n    if not na(ma2_val)\r\n        [bg, txt, sty] = getLabelSettings(c2)\r\n        lbl2 := label.new(x_pos, ma2_val, formatTimeframe(ma2_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma3_val)\r\n        [bg, txt, sty] = getLabelSettings(c3)\r\n        lbl3 := label.new(x_pos, ma3_val, formatTimeframe(ma3_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma4_val)\r\n        [bg, txt, sty] = getLabelSettings(c4)\r\n        lbl4 := label.new(x_pos, ma4_val, formatTimeframe(ma4_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma5_val)\r\n        [bg, txt, sty] = getLabelSettings(c5)\r\n        lbl5 := label.new(x_pos, ma5_val, formatTimeframe(ma5_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n        \r\n    if not na(ma6_val)\r\n        [bg, txt, sty] = getLabelSettings(c6)\r\n        lbl6 := label.new(x_pos, ma6_val, formatTimeframe(ma6_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)'
[CAPTURE 1] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © nipoch\r\n\r\n//@version=6\r\nindicator("MA Labels v8", overlay=true)\r\n\r\n// --- DISPLAY SETTINGS ---\r\ngrp_display = "Display Settings"\r\nlbl_style = input.string("Text Only", "Chart Label Style", options=["Text Only", "Bubble"], group=grp_display, tooltip="Text Only: Transparent background, Colored text.\\nBubble: Colored background, White text.")\r\nlbl_offset = input.int(3, "Chart Label Offset", minval=0, group=grp_display, tooltip="Distance from the last bar to the chart label.")\r\nshow_scale_labels = input.bool(false, "Show Labels on Price Scale", group=grp_display, tooltip="Displays a label on the right Y-axis scale (price ruler) with a tracking line.")\r\nshow_current_tf = input.bool(false, "Show current timeframe", group=grp_display, tooltip="If disabled, current timeframe MA will be hidden.")\r\n\r\n// --- MONO COLOR SETTINGS ---\r\ngrp_mono = "Mono Color Settings"\r\nmono_enabled = input.bool(false, "Enable Mono Color", group=grp_mono, tooltip="If enabled, overrides individual MA colors with the single color below.")\r\nmono_color = input.color(color.gray, "Mono Color", group=grp_mono)\r\n\r\n// --- MA SETTINGS ---\r\n// MA 1 (15m)\r\ngrp_ma1 = "MA 1 (15m)"\r\nma1_enabled = input.bool(true, "Enabled", group=grp_ma1)\r\nma1_ind_color = input.color(color.blue, "Color", group=grp_ma1)\r\nma1_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma1)\r\nma1_length = input.int(200, "Length", group=grp_ma1)\r\nma1_tf = input.timeframe("15", "Timeframe", group=grp_ma1)\r\n\r\n// MA 2 (1h)\r\ngrp_ma2 = "MA 2 (1h)"\r\nma2_enabled = input.bool(true, "Enabled", group=grp_ma2)\r\nma2_ind_color = input.color(color.orange, "Color", group=grp_ma2)\r\nma2_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma2)\r\nma2_length = input.int(200, "Length", group=grp_ma2)\r\nma2_tf = input.timeframe("60", "Timeframe", group=grp_ma2)\r\n\r\n// MA 3 (4h)\r\ngrp_ma3 = "MA 3 (4h)"\r\nma3_enabled = input.bool(true, "Enabled", group=grp_ma3)\r\nma3_ind_color = input.color(color.green, "Color", group=grp_ma3)\r\nma3_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma3)\r\nma3_length = input.int(200, "Length", group=grp_ma3)\r\nma3_tf = input.timeframe("240", "Timeframe", group=grp_ma3)\r\n\r\n// MA 4 (12h)\r\ngrp_ma4 = "MA 4 (12h)"\r\nma4_enabled = input.bool(true, "Enabled", group=grp_ma4)\r\nma4_ind_color = input.color(color.red, "Color", group=grp_ma4)\r\nma4_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma4)\r\nma4_length = input.int(200, "Length", group=grp_ma4)\r\nma4_tf = input.timeframe("720", "Timeframe", group=grp_ma4)\r\n\r\n// MA 5 (2d)\r\ngrp_ma5 = "MA 5 (2d)"\r\nma5_enabled = input.bool(true, "Enabled", group=grp_ma5)\r\nma5_ind_color = input.color(color.purple, "Color", group=grp_ma5)\r\nma5_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma5)\r\nma5_length = input.int(200, "Length", group=grp_ma5)\r\nma5_tf = input.timeframe("2D", "Timeframe", group=grp_ma5)\r\n\r\n// MA 6 (Weekly)\r\ngrp_ma6 = "MA 6 (Weekly)"\r\nma6_enabled = input.bool(true, "Enabled", group=grp_ma6)\r\nma6_ind_color = input.color(color.teal, "Color", group=grp_ma6)\r\nma6_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma6)\r\nma6_length = input.int(200, "Length", group=grp_ma6)\r\nma6_tf = input.timeframe("1W", "Timeframe", group=grp_ma6)\r\n\r\n// --- FUNCTIONS ---\r\n\r\n// Determine final color (Mono vs Individual)\r\ngetFinalColor(indColor) =>\r\n    mono_enabled ? mono_color : indColor\r\n\r\n// Calculates MA based on type\r\ncalcMA(length, maType) =>\r\n    maType == "EMA" ? ta.ema(close, length) : ta.sma(close, length)\r\n\r\n// Dynamically formats the timeframe string into a readable label\r\nformatTimeframe(tf) =>\r\n    if str.contains(tf, "D") or str.contains(tf, "W") or str.contains(tf, "M") or str.contains(tf, "S")\r\n        tf\r\n    else\r\n        mins = str.tonumber(tf)\r\n        if not na(mins)\r\n            if mins >= 60 and mins % 60 == 0\r\n                str.tostring(mins / 60) + "h"\r\n            else\r\n                str.tostring(mins) + "m"\r\n        else\r\n            tf\r\n\r\n// Helper to determine Style and Color for Chart Labels\r\ngetLabelSettings(targetColor) =>\r\n    // Logic:\r\n    // If Text Only: BG is Transparent, Text is targetColor\r\n    // If Bubble:    BG is targetColor, Text is ALWAYS WHITE\r\n    if lbl_style == "Text Only"\r\n        [color.new(color.white, 100), targetColor, label.style_label_left]\r\n    else\r\n        [targetColor, color.white, label.style_label_left]\r\n\r\n// Helper to check if MA should be displayed\r\nshouldDisplay(enabled, tf) =>\r\n    enabled and (show_current_tf or (timeframe.in_seconds(tf) != timeframe.in_seconds(timeframe.period)))\r\n\r\n// --- CALCULATIONS ---\r\nma1_val = shouldDisplay(ma1_enabled, ma1_tf) ? request.security(syminfo.tickerid, ma1_tf, calcMA(ma1_length, ma1_type)) : na\r\nma2_val = shouldDisplay(ma2_enabled, ma2_tf) ? request.security(syminfo.tickerid, ma2_tf, calcMA(ma2_length, ma2_type)) : na\r\nma3_val = shouldDisplay(ma3_enabled, ma3_tf) ? request.security(syminfo.tickerid, ma3_tf, calcMA(ma3_length, ma3_type)) : na\r\nma4_val = shouldDisplay(ma4_enabled, ma4_tf) ? request.security(syminfo.tickerid, ma4_tf, calcMA(ma4_length, ma4_type)) : na\r\nma5_val = shouldDisplay(ma5_enabled, ma5_tf) ? request.security(syminfo.tickerid, ma5_tf, calcMA(ma5_length, ma5_type)) : na\r\nma6_val = shouldDisplay(ma6_enabled, ma6_tf) ? request.security(syminfo.tickerid, ma6_tf, calcMA(ma6_length, ma6_type)) : na\r\n\r\n// --- RESOLVE COLORS ---\r\nc1 = getFinalColor(ma1_ind_color)\r\nc2 = getFinalColor(ma2_ind_color)\r\nc3 = getFinalColor(ma3_ind_color)\r\nc4 = getFinalColor(ma4_ind_color)\r\nc5 = getFinalColor(ma5_ind_color)\r\nc6 = getFinalColor(ma6_ind_color)\r\n\r\n// --- SCALE LABELS (PLOT) ---\r\nplot(ma1_val, "MA 1 Scale", color=c1, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma2_val, "MA 2 Scale", color=c2, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma3_val, "MA 3 Scale", color=c3, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma4_val, "MA 4 Scale", color=c4, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma5_val, "MA 5 Scale", color=c5, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma6_val, "MA 6 Scale", color=c6, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\n\r\n// --- CHART LABELS (TEXT/BUBBLE) ---\r\nvar label lbl1 = na\r\nvar label lbl2 = na\r\nvar label lbl3 = na\r\nvar label lbl4 = na\r\nvar label lbl5 = na\r\nvar label lbl6 = na\r\n\r\nif barstate.islast\r\n    label.delete(lbl1)\r\n    label.delete(lbl2)\r\n    label.delete(lbl3)\r\n    label.delete(lbl4)\r\n    label.delete(lbl5)\r\n    label.delete(lbl6)\r\n    \r\n    x_pos = bar_index + lbl_offset\r\n    \r\n    if not na(ma1_val)\r\n        [bg, txt, sty] = getLabelSettings(c1)\r\n        lbl1 := label.new(x_pos, ma1_val, formatTimeframe(ma1_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n        \r\n    if not na(ma2_val)\r\n        [bg, txt, sty] = getLabelSettings(c2)\r\n        lbl2 := label.new(x_pos, ma2_val, formatTimeframe(ma2_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma3_val)\r\n        [bg, txt, sty] = getLabelSettings(c3)\r\n        lbl3 := label.new(x_pos, ma3_val, formatTimeframe(ma3_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma4_val)\r\n        [bg, txt, sty] = getLabelSettings(c4)\r\n        lbl4 := label.new(x_pos, ma4_val, formatTimeframe(ma4_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma5_val)\r\n        [bg, txt, sty] = getLabelSettings(c5)\r\n        lbl5 := label.new(x_pos, ma5_val, formatTimeframe(ma5_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n        \r\n    if not na(ma6_val)\r\n        [bg, txt, sty] = getLabelSettings(c6)\r\n        lbl6 := label.new(x_pos, ma6_val, formatTimeframe(ma6_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)'
[CAPTURE 2] '// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\r\n// © nipoch\r\n\r\n//@version=6\r\nindicator("MA Labels v8", overlay=true)\r\n\r\n// --- DISPLAY SETTINGS ---\r\ngrp_display = "Display Settings"\r\nlbl_style = input.string("Text Only", "Chart Label Style", options=["Text Only", "Bubble"], group=grp_display, tooltip="Text Only: Transparent background, Colored text.\\nBubble: Colored background, White text.")\r\nlbl_offset = input.int(3, "Chart Label Offset", minval=0, group=grp_display, tooltip="Distance from the last bar to the chart label.")\r\nshow_scale_labels = input.bool(false, "Show Labels on Price Scale", group=grp_display, tooltip="Displays a label on the right Y-axis scale (price ruler) with a tracking line.")\r\nshow_current_tf = input.bool(false, "Show current timeframe", group=grp_display, tooltip="If disabled, current timeframe MA will be hidden.")\r\n\r\n// --- MONO COLOR SETTINGS ---\r\ngrp_mono = "Mono Color Settings"\r\nmono_enabled = input.bool(false, "Enable Mono Color", group=grp_mono, tooltip="If enabled, overrides individual MA colors with the single color below.")\r\nmono_color = input.color(color.gray, "Mono Color", group=grp_mono)\r\n\r\n// --- MA SETTINGS ---\r\n// MA 1 (15m)\r\ngrp_ma1 = "MA 1 (15m)"\r\nma1_enabled = input.bool(true, "Enabled", group=grp_ma1)\r\nma1_ind_color = input.color(color.blue, "Color", group=grp_ma1)\r\nma1_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma1)\r\nma1_length = input.int(200, "Length", group=grp_ma1)\r\nma1_tf = input.timeframe("15", "Timeframe", group=grp_ma1)\r\n\r\n// MA 2 (1h)\r\ngrp_ma2 = "MA 2 (1h)"\r\nma2_enabled = input.bool(true, "Enabled", group=grp_ma2)\r\nma2_ind_color = input.color(color.orange, "Color", group=grp_ma2)\r\nma2_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma2)\r\nma2_length = input.int(200, "Length", group=grp_ma2)\r\nma2_tf = input.timeframe("60", "Timeframe", group=grp_ma2)\r\n\r\n// MA 3 (4h)\r\ngrp_ma3 = "MA 3 (4h)"\r\nma3_enabled = input.bool(true, "Enabled", group=grp_ma3)\r\nma3_ind_color = input.color(color.green, "Color", group=grp_ma3)\r\nma3_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma3)\r\nma3_length = input.int(200, "Length", group=grp_ma3)\r\nma3_tf = input.timeframe("240", "Timeframe", group=grp_ma3)\r\n\r\n// MA 4 (12h)\r\ngrp_ma4 = "MA 4 (12h)"\r\nma4_enabled = input.bool(true, "Enabled", group=grp_ma4)\r\nma4_ind_color = input.color(color.red, "Color", group=grp_ma4)\r\nma4_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma4)\r\nma4_length = input.int(200, "Length", group=grp_ma4)\r\nma4_tf = input.timeframe("720", "Timeframe", group=grp_ma4)\r\n\r\n// MA 5 (2d)\r\ngrp_ma5 = "MA 5 (2d)"\r\nma5_enabled = input.bool(true, "Enabled", group=grp_ma5)\r\nma5_ind_color = input.color(color.purple, "Color", group=grp_ma5)\r\nma5_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma5)\r\nma5_length = input.int(200, "Length", group=grp_ma5)\r\nma5_tf = input.timeframe("2D", "Timeframe", group=grp_ma5)\r\n\r\n// MA 6 (Weekly)\r\ngrp_ma6 = "MA 6 (Weekly)"\r\nma6_enabled = input.bool(true, "Enabled", group=grp_ma6)\r\nma6_ind_color = input.color(color.teal, "Color", group=grp_ma6)\r\nma6_type = input.string("EMA", "Type", options=["EMA", "SMA"], group=grp_ma6)\r\nma6_length = input.int(200, "Length", group=grp_ma6)\r\nma6_tf = input.timeframe("1W", "Timeframe", group=grp_ma6)\r\n\r\n// --- FUNCTIONS ---\r\n\r\n// Determine final color (Mono vs Individual)\r\ngetFinalColor(indColor) =>\r\n    mono_enabled ? mono_color : indColor\r\n\r\n// Calculates MA based on type\r\ncalcMA(length, maType) =>\r\n    maType == "EMA" ? ta.ema(close, length) : ta.sma(close, length)\r\n\r\n// Dynamically formats the timeframe string into a readable label\r\nformatTimeframe(tf) =>\r\n    if str.contains(tf, "D") or str.contains(tf, "W") or str.contains(tf, "M") or str.contains(tf, "S")\r\n        tf\r\n    else\r\n        mins = str.tonumber(tf)\r\n        if not na(mins)\r\n            if mins >= 60 and mins % 60 == 0\r\n                str.tostring(mins / 60) + "h"\r\n            else\r\n                str.tostring(mins) + "m"\r\n        else\r\n            tf\r\n\r\n// Helper to determine Style and Color for Chart Labels\r\ngetLabelSettings(targetColor) =>\r\n    // Logic:\r\n    // If Text Only: BG is Transparent, Text is targetColor\r\n    // If Bubble:    BG is targetColor, Text is ALWAYS WHITE\r\n    if lbl_style == "Text Only"\r\n        [color.new(color.white, 100), targetColor, label.style_label_left]\r\n    else\r\n        [targetColor, color.white, label.style_label_left]\r\n\r\n// Helper to check if MA should be displayed\r\nshouldDisplay(enabled, tf) =>\r\n    enabled and (show_current_tf or (timeframe.in_seconds(tf) != timeframe.in_seconds(timeframe.period)))\r\n\r\n// --- CALCULATIONS ---\r\nma1_val = shouldDisplay(ma1_enabled, ma1_tf) ? request.security(syminfo.tickerid, ma1_tf, calcMA(ma1_length, ma1_type)) : na\r\nma2_val = shouldDisplay(ma2_enabled, ma2_tf) ? request.security(syminfo.tickerid, ma2_tf, calcMA(ma2_length, ma2_type)) : na\r\nma3_val = shouldDisplay(ma3_enabled, ma3_tf) ? request.security(syminfo.tickerid, ma3_tf, calcMA(ma3_length, ma3_type)) : na\r\nma4_val = shouldDisplay(ma4_enabled, ma4_tf) ? request.security(syminfo.tickerid, ma4_tf, calcMA(ma4_length, ma4_type)) : na\r\nma5_val = shouldDisplay(ma5_enabled, ma5_tf) ? request.security(syminfo.tickerid, ma5_tf, calcMA(ma5_length, ma5_type)) : na\r\nma6_val = shouldDisplay(ma6_enabled, ma6_tf) ? request.security(syminfo.tickerid, ma6_tf, calcMA(ma6_length, ma6_type)) : na\r\n\r\n// --- RESOLVE COLORS ---\r\nc1 = getFinalColor(ma1_ind_color)\r\nc2 = getFinalColor(ma2_ind_color)\r\nc3 = getFinalColor(ma3_ind_color)\r\nc4 = getFinalColor(ma4_ind_color)\r\nc5 = getFinalColor(ma5_ind_color)\r\nc6 = getFinalColor(ma6_ind_color)\r\n\r\n// --- SCALE LABELS (PLOT) ---\r\nplot(ma1_val, "MA 1 Scale", color=c1, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma2_val, "MA 2 Scale", color=c2, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma3_val, "MA 3 Scale", color=c3, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma4_val, "MA 4 Scale", color=c4, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma5_val, "MA 5 Scale", color=c5, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\nplot(ma6_val, "MA 6 Scale", color=c6, trackprice=show_scale_labels, display=show_scale_labels ? display.price_scale : display.none)\r\n\r\n// --- CHART LABELS (TEXT/BUBBLE) ---\r\nvar label lbl1 = na\r\nvar label lbl2 = na\r\nvar label lbl3 = na\r\nvar label lbl4 = na\r\nvar label lbl5 = na\r\nvar label lbl6 = na\r\n\r\nif barstate.islast\r\n    label.delete(lbl1)\r\n    label.delete(lbl2)\r\n    label.delete(lbl3)\r\n    label.delete(lbl4)\r\n    label.delete(lbl5)\r\n    label.delete(lbl6)\r\n    \r\n    x_pos = bar_index + lbl_offset\r\n    \r\n    if not na(ma1_val)\r\n        [bg, txt, sty] = getLabelSettings(c1)\r\n        lbl1 := label.new(x_pos, ma1_val, formatTimeframe(ma1_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n        \r\n    if not na(ma2_val)\r\n        [bg, txt, sty] = getLabelSettings(c2)\r\n        lbl2 := label.new(x_pos, ma2_val, formatTimeframe(ma2_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma3_val)\r\n        [bg, txt, sty] = getLabelSettings(c3)\r\n        lbl3 := label.new(x_pos, ma3_val, formatTimeframe(ma3_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma4_val)\r\n        [bg, txt, sty] = getLabelSettings(c4)\r\n        lbl4 := label.new(x_pos, ma4_val, formatTimeframe(ma4_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n\r\n    if not na(ma5_val)\r\n        [bg, txt, sty] = getLabelSettings(c5)\r\n        lbl5 := label.new(x_pos, ma5_val, formatTimeframe(ma5_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)\r\n        \r\n    if not na(ma6_val)\r\n        [bg, txt, sty] = getLabelSettings(c6)\r\n        lbl6 := label.new(x_pos, ma6_val, formatTimeframe(ma6_tf), xloc=xloc.bar_index, color=bg, textcolor=txt, style=sty)'
[DEBUG] save_script called: script_id=eeIraeIq title=MA Labels v8 category=eeIraeIq force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\eeIraeIq_MA_Labels_v8.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\eeIraeIq_MA_Labels_v8.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 23:14:43 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 23:14:43 GMT' as: 2026-02-08T23:14:43+00:00
[DEBUG] Exact published date for header: 2026-02-08T23:14:43+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/E3KHrN52/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
// This source code is subject to the terms of the GNU License 2.0 at https://www.gnu.org/licenses/old-licenses/gpl-
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '// This source code is subject to the terms of the GNU License 2.0 at https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html\r\n// © Kronight\r\n\r\n//@version=6\r\nindicator(\'Inside/Outside Bar Highlight\', overlay = true)\r\n\r\nbullishIBar = 1\r\nbearishIBar = -1\r\n\r\nbullishOBar = 1\r\nbearishOBar = -1\r\n\r\nisInside() =>\r\n    previousBar = 1\r\n    bodyStatus = close >= open ? 1 : -1\r\n    isInsidePattern = high < high[previousBar] and low > low[previousBar]\r\n\r\n    isInsidePattern ? bodyStatus : 0\r\n\r\nisOutside() =>\r\n    previousBar = 1\r\n    bodyStatus = close >= open ? 1 : -1\r\n    isOutsidePattern = high > high[previousBar] and low < low[previousBar]\r\n\r\n    isOutsidePattern ? bodyStatus : 0\r\n\r\nbarcolor(isInside() == bullishIBar ? color.rgb(82, 175, 82, 100) : na, 0, true, 220, "BullishIBar")\r\nbarcolor(isInside() == bearishIBar ? color.rgb(255, 82, 82, 100) : na, 0, true, 220, "BearishIBar")\r\n\r\nbarcolor(isOutside() == bullishOBar ? #1b5e20 : na, 0, true, 220, "BullishOBar")\r\nbarcolor(isOutside() == bearishOBar ? #b22833 : na, 0, true, 220, "BearishOBar")\r\n'
[CAPTURE 1] '// This source code is subject to the terms of the GNU License 2.0 at https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html\r\n// © Kronight\r\n\r\n//@version=6\r\nindicator(\'Inside/Outside Bar Highlight\', overlay = true)\r\n\r\nbullishIBar = 1\r\nbearishIBar = -1\r\n\r\nbullishOBar = 1\r\nbearishOBar = -1\r\n\r\nisInside() =>\r\n    previousBar = 1\r\n    bodyStatus = close >= open ? 1 : -1\r\n    isInsidePattern = high < high[previousBar] and low > low[previousBar]\r\n\r\n    isInsidePattern ? bodyStatus : 0\r\n\r\nisOutside() =>\r\n    previousBar = 1\r\n    bodyStatus = close >= open ? 1 : -1\r\n    isOutsidePattern = high > high[previousBar] and low < low[previousBar]\r\n\r\n    isOutsidePattern ? bodyStatus : 0\r\n\r\nbarcolor(isInside() == bullishIBar ? color.rgb(82, 175, 82, 100) : na, 0, true, 220, "BullishIBar")\r\nbarcolor(isInside() == bearishIBar ? color.rgb(255, 82, 82, 100) : na, 0, true, 220, "BearishIBar")\r\n\r\nbarcolor(isOutside() == bullishOBar ? #1b5e20 : na, 0, true, 220, "BullishOBar")\r\nbarcolor(isOutside() == bearishOBar ? #b22833 : na, 0, true, 220, "BearishOBar")\r\n'
[CAPTURE 2] '// This source code is subject to the terms of the GNU License 2.0 at https://www.gnu.org/licenses/old-licenses/gpl-2.0.en.html\r\n// © Kronight\r\n\r\n//@version=6\r\nindicator(\'Inside/Outside Bar Highlight\', overlay = true)\r\n\r\nbullishIBar = 1\r\nbearishIBar = -1\r\n\r\nbullishOBar = 1\r\nbearishOBar = -1\r\n\r\nisInside() =>\r\n    previousBar = 1\r\n    bodyStatus = close >= open ? 1 : -1\r\n    isInsidePattern = high < high[previousBar] and low > low[previousBar]\r\n\r\n    isInsidePattern ? bodyStatus : 0\r\n\r\nisOutside() =>\r\n    previousBar = 1\r\n    bodyStatus = close >= open ? 1 : -1\r\n    isOutsidePattern = high > high[previousBar] and low < low[previousBar]\r\n\r\n    isOutsidePattern ? bodyStatus : 0\r\n\r\nbarcolor(isInside() == bullishIBar ? color.rgb(82, 175, 82, 100) : na, 0, true, 220, "BullishIBar")\r\nbarcolor(isInside() == bearishIBar ? color.rgb(255, 82, 82, 100) : na, 0, true, 220, "BearishIBar")\r\n\r\nbarcolor(isOutside() == bullishOBar ? #1b5e20 : na, 0, true, 220, "BullishOBar")\r\nbarcolor(isOutside() == bearishOBar ? #b22833 : na, 0, true, 220, "BearishOBar")\r\n'
[DEBUG] save_script called: script_id=E3KHrN52 title=Inside/Outside Bar Highlight category=E3KHrN52 force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\E3KHrN52_InsideOutside_Bar_Highlight.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\E3KHrN52_InsideOutside_Bar_Highlight.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 22:58:35 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 22:58:35 GMT' as: 2026-02-08T22:58:35+00:00
[DEBUG] Exact published date for header: 2026-02-08T22:58:35+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/WQkwVici-All-in-one-Dynamic-Trade-Sessions/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\r\nindicator("Fusion Strategy V5 [Dynamic Trade Sessions]", overlay=true, max_lines_count=500, max_labels_count=500)\r\n\r\n// --- 1. SETTINGS ---\r\n// Strategy Settings\r\nema_len = input.int(50, "Trend Filter (EMA)")\r\nrsi_len = input.int(7, "RSI Length")\r\natr_len = input.int(14, "ATR Length (Risk)")\r\nrr_ratio = input.float(2.0, "Risk:Reward Ratio")\r\n\r\n// --- 2. CALCULATIONS ---\r\n// Trend & Momentum\r\ntrend_ema = ta.ema(close, ema_len)\r\nrsi = ta.rsi(close, rsi_len)\r\natr = ta.atr(atr_len)\r\n[macdLine, signalLine, _] = ta.macd(close, 12, 26, 9)\r\n\r\n// --- 3. DYNAMIC SESSION LOGIC ---\r\n// A "Trade Session" is defined by MOMENTUM, not time.\r\n// If RSI is stuck between 45 and 55, the session is CLOSED (Chop).\r\n// If RSI breaks out, the session is OPEN.\r\n\r\nis_chop = rsi > 45 and rsi < 55\r\nis_trending = not is_chop\r\n\r\n// Count how long the current session has lasted\r\nvar int session_duration = 0\r\nif is_trending\r\n    session_duration := session_duration + 1\r\nelse\r\n    session_duration := 0\r\n\r\n// Background Colors for Dynamic Sessions\r\n// Blue = Active Trade Session (Momentum is present)\r\n// Grey = Dead Zone (Chop)\r\nbgcolor(is_trending ? color.new(color.blue, 90) : color.new(color.gray, 90))\r\n\r\n// --- 4. TRADE SIGNALS ---\r\n// Long Condition\r\nlong_cond = ta.crossover(macdLine, signalLine) and close > trend_ema and rsi > 50 and is_trending\r\n\r\n// Short Condition\r\nshort_cond = ta.crossunder(macdLine, signalLine) and close < trend_ema and rsi < 50 and is_trending\r\n\r\n// --- 5. VISUALS ---\r\n// Color Bars based on session status\r\nbarcolor(is_chop ? color.gray : na)\r\n\r\n// Plot Trend Line\r\nplot(trend_ema, "Trend EMA", color=color.white, linewidth=2)\r\n\r\n// --- 6. TRADE MANAGEMENT & LABELS ---\r\nvar float entry_price = na\r\nvar float stop_price = na\r\nvar float tp_price = na\r\n\r\nif long_cond\r\n    entry_price := close\r\n    stop_price := close - (atr * 1.5)\r\n    dist = close - stop_price\r\n    tp_price := close + (dist * rr_ratio)\r\n    \r\n    // Labels\r\n    label.new(bar_index, stop_price, "1. SL: " + str.tostring(stop_price, format.mintick), color=color.red, style=label.style_label_up, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, entry_price, "2. ENTRY: " + str.tostring(entry_price, format.mintick), color=color.blue, style=label.style_label_left, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "3. TP: " + str.tostring(tp_price, format.mintick), color=color.green, style=label.style_label_down, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "4. RR: 1:" + str.tostring(rr_ratio), color=color.new(color.yellow, 0), style=label.style_label_lower_right, textcolor=color.black, size=size.small)\r\n\r\nif short_cond\r\n    entry_price := close\r\n    stop_price := close + (atr * 1.5)\r\n    dist = stop_price - close\r\n    tp_price := close - (dist * rr_ratio)\r\n\r\n    // Labels\r\n    label.new(bar_index, stop_price, "1. SL: " + str.tostring(stop_price, format.mintick), color=color.red, style=label.style_label_down, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, entry_price, "2. ENTRY: " + str.tostring(entry_price, format.mintick), color=color.blue, style=label.style_label_left, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "3. TP: " + str.tostring(tp_price, format.mintick), color=color.green, style=label.style_label_up, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "4. RR: 1:" + str.tostring(rr_ratio), color=color.new(color.yellow, 0), style=label.style_label_upper_right, textcolor=color.black, size=size.small)\r\n\r\n// --- 7. INTELLIGENT DASHBOARD ---\r\nvar tbl = table.new(position.top_right, 2, 7, bgcolor=color.new(color.black, 40), frame_color=color.gray, frame_width=1)\r\n\r\n// Determine Session Status Text\r\nstring sess_txt = "DEAD / CHOP"\r\ncolor sess_col = color.gray\r\n\r\nif is_trending\r\n    sess_txt := "ACTIVE: " + str.tostring(session_duration) + " BARS"\r\n    sess_col := color.blue\r\nelse\r\n    sess_txt := "WAITING..."\r\n    sess_col := color.gray\r\n\r\n// Determine Trend Status\r\nstring status_txt = "NEUTRAL"\r\ncolor status_bg = color.gray\r\n\r\nif close > trend_ema\r\n    status_txt := "BULLISH"\r\n    status_bg := color.green\r\nelse\r\n    status_txt := "BEARISH"\r\n    status_bg := color.red\r\n\r\nif barstate.islast\r\n    // Header\r\n    table.cell(tbl, 0, 0, "FUSION V5", text_color=color.white, bgcolor=color.black)\r\n    \r\n    // Row 1: Session Duration (NEW)\r\n    table.cell(tbl, 0, 1, "MOMENTUM SESSION", text_color=color.white, bgcolor=sess_col)\r\n    table.cell(tbl, 1, 1, sess_txt, text_color=color.white, bgcolor=sess_col)\r\n\r\n    // Row 2: Market Status\r\n    table.cell(tbl, 0, 2, "TREND", text_color=color.white, bgcolor=status_bg)\r\n    table.cell(tbl, 1, 2, status_txt, text_color=color.white, bgcolor=status_bg)\r\n    \r\n    // Row 3: Stop Loss\r\n    table.cell(tbl, 0, 3, "1. STOP LOSS", text_color=color.red)\r\n    table.cell(tbl, 1, 3, str.tostring(stop_price, format.mintick), text_color=color.red)\r\n\r\n    // Row 4: Entry\r\n    table.cell(tbl, 0, 4, "2. ENTRY", text_color=color.white)\r\n    table.cell(tbl, 1, 4, str.tostring(entry_price, format.mintick), text_color=color.white)\r\n    \r\n    // Row 5: Take Profit\r\n    table.cell(tbl, 0, 5, "3. TAKE PROFIT", text_color=color.green)\r\n    table.cell(tbl, 1, 5, str.tostring(tp_price, format.mintick), text_color=color.green)\r\n    \r\n    // Row 6: RR Ratio\r\n    table.cell(tbl, 0, 6, "4. RR RATIO", text_color=color.yellow)\r\n    table.cell(tbl, 1, 6, "1 : " + str.tostring(rr_ratio), text_color=color.yellow)\r\n\r\n'
[CAPTURE 1] '//@version=5\r\nindicator("Fusion Strategy V5 [Dynamic Trade Sessions]", overlay=true, max_lines_count=500, max_labels_count=500)\r\n\r\n// --- 1. SETTINGS ---\r\n// Strategy Settings\r\nema_len = input.int(50, "Trend Filter (EMA)")\r\nrsi_len = input.int(7, "RSI Length")\r\natr_len = input.int(14, "ATR Length (Risk)")\r\nrr_ratio = input.float(2.0, "Risk:Reward Ratio")\r\n\r\n// --- 2. CALCULATIONS ---\r\n// Trend & Momentum\r\ntrend_ema = ta.ema(close, ema_len)\r\nrsi = ta.rsi(close, rsi_len)\r\natr = ta.atr(atr_len)\r\n[macdLine, signalLine, _] = ta.macd(close, 12, 26, 9)\r\n\r\n// --- 3. DYNAMIC SESSION LOGIC ---\r\n// A "Trade Session" is defined by MOMENTUM, not time.\r\n// If RSI is stuck between 45 and 55, the session is CLOSED (Chop).\r\n// If RSI breaks out, the session is OPEN.\r\n\r\nis_chop = rsi > 45 and rsi < 55\r\nis_trending = not is_chop\r\n\r\n// Count how long the current session has lasted\r\nvar int session_duration = 0\r\nif is_trending\r\n    session_duration := session_duration + 1\r\nelse\r\n    session_duration := 0\r\n\r\n// Background Colors for Dynamic Sessions\r\n// Blue = Active Trade Session (Momentum is present)\r\n// Grey = Dead Zone (Chop)\r\nbgcolor(is_trending ? color.new(color.blue, 90) : color.new(color.gray, 90))\r\n\r\n// --- 4. TRADE SIGNALS ---\r\n// Long Condition\r\nlong_cond = ta.crossover(macdLine, signalLine) and close > trend_ema and rsi > 50 and is_trending\r\n\r\n// Short Condition\r\nshort_cond = ta.crossunder(macdLine, signalLine) and close < trend_ema and rsi < 50 and is_trending\r\n\r\n// --- 5. VISUALS ---\r\n// Color Bars based on session status\r\nbarcolor(is_chop ? color.gray : na)\r\n\r\n// Plot Trend Line\r\nplot(trend_ema, "Trend EMA", color=color.white, linewidth=2)\r\n\r\n// --- 6. TRADE MANAGEMENT & LABELS ---\r\nvar float entry_price = na\r\nvar float stop_price = na\r\nvar float tp_price = na\r\n\r\nif long_cond\r\n    entry_price := close\r\n    stop_price := close - (atr * 1.5)\r\n    dist = close - stop_price\r\n    tp_price := close + (dist * rr_ratio)\r\n    \r\n    // Labels\r\n    label.new(bar_index, stop_price, "1. SL: " + str.tostring(stop_price, format.mintick), color=color.red, style=label.style_label_up, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, entry_price, "2. ENTRY: " + str.tostring(entry_price, format.mintick), color=color.blue, style=label.style_label_left, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "3. TP: " + str.tostring(tp_price, format.mintick), color=color.green, style=label.style_label_down, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "4. RR: 1:" + str.tostring(rr_ratio), color=color.new(color.yellow, 0), style=label.style_label_lower_right, textcolor=color.black, size=size.small)\r\n\r\nif short_cond\r\n    entry_price := close\r\n    stop_price := close + (atr * 1.5)\r\n    dist = stop_price - close\r\n    tp_price := close - (dist * rr_ratio)\r\n\r\n    // Labels\r\n    label.new(bar_index, stop_price, "1. SL: " + str.tostring(stop_price, format.mintick), color=color.red, style=label.style_label_down, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, entry_price, "2. ENTRY: " + str.tostring(entry_price, format.mintick), color=color.blue, style=label.style_label_left, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "3. TP: " + str.tostring(tp_price, format.mintick), color=color.green, style=label.style_label_up, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "4. RR: 1:" + str.tostring(rr_ratio), color=color.new(color.yellow, 0), style=label.style_label_upper_right, textcolor=color.black, size=size.small)\r\n\r\n// --- 7. INTELLIGENT DASHBOARD ---\r\nvar tbl = table.new(position.top_right, 2, 7, bgcolor=color.new(color.black, 40), frame_color=color.gray, frame_width=1)\r\n\r\n// Determine Session Status Text\r\nstring sess_txt = "DEAD / CHOP"\r\ncolor sess_col = color.gray\r\n\r\nif is_trending\r\n    sess_txt := "ACTIVE: " + str.tostring(session_duration) + " BARS"\r\n    sess_col := color.blue\r\nelse\r\n    sess_txt := "WAITING..."\r\n    sess_col := color.gray\r\n\r\n// Determine Trend Status\r\nstring status_txt = "NEUTRAL"\r\ncolor status_bg = color.gray\r\n\r\nif close > trend_ema\r\n    status_txt := "BULLISH"\r\n    status_bg := color.green\r\nelse\r\n    status_txt := "BEARISH"\r\n    status_bg := color.red\r\n\r\nif barstate.islast\r\n    // Header\r\n    table.cell(tbl, 0, 0, "FUSION V5", text_color=color.white, bgcolor=color.black)\r\n    \r\n    // Row 1: Session Duration (NEW)\r\n    table.cell(tbl, 0, 1, "MOMENTUM SESSION", text_color=color.white, bgcolor=sess_col)\r\n    table.cell(tbl, 1, 1, sess_txt, text_color=color.white, bgcolor=sess_col)\r\n\r\n    // Row 2: Market Status\r\n    table.cell(tbl, 0, 2, "TREND", text_color=color.white, bgcolor=status_bg)\r\n    table.cell(tbl, 1, 2, status_txt, text_color=color.white, bgcolor=status_bg)\r\n    \r\n    // Row 3: Stop Loss\r\n    table.cell(tbl, 0, 3, "1. STOP LOSS", text_color=color.red)\r\n    table.cell(tbl, 1, 3, str.tostring(stop_price, format.mintick), text_color=color.red)\r\n\r\n    // Row 4: Entry\r\n    table.cell(tbl, 0, 4, "2. ENTRY", text_color=color.white)\r\n    table.cell(tbl, 1, 4, str.tostring(entry_price, format.mintick), text_color=color.white)\r\n    \r\n    // Row 5: Take Profit\r\n    table.cell(tbl, 0, 5, "3. TAKE PROFIT", text_color=color.green)\r\n    table.cell(tbl, 1, 5, str.tostring(tp_price, format.mintick), text_color=color.green)\r\n    \r\n    // Row 6: RR Ratio\r\n    table.cell(tbl, 0, 6, "4. RR RATIO", text_color=color.yellow)\r\n    table.cell(tbl, 1, 6, "1 : " + str.tostring(rr_ratio), text_color=color.yellow)\r\n\r\n'
[CAPTURE 2] '//@version=5\r\nindicator("Fusion Strategy V5 [Dynamic Trade Sessions]", overlay=true, max_lines_count=500, max_labels_count=500)\r\n\r\n// --- 1. SETTINGS ---\r\n// Strategy Settings\r\nema_len = input.int(50, "Trend Filter (EMA)")\r\nrsi_len = input.int(7, "RSI Length")\r\natr_len = input.int(14, "ATR Length (Risk)")\r\nrr_ratio = input.float(2.0, "Risk:Reward Ratio")\r\n\r\n// --- 2. CALCULATIONS ---\r\n// Trend & Momentum\r\ntrend_ema = ta.ema(close, ema_len)\r\nrsi = ta.rsi(close, rsi_len)\r\natr = ta.atr(atr_len)\r\n[macdLine, signalLine, _] = ta.macd(close, 12, 26, 9)\r\n\r\n// --- 3. DYNAMIC SESSION LOGIC ---\r\n// A "Trade Session" is defined by MOMENTUM, not time.\r\n// If RSI is stuck between 45 and 55, the session is CLOSED (Chop).\r\n// If RSI breaks out, the session is OPEN.\r\n\r\nis_chop = rsi > 45 and rsi < 55\r\nis_trending = not is_chop\r\n\r\n// Count how long the current session has lasted\r\nvar int session_duration = 0\r\nif is_trending\r\n    session_duration := session_duration + 1\r\nelse\r\n    session_duration := 0\r\n\r\n// Background Colors for Dynamic Sessions\r\n// Blue = Active Trade Session (Momentum is present)\r\n// Grey = Dead Zone (Chop)\r\nbgcolor(is_trending ? color.new(color.blue, 90) : color.new(color.gray, 90))\r\n\r\n// --- 4. TRADE SIGNALS ---\r\n// Long Condition\r\nlong_cond = ta.crossover(macdLine, signalLine) and close > trend_ema and rsi > 50 and is_trending\r\n\r\n// Short Condition\r\nshort_cond = ta.crossunder(macdLine, signalLine) and close < trend_ema and rsi < 50 and is_trending\r\n\r\n// --- 5. VISUALS ---\r\n// Color Bars based on session status\r\nbarcolor(is_chop ? color.gray : na)\r\n\r\n// Plot Trend Line\r\nplot(trend_ema, "Trend EMA", color=color.white, linewidth=2)\r\n\r\n// --- 6. TRADE MANAGEMENT & LABELS ---\r\nvar float entry_price = na\r\nvar float stop_price = na\r\nvar float tp_price = na\r\n\r\nif long_cond\r\n    entry_price := close\r\n    stop_price := close - (atr * 1.5)\r\n    dist = close - stop_price\r\n    tp_price := close + (dist * rr_ratio)\r\n    \r\n    // Labels\r\n    label.new(bar_index, stop_price, "1. SL: " + str.tostring(stop_price, format.mintick), color=color.red, style=label.style_label_up, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, entry_price, "2. ENTRY: " + str.tostring(entry_price, format.mintick), color=color.blue, style=label.style_label_left, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "3. TP: " + str.tostring(tp_price, format.mintick), color=color.green, style=label.style_label_down, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "4. RR: 1:" + str.tostring(rr_ratio), color=color.new(color.yellow, 0), style=label.style_label_lower_right, textcolor=color.black, size=size.small)\r\n\r\nif short_cond\r\n    entry_price := close\r\n    stop_price := close + (atr * 1.5)\r\n    dist = stop_price - close\r\n    tp_price := close - (dist * rr_ratio)\r\n\r\n    // Labels\r\n    label.new(bar_index, stop_price, "1. SL: " + str.tostring(stop_price, format.mintick), color=color.red, style=label.style_label_down, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, entry_price, "2. ENTRY: " + str.tostring(entry_price, format.mintick), color=color.blue, style=label.style_label_left, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "3. TP: " + str.tostring(tp_price, format.mintick), color=color.green, style=label.style_label_up, textcolor=color.white, size=size.small)\r\n    label.new(bar_index, tp_price, "4. RR: 1:" + str.tostring(rr_ratio), color=color.new(color.yellow, 0), style=label.style_label_upper_right, textcolor=color.black, size=size.small)\r\n\r\n// --- 7. INTELLIGENT DASHBOARD ---\r\nvar tbl = table.new(position.top_right, 2, 7, bgcolor=color.new(color.black, 40), frame_color=color.gray, frame_width=1)\r\n\r\n// Determine Session Status Text\r\nstring sess_txt = "DEAD / CHOP"\r\ncolor sess_col = color.gray\r\n\r\nif is_trending\r\n    sess_txt := "ACTIVE: " + str.tostring(session_duration) + " BARS"\r\n    sess_col := color.blue\r\nelse\r\n    sess_txt := "WAITING..."\r\n    sess_col := color.gray\r\n\r\n// Determine Trend Status\r\nstring status_txt = "NEUTRAL"\r\ncolor status_bg = color.gray\r\n\r\nif close > trend_ema\r\n    status_txt := "BULLISH"\r\n    status_bg := color.green\r\nelse\r\n    status_txt := "BEARISH"\r\n    status_bg := color.red\r\n\r\nif barstate.islast\r\n    // Header\r\n    table.cell(tbl, 0, 0, "FUSION V5", text_color=color.white, bgcolor=color.black)\r\n    \r\n    // Row 1: Session Duration (NEW)\r\n    table.cell(tbl, 0, 1, "MOMENTUM SESSION", text_color=color.white, bgcolor=sess_col)\r\n    table.cell(tbl, 1, 1, sess_txt, text_color=color.white, bgcolor=sess_col)\r\n\r\n    // Row 2: Market Status\r\n    table.cell(tbl, 0, 2, "TREND", text_color=color.white, bgcolor=status_bg)\r\n    table.cell(tbl, 1, 2, status_txt, text_color=color.white, bgcolor=status_bg)\r\n    \r\n    // Row 3: Stop Loss\r\n    table.cell(tbl, 0, 3, "1. STOP LOSS", text_color=color.red)\r\n    table.cell(tbl, 1, 3, str.tostring(stop_price, format.mintick), text_color=color.red)\r\n\r\n    // Row 4: Entry\r\n    table.cell(tbl, 0, 4, "2. ENTRY", text_color=color.white)\r\n    table.cell(tbl, 1, 4, str.tostring(entry_price, format.mintick), text_color=color.white)\r\n    \r\n    // Row 5: Take Profit\r\n    table.cell(tbl, 0, 5, "3. TAKE PROFIT", text_color=color.green)\r\n    table.cell(tbl, 1, 5, str.tostring(tp_price, format.mintick), text_color=color.green)\r\n    \r\n    // Row 6: RR Ratio\r\n    table.cell(tbl, 0, 6, "4. RR RATIO", text_color=color.yellow)\r\n    table.cell(tbl, 1, 6, "1 : " + str.tostring(rr_ratio), text_color=color.yellow)\r\n\r\n'
[DEBUG] save_script called: script_id=WQkwVici title=All in one Dynamic Trade Sessions category=WQkwVici force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\WQkwVici_All_in_one_Dynamic_Trade_Sessions.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\WQkwVici_All_in_one_Dynamic_Trade_Sessions.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 22:36:24 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 22:36:24 GMT' as: 2026-02-08T22:36:24+00:00
[DEBUG] Exact published date for header: 2026-02-08T22:36:24+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/jwRpAgI4-mtf-structure-table-smart-money/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator("MTF Structure Table (Lux-style) — Table Only v2.2", overlay=true, max_labels_count=0, max_lines_count=0, max_boxes_count=0)\n\n//=========================\n// Inputs\n//=========================\ngrp = "MTF Table"\n\nr1_on = input.bool(true,  "Row 1", group=grp, inline="r1")\nr1_tf = input.string("15", "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r1")\n\nr2_on = input.bool(true,  "Row 2", group=grp, inline="r2")\nr2_tf = input.string("60", "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r2")\n\nr3_on = input.bool(true,  "Row 3", group=grp, inline="r3")\nr3_tf = input.string("240","TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r3")\n\nr4_on = input.bool(true,  "Row 4", group=grp, inline="r4")\nr4_tf = input.string("D",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r4")\n\nr5_on = input.bool(false, "Row 5", group=grp, inline="r5")\nr5_tf = input.string("W",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r5")\n\nr6_on = input.bool(false, "Row 6", group=grp, inline="r6")\nr6_tf = input.string("M",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r6")\n\npivotLen = input.int(5, "Structure length", minval=2, maxval=50, group=grp)\n\nposOpt  = input.string("Top Right", "Table position", options=["Top Right","Top Left","Bottom Right","Bottom Left"], group=grp)\nshowBOS = input.bool(true, "Show BOS (off = only CHoCH)", group=grp)\n\nsizeOpt = input.string("Normal", "Table size", options=["Tiny","Small","Normal","Large","Huge"], group=grp)\n\nbullCol = input.color(color.new(color.teal, 0), "Bull color", group=grp)\nbearCol = input.color(color.new(color.red, 0),  "Bear color", group=grp)\nnoneCol = input.color(color.new(color.gray, 75),"None color", group=grp)\nbgCol   = input.color(color.new(color.black, 80),"Table bg", group=grp)\ntxtCol  = input.color(color.white, "Text", group=grp)\n\n//=========================\n// Helpers (v6-safe)\n//=========================\nf_tfLabel(tf) =>\n    out = tf\n    if tf == "5"\n        out := "5m"\n    else if tf == "15"\n        out := "15m"\n    else if tf == "30"\n        out := "30m"\n    else if tf == "60"\n        out := "1h"\n    else if tf == "240"\n        out := "4h"\n    else if tf == "D"\n        out := "D"\n    else if tf == "W"\n        out := "W"\n    else if tf == "M"\n        out := "M"\n    out\n\nf_tableSize(sz) =>\n    out = size.normal\n    if sz == "Tiny"\n        out := size.tiny\n    else if sz == "Small"\n        out := size.small\n    else if sz == "Normal"\n        out := size.normal\n    else if sz == "Large"\n        out := size.large\n    else if sz == "Huge"\n        out := size.huge\n    out\n\nf_txt(typ) =>\n    out = "—"\n    if typ == 2\n        out := "CHoCH"\n    else if typ == 1\n        out := "BOS"\n    out\n\nf_col(dir, typ) =>\n    out = noneCol\n    if typ != 0\n        out := dir == 1 ? bullCol : bearCol\n    out\n\npos =\n     posOpt == "Top Right" ? position.top_right :\n     posOpt == "Top Left" ? position.top_left :\n     posOpt == "Bottom Right" ? position.bottom_right :\n     position.bottom_left\n\n//=========================\n// Core structure function\n// Returns: [dir, typ]\n// dir:  1 bull, -1 bear, 0 none\n// typ:  2 CHoCH, 1 BOS, 0 none\n//=========================\nf_mtfSignal(_len) =>\n    var float swingHigh = na\n    var float swingLow  = na\n    var bool  highCrossed = false\n    var bool  lowCrossed  = false\n    var int   trend = 0\n    var int   lastDir = 0\n    var int   lastTyp = 0\n\n    ph = ta.pivothigh(high, _len, _len)\n    pl = ta.pivotlow(low,  _len, _len)\n\n    if not na(ph)\n        swingHigh := ph\n        highCrossed := false\n\n    if not na(pl)\n        swingLow := pl\n        lowCrossed := false\n\n    bullBreak = not na(swingHigh) and ta.crossover(close, swingHigh) and not highCrossed\n    bearBreak = not na(swingLow)  and ta.crossunder(close, swingLow) and not lowCrossed\n\n    if bullBreak\n        typ = 1\n        if trend == -1\n            typ := 2\n        highCrossed := true\n        trend := 1\n        lastDir := 1\n        lastTyp := typ\n\n    if bearBreak\n        typ = 1\n        if trend == 1\n            typ := 2\n        lowCrossed := true\n        trend := -1\n        lastDir := -1\n        lastTyp := typ\n\n    [lastDir, lastTyp]\n\n//=========================\n// Security wrapper (single-line)\n//=========================\nf_get(tf) =>\n    request.security(syminfo.tickerid, tf, f_mtfSignal(pivotLen), barmerge.gaps_off, barmerge.lookahead_off)\n\n//=========================\n// Table (6 rows + header)\n//=========================\nvar table t = table.new(pos, 2, 7, border_width=1, frame_color=color.new(color.white, 85), bgcolor=bgCol)\n\nf_setCell(_row, _tf, _on) =>\n    s = f_tableSize(sizeOpt)\n    if _on\n        [d, k] = f_get(_tf)\n        kk = k\n        if not showBOS and k == 1\n            kk := 0\n        table.cell(t, 0, _row, f_tfLabel(_tf), text_color=txtCol, text_size=s)\n        table.cell(t, 1, _row, f_txt(kk), text_color=txtCol, bgcolor=f_col(d, kk), text_size=s)\n    else\n        table.cell(t, 0, _row, "", text_color=txtCol, text_size=s)\n        table.cell(t, 1, _row, "", text_color=txtCol, text_size=s)\n\nif barstate.islast\n    s = f_tableSize(sizeOpt)\n    table.cell(t, 0, 0, "TF", text_color=txtCol, bgcolor=color.new(color.black, 0), text_size=s)\n    table.cell(t, 1, 0, "Structure", text_color=txtCol, bgcolor=color.new(color.black, 0), text_size=s)\n\n    f_setCell(1, r1_tf, r1_on)\n    f_setCell(2, r2_tf, r2_on)\n    f_setCell(3, r3_tf, r3_on)\n    f_setCell(4, r4_tf, r4_on)\n    f_setCell(5, r5_tf, r5_on)\n    f_setCell(6, r6_tf, r6_on)'
[CAPTURE 1] '//@version=6\nindicator("MTF Structure Table (Lux-style) — Table Only v2.2", overlay=true, max_labels_count=0, max_lines_count=0, max_boxes_count=0)\n\n//=========================\n// Inputs\n//=========================\ngrp = "MTF Table"\n\nr1_on = input.bool(true,  "Row 1", group=grp, inline="r1")\nr1_tf = input.string("15", "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r1")\n\nr2_on = input.bool(true,  "Row 2", group=grp, inline="r2")\nr2_tf = input.string("60", "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r2")\n\nr3_on = input.bool(true,  "Row 3", group=grp, inline="r3")\nr3_tf = input.string("240","TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r3")\n\nr4_on = input.bool(true,  "Row 4", group=grp, inline="r4")\nr4_tf = input.string("D",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r4")\n\nr5_on = input.bool(false, "Row 5", group=grp, inline="r5")\nr5_tf = input.string("W",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r5")\n\nr6_on = input.bool(false, "Row 6", group=grp, inline="r6")\nr6_tf = input.string("M",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r6")\n\npivotLen = input.int(5, "Structure length", minval=2, maxval=50, group=grp)\n\nposOpt  = input.string("Top Right", "Table position", options=["Top Right","Top Left","Bottom Right","Bottom Left"], group=grp)\nshowBOS = input.bool(true, "Show BOS (off = only CHoCH)", group=grp)\n\nsizeOpt = input.string("Normal", "Table size", options=["Tiny","Small","Normal","Large","Huge"], group=grp)\n\nbullCol = input.color(color.new(color.teal, 0), "Bull color", group=grp)\nbearCol = input.color(color.new(color.red, 0),  "Bear color", group=grp)\nnoneCol = input.color(color.new(color.gray, 75),"None color", group=grp)\nbgCol   = input.color(color.new(color.black, 80),"Table bg", group=grp)\ntxtCol  = input.color(color.white, "Text", group=grp)\n\n//=========================\n// Helpers (v6-safe)\n//=========================\nf_tfLabel(tf) =>\n    out = tf\n    if tf == "5"\n        out := "5m"\n    else if tf == "15"\n        out := "15m"\n    else if tf == "30"\n        out := "30m"\n    else if tf == "60"\n        out := "1h"\n    else if tf == "240"\n        out := "4h"\n    else if tf == "D"\n        out := "D"\n    else if tf == "W"\n        out := "W"\n    else if tf == "M"\n        out := "M"\n    out\n\nf_tableSize(sz) =>\n    out = size.normal\n    if sz == "Tiny"\n        out := size.tiny\n    else if sz == "Small"\n        out := size.small\n    else if sz == "Normal"\n        out := size.normal\n    else if sz == "Large"\n        out := size.large\n    else if sz == "Huge"\n        out := size.huge\n    out\n\nf_txt(typ) =>\n    out = "—"\n    if typ == 2\n        out := "CHoCH"\n    else if typ == 1\n        out := "BOS"\n    out\n\nf_col(dir, typ) =>\n    out = noneCol\n    if typ != 0\n        out := dir == 1 ? bullCol : bearCol\n    out\n\npos =\n     posOpt == "Top Right" ? position.top_right :\n     posOpt == "Top Left" ? position.top_left :\n     posOpt == "Bottom Right" ? position.bottom_right :\n     position.bottom_left\n\n//=========================\n// Core structure function\n// Returns: [dir, typ]\n// dir:  1 bull, -1 bear, 0 none\n// typ:  2 CHoCH, 1 BOS, 0 none\n//=========================\nf_mtfSignal(_len) =>\n    var float swingHigh = na\n    var float swingLow  = na\n    var bool  highCrossed = false\n    var bool  lowCrossed  = false\n    var int   trend = 0\n    var int   lastDir = 0\n    var int   lastTyp = 0\n\n    ph = ta.pivothigh(high, _len, _len)\n    pl = ta.pivotlow(low,  _len, _len)\n\n    if not na(ph)\n        swingHigh := ph\n        highCrossed := false\n\n    if not na(pl)\n        swingLow := pl\n        lowCrossed := false\n\n    bullBreak = not na(swingHigh) and ta.crossover(close, swingHigh) and not highCrossed\n    bearBreak = not na(swingLow)  and ta.crossunder(close, swingLow) and not lowCrossed\n\n    if bullBreak\n        typ = 1\n        if trend == -1\n            typ := 2\n        highCrossed := true\n        trend := 1\n        lastDir := 1\n        lastTyp := typ\n\n    if bearBreak\n        typ = 1\n        if trend == 1\n            typ := 2\n        lowCrossed := true\n        trend := -1\n        lastDir := -1\n        lastTyp := typ\n\n    [lastDir, lastTyp]\n\n//=========================\n// Security wrapper (single-line)\n//=========================\nf_get(tf) =>\n    request.security(syminfo.tickerid, tf, f_mtfSignal(pivotLen), barmerge.gaps_off, barmerge.lookahead_off)\n\n//=========================\n// Table (6 rows + header)\n//=========================\nvar table t = table.new(pos, 2, 7, border_width=1, frame_color=color.new(color.white, 85), bgcolor=bgCol)\n\nf_setCell(_row, _tf, _on) =>\n    s = f_tableSize(sizeOpt)\n    if _on\n        [d, k] = f_get(_tf)\n        kk = k\n        if not showBOS and k == 1\n            kk := 0\n        table.cell(t, 0, _row, f_tfLabel(_tf), text_color=txtCol, text_size=s)\n        table.cell(t, 1, _row, f_txt(kk), text_color=txtCol, bgcolor=f_col(d, kk), text_size=s)\n    else\n        table.cell(t, 0, _row, "", text_color=txtCol, text_size=s)\n        table.cell(t, 1, _row, "", text_color=txtCol, text_size=s)\n\nif barstate.islast\n    s = f_tableSize(sizeOpt)\n    table.cell(t, 0, 0, "TF", text_color=txtCol, bgcolor=color.new(color.black, 0), text_size=s)\n    table.cell(t, 1, 0, "Structure", text_color=txtCol, bgcolor=color.new(color.black, 0), text_size=s)\n\n    f_setCell(1, r1_tf, r1_on)\n    f_setCell(2, r2_tf, r2_on)\n    f_setCell(3, r3_tf, r3_on)\n    f_setCell(4, r4_tf, r4_on)\n    f_setCell(5, r5_tf, r5_on)\n    f_setCell(6, r6_tf, r6_on)'
[CAPTURE 2] '//@version=6\nindicator("MTF Structure Table (Lux-style) — Table Only v2.2", overlay=true, max_labels_count=0, max_lines_count=0, max_boxes_count=0)\n\n//=========================\n// Inputs\n//=========================\ngrp = "MTF Table"\n\nr1_on = input.bool(true,  "Row 1", group=grp, inline="r1")\nr1_tf = input.string("15", "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r1")\n\nr2_on = input.bool(true,  "Row 2", group=grp, inline="r2")\nr2_tf = input.string("60", "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r2")\n\nr3_on = input.bool(true,  "Row 3", group=grp, inline="r3")\nr3_tf = input.string("240","TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r3")\n\nr4_on = input.bool(true,  "Row 4", group=grp, inline="r4")\nr4_tf = input.string("D",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r4")\n\nr5_on = input.bool(false, "Row 5", group=grp, inline="r5")\nr5_tf = input.string("W",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r5")\n\nr6_on = input.bool(false, "Row 6", group=grp, inline="r6")\nr6_tf = input.string("M",  "TF", options=["5","15","30","60","240","D","W","M"], group=grp, inline="r6")\n\npivotLen = input.int(5, "Structure length", minval=2, maxval=50, group=grp)\n\nposOpt  = input.string("Top Right", "Table position", options=["Top Right","Top Left","Bottom Right","Bottom Left"], group=grp)\nshowBOS = input.bool(true, "Show BOS (off = only CHoCH)", group=grp)\n\nsizeOpt = input.string("Normal", "Table size", options=["Tiny","Small","Normal","Large","Huge"], group=grp)\n\nbullCol = input.color(color.new(color.teal, 0), "Bull color", group=grp)\nbearCol = input.color(color.new(color.red, 0),  "Bear color", group=grp)\nnoneCol = input.color(color.new(color.gray, 75),"None color", group=grp)\nbgCol   = input.color(color.new(color.black, 80),"Table bg", group=grp)\ntxtCol  = input.color(color.white, "Text", group=grp)\n\n//=========================\n// Helpers (v6-safe)\n//=========================\nf_tfLabel(tf) =>\n    out = tf\n    if tf == "5"\n        out := "5m"\n    else if tf == "15"\n        out := "15m"\n    else if tf == "30"\n        out := "30m"\n    else if tf == "60"\n        out := "1h"\n    else if tf == "240"\n        out := "4h"\n    else if tf == "D"\n        out := "D"\n    else if tf == "W"\n        out := "W"\n    else if tf == "M"\n        out := "M"\n    out\n\nf_tableSize(sz) =>\n    out = size.normal\n    if sz == "Tiny"\n        out := size.tiny\n    else if sz == "Small"\n        out := size.small\n    else if sz == "Normal"\n        out := size.normal\n    else if sz == "Large"\n        out := size.large\n    else if sz == "Huge"\n        out := size.huge\n    out\n\nf_txt(typ) =>\n    out = "—"\n    if typ == 2\n        out := "CHoCH"\n    else if typ == 1\n        out := "BOS"\n    out\n\nf_col(dir, typ) =>\n    out = noneCol\n    if typ != 0\n        out := dir == 1 ? bullCol : bearCol\n    out\n\npos =\n     posOpt == "Top Right" ? position.top_right :\n     posOpt == "Top Left" ? position.top_left :\n     posOpt == "Bottom Right" ? position.bottom_right :\n     position.bottom_left\n\n//=========================\n// Core structure function\n// Returns: [dir, typ]\n// dir:  1 bull, -1 bear, 0 none\n// typ:  2 CHoCH, 1 BOS, 0 none\n//=========================\nf_mtfSignal(_len) =>\n    var float swingHigh = na\n    var float swingLow  = na\n    var bool  highCrossed = false\n    var bool  lowCrossed  = false\n    var int   trend = 0\n    var int   lastDir = 0\n    var int   lastTyp = 0\n\n    ph = ta.pivothigh(high, _len, _len)\n    pl = ta.pivotlow(low,  _len, _len)\n\n    if not na(ph)\n        swingHigh := ph\n        highCrossed := false\n\n    if not na(pl)\n        swingLow := pl\n        lowCrossed := false\n\n    bullBreak = not na(swingHigh) and ta.crossover(close, swingHigh) and not highCrossed\n    bearBreak = not na(swingLow)  and ta.crossunder(close, swingLow) and not lowCrossed\n\n    if bullBreak\n        typ = 1\n        if trend == -1\n            typ := 2\n        highCrossed := true\n        trend := 1\n        lastDir := 1\n        lastTyp := typ\n\n    if bearBreak\n        typ = 1\n        if trend == 1\n            typ := 2\n        lowCrossed := true\n        trend := -1\n        lastDir := -1\n        lastTyp := typ\n\n    [lastDir, lastTyp]\n\n//=========================\n// Security wrapper (single-line)\n//=========================\nf_get(tf) =>\n    request.security(syminfo.tickerid, tf, f_mtfSignal(pivotLen), barmerge.gaps_off, barmerge.lookahead_off)\n\n//=========================\n// Table (6 rows + header)\n//=========================\nvar table t = table.new(pos, 2, 7, border_width=1, frame_color=color.new(color.white, 85), bgcolor=bgCol)\n\nf_setCell(_row, _tf, _on) =>\n    s = f_tableSize(sizeOpt)\n    if _on\n        [d, k] = f_get(_tf)\n        kk = k\n        if not showBOS and k == 1\n            kk := 0\n        table.cell(t, 0, _row, f_tfLabel(_tf), text_color=txtCol, text_size=s)\n        table.cell(t, 1, _row, f_txt(kk), text_color=txtCol, bgcolor=f_col(d, kk), text_size=s)\n    else\n        table.cell(t, 0, _row, "", text_color=txtCol, text_size=s)\n        table.cell(t, 1, _row, "", text_color=txtCol, text_size=s)\n\nif barstate.islast\n    s = f_tableSize(sizeOpt)\n    table.cell(t, 0, 0, "TF", text_color=txtCol, bgcolor=color.new(color.black, 0), text_size=s)\n    table.cell(t, 1, 0, "Structure", text_color=txtCol, bgcolor=color.new(color.black, 0), text_size=s)\n\n    f_setCell(1, r1_tf, r1_on)\n    f_setCell(2, r2_tf, r2_on)\n    f_setCell(3, r3_tf, r3_on)\n    f_setCell(4, r4_tf, r4_on)\n    f_setCell(5, r5_tf, r5_on)\n    f_setCell(6, r6_tf, r6_on)'
[DEBUG] save_script called: script_id=jwRpAgI4 title=MTF Structure Table Smart Money category=jwRpAgI4 force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\jwRpAgI4_MTF_Structure_Table_Smart_Money.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\jwRpAgI4_MTF_Structure_Table_Smart_Money.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 22:34:24 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 22:34:24 GMT' as: 2026-02-08T22:34:24+00:00
[DEBUG] Exact published date for header: 2026-02-08T22:34:24+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/r6MsEBET-stratbynick/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=6\nindicator("S/R Breakout Scalper Signals", overlay=true)\n\n// INPUTS\npivotLeft = input.int(15, "Pivot Left Bars", minval=5, maxval=30)\npivotRight = input.int(3, "Pivot Right Bars", minval=1, maxval=10)\nminBreakoutPercent = input.float(0.1, "Min Breakout Distance %", minval=0.05, maxval=0.5, step=0.05)\ncooldownBars = input.int(15, "Cooldown Between Trades", minval=5, maxval=50)\nprofitTarget = input.float(0.5, "Profit Target %", minval=0.25, maxval=2.0, step=0.05)\nstopLossPercent = input.float(0.25, "Stop Loss %", minval=0.1, maxval=1.0, step=0.05)\n\n// FIND PIVOT S/R LEVELS\npivotHigh = ta.pivothigh(high, pivotLeft, pivotRight)\npivotLow = ta.pivotlow(low, pivotLeft, pivotRight)\n\nvar float resistanceLevel = na\nvar float supportLevel = na\n\nif not na(pivotHigh)\n    resistanceLevel := pivotHigh\n\nif not na(pivotLow)\n    supportLevel := pivotLow\n\n// DETECT CHOPPY/SIDEWAYS MARKET\nsrRange = resistanceLevel - supportLevel\nsrRangePercent = not na(srRange) ? srRange / supportLevel * 100 : 0\nisChoppyMarket = srRangePercent < 0.5 and srRangePercent > 0\npriceInMiddle = not na(resistanceLevel) and not na(supportLevel) and close > supportLevel and close < resistanceLevel\n\nvar int barsInRange = 0\nif priceInMiddle\n    barsInRange := barsInRange + 1\nelse\n    barsInRange := 0\n\nveryChoppy = barsInRange > 15\n\n// BREAKOUT DETECTION\nwasBelow = close[1] <= resistanceLevel\nnowAbove = close > resistanceLevel\njustBrokeResistance = wasBelow and nowAbove\n\nwasAbove = close[1] >= supportLevel\nnowBelow = close < supportLevel\njustBrokeSupport = wasAbove and nowBelow\n\ndistanceAboveResistance = not na(resistanceLevel) ? (close - resistanceLevel) / resistanceLevel * 100 : 0\ndistanceBelowSupport = not na(supportLevel) ? (supportLevel - close) / supportLevel * 100 : 0\n\nvalidBreakUp = justBrokeResistance and distanceAboveResistance > minBreakoutPercent\nvalidBreakDown = justBrokeSupport and distanceBelowSupport > minBreakoutPercent\n\n// MOMENTUM\nisGreenCandle = close > open\nisRedCandle = close < open\nbodySize = math.abs(close - open)\ntotalRange = high - low\nstrongCandle = totalRange > 0 ? bodySize / totalRange > 0.3 : false\n\nrecentGreen = (close > open ? 1 : 0) + (close[1] > open[1] ? 1 : 0) + (close[2] > open[2] ? 1 : 0)\nrecentRed = (close < open ? 1 : 0) + (close[1] < open[1] ? 1 : 0) + (close[2] < open[2] ? 1 : 0)\n\nbullishMomentum = recentGreen >= 2\nbearishMomentum = recentRed >= 2\n\nlongBreakout = validBreakUp and bullishMomentum and strongCandle\nshortBreakout = validBreakDown and bearishMomentum and strongCandle\n\n// ENTRY SIGNALS\nvar int lastSignalBar = -999\ncooldownOK = bar_index - lastSignalBar > cooldownBars\n\nlongEntry = longBreakout and not veryChoppy and not isChoppyMarket and cooldownOK\nshortEntry = shortBreakout and not veryChoppy and not isChoppyMarket and cooldownOK\n\nif longEntry\n    lastSignalBar := bar_index\n\nif shortEntry\n    lastSignalBar := bar_index\n\n// TRACK HYPOTHETICAL POSITION FOR DISPLAY\nvar float entryPrice = 0.0\nvar int entryBar = 0\nvar bool inLong = false\nvar bool inShort = false\nvar float highestProfit = 0.0\nvar float lowestProfit = 0.0\n\n// Entry logic for display\nif longEntry and not inLong and not inShort\n    inLong := true\n    entryPrice := close\n    entryBar := bar_index\n    highestProfit := 0.0\n\nif shortEntry and not inShort and not inLong\n    inShort := true\n    entryPrice := close\n    entryBar := bar_index\n    lowestProfit := 0.0\n\n// Calculate current profit\nbarsInTrade = bar_index - entryBar\nlongProfit = inLong ? (close - entryPrice) / entryPrice * 100 : 0.0\nshortProfit = inShort ? (entryPrice - close) / entryPrice * 100 : 0.0\n\n// Track peak profit\nif inLong\n    highestProfit := math.max(highestProfit, longProfit)\n\nif inShort\n    lowestProfit := math.max(lowestProfit, shortProfit)\n\n// EXIT CONDITIONS (for display only)\n// LONG EXITS\nlongStopLoss = inLong and close < entryPrice * (1 - stopLossPercent/100)\nlongTakeProfit = inLong and longProfit >= profitTarget\nlongTrailing = inLong and highestProfit >= 0.3 and longProfit < (highestProfit - 0.2)\nlongMomentumReverse = inLong and longProfit > 0.2 and recentRed >= 2\nlongEarlyReverse = inLong and barsInTrade >= 3 and longProfit < 0.15 and recentRed >= 2\nlongFailedBreakout = inLong and barsInTrade >= 2 and close < resistanceLevel\nmaxBarsExit = barsInTrade >= 25\n\nlongExit = longStopLoss or longTakeProfit or longTrailing or longMomentumReverse or longEarlyReverse or longFailedBreakout or (inLong and maxBarsExit and longProfit < profitTarget * 0.5)\n\n// SHORT EXITS\nshortStopLoss = inShort and close > entryPrice * (1 + stopLossPercent/100)\nshortTakeProfit = inShort and shortProfit >= profitTarget\nshortTrailing = inShort and lowestProfit >= 0.3 and shortProfit < (lowestProfit - 0.2)\nshortMomentumReverse = inShort and shortProfit > 0.2 and recentGreen >= 2\nshortEarlyReverse = inShort and barsInTrade >= 3 and shortProfit < 0.15 and recentGreen >= 2\nshortFailedBreakout = inShort and barsInTrade >= 2 and close > supportLevel\n\nshortExit = shortStopLoss or shortTakeProfit or shortTrailing or shortMomentumReverse or shortEarlyReverse or shortFailedBreakout or (inShort and maxBarsExit and shortProfit < profitTarget * 0.5)\n\n// Reset position on exit\nif longExit\n    inLong := false\n    entryPrice := 0.0\n\nif shortExit\n    inShort := false\n    entryPrice := 0.0\n\n// VISUALIZATION\n// Show exit markers\nplotshape(longExit, "Long Exit", shape.xcross, location.abovebar, color.red, size=size.small, text="EXIT")\nplotshape(shortExit, "Short Exit", shape.xcross, location.belowbar, color.lime, size=size.small, text="EXIT")\nplot(resistanceLevel, "Resistance", color=color.red, linewidth=2, style=plot.style_linebr)\nplot(supportLevel, "Support", color=color.green, linewidth=2, style=plot.style_linebr)\n\nplotshape(longEntry, "Long", shape.triangleup, location.belowbar, color.lime, size=size.normal, text="LONG")\nplotshape(shortEntry, "Short", shape.triangledown, location.abovebar, color.red, size=size.normal, text="SHORT")\n\n// Show reversal warnings\nbgcolor(longEarlyReverse or shortEarlyReverse ? color.new(color.orange, 60) : na, title="Early Reversal")\nbgcolor(longFailedBreakout or shortFailedBreakout ? color.new(color.purple, 70) : na, title="Failed Breakout")\nbgcolor(bullishMomentum and not veryChoppy ? color.new(color.green, 95) : na, title="Bullish Momentum")\nbgcolor(bearishMomentum and not veryChoppy ? color.new(color.red, 95) : na, title="Bearish Momentum")\nbgcolor(veryChoppy or isChoppyMarket ? color.new(color.yellow, 90) : na, title="Choppy Market")\nbgcolor(inLong ? color.new(color.lime, 85) : inShort ? color.new(color.maroon, 85) : na, title="In Position")\n\n// INFO TABLE\nvar table infoTable = table.new(position.top_right, 2, 10, bgcolor=color.new(color.black, 80), border_width=1)\nif barstate.islast\n    table.cell(infoTable, 0, 0, "Position", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 0, inLong ? "LONG" : inShort ? "SHORT" : "FLAT", text_color=inLong ? color.green : inShort ? color.red : color.gray, text_size=size.small)\n    \n    table.cell(infoTable, 0, 1, "Profit %", text_color=color.white, text_size=size.small)\n    currentProfit = inLong ? longProfit : inShort ? shortProfit : 0.0\n    table.cell(infoTable, 1, 1, str.tostring(currentProfit, "#.##") + "%", text_color=currentProfit > 0 ? color.green : color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 2, "Peak Profit", text_color=color.white, text_size=size.small)\n    peakProfit = inLong ? highestProfit : inShort ? lowestProfit : 0.0\n    table.cell(infoTable, 1, 2, str.tostring(peakProfit, "#.##") + "%", text_color=color.blue, text_size=size.small)\n    \n    table.cell(infoTable, 0, 3, "Target", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 3, str.tostring(profitTarget, "#.##") + "%", text_color=color.orange, text_size=size.small)\n    \n    table.cell(infoTable, 0, 4, "Resistance", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 4, str.tostring(resistanceLevel, "#.#####"), text_color=color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 5, "Support", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 5, str.tostring(supportLevel, "#.#####"), text_color=color.green, text_size=size.small)\n    \n    table.cell(infoTable, 0, 6, "S/R Range %", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 6, str.tostring(srRangePercent, "#.##") + "%", text_color=srRangePercent > 0.5 ? color.green : color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 7, "Market", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 7, veryChoppy or isChoppyMarket ? "CHOPPY" : "OK", text_color=veryChoppy or isChoppyMarket ? color.yellow : color.green, text_size=size.small)\n    \n    table.cell(infoTable, 0, 8, "Bullish Mom", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 8, str.tostring(recentGreen) + "/3", text_color=bullishMomentum ? color.green : color.gray, text_size=size.small)\n    \n    table.cell(infoTable, 0, 9, "Bearish Mom", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 9, str.tostring(recentRed) + "/3", text_color=bearishMomentum ? color.red : color.gray, text_size=size.small)\n\n// ALERTS\nalertcondition(longEntry, "Long Entry Signal", "LONG: Breakout above resistance with momentum - Target: {{plot_0}}")\nalertcondition(shortEntry, "Short Entry Signal", "SHORT: Breakdown below support with momentum - Target: {{plot_1}}")\nalertcondition(longExit, "Long Exit Signal", "EXIT LONG position")\nalertcondition(shortExit, "Short Exit Signal", "EXIT SHORT position")\n'
[CAPTURE 1] '//@version=6\nindicator("S/R Breakout Scalper Signals", overlay=true)\n\n// INPUTS\npivotLeft = input.int(15, "Pivot Left Bars", minval=5, maxval=30)\npivotRight = input.int(3, "Pivot Right Bars", minval=1, maxval=10)\nminBreakoutPercent = input.float(0.1, "Min Breakout Distance %", minval=0.05, maxval=0.5, step=0.05)\ncooldownBars = input.int(15, "Cooldown Between Trades", minval=5, maxval=50)\nprofitTarget = input.float(0.5, "Profit Target %", minval=0.25, maxval=2.0, step=0.05)\nstopLossPercent = input.float(0.25, "Stop Loss %", minval=0.1, maxval=1.0, step=0.05)\n\n// FIND PIVOT S/R LEVELS\npivotHigh = ta.pivothigh(high, pivotLeft, pivotRight)\npivotLow = ta.pivotlow(low, pivotLeft, pivotRight)\n\nvar float resistanceLevel = na\nvar float supportLevel = na\n\nif not na(pivotHigh)\n    resistanceLevel := pivotHigh\n\nif not na(pivotLow)\n    supportLevel := pivotLow\n\n// DETECT CHOPPY/SIDEWAYS MARKET\nsrRange = resistanceLevel - supportLevel\nsrRangePercent = not na(srRange) ? srRange / supportLevel * 100 : 0\nisChoppyMarket = srRangePercent < 0.5 and srRangePercent > 0\npriceInMiddle = not na(resistanceLevel) and not na(supportLevel) and close > supportLevel and close < resistanceLevel\n\nvar int barsInRange = 0\nif priceInMiddle\n    barsInRange := barsInRange + 1\nelse\n    barsInRange := 0\n\nveryChoppy = barsInRange > 15\n\n// BREAKOUT DETECTION\nwasBelow = close[1] <= resistanceLevel\nnowAbove = close > resistanceLevel\njustBrokeResistance = wasBelow and nowAbove\n\nwasAbove = close[1] >= supportLevel\nnowBelow = close < supportLevel\njustBrokeSupport = wasAbove and nowBelow\n\ndistanceAboveResistance = not na(resistanceLevel) ? (close - resistanceLevel) / resistanceLevel * 100 : 0\ndistanceBelowSupport = not na(supportLevel) ? (supportLevel - close) / supportLevel * 100 : 0\n\nvalidBreakUp = justBrokeResistance and distanceAboveResistance > minBreakoutPercent\nvalidBreakDown = justBrokeSupport and distanceBelowSupport > minBreakoutPercent\n\n// MOMENTUM\nisGreenCandle = close > open\nisRedCandle = close < open\nbodySize = math.abs(close - open)\ntotalRange = high - low\nstrongCandle = totalRange > 0 ? bodySize / totalRange > 0.3 : false\n\nrecentGreen = (close > open ? 1 : 0) + (close[1] > open[1] ? 1 : 0) + (close[2] > open[2] ? 1 : 0)\nrecentRed = (close < open ? 1 : 0) + (close[1] < open[1] ? 1 : 0) + (close[2] < open[2] ? 1 : 0)\n\nbullishMomentum = recentGreen >= 2\nbearishMomentum = recentRed >= 2\n\nlongBreakout = validBreakUp and bullishMomentum and strongCandle\nshortBreakout = validBreakDown and bearishMomentum and strongCandle\n\n// ENTRY SIGNALS\nvar int lastSignalBar = -999\ncooldownOK = bar_index - lastSignalBar > cooldownBars\n\nlongEntry = longBreakout and not veryChoppy and not isChoppyMarket and cooldownOK\nshortEntry = shortBreakout and not veryChoppy and not isChoppyMarket and cooldownOK\n\nif longEntry\n    lastSignalBar := bar_index\n\nif shortEntry\n    lastSignalBar := bar_index\n\n// TRACK HYPOTHETICAL POSITION FOR DISPLAY\nvar float entryPrice = 0.0\nvar int entryBar = 0\nvar bool inLong = false\nvar bool inShort = false\nvar float highestProfit = 0.0\nvar float lowestProfit = 0.0\n\n// Entry logic for display\nif longEntry and not inLong and not inShort\n    inLong := true\n    entryPrice := close\n    entryBar := bar_index\n    highestProfit := 0.0\n\nif shortEntry and not inShort and not inLong\n    inShort := true\n    entryPrice := close\n    entryBar := bar_index\n    lowestProfit := 0.0\n\n// Calculate current profit\nbarsInTrade = bar_index - entryBar\nlongProfit = inLong ? (close - entryPrice) / entryPrice * 100 : 0.0\nshortProfit = inShort ? (entryPrice - close) / entryPrice * 100 : 0.0\n\n// Track peak profit\nif inLong\n    highestProfit := math.max(highestProfit, longProfit)\n\nif inShort\n    lowestProfit := math.max(lowestProfit, shortProfit)\n\n// EXIT CONDITIONS (for display only)\n// LONG EXITS\nlongStopLoss = inLong and close < entryPrice * (1 - stopLossPercent/100)\nlongTakeProfit = inLong and longProfit >= profitTarget\nlongTrailing = inLong and highestProfit >= 0.3 and longProfit < (highestProfit - 0.2)\nlongMomentumReverse = inLong and longProfit > 0.2 and recentRed >= 2\nlongEarlyReverse = inLong and barsInTrade >= 3 and longProfit < 0.15 and recentRed >= 2\nlongFailedBreakout = inLong and barsInTrade >= 2 and close < resistanceLevel\nmaxBarsExit = barsInTrade >= 25\n\nlongExit = longStopLoss or longTakeProfit or longTrailing or longMomentumReverse or longEarlyReverse or longFailedBreakout or (inLong and maxBarsExit and longProfit < profitTarget * 0.5)\n\n// SHORT EXITS\nshortStopLoss = inShort and close > entryPrice * (1 + stopLossPercent/100)\nshortTakeProfit = inShort and shortProfit >= profitTarget\nshortTrailing = inShort and lowestProfit >= 0.3 and shortProfit < (lowestProfit - 0.2)\nshortMomentumReverse = inShort and shortProfit > 0.2 and recentGreen >= 2\nshortEarlyReverse = inShort and barsInTrade >= 3 and shortProfit < 0.15 and recentGreen >= 2\nshortFailedBreakout = inShort and barsInTrade >= 2 and close > supportLevel\n\nshortExit = shortStopLoss or shortTakeProfit or shortTrailing or shortMomentumReverse or shortEarlyReverse or shortFailedBreakout or (inShort and maxBarsExit and shortProfit < profitTarget * 0.5)\n\n// Reset position on exit\nif longExit\n    inLong := false\n    entryPrice := 0.0\n\nif shortExit\n    inShort := false\n    entryPrice := 0.0\n\n// VISUALIZATION\n// Show exit markers\nplotshape(longExit, "Long Exit", shape.xcross, location.abovebar, color.red, size=size.small, text="EXIT")\nplotshape(shortExit, "Short Exit", shape.xcross, location.belowbar, color.lime, size=size.small, text="EXIT")\nplot(resistanceLevel, "Resistance", color=color.red, linewidth=2, style=plot.style_linebr)\nplot(supportLevel, "Support", color=color.green, linewidth=2, style=plot.style_linebr)\n\nplotshape(longEntry, "Long", shape.triangleup, location.belowbar, color.lime, size=size.normal, text="LONG")\nplotshape(shortEntry, "Short", shape.triangledown, location.abovebar, color.red, size=size.normal, text="SHORT")\n\n// Show reversal warnings\nbgcolor(longEarlyReverse or shortEarlyReverse ? color.new(color.orange, 60) : na, title="Early Reversal")\nbgcolor(longFailedBreakout or shortFailedBreakout ? color.new(color.purple, 70) : na, title="Failed Breakout")\nbgcolor(bullishMomentum and not veryChoppy ? color.new(color.green, 95) : na, title="Bullish Momentum")\nbgcolor(bearishMomentum and not veryChoppy ? color.new(color.red, 95) : na, title="Bearish Momentum")\nbgcolor(veryChoppy or isChoppyMarket ? color.new(color.yellow, 90) : na, title="Choppy Market")\nbgcolor(inLong ? color.new(color.lime, 85) : inShort ? color.new(color.maroon, 85) : na, title="In Position")\n\n// INFO TABLE\nvar table infoTable = table.new(position.top_right, 2, 10, bgcolor=color.new(color.black, 80), border_width=1)\nif barstate.islast\n    table.cell(infoTable, 0, 0, "Position", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 0, inLong ? "LONG" : inShort ? "SHORT" : "FLAT", text_color=inLong ? color.green : inShort ? color.red : color.gray, text_size=size.small)\n    \n    table.cell(infoTable, 0, 1, "Profit %", text_color=color.white, text_size=size.small)\n    currentProfit = inLong ? longProfit : inShort ? shortProfit : 0.0\n    table.cell(infoTable, 1, 1, str.tostring(currentProfit, "#.##") + "%", text_color=currentProfit > 0 ? color.green : color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 2, "Peak Profit", text_color=color.white, text_size=size.small)\n    peakProfit = inLong ? highestProfit : inShort ? lowestProfit : 0.0\n    table.cell(infoTable, 1, 2, str.tostring(peakProfit, "#.##") + "%", text_color=color.blue, text_size=size.small)\n    \n    table.cell(infoTable, 0, 3, "Target", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 3, str.tostring(profitTarget, "#.##") + "%", text_color=color.orange, text_size=size.small)\n    \n    table.cell(infoTable, 0, 4, "Resistance", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 4, str.tostring(resistanceLevel, "#.#####"), text_color=color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 5, "Support", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 5, str.tostring(supportLevel, "#.#####"), text_color=color.green, text_size=size.small)\n    \n    table.cell(infoTable, 0, 6, "S/R Range %", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 6, str.tostring(srRangePercent, "#.##") + "%", text_color=srRangePercent > 0.5 ? color.green : color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 7, "Market", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 7, veryChoppy or isChoppyMarket ? "CHOPPY" : "OK", text_color=veryChoppy or isChoppyMarket ? color.yellow : color.green, text_size=size.small)\n    \n    table.cell(infoTable, 0, 8, "Bullish Mom", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 8, str.tostring(recentGreen) + "/3", text_color=bullishMomentum ? color.green : color.gray, text_size=size.small)\n    \n    table.cell(infoTable, 0, 9, "Bearish Mom", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 9, str.tostring(recentRed) + "/3", text_color=bearishMomentum ? color.red : color.gray, text_size=size.small)\n\n// ALERTS\nalertcondition(longEntry, "Long Entry Signal", "LONG: Breakout above resistance with momentum - Target: {{plot_0}}")\nalertcondition(shortEntry, "Short Entry Signal", "SHORT: Breakdown below support with momentum - Target: {{plot_1}}")\nalertcondition(longExit, "Long Exit Signal", "EXIT LONG position")\nalertcondition(shortExit, "Short Exit Signal", "EXIT SHORT position")\n'
[CAPTURE 2] '//@version=6\nindicator("S/R Breakout Scalper Signals", overlay=true)\n\n// INPUTS\npivotLeft = input.int(15, "Pivot Left Bars", minval=5, maxval=30)\npivotRight = input.int(3, "Pivot Right Bars", minval=1, maxval=10)\nminBreakoutPercent = input.float(0.1, "Min Breakout Distance %", minval=0.05, maxval=0.5, step=0.05)\ncooldownBars = input.int(15, "Cooldown Between Trades", minval=5, maxval=50)\nprofitTarget = input.float(0.5, "Profit Target %", minval=0.25, maxval=2.0, step=0.05)\nstopLossPercent = input.float(0.25, "Stop Loss %", minval=0.1, maxval=1.0, step=0.05)\n\n// FIND PIVOT S/R LEVELS\npivotHigh = ta.pivothigh(high, pivotLeft, pivotRight)\npivotLow = ta.pivotlow(low, pivotLeft, pivotRight)\n\nvar float resistanceLevel = na\nvar float supportLevel = na\n\nif not na(pivotHigh)\n    resistanceLevel := pivotHigh\n\nif not na(pivotLow)\n    supportLevel := pivotLow\n\n// DETECT CHOPPY/SIDEWAYS MARKET\nsrRange = resistanceLevel - supportLevel\nsrRangePercent = not na(srRange) ? srRange / supportLevel * 100 : 0\nisChoppyMarket = srRangePercent < 0.5 and srRangePercent > 0\npriceInMiddle = not na(resistanceLevel) and not na(supportLevel) and close > supportLevel and close < resistanceLevel\n\nvar int barsInRange = 0\nif priceInMiddle\n    barsInRange := barsInRange + 1\nelse\n    barsInRange := 0\n\nveryChoppy = barsInRange > 15\n\n// BREAKOUT DETECTION\nwasBelow = close[1] <= resistanceLevel\nnowAbove = close > resistanceLevel\njustBrokeResistance = wasBelow and nowAbove\n\nwasAbove = close[1] >= supportLevel\nnowBelow = close < supportLevel\njustBrokeSupport = wasAbove and nowBelow\n\ndistanceAboveResistance = not na(resistanceLevel) ? (close - resistanceLevel) / resistanceLevel * 100 : 0\ndistanceBelowSupport = not na(supportLevel) ? (supportLevel - close) / supportLevel * 100 : 0\n\nvalidBreakUp = justBrokeResistance and distanceAboveResistance > minBreakoutPercent\nvalidBreakDown = justBrokeSupport and distanceBelowSupport > minBreakoutPercent\n\n// MOMENTUM\nisGreenCandle = close > open\nisRedCandle = close < open\nbodySize = math.abs(close - open)\ntotalRange = high - low\nstrongCandle = totalRange > 0 ? bodySize / totalRange > 0.3 : false\n\nrecentGreen = (close > open ? 1 : 0) + (close[1] > open[1] ? 1 : 0) + (close[2] > open[2] ? 1 : 0)\nrecentRed = (close < open ? 1 : 0) + (close[1] < open[1] ? 1 : 0) + (close[2] < open[2] ? 1 : 0)\n\nbullishMomentum = recentGreen >= 2\nbearishMomentum = recentRed >= 2\n\nlongBreakout = validBreakUp and bullishMomentum and strongCandle\nshortBreakout = validBreakDown and bearishMomentum and strongCandle\n\n// ENTRY SIGNALS\nvar int lastSignalBar = -999\ncooldownOK = bar_index - lastSignalBar > cooldownBars\n\nlongEntry = longBreakout and not veryChoppy and not isChoppyMarket and cooldownOK\nshortEntry = shortBreakout and not veryChoppy and not isChoppyMarket and cooldownOK\n\nif longEntry\n    lastSignalBar := bar_index\n\nif shortEntry\n    lastSignalBar := bar_index\n\n// TRACK HYPOTHETICAL POSITION FOR DISPLAY\nvar float entryPrice = 0.0\nvar int entryBar = 0\nvar bool inLong = false\nvar bool inShort = false\nvar float highestProfit = 0.0\nvar float lowestProfit = 0.0\n\n// Entry logic for display\nif longEntry and not inLong and not inShort\n    inLong := true\n    entryPrice := close\n    entryBar := bar_index\n    highestProfit := 0.0\n\nif shortEntry and not inShort and not inLong\n    inShort := true\n    entryPrice := close\n    entryBar := bar_index\n    lowestProfit := 0.0\n\n// Calculate current profit\nbarsInTrade = bar_index - entryBar\nlongProfit = inLong ? (close - entryPrice) / entryPrice * 100 : 0.0\nshortProfit = inShort ? (entryPrice - close) / entryPrice * 100 : 0.0\n\n// Track peak profit\nif inLong\n    highestProfit := math.max(highestProfit, longProfit)\n\nif inShort\n    lowestProfit := math.max(lowestProfit, shortProfit)\n\n// EXIT CONDITIONS (for display only)\n// LONG EXITS\nlongStopLoss = inLong and close < entryPrice * (1 - stopLossPercent/100)\nlongTakeProfit = inLong and longProfit >= profitTarget\nlongTrailing = inLong and highestProfit >= 0.3 and longProfit < (highestProfit - 0.2)\nlongMomentumReverse = inLong and longProfit > 0.2 and recentRed >= 2\nlongEarlyReverse = inLong and barsInTrade >= 3 and longProfit < 0.15 and recentRed >= 2\nlongFailedBreakout = inLong and barsInTrade >= 2 and close < resistanceLevel\nmaxBarsExit = barsInTrade >= 25\n\nlongExit = longStopLoss or longTakeProfit or longTrailing or longMomentumReverse or longEarlyReverse or longFailedBreakout or (inLong and maxBarsExit and longProfit < profitTarget * 0.5)\n\n// SHORT EXITS\nshortStopLoss = inShort and close > entryPrice * (1 + stopLossPercent/100)\nshortTakeProfit = inShort and shortProfit >= profitTarget\nshortTrailing = inShort and lowestProfit >= 0.3 and shortProfit < (lowestProfit - 0.2)\nshortMomentumReverse = inShort and shortProfit > 0.2 and recentGreen >= 2\nshortEarlyReverse = inShort and barsInTrade >= 3 and shortProfit < 0.15 and recentGreen >= 2\nshortFailedBreakout = inShort and barsInTrade >= 2 and close > supportLevel\n\nshortExit = shortStopLoss or shortTakeProfit or shortTrailing or shortMomentumReverse or shortEarlyReverse or shortFailedBreakout or (inShort and maxBarsExit and shortProfit < profitTarget * 0.5)\n\n// Reset position on exit\nif longExit\n    inLong := false\n    entryPrice := 0.0\n\nif shortExit\n    inShort := false\n    entryPrice := 0.0\n\n// VISUALIZATION\n// Show exit markers\nplotshape(longExit, "Long Exit", shape.xcross, location.abovebar, color.red, size=size.small, text="EXIT")\nplotshape(shortExit, "Short Exit", shape.xcross, location.belowbar, color.lime, size=size.small, text="EXIT")\nplot(resistanceLevel, "Resistance", color=color.red, linewidth=2, style=plot.style_linebr)\nplot(supportLevel, "Support", color=color.green, linewidth=2, style=plot.style_linebr)\n\nplotshape(longEntry, "Long", shape.triangleup, location.belowbar, color.lime, size=size.normal, text="LONG")\nplotshape(shortEntry, "Short", shape.triangledown, location.abovebar, color.red, size=size.normal, text="SHORT")\n\n// Show reversal warnings\nbgcolor(longEarlyReverse or shortEarlyReverse ? color.new(color.orange, 60) : na, title="Early Reversal")\nbgcolor(longFailedBreakout or shortFailedBreakout ? color.new(color.purple, 70) : na, title="Failed Breakout")\nbgcolor(bullishMomentum and not veryChoppy ? color.new(color.green, 95) : na, title="Bullish Momentum")\nbgcolor(bearishMomentum and not veryChoppy ? color.new(color.red, 95) : na, title="Bearish Momentum")\nbgcolor(veryChoppy or isChoppyMarket ? color.new(color.yellow, 90) : na, title="Choppy Market")\nbgcolor(inLong ? color.new(color.lime, 85) : inShort ? color.new(color.maroon, 85) : na, title="In Position")\n\n// INFO TABLE\nvar table infoTable = table.new(position.top_right, 2, 10, bgcolor=color.new(color.black, 80), border_width=1)\nif barstate.islast\n    table.cell(infoTable, 0, 0, "Position", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 0, inLong ? "LONG" : inShort ? "SHORT" : "FLAT", text_color=inLong ? color.green : inShort ? color.red : color.gray, text_size=size.small)\n    \n    table.cell(infoTable, 0, 1, "Profit %", text_color=color.white, text_size=size.small)\n    currentProfit = inLong ? longProfit : inShort ? shortProfit : 0.0\n    table.cell(infoTable, 1, 1, str.tostring(currentProfit, "#.##") + "%", text_color=currentProfit > 0 ? color.green : color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 2, "Peak Profit", text_color=color.white, text_size=size.small)\n    peakProfit = inLong ? highestProfit : inShort ? lowestProfit : 0.0\n    table.cell(infoTable, 1, 2, str.tostring(peakProfit, "#.##") + "%", text_color=color.blue, text_size=size.small)\n    \n    table.cell(infoTable, 0, 3, "Target", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 3, str.tostring(profitTarget, "#.##") + "%", text_color=color.orange, text_size=size.small)\n    \n    table.cell(infoTable, 0, 4, "Resistance", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 4, str.tostring(resistanceLevel, "#.#####"), text_color=color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 5, "Support", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 5, str.tostring(supportLevel, "#.#####"), text_color=color.green, text_size=size.small)\n    \n    table.cell(infoTable, 0, 6, "S/R Range %", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 6, str.tostring(srRangePercent, "#.##") + "%", text_color=srRangePercent > 0.5 ? color.green : color.red, text_size=size.small)\n    \n    table.cell(infoTable, 0, 7, "Market", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 7, veryChoppy or isChoppyMarket ? "CHOPPY" : "OK", text_color=veryChoppy or isChoppyMarket ? color.yellow : color.green, text_size=size.small)\n    \n    table.cell(infoTable, 0, 8, "Bullish Mom", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 8, str.tostring(recentGreen) + "/3", text_color=bullishMomentum ? color.green : color.gray, text_size=size.small)\n    \n    table.cell(infoTable, 0, 9, "Bearish Mom", text_color=color.white, text_size=size.small)\n    table.cell(infoTable, 1, 9, str.tostring(recentRed) + "/3", text_color=bearishMomentum ? color.red : color.gray, text_size=size.small)\n\n// ALERTS\nalertcondition(longEntry, "Long Entry Signal", "LONG: Breakout above resistance with momentum - Target: {{plot_0}}")\nalertcondition(shortEntry, "Short Entry Signal", "SHORT: Breakdown below support with momentum - Target: {{plot_1}}")\nalertcondition(longExit, "Long Exit Signal", "EXIT LONG position")\nalertcondition(shortExit, "Short Exit Signal", "EXIT SHORT position")\n'
[DEBUG] save_script called: script_id=r6MsEBET title=stratbynick category=r6MsEBET force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\r6MsEBET_stratbynick.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\r6MsEBET_stratbynick.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 22:05:46 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 22:05:46 GMT' as: 2026-02-08T22:05:46+00:00
[DEBUG] Exact published date for header: 2026-02-08T22:05:46+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/vlMD9hnc-Capital-Options-Gate/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\nindicator("Capital Options Gate (D/4H → 5m) | QQQ & TSLA", overlay=true, max_labels_count=500)\n\n// ===================== INPUTS =====================\nminScore        = input.int(75, "Min Score to PASS", minval=0, maxval=100)\n\n// Sessions (NY)\nuseSession      = input.bool(true, "Restrict to NY Sessions")\nnySessionAM     = input.session("0930-1100", "NY AM Session (ET)")\nnySessionPM     = input.session("1345-1545", "NY PM Session (ET)")\n\n// HTF Trend Filter (Daily + 4H)\nuseHTFTrend     = input.bool(true, "Require Daily + 4H Trend Alignment")\ndFastLen        = input.int(20, "Daily EMA Fast")\ndSlowLen        = input.int(200, "Daily EMA Slow")\nh4FastLen       = input.int(20, "4H EMA Fast")\nh4SlowLen       = input.int(200, "4H EMA Slow")\n\n// 5m Structure Filters\nemaFastLen      = input.int(9, "5m EMA 9")\nemaMidLen       = input.int(20, "5m EMA 20")\nemaSlowLen      = input.int(200, "5m EMA 200")\n\n// VWAP Filter\nuseVWAP         = input.bool(true, "Require VWAP Alignment")\nvwapBufferPct   = input.float(0.15, "VWAP Buffer %", step=0.01)\n\n// Manual HTF Level (set from Daily/4H)\nuseManualLevel  = input.bool(true, "Use Manual HTF Level Input")\nhtfLevel        = input.float(0.0, "HTF Level (from D/4H)", step=0.01)\n\n// Setup Logic\nretestBars      = input.int(5, "Retest Window (bars)")\nmomAtrMult      = input.float(0.5, "Momentum Candle ATR Mult", step=0.1)\n\n// Risk Proxy\nmaxRiskPct      = input.float(0.40, "Max Risk % of Price (from level)", step=0.01)\n\n// ===================== SESSION LOGIC =====================\ninSessionAM = not na(time(timeframe.period, nySessionAM))\ninSessionPM = not na(time(timeframe.period, nySessionPM))\ninSession   = not useSession or (inSessionAM or inSessionPM)\n\nsessionName = inSessionAM ? "AM" : inSessionPM ? "PM" : "OFF"\n\n// ===================== HTF TREND (AUTO) =====================\n// Intended to run on 5-minute chart\ndEmaFast  = request.security(syminfo.tickerid, "D",   ta.ema(close, dFastLen))\ndEmaSlow  = request.security(syminfo.tickerid, "D",   ta.ema(close, dSlowLen))\nh4EmaFast = request.security(syminfo.tickerid, "240", ta.ema(close, h4FastLen))\nh4EmaSlow = request.security(syminfo.tickerid, "240", ta.ema(close, h4SlowLen))\n\ndailyBull = dEmaFast > dEmaSlow\ndailyBear = dEmaFast < dEmaSlow\nh4Bull    = h4EmaFast > h4EmaSlow\nh4Bear    = h4EmaFast < h4EmaSlow\n\nhtfBull = dailyBull and h4Bull\nhtfBear = dailyBear and h4Bear\nhtfOk   = not useHTFTrend or (htfBull or htfBear)\n\nhtfState = htfBull ? "BULL" : htfBear ? "BEAR" : "NEUTRAL"\n\n// ===================== 5m INDICATORS =====================\nema9   = ta.ema(close, emaFastLen)\nema20  = ta.ema(close, emaMidLen)\nema200 = ta.ema(close, emaSlowLen)\n\nvwapV = ta.vwap(hlc3)\natr   = ta.atr(14)\n\n// 5m micro-trend alignment\nbullTrend5 = ema9 > ema20 and ema20 > ema200\nbearTrend5 = ema9 < ema20 and ema20 < ema200\ntrendOk5   = bullTrend5 or bearTrend5\n\n// VWAP alignment (don’t fight VWAP)\nbullVWAP = close >= vwapV * (1 - vwapBufferPct/100)\nbearVWAP = close <= vwapV * (1 + vwapBufferPct/100)\nvwapOk   = not useVWAP or (bullVWAP or bearVWAP)\n\n// ===================== LEVEL + SETUPS =====================\nlevelSet = not useManualLevel or (useManualLevel and htfLevel > 0)\nlevel    = useManualLevel ? htfLevel : na\n\n// Break + CLOSE (your rule)\nbullBreakClose = levelSet and close > level\nbearBreakClose = levelSet and close < level\n\n// Break & Retest\nbullRetest = levelSet and ta.barssince(bullBreakClose) <= retestBars and low <= level and close >= level\nbearRetest = levelSet and ta.barssince(bearBreakClose) <= retestBars and high >= level and close <= level\n\n// Momentum Break (strong body relative to ATR)\nbullMomentum = bullBreakClose and close > open and (close - open) > atr * momAtrMult\nbearMomentum = bearBreakClose and close < open and (open - close) > atr * momAtrMult\n\nsetupBull = bullRetest or bullMomentum\nsetupBear = bearRetest or bearMomentum\nsetupOk   = setupBull or setupBear\n\nsetupName = bullRetest ? "B&R LONG" : bearRetest ? "B&R SHORT" : bullMomentum ? "MOMO LONG" : bearMomentum ? "MOMO SHORT" : "NONE"\n\n// Direction gate: only trade in HTF direction (if enabled)\ndirOk = not useHTFTrend or ((htfBull and setupBull) or (htfBear and setupBear))\n\n// Risk proxy: distance from level to current close must be tight\nriskPct = levelSet ? (math.abs(close - level) / close * 100) : 999.0\nriskOk  = riskPct <= maxRiskPct\n\n// ===================== SCORING (100-POINT MODEL) =====================\nscore = 0\nscore += inSession ? 20 : 0\nscore += htfOk ? 20 : 0\nscore += trendOk5 ? 15 : 0\nscore += setupOk ? 25 : 0\nscore += vwapOk ? 10 : 0\nscore += (dirOk and riskOk and levelSet) ? 10 : 0\n\npass = score >= minScore and inSession and levelSet and setupOk and dirOk and riskOk\n\n// ===================== VISUALS =====================\nplot(ema9,   "EMA 9 (5m)",   color=color.white)\nplot(ema20,  "EMA 20 (5m)",  color=color.yellow)\nplot(ema200, "EMA 200 (5m)", color=color.orange)\nplot(useVWAP ? vwapV : na, "VWAP", color=color.aqua)\n\nplot(useManualLevel and levelSet ? level : na, "HTF Level", color=color.new(color.fuchsia, 0), style=plot.style_linebr, linewidth=2)\n\nbgcolor(pass ? color.new(color.green, 85) : na)\n\n// ===================== STATUS LABEL (SAFE) =====================\nvar label statusLbl = na\n\nstatusText = "Ticker: " + syminfo.ticker + "\\nSession: " + sessionName + "\\nHTF: " + htfState + "\\nSetup: " + setupName + "\\nScore: " + str.tostring(score) + "\\nRisk%: " + str.tostring(riskPct, "#.##") + "%" + (pass ? "\\n✅ PASS" : "\\n❌ FAIL")\n\nif barstate.islast\n    if not na(statusLbl)\n        label.delete(statusLbl)\n    statusLbl := label.new(x=bar_index, y=high, text=statusText, style=label.style_label_down, textcolor=color.white, color=pass ? color.new(color.green, 0) : color.new(color.red, 0))\n\n// ===================== ALERT =====================\n// Keep message static; customize in the alert dialog with placeholders.\nalertcondition(pass, title="CAPITAL GATE PASS", message="Capital Gate PASS on {{ticker}} (5m). Check chart for setup + level alignment.")\n\n'
[CAPTURE 1] '//@version=5\nindicator("Capital Options Gate (D/4H → 5m) | QQQ & TSLA", overlay=true, max_labels_count=500)\n\n// ===================== INPUTS =====================\nminScore        = input.int(75, "Min Score to PASS", minval=0, maxval=100)\n\n// Sessions (NY)\nuseSession      = input.bool(true, "Restrict to NY Sessions")\nnySessionAM     = input.session("0930-1100", "NY AM Session (ET)")\nnySessionPM     = input.session("1345-1545", "NY PM Session (ET)")\n\n// HTF Trend Filter (Daily + 4H)\nuseHTFTrend     = input.bool(true, "Require Daily + 4H Trend Alignment")\ndFastLen        = input.int(20, "Daily EMA Fast")\ndSlowLen        = input.int(200, "Daily EMA Slow")\nh4FastLen       = input.int(20, "4H EMA Fast")\nh4SlowLen       = input.int(200, "4H EMA Slow")\n\n// 5m Structure Filters\nemaFastLen      = input.int(9, "5m EMA 9")\nemaMidLen       = input.int(20, "5m EMA 20")\nemaSlowLen      = input.int(200, "5m EMA 200")\n\n// VWAP Filter\nuseVWAP         = input.bool(true, "Require VWAP Alignment")\nvwapBufferPct   = input.float(0.15, "VWAP Buffer %", step=0.01)\n\n// Manual HTF Level (set from Daily/4H)\nuseManualLevel  = input.bool(true, "Use Manual HTF Level Input")\nhtfLevel        = input.float(0.0, "HTF Level (from D/4H)", step=0.01)\n\n// Setup Logic\nretestBars      = input.int(5, "Retest Window (bars)")\nmomAtrMult      = input.float(0.5, "Momentum Candle ATR Mult", step=0.1)\n\n// Risk Proxy\nmaxRiskPct      = input.float(0.40, "Max Risk % of Price (from level)", step=0.01)\n\n// ===================== SESSION LOGIC =====================\ninSessionAM = not na(time(timeframe.period, nySessionAM))\ninSessionPM = not na(time(timeframe.period, nySessionPM))\ninSession   = not useSession or (inSessionAM or inSessionPM)\n\nsessionName = inSessionAM ? "AM" : inSessionPM ? "PM" : "OFF"\n\n// ===================== HTF TREND (AUTO) =====================\n// Intended to run on 5-minute chart\ndEmaFast  = request.security(syminfo.tickerid, "D",   ta.ema(close, dFastLen))\ndEmaSlow  = request.security(syminfo.tickerid, "D",   ta.ema(close, dSlowLen))\nh4EmaFast = request.security(syminfo.tickerid, "240", ta.ema(close, h4FastLen))\nh4EmaSlow = request.security(syminfo.tickerid, "240", ta.ema(close, h4SlowLen))\n\ndailyBull = dEmaFast > dEmaSlow\ndailyBear = dEmaFast < dEmaSlow\nh4Bull    = h4EmaFast > h4EmaSlow\nh4Bear    = h4EmaFast < h4EmaSlow\n\nhtfBull = dailyBull and h4Bull\nhtfBear = dailyBear and h4Bear\nhtfOk   = not useHTFTrend or (htfBull or htfBear)\n\nhtfState = htfBull ? "BULL" : htfBear ? "BEAR" : "NEUTRAL"\n\n// ===================== 5m INDICATORS =====================\nema9   = ta.ema(close, emaFastLen)\nema20  = ta.ema(close, emaMidLen)\nema200 = ta.ema(close, emaSlowLen)\n\nvwapV = ta.vwap(hlc3)\natr   = ta.atr(14)\n\n// 5m micro-trend alignment\nbullTrend5 = ema9 > ema20 and ema20 > ema200\nbearTrend5 = ema9 < ema20 and ema20 < ema200\ntrendOk5   = bullTrend5 or bearTrend5\n\n// VWAP alignment (don’t fight VWAP)\nbullVWAP = close >= vwapV * (1 - vwapBufferPct/100)\nbearVWAP = close <= vwapV * (1 + vwapBufferPct/100)\nvwapOk   = not useVWAP or (bullVWAP or bearVWAP)\n\n// ===================== LEVEL + SETUPS =====================\nlevelSet = not useManualLevel or (useManualLevel and htfLevel > 0)\nlevel    = useManualLevel ? htfLevel : na\n\n// Break + CLOSE (your rule)\nbullBreakClose = levelSet and close > level\nbearBreakClose = levelSet and close < level\n\n// Break & Retest\nbullRetest = levelSet and ta.barssince(bullBreakClose) <= retestBars and low <= level and close >= level\nbearRetest = levelSet and ta.barssince(bearBreakClose) <= retestBars and high >= level and close <= level\n\n// Momentum Break (strong body relative to ATR)\nbullMomentum = bullBreakClose and close > open and (close - open) > atr * momAtrMult\nbearMomentum = bearBreakClose and close < open and (open - close) > atr * momAtrMult\n\nsetupBull = bullRetest or bullMomentum\nsetupBear = bearRetest or bearMomentum\nsetupOk   = setupBull or setupBear\n\nsetupName = bullRetest ? "B&R LONG" : bearRetest ? "B&R SHORT" : bullMomentum ? "MOMO LONG" : bearMomentum ? "MOMO SHORT" : "NONE"\n\n// Direction gate: only trade in HTF direction (if enabled)\ndirOk = not useHTFTrend or ((htfBull and setupBull) or (htfBear and setupBear))\n\n// Risk proxy: distance from level to current close must be tight\nriskPct = levelSet ? (math.abs(close - level) / close * 100) : 999.0\nriskOk  = riskPct <= maxRiskPct\n\n// ===================== SCORING (100-POINT MODEL) =====================\nscore = 0\nscore += inSession ? 20 : 0\nscore += htfOk ? 20 : 0\nscore += trendOk5 ? 15 : 0\nscore += setupOk ? 25 : 0\nscore += vwapOk ? 10 : 0\nscore += (dirOk and riskOk and levelSet) ? 10 : 0\n\npass = score >= minScore and inSession and levelSet and setupOk and dirOk and riskOk\n\n// ===================== VISUALS =====================\nplot(ema9,   "EMA 9 (5m)",   color=color.white)\nplot(ema20,  "EMA 20 (5m)",  color=color.yellow)\nplot(ema200, "EMA 200 (5m)", color=color.orange)\nplot(useVWAP ? vwapV : na, "VWAP", color=color.aqua)\n\nplot(useManualLevel and levelSet ? level : na, "HTF Level", color=color.new(color.fuchsia, 0), style=plot.style_linebr, linewidth=2)\n\nbgcolor(pass ? color.new(color.green, 85) : na)\n\n// ===================== STATUS LABEL (SAFE) =====================\nvar label statusLbl = na\n\nstatusText = "Ticker: " + syminfo.ticker + "\\nSession: " + sessionName + "\\nHTF: " + htfState + "\\nSetup: " + setupName + "\\nScore: " + str.tostring(score) + "\\nRisk%: " + str.tostring(riskPct, "#.##") + "%" + (pass ? "\\n✅ PASS" : "\\n❌ FAIL")\n\nif barstate.islast\n    if not na(statusLbl)\n        label.delete(statusLbl)\n    statusLbl := label.new(x=bar_index, y=high, text=statusText, style=label.style_label_down, textcolor=color.white, color=pass ? color.new(color.green, 0) : color.new(color.red, 0))\n\n// ===================== ALERT =====================\n// Keep message static; customize in the alert dialog with placeholders.\nalertcondition(pass, title="CAPITAL GATE PASS", message="Capital Gate PASS on {{ticker}} (5m). Check chart for setup + level alignment.")\n\n'
[CAPTURE 2] '//@version=5\nindicator("Capital Options Gate (D/4H → 5m) | QQQ & TSLA", overlay=true, max_labels_count=500)\n\n// ===================== INPUTS =====================\nminScore        = input.int(75, "Min Score to PASS", minval=0, maxval=100)\n\n// Sessions (NY)\nuseSession      = input.bool(true, "Restrict to NY Sessions")\nnySessionAM     = input.session("0930-1100", "NY AM Session (ET)")\nnySessionPM     = input.session("1345-1545", "NY PM Session (ET)")\n\n// HTF Trend Filter (Daily + 4H)\nuseHTFTrend     = input.bool(true, "Require Daily + 4H Trend Alignment")\ndFastLen        = input.int(20, "Daily EMA Fast")\ndSlowLen        = input.int(200, "Daily EMA Slow")\nh4FastLen       = input.int(20, "4H EMA Fast")\nh4SlowLen       = input.int(200, "4H EMA Slow")\n\n// 5m Structure Filters\nemaFastLen      = input.int(9, "5m EMA 9")\nemaMidLen       = input.int(20, "5m EMA 20")\nemaSlowLen      = input.int(200, "5m EMA 200")\n\n// VWAP Filter\nuseVWAP         = input.bool(true, "Require VWAP Alignment")\nvwapBufferPct   = input.float(0.15, "VWAP Buffer %", step=0.01)\n\n// Manual HTF Level (set from Daily/4H)\nuseManualLevel  = input.bool(true, "Use Manual HTF Level Input")\nhtfLevel        = input.float(0.0, "HTF Level (from D/4H)", step=0.01)\n\n// Setup Logic\nretestBars      = input.int(5, "Retest Window (bars)")\nmomAtrMult      = input.float(0.5, "Momentum Candle ATR Mult", step=0.1)\n\n// Risk Proxy\nmaxRiskPct      = input.float(0.40, "Max Risk % of Price (from level)", step=0.01)\n\n// ===================== SESSION LOGIC =====================\ninSessionAM = not na(time(timeframe.period, nySessionAM))\ninSessionPM = not na(time(timeframe.period, nySessionPM))\ninSession   = not useSession or (inSessionAM or inSessionPM)\n\nsessionName = inSessionAM ? "AM" : inSessionPM ? "PM" : "OFF"\n\n// ===================== HTF TREND (AUTO) =====================\n// Intended to run on 5-minute chart\ndEmaFast  = request.security(syminfo.tickerid, "D",   ta.ema(close, dFastLen))\ndEmaSlow  = request.security(syminfo.tickerid, "D",   ta.ema(close, dSlowLen))\nh4EmaFast = request.security(syminfo.tickerid, "240", ta.ema(close, h4FastLen))\nh4EmaSlow = request.security(syminfo.tickerid, "240", ta.ema(close, h4SlowLen))\n\ndailyBull = dEmaFast > dEmaSlow\ndailyBear = dEmaFast < dEmaSlow\nh4Bull    = h4EmaFast > h4EmaSlow\nh4Bear    = h4EmaFast < h4EmaSlow\n\nhtfBull = dailyBull and h4Bull\nhtfBear = dailyBear and h4Bear\nhtfOk   = not useHTFTrend or (htfBull or htfBear)\n\nhtfState = htfBull ? "BULL" : htfBear ? "BEAR" : "NEUTRAL"\n\n// ===================== 5m INDICATORS =====================\nema9   = ta.ema(close, emaFastLen)\nema20  = ta.ema(close, emaMidLen)\nema200 = ta.ema(close, emaSlowLen)\n\nvwapV = ta.vwap(hlc3)\natr   = ta.atr(14)\n\n// 5m micro-trend alignment\nbullTrend5 = ema9 > ema20 and ema20 > ema200\nbearTrend5 = ema9 < ema20 and ema20 < ema200\ntrendOk5   = bullTrend5 or bearTrend5\n\n// VWAP alignment (don’t fight VWAP)\nbullVWAP = close >= vwapV * (1 - vwapBufferPct/100)\nbearVWAP = close <= vwapV * (1 + vwapBufferPct/100)\nvwapOk   = not useVWAP or (bullVWAP or bearVWAP)\n\n// ===================== LEVEL + SETUPS =====================\nlevelSet = not useManualLevel or (useManualLevel and htfLevel > 0)\nlevel    = useManualLevel ? htfLevel : na\n\n// Break + CLOSE (your rule)\nbullBreakClose = levelSet and close > level\nbearBreakClose = levelSet and close < level\n\n// Break & Retest\nbullRetest = levelSet and ta.barssince(bullBreakClose) <= retestBars and low <= level and close >= level\nbearRetest = levelSet and ta.barssince(bearBreakClose) <= retestBars and high >= level and close <= level\n\n// Momentum Break (strong body relative to ATR)\nbullMomentum = bullBreakClose and close > open and (close - open) > atr * momAtrMult\nbearMomentum = bearBreakClose and close < open and (open - close) > atr * momAtrMult\n\nsetupBull = bullRetest or bullMomentum\nsetupBear = bearRetest or bearMomentum\nsetupOk   = setupBull or setupBear\n\nsetupName = bullRetest ? "B&R LONG" : bearRetest ? "B&R SHORT" : bullMomentum ? "MOMO LONG" : bearMomentum ? "MOMO SHORT" : "NONE"\n\n// Direction gate: only trade in HTF direction (if enabled)\ndirOk = not useHTFTrend or ((htfBull and setupBull) or (htfBear and setupBear))\n\n// Risk proxy: distance from level to current close must be tight\nriskPct = levelSet ? (math.abs(close - level) / close * 100) : 999.0\nriskOk  = riskPct <= maxRiskPct\n\n// ===================== SCORING (100-POINT MODEL) =====================\nscore = 0\nscore += inSession ? 20 : 0\nscore += htfOk ? 20 : 0\nscore += trendOk5 ? 15 : 0\nscore += setupOk ? 25 : 0\nscore += vwapOk ? 10 : 0\nscore += (dirOk and riskOk and levelSet) ? 10 : 0\n\npass = score >= minScore and inSession and levelSet and setupOk and dirOk and riskOk\n\n// ===================== VISUALS =====================\nplot(ema9,   "EMA 9 (5m)",   color=color.white)\nplot(ema20,  "EMA 20 (5m)",  color=color.yellow)\nplot(ema200, "EMA 200 (5m)", color=color.orange)\nplot(useVWAP ? vwapV : na, "VWAP", color=color.aqua)\n\nplot(useManualLevel and levelSet ? level : na, "HTF Level", color=color.new(color.fuchsia, 0), style=plot.style_linebr, linewidth=2)\n\nbgcolor(pass ? color.new(color.green, 85) : na)\n\n// ===================== STATUS LABEL (SAFE) =====================\nvar label statusLbl = na\n\nstatusText = "Ticker: " + syminfo.ticker + "\\nSession: " + sessionName + "\\nHTF: " + htfState + "\\nSetup: " + setupName + "\\nScore: " + str.tostring(score) + "\\nRisk%: " + str.tostring(riskPct, "#.##") + "%" + (pass ? "\\n✅ PASS" : "\\n❌ FAIL")\n\nif barstate.islast\n    if not na(statusLbl)\n        label.delete(statusLbl)\n    statusLbl := label.new(x=bar_index, y=high, text=statusText, style=label.style_label_down, textcolor=color.white, color=pass ? color.new(color.green, 0) : color.new(color.red, 0))\n\n// ===================== ALERT =====================\n// Keep message static; customize in the alert dialog with placeholders.\nalertcondition(pass, title="CAPITAL GATE PASS", message="Capital Gate PASS on {{ticker}} (5m). Check chart for setup + level alignment.")\n\n'
[DEBUG] save_script called: script_id=vlMD9hnc title=Capital Options Gate category=vlMD9hnc force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\vlMD9hnc_Capital_Options_Gate.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\vlMD9hnc_Capital_Options_Gate.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 22:04:41 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 22:04:41 GMT' as: 2026-02-08T22:04:41+00:00
[DEBUG] Exact published date for header: 2026-02-08T22:04:41+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/I2nP7fQE-XAUUSD-Breakout-SL-Points-15-Minute-Strategy-By-Nitin-Soni/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
//@version=5in
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\r\nindicator("XAUUSD Dynamic Breakout + SL Points", overlay=true, max_boxes_count=500, max_labels_count=500)\r\n\r\n// --- इनपुट्स ---\r\ntz = input.string("GMT+5:30", "Timezone", tooltip="IST के लिए GMT+5:30 रहने दें")\r\ntarget_hour = input.int(4, "Start Hour (24h Format)", minval=0, maxval=23)\r\ntarget_minute = input.int(30, "Start Minute", minval=0, maxval=59)\r\nbox_width = input.int(40, "Box Width (Bars)", minval=1)\r\n\r\n// चेक करना कि क्या यह सेलेक्ट की हुई टाइम वाली कैंडल है\r\nisFirstCandle = hour(time, tz) == target_hour and minute(time, tz) == target_minute\r\n\r\n// लेबल्स के लिए फंक्शन\r\nf_createLabel(_x, _y, _txt, _color, _style) =>\r\n    label.new(_x, _y, _txt, color=_color, textcolor=color.white, style=_style, size=size.small)\r\n\r\n// लाइन के लिए फंक्शन\r\nf_createLine(_x1, _x2, _y, _color) =>\r\n    line.new(_x1, _y, _x2, _y, color=_color, width=1, style=line.style_dashed)\r\n\r\nif isFirstCandle\r\n    float cHigh = high\r\n    float cLow  = low\r\n    float body  = cHigh - cLow\r\n    int labelX  = bar_index + box_width \r\n    \r\n    // SL पॉइंट्स कैलकुलेशन (Gold/Silver के लिए 10 से गुना किया है ताकि पॉइंट्स दिखे)\r\n    // अगर आप पिप्स देखना चाहते हैं तो इसे अपने हिसाब से एडजस्ट कर सकते हैं\r\n    float slPoints = body * 1\r\n\r\n    // --- कैलकुलेशन (RR 1:1, 1:2, 1:3) ---\r\n    float buyTP1 = cHigh + body, buyTP2 = cHigh + (body * 2), buyFinal = cHigh + (body * 3)\r\n    float sellTP1 = cLow - body, sellTP2 = cLow - (body * 2), sellFinal = cLow - (body * 3)\r\n\r\n    // --- LEFT SIDE SL LABEL ---\r\n    f_createLabel(bar_index, cLow - (body * 0.2), "SL Points: " + str.tostring(slPoints, "#.#"), color.orange, label.style_label_right)\r\n\r\n    // --- BUY SETUP ड्राइंग ---\r\n    box.new(bar_index, buyFinal, labelX, cHigh, bgcolor=color.new(color.green, 90), border_color=color.new(color.green, 50))\r\n    box.new(bar_index, cHigh, labelX, cLow, bgcolor=color.new(color.red, 90), border_color=color.new(color.red, 50))\r\n    \r\n    // TP Lines\r\n    f_createLine(bar_index, labelX, buyTP1, color.new(color.green, 50))\r\n    f_createLine(bar_index, labelX, buyTP2, color.new(color.green, 50))\r\n    f_createLine(bar_index, labelX, buyFinal, color.new(color.green, 20))\r\n\r\n    // Right Side Labels\r\n    f_createLabel(labelX, buyFinal, "Final TP (1:3)\\n" + str.tostring(buyFinal, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, buyTP2, "2nd TP (1:2)\\n" + str.tostring(buyTP2, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, buyTP1, "1st TP (1:1)\\n" + str.tostring(buyTP1, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, cHigh, "Entry (High)\\n" + str.tostring(cHigh, "#.##"), color.gray, label.style_label_left)\r\n    f_createLabel(labelX, cLow, "SL (Low)\\n" + str.tostring(cLow, "#.##"), color.red, label.style_label_left)\r\n\r\n    // --- SELL SETUP ड्राइंग ---\r\n    box.new(bar_index, cLow, labelX, sellFinal, bgcolor=color.new(color.red, 90), border_color=color.new(color.red, 50))\r\n    \r\n    // TP Lines\r\n    f_createLine(bar_index, labelX, sellTP1, color.new(color.red, 50))\r\n    f_createLine(bar_index, labelX, sellTP2, color.new(color.red, 50))\r\n    f_createLine(bar_index, labelX, sellFinal, color.new(color.red, 20))\r\n    \r\n    f_createLabel(labelX, sellFinal, "Final TP (1:3)\\n" + str.tostring(sellFinal, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, sellTP2, "2nd TP (1:2)\\n" + str.tostring(sellTP2, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, sellTP1, "1st TP (1:1)\\n" + str.tostring(sellTP1, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, cLow, "Entry (Low)\\n" + str.tostring(cLow, "#.##"), color.gray, label.style_label_left)'
[CAPTURE 1] '//@version=5\r\nindicator("XAUUSD Dynamic Breakout + SL Points", overlay=true, max_boxes_count=500, max_labels_count=500)\r\n\r\n// --- इनपुट्स ---\r\ntz = input.string("GMT+5:30", "Timezone", tooltip="IST के लिए GMT+5:30 रहने दें")\r\ntarget_hour = input.int(4, "Start Hour (24h Format)", minval=0, maxval=23)\r\ntarget_minute = input.int(30, "Start Minute", minval=0, maxval=59)\r\nbox_width = input.int(40, "Box Width (Bars)", minval=1)\r\n\r\n// चेक करना कि क्या यह सेलेक्ट की हुई टाइम वाली कैंडल है\r\nisFirstCandle = hour(time, tz) == target_hour and minute(time, tz) == target_minute\r\n\r\n// लेबल्स के लिए फंक्शन\r\nf_createLabel(_x, _y, _txt, _color, _style) =>\r\n    label.new(_x, _y, _txt, color=_color, textcolor=color.white, style=_style, size=size.small)\r\n\r\n// लाइन के लिए फंक्शन\r\nf_createLine(_x1, _x2, _y, _color) =>\r\n    line.new(_x1, _y, _x2, _y, color=_color, width=1, style=line.style_dashed)\r\n\r\nif isFirstCandle\r\n    float cHigh = high\r\n    float cLow  = low\r\n    float body  = cHigh - cLow\r\n    int labelX  = bar_index + box_width \r\n    \r\n    // SL पॉइंट्स कैलकुलेशन (Gold/Silver के लिए 10 से गुना किया है ताकि पॉइंट्स दिखे)\r\n    // अगर आप पिप्स देखना चाहते हैं तो इसे अपने हिसाब से एडजस्ट कर सकते हैं\r\n    float slPoints = body * 1\r\n\r\n    // --- कैलकुलेशन (RR 1:1, 1:2, 1:3) ---\r\n    float buyTP1 = cHigh + body, buyTP2 = cHigh + (body * 2), buyFinal = cHigh + (body * 3)\r\n    float sellTP1 = cLow - body, sellTP2 = cLow - (body * 2), sellFinal = cLow - (body * 3)\r\n\r\n    // --- LEFT SIDE SL LABEL ---\r\n    f_createLabel(bar_index, cLow - (body * 0.2), "SL Points: " + str.tostring(slPoints, "#.#"), color.orange, label.style_label_right)\r\n\r\n    // --- BUY SETUP ड्राइंग ---\r\n    box.new(bar_index, buyFinal, labelX, cHigh, bgcolor=color.new(color.green, 90), border_color=color.new(color.green, 50))\r\n    box.new(bar_index, cHigh, labelX, cLow, bgcolor=color.new(color.red, 90), border_color=color.new(color.red, 50))\r\n    \r\n    // TP Lines\r\n    f_createLine(bar_index, labelX, buyTP1, color.new(color.green, 50))\r\n    f_createLine(bar_index, labelX, buyTP2, color.new(color.green, 50))\r\n    f_createLine(bar_index, labelX, buyFinal, color.new(color.green, 20))\r\n\r\n    // Right Side Labels\r\n    f_createLabel(labelX, buyFinal, "Final TP (1:3)\\n" + str.tostring(buyFinal, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, buyTP2, "2nd TP (1:2)\\n" + str.tostring(buyTP2, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, buyTP1, "1st TP (1:1)\\n" + str.tostring(buyTP1, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, cHigh, "Entry (High)\\n" + str.tostring(cHigh, "#.##"), color.gray, label.style_label_left)\r\n    f_createLabel(labelX, cLow, "SL (Low)\\n" + str.tostring(cLow, "#.##"), color.red, label.style_label_left)\r\n\r\n    // --- SELL SETUP ड्राइंग ---\r\n    box.new(bar_index, cLow, labelX, sellFinal, bgcolor=color.new(color.red, 90), border_color=color.new(color.red, 50))\r\n    \r\n    // TP Lines\r\n    f_createLine(bar_index, labelX, sellTP1, color.new(color.red, 50))\r\n    f_createLine(bar_index, labelX, sellTP2, color.new(color.red, 50))\r\n    f_createLine(bar_index, labelX, sellFinal, color.new(color.red, 20))\r\n    \r\n    f_createLabel(labelX, sellFinal, "Final TP (1:3)\\n" + str.tostring(sellFinal, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, sellTP2, "2nd TP (1:2)\\n" + str.tostring(sellTP2, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, sellTP1, "1st TP (1:1)\\n" + str.tostring(sellTP1, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, cLow, "Entry (Low)\\n" + str.tostring(cLow, "#.##"), color.gray, label.style_label_left)'
[CAPTURE 2] '//@version=5\r\nindicator("XAUUSD Dynamic Breakout + SL Points", overlay=true, max_boxes_count=500, max_labels_count=500)\r\n\r\n// --- इनपुट्स ---\r\ntz = input.string("GMT+5:30", "Timezone", tooltip="IST के लिए GMT+5:30 रहने दें")\r\ntarget_hour = input.int(4, "Start Hour (24h Format)", minval=0, maxval=23)\r\ntarget_minute = input.int(30, "Start Minute", minval=0, maxval=59)\r\nbox_width = input.int(40, "Box Width (Bars)", minval=1)\r\n\r\n// चेक करना कि क्या यह सेलेक्ट की हुई टाइम वाली कैंडल है\r\nisFirstCandle = hour(time, tz) == target_hour and minute(time, tz) == target_minute\r\n\r\n// लेबल्स के लिए फंक्शन\r\nf_createLabel(_x, _y, _txt, _color, _style) =>\r\n    label.new(_x, _y, _txt, color=_color, textcolor=color.white, style=_style, size=size.small)\r\n\r\n// लाइन के लिए फंक्शन\r\nf_createLine(_x1, _x2, _y, _color) =>\r\n    line.new(_x1, _y, _x2, _y, color=_color, width=1, style=line.style_dashed)\r\n\r\nif isFirstCandle\r\n    float cHigh = high\r\n    float cLow  = low\r\n    float body  = cHigh - cLow\r\n    int labelX  = bar_index + box_width \r\n    \r\n    // SL पॉइंट्स कैलकुलेशन (Gold/Silver के लिए 10 से गुना किया है ताकि पॉइंट्स दिखे)\r\n    // अगर आप पिप्स देखना चाहते हैं तो इसे अपने हिसाब से एडजस्ट कर सकते हैं\r\n    float slPoints = body * 1\r\n\r\n    // --- कैलकुलेशन (RR 1:1, 1:2, 1:3) ---\r\n    float buyTP1 = cHigh + body, buyTP2 = cHigh + (body * 2), buyFinal = cHigh + (body * 3)\r\n    float sellTP1 = cLow - body, sellTP2 = cLow - (body * 2), sellFinal = cLow - (body * 3)\r\n\r\n    // --- LEFT SIDE SL LABEL ---\r\n    f_createLabel(bar_index, cLow - (body * 0.2), "SL Points: " + str.tostring(slPoints, "#.#"), color.orange, label.style_label_right)\r\n\r\n    // --- BUY SETUP ड्राइंग ---\r\n    box.new(bar_index, buyFinal, labelX, cHigh, bgcolor=color.new(color.green, 90), border_color=color.new(color.green, 50))\r\n    box.new(bar_index, cHigh, labelX, cLow, bgcolor=color.new(color.red, 90), border_color=color.new(color.red, 50))\r\n    \r\n    // TP Lines\r\n    f_createLine(bar_index, labelX, buyTP1, color.new(color.green, 50))\r\n    f_createLine(bar_index, labelX, buyTP2, color.new(color.green, 50))\r\n    f_createLine(bar_index, labelX, buyFinal, color.new(color.green, 20))\r\n\r\n    // Right Side Labels\r\n    f_createLabel(labelX, buyFinal, "Final TP (1:3)\\n" + str.tostring(buyFinal, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, buyTP2, "2nd TP (1:2)\\n" + str.tostring(buyTP2, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, buyTP1, "1st TP (1:1)\\n" + str.tostring(buyTP1, "#.##"), color.green, label.style_label_left)\r\n    f_createLabel(labelX, cHigh, "Entry (High)\\n" + str.tostring(cHigh, "#.##"), color.gray, label.style_label_left)\r\n    f_createLabel(labelX, cLow, "SL (Low)\\n" + str.tostring(cLow, "#.##"), color.red, label.style_label_left)\r\n\r\n    // --- SELL SETUP ड्राइंग ---\r\n    box.new(bar_index, cLow, labelX, sellFinal, bgcolor=color.new(color.red, 90), border_color=color.new(color.red, 50))\r\n    \r\n    // TP Lines\r\n    f_createLine(bar_index, labelX, sellTP1, color.new(color.red, 50))\r\n    f_createLine(bar_index, labelX, sellTP2, color.new(color.red, 50))\r\n    f_createLine(bar_index, labelX, sellFinal, color.new(color.red, 20))\r\n    \r\n    f_createLabel(labelX, sellFinal, "Final TP (1:3)\\n" + str.tostring(sellFinal, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, sellTP2, "2nd TP (1:2)\\n" + str.tostring(sellTP2, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, sellTP1, "1st TP (1:1)\\n" + str.tostring(sellTP1, "#.##"), color.red, label.style_label_left)\r\n    f_createLabel(labelX, cLow, "Entry (Low)\\n" + str.tostring(cLow, "#.##"), color.gray, label.style_label_left)'
[DEBUG] save_script called: script_id=I2nP7fQE title=XAUUSD Breakout + SL Points 15 Minute Strategy By Nitin Soni category=I2nP7fQE force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\I2nP7fQE_XAUUSD_Breakout_+_SL_Points_15_Minute_Strategy_By_Nitin_Soni.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\I2nP7fQE_XAUUSD_Breakout_+_SL_Points_15_Minute_Strategy_By_Nitin_Soni.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Sun, 08 Feb 2026 23:36:25 GMT'
[DEBUG] Parsed RFC-2822 time 'Sun, 08 Feb 2026 23:36:25 GMT' as: 2026-02-08T23:36:25+00:00
[DEBUG] Exact published date for header: 2026-02-08T23:36:25+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/dPce50Ra-0DTE-Strategy/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\nindicator("0DTE Strategy", overlay=true, max_labels_count=500, max_boxes_count=500)\n\n// ============================================================================\n// INPUT SETTINGS\n// ============================================================================\n\n// Timeframe Settings\ntrendTimeframe = input.timeframe("5", "Trend Timeframe (5-Min Chart)", group="Timeframes")\nentryTimeframe = input.timeframe("30S", "Entry Timeframe (30-Sec Chart)", group="Timeframes")\n\n// EMA Settings\nemaLength = input.int(9, "EMA Length", minval=1, group="Indicators")\nshowEMA = input.bool(true, "Show 9EMA", group="Indicators")\nemaColor = input.color(color.yellow, "9EMA Color", group="Indicators")\n\n// VWAP Settings\nshowVWAP = input.bool(true, "Show VWAP", group="Indicators")\nvwapColor = input.color(color.blue, "VWAP Color", group="Indicators")\n\n// Trading Window Settings\nshowTradingWindows = input.bool(true, "Show Trading Windows", group="Trading Windows")\ntrade1Start = input.int(935, "Trade 1 Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade1End = input.int(950, "Trade 1 End (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade2Start = input.int(1000, "Trade 2 Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade2End = input.int(1020, "Trade 2 End (EST)", minval=0, maxval=2359, group="Trading Windows")\ndeathZoneStart = input.int(1100, "Death Zone Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ndeathZoneEnd = input.int(1530, "Death Zone End (EST)", minval=0, maxval=2359, group="Trading Windows")\nmocStart = input.int(1545, "MOC Trade Start (EST)", minval=0, maxval=2359, group="Trading Windows")\nmocEnd = input.int(1600, "MOC Trade End (EST)", minval=0, maxval=2359, group="Trading Windows")\n\n// Signal Settings\nshowBuySignals = input.bool(true, "Show Buy Signals", group="Signals")\nshowSellSignals = input.bool(true, "Show Sell Signals", group="Signals")\nshowAlerts = input.bool(true, "Enable Alerts", group="Signals")\n\n// Pre-Market Levels\nshowPMH = input.bool(true, "Show Pre-Market High (PMH)", group="Pre-Market Levels")\nshowPML = input.bool(true, "Show Pre-Market Low (PML)", group="Pre-Market Levels")\nshowPDC = input.bool(true, "Show Previous Day Close (PDC)", group="Pre-Market Levels")\n\n// Visual Settings\ntrade1Color = input.color(color.new(color.green, 90), "Trade 1 Window Color", group="Visual")\ntrade2Color = input.color(color.new(color.blue, 90), "Trade 2 Window Color", group="Visual")\ndeathZoneColor = input.color(color.new(color.red, 90), "Death Zone Color", group="Visual")\nmocColor = input.color(color.new(color.purple, 90), "MOC Window Color", group="Visual")\n\n// ============================================================================\n// INDICATOR CALCULATIONS\n// ============================================================================\n\n// 9EMA Calculation\nema9 = ta.ema(close, emaLength)\n\n// VWAP Calculation\nvwapValue = ta.vwap(close)\n\n// Higher Timeframe EMA (5-Min for trend confirmation)\nhtfEMA = request.security(syminfo.tickerid, trendTimeframe, ta.ema(close, emaLength))\n\n// Higher Timeframe VWAP\nhtfVWAP = request.security(syminfo.tickerid, trendTimeframe, ta.vwap(close))\n\n// ============================================================================\n// TIME FUNCTIONS\n// ============================================================================\n\n// Convert time to minutes since midnight for easier comparison\ngetCurrentTimeEST() =>\n    currentHour = hour(time, "America/New_York")\n    currentMinute = minute(time, "America/New_York")\n    currentHour * 100 + currentMinute\n\ntimeNow = getCurrentTimeEST()\n\n// Check if in specific trading windows\ninTrade1 = timeNow >= trade1Start and timeNow <= trade1End\ninTrade2 = timeNow >= trade2Start and timeNow <= trade2End\ninDeathZone = timeNow >= deathZoneStart and timeNow <= deathZoneEnd\ninMOC = timeNow >= mocStart and timeNow <= mocEnd\ninActiveWindow = (inTrade1 or inTrade2 or inMOC) and not inDeathZone\n\n// ============================================================================\n// PRE-MARKET LEVELS\n// ============================================================================\n\n// Previous Day Close\nvar float pdcLevel = na\nif dayofweek != dayofweek[1]\n    pdcLevel := close[1]\n\n// Pre-Market High and Low (simplified - tracks session high/low before 9:30)\nvar float pmhLevel = na\nvar float pmlLevel = na\n\nisPreMarket = timeNow < 930\n\nif isPreMarket\n    if na(pmhLevel) or high > pmhLevel\n        pmhLevel := high\n    if na(pmlLevel) or low < pmlLevel\n        pmlLevel := low\nelse if timeNow >= 930 and timeNow < 935\n    // Lock in PM levels at market open\n    pmhLevel := pmhLevel\n    pmlLevel := pmlLevel\n\n// ============================================================================\n// TREND ANALYSIS\n// ============================================================================\n\n// 5-Min Trend Conditions\nbullishTrend5m = close > htfVWAP and close > htfEMA\nbearishTrend5m = close < htfVWAP and close < htfEMA\n\n// Current Timeframe Conditions\nbullishNow = close > vwapValue and close > ema9\nbearishNow = close < vwapValue and close < ema9\n\n// Combined Trend Alignment\nstrongBullish = bullishTrend5m and bullishNow\nstrongBearish = bearishTrend5m and bearishNow\n\n// ============================================================================\n// ENTRY SIGNALS\n// ============================================================================\n\n// Look for pullback to 9EMA then bounce\npullbackToBullEMA = low <= ema9 and close > ema9 and close > open\npullbackToBearEMA = high >= ema9 and close < ema9 and close < open\n\n// Higher Low Detection (for Trade 2)\nhigherLow = low > low[1] and low[1] > low[2]\nlowerHigh = high < high[1] and high[1] < high[2]\n\n// Buy Signal: Bullish trend + pullback + green candle + in active window\nbuySignal = strongBullish and pullbackToBullEMA and inActiveWindow\nbuySignalTrade2 = strongBullish and higherLow and inTrade2\n\n// Sell Signal: Bearish trend + pullback + red candle + in active window\nsellSignal = strongBearish and pullbackToBearEMA and inActiveWindow\nsellSignalTrade2 = strongBearish and lowerHigh and inTrade2\n\n// ============================================================================\n// PLOTTING\n// ============================================================================\n\n// Plot EMAs\nplot(showEMA ? ema9 : na, "9EMA (Current TF)", color=emaColor, linewidth=2)\nplot(showEMA ? htfEMA : na, "9EMA (5-Min)", color=color.new(emaColor, 50), linewidth=1, style=plot.style_circles)\n\n// Plot VWAP\nplot(showVWAP ? vwapValue : na, "VWAP (Current TF)", color=vwapColor, linewidth=2)\nplot(showVWAP ? htfVWAP : na, "VWAP (5-Min)", color=color.new(vwapColor, 50), linewidth=1, style=plot.style_circles)\n\n// Plot Pre-Market Levels\nplot(showPDC ? pdcLevel : na, "Previous Day Close", color=color.gray, linewidth=1, style=plot.style_cross)\nplot(showPMH ? pmhLevel : na, "Pre-Market High", color=color.green, linewidth=1, style=plot.style_stepline)\nplot(showPML ? pmlLevel : na, "Pre-Market Low", color=color.red, linewidth=1, style=plot.style_stepline)\n\n// ============================================================================\n// TRADING WINDOW BACKGROUNDS\n// ============================================================================\n\nbgcolor(showTradingWindows and inTrade1 ? trade1Color : na, title="Trade 1 Window")\nbgcolor(showTradingWindows and inTrade2 ? trade2Color : na, title="Trade 2 Window")\nbgcolor(showTradingWindows and inDeathZone ? deathZoneColor : na, title="Death Zone")\nbgcolor(showTradingWindows and inMOC ? mocColor : na, title="MOC Window")\n\n// ============================================================================\n// SIGNAL MARKERS\n// ============================================================================\n\n// Buy Signals\nplotshape(showBuySignals and (buySignal or buySignalTrade2), "Buy Signal", shape.triangleup, location.belowbar, color=color.new(color.green, 0), size=size.small)\n\n// Sell Signals\nplotshape(showSellSignals and (sellSignal or sellSignalTrade2), "Sell Signal", shape.triangledown, location.abovebar, color=color.new(color.red, 0), size=size.small)\n\n// ============================================================================\n// LABELS AND INFO\n// ============================================================================\n\n// Show current window status\nvar label windowLabel = na\nif barstate.islast\n    label.delete(windowLabel)\n    windowText = inTrade1 ? "TRADE 1 ACTIVE" : inTrade2 ? "TRADE 2 ACTIVE" : inDeathZone ? "DEATH ZONE - STAY CASH" : inMOC ? "MOC WINDOW ACTIVE" : "Outside Trading Windows"\n    windowColor = inTrade1 ? color.green : inTrade2 ? color.blue : inDeathZone ? color.red : inMOC ? color.purple : color.gray\n    windowLabel := label.new(bar_index, high, windowText, color=color.new(windowColor, 70), textcolor=color.white, style=label.style_label_down, size=size.normal)\n\n// Show trend status\nvar label trendLabel = na\nif barstate.islast\n    label.delete(trendLabel)\n    trendText = strongBullish ? "STRONG BULLISH ↑" : strongBearish ? "STRONG BEARISH ↓" : bullishNow ? "Bullish (Current TF)" : bearishNow ? "Bearish (Current TF)" : "Neutral/Choppy"\n    trendColor = strongBullish ? color.green : strongBearish ? color.red : color.orange\n    trendLabel := label.new(bar_index, low, trendText, color=color.new(trendColor, 70), textcolor=color.white, style=label.style_label_up, size=size.normal)\n\n// ============================================================================\n// ALERTS\n// ============================================================================\n\nif showAlerts\n    if buySignal or buySignalTrade2\n        alert("30-Day Sprint: BUY SIGNAL - Price above VWAP + 9EMA in active window", alert.freq_once_per_bar)\n    if sellSignal or sellSignalTrade2\n        alert("30-Day Sprint: SELL SIGNAL - Price below VWAP + 9EMA in active window", alert.freq_once_per_bar)\n    if inDeathZone and not inDeathZone[1]\n        alert("30-Day Sprint: DEATH ZONE ENTERED - Stay Cash, Avoid Trading", alert.freq_once_per_bar)\n    if inMOC and not inMOC[1]\n        alert("30-Day Sprint: MOC WINDOW OPEN - Check imbalance data", alert.freq_once_per_bar)\n\n// ============================================================================\n// TABLE DISPLAY (Optional Dashboard)\n// ============================================================================\n\nvar table dashboard = table.new(position.top_right, 2, 8, border_width=1)\n\nif barstate.islast\n    // Header\n    table.cell(dashboard, 0, 0, "30-Day Sprint Dashboard", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.normal)\n    table.merge_cells(dashboard, 0, 0, 1, 0)\n    \n    // Current Status\n    table.cell(dashboard, 0, 1, "Window:", text_color=color.rgb(25, 23, 23))\n    windowStatusText = inTrade1 ? "Trade 1" : inTrade2 ? "Trade 2" : inDeathZone ? "DEATH ZONE" : inMOC ? "MOC" : "Closed"\n    windowStatusColor = inTrade1 ? color.green : inTrade2 ? color.blue : inDeathZone ? color.red : inMOC ? color.purple : color.gray\n    table.cell(dashboard, 1, 1, windowStatusText, bgcolor=color.new(windowStatusColor, 70), text_color=color.white)\n    \n    // Trend Status\n    table.cell(dashboard, 0, 2, "5-Min Trend:", text_color=color.rgb(14, 12, 12))\n    trend5mText = bullishTrend5m ? "BULLISH ↑" : bearishTrend5m ? "BEARISH ↓" : "NEUTRAL"\n    trend5mColor = bullishTrend5m ? color.green : bearishTrend5m ? color.red : color.orange\n    table.cell(dashboard, 1, 2, trend5mText, bgcolor=color.new(trend5mColor, 70), text_color=color.white)\n    \n    // Current TF Trend\n    table.cell(dashboard, 0, 3, "Current TF:", text_color=color.rgb(39, 36, 36))\n    currentTrendText = bullishNow ? "Bullish ↑" : bearishNow ? "Bearish ↓" : "Neutral"\n    currentTrendColor = bullishNow ? color.green : bearishNow ? color.red : color.orange\n    table.cell(dashboard, 1, 3, currentTrendText, bgcolor=color.new(currentTrendColor, 70), text_color=color.white)\n    \n    // Price vs VWAP\n    table.cell(dashboard, 0, 4, "Price vs VWAP:", text_color=color.rgb(52, 48, 48))\n    vwapStatus = close > vwapValue ? "ABOVE ✓" : "BELOW ✗"\n    vwapStatusColor = close > vwapValue ? color.green : color.red\n    table.cell(dashboard, 1, 4, vwapStatus, bgcolor=color.new(vwapStatusColor, 70), text_color=color.white)\n    \n    // Price vs 9EMA\n    table.cell(dashboard, 0, 5, "Price vs 9EMA:", text_color=color.rgb(17, 15, 15))\n    emaStatus = close > ema9 ? "ABOVE ✓" : "BELOW ✗"\n    emaStatusColor = close > ema9 ? color.green : color.red\n    table.cell(dashboard, 1, 5, emaStatus, bgcolor=color.new(emaStatusColor, 70), text_color=color.white)\n    \n    // Alignment Status\n    table.cell(dashboard, 0, 6, "Alignment:", text_color=color.rgb(22, 20, 20))\n    alignmentText = strongBullish ? "STRONG BULL" : strongBearish ? "STRONG BEAR" : "Mixed"\n    alignmentColor = strongBullish ? color.green : strongBearish ? color.red : color.orange\n    table.cell(dashboard, 1, 6, alignmentText, bgcolor=color.new(alignmentColor, 70), text_color=color.white)\n    \n    // Action\n    table.cell(dashboard, 0, 7, "Action:", text_color=color.rgb(25, 23, 23))\n    actionText = inDeathZone ? "STAY CASH" : strongBullish and inActiveWindow ? "Watch for CALLS" : strongBearish and inActiveWindow ? "Watch for PUTS" : "Wait for Setup"\n    actionColor = inDeathZone ? color.red : strongBullish and inActiveWindow ? color.green : strongBearish and inActiveWindow ? color.red : color.gray\n    table.cell(dashboard, 1, 7, actionText, bgcolor=color.new(actionColor, 70), text_color=color.white)'
[CAPTURE 1] '//@version=5\nindicator("0DTE Strategy", overlay=true, max_labels_count=500, max_boxes_count=500)\n\n// ============================================================================\n// INPUT SETTINGS\n// ============================================================================\n\n// Timeframe Settings\ntrendTimeframe = input.timeframe("5", "Trend Timeframe (5-Min Chart)", group="Timeframes")\nentryTimeframe = input.timeframe("30S", "Entry Timeframe (30-Sec Chart)", group="Timeframes")\n\n// EMA Settings\nemaLength = input.int(9, "EMA Length", minval=1, group="Indicators")\nshowEMA = input.bool(true, "Show 9EMA", group="Indicators")\nemaColor = input.color(color.yellow, "9EMA Color", group="Indicators")\n\n// VWAP Settings\nshowVWAP = input.bool(true, "Show VWAP", group="Indicators")\nvwapColor = input.color(color.blue, "VWAP Color", group="Indicators")\n\n// Trading Window Settings\nshowTradingWindows = input.bool(true, "Show Trading Windows", group="Trading Windows")\ntrade1Start = input.int(935, "Trade 1 Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade1End = input.int(950, "Trade 1 End (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade2Start = input.int(1000, "Trade 2 Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade2End = input.int(1020, "Trade 2 End (EST)", minval=0, maxval=2359, group="Trading Windows")\ndeathZoneStart = input.int(1100, "Death Zone Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ndeathZoneEnd = input.int(1530, "Death Zone End (EST)", minval=0, maxval=2359, group="Trading Windows")\nmocStart = input.int(1545, "MOC Trade Start (EST)", minval=0, maxval=2359, group="Trading Windows")\nmocEnd = input.int(1600, "MOC Trade End (EST)", minval=0, maxval=2359, group="Trading Windows")\n\n// Signal Settings\nshowBuySignals = input.bool(true, "Show Buy Signals", group="Signals")\nshowSellSignals = input.bool(true, "Show Sell Signals", group="Signals")\nshowAlerts = input.bool(true, "Enable Alerts", group="Signals")\n\n// Pre-Market Levels\nshowPMH = input.bool(true, "Show Pre-Market High (PMH)", group="Pre-Market Levels")\nshowPML = input.bool(true, "Show Pre-Market Low (PML)", group="Pre-Market Levels")\nshowPDC = input.bool(true, "Show Previous Day Close (PDC)", group="Pre-Market Levels")\n\n// Visual Settings\ntrade1Color = input.color(color.new(color.green, 90), "Trade 1 Window Color", group="Visual")\ntrade2Color = input.color(color.new(color.blue, 90), "Trade 2 Window Color", group="Visual")\ndeathZoneColor = input.color(color.new(color.red, 90), "Death Zone Color", group="Visual")\nmocColor = input.color(color.new(color.purple, 90), "MOC Window Color", group="Visual")\n\n// ============================================================================\n// INDICATOR CALCULATIONS\n// ============================================================================\n\n// 9EMA Calculation\nema9 = ta.ema(close, emaLength)\n\n// VWAP Calculation\nvwapValue = ta.vwap(close)\n\n// Higher Timeframe EMA (5-Min for trend confirmation)\nhtfEMA = request.security(syminfo.tickerid, trendTimeframe, ta.ema(close, emaLength))\n\n// Higher Timeframe VWAP\nhtfVWAP = request.security(syminfo.tickerid, trendTimeframe, ta.vwap(close))\n\n// ============================================================================\n// TIME FUNCTIONS\n// ============================================================================\n\n// Convert time to minutes since midnight for easier comparison\ngetCurrentTimeEST() =>\n    currentHour = hour(time, "America/New_York")\n    currentMinute = minute(time, "America/New_York")\n    currentHour * 100 + currentMinute\n\ntimeNow = getCurrentTimeEST()\n\n// Check if in specific trading windows\ninTrade1 = timeNow >= trade1Start and timeNow <= trade1End\ninTrade2 = timeNow >= trade2Start and timeNow <= trade2End\ninDeathZone = timeNow >= deathZoneStart and timeNow <= deathZoneEnd\ninMOC = timeNow >= mocStart and timeNow <= mocEnd\ninActiveWindow = (inTrade1 or inTrade2 or inMOC) and not inDeathZone\n\n// ============================================================================\n// PRE-MARKET LEVELS\n// ============================================================================\n\n// Previous Day Close\nvar float pdcLevel = na\nif dayofweek != dayofweek[1]\n    pdcLevel := close[1]\n\n// Pre-Market High and Low (simplified - tracks session high/low before 9:30)\nvar float pmhLevel = na\nvar float pmlLevel = na\n\nisPreMarket = timeNow < 930\n\nif isPreMarket\n    if na(pmhLevel) or high > pmhLevel\n        pmhLevel := high\n    if na(pmlLevel) or low < pmlLevel\n        pmlLevel := low\nelse if timeNow >= 930 and timeNow < 935\n    // Lock in PM levels at market open\n    pmhLevel := pmhLevel\n    pmlLevel := pmlLevel\n\n// ============================================================================\n// TREND ANALYSIS\n// ============================================================================\n\n// 5-Min Trend Conditions\nbullishTrend5m = close > htfVWAP and close > htfEMA\nbearishTrend5m = close < htfVWAP and close < htfEMA\n\n// Current Timeframe Conditions\nbullishNow = close > vwapValue and close > ema9\nbearishNow = close < vwapValue and close < ema9\n\n// Combined Trend Alignment\nstrongBullish = bullishTrend5m and bullishNow\nstrongBearish = bearishTrend5m and bearishNow\n\n// ============================================================================\n// ENTRY SIGNALS\n// ============================================================================\n\n// Look for pullback to 9EMA then bounce\npullbackToBullEMA = low <= ema9 and close > ema9 and close > open\npullbackToBearEMA = high >= ema9 and close < ema9 and close < open\n\n// Higher Low Detection (for Trade 2)\nhigherLow = low > low[1] and low[1] > low[2]\nlowerHigh = high < high[1] and high[1] < high[2]\n\n// Buy Signal: Bullish trend + pullback + green candle + in active window\nbuySignal = strongBullish and pullbackToBullEMA and inActiveWindow\nbuySignalTrade2 = strongBullish and higherLow and inTrade2\n\n// Sell Signal: Bearish trend + pullback + red candle + in active window\nsellSignal = strongBearish and pullbackToBearEMA and inActiveWindow\nsellSignalTrade2 = strongBearish and lowerHigh and inTrade2\n\n// ============================================================================\n// PLOTTING\n// ============================================================================\n\n// Plot EMAs\nplot(showEMA ? ema9 : na, "9EMA (Current TF)", color=emaColor, linewidth=2)\nplot(showEMA ? htfEMA : na, "9EMA (5-Min)", color=color.new(emaColor, 50), linewidth=1, style=plot.style_circles)\n\n// Plot VWAP\nplot(showVWAP ? vwapValue : na, "VWAP (Current TF)", color=vwapColor, linewidth=2)\nplot(showVWAP ? htfVWAP : na, "VWAP (5-Min)", color=color.new(vwapColor, 50), linewidth=1, style=plot.style_circles)\n\n// Plot Pre-Market Levels\nplot(showPDC ? pdcLevel : na, "Previous Day Close", color=color.gray, linewidth=1, style=plot.style_cross)\nplot(showPMH ? pmhLevel : na, "Pre-Market High", color=color.green, linewidth=1, style=plot.style_stepline)\nplot(showPML ? pmlLevel : na, "Pre-Market Low", color=color.red, linewidth=1, style=plot.style_stepline)\n\n// ============================================================================\n// TRADING WINDOW BACKGROUNDS\n// ============================================================================\n\nbgcolor(showTradingWindows and inTrade1 ? trade1Color : na, title="Trade 1 Window")\nbgcolor(showTradingWindows and inTrade2 ? trade2Color : na, title="Trade 2 Window")\nbgcolor(showTradingWindows and inDeathZone ? deathZoneColor : na, title="Death Zone")\nbgcolor(showTradingWindows and inMOC ? mocColor : na, title="MOC Window")\n\n// ============================================================================\n// SIGNAL MARKERS\n// ============================================================================\n\n// Buy Signals\nplotshape(showBuySignals and (buySignal or buySignalTrade2), "Buy Signal", shape.triangleup, location.belowbar, color=color.new(color.green, 0), size=size.small)\n\n// Sell Signals\nplotshape(showSellSignals and (sellSignal or sellSignalTrade2), "Sell Signal", shape.triangledown, location.abovebar, color=color.new(color.red, 0), size=size.small)\n\n// ============================================================================\n// LABELS AND INFO\n// ============================================================================\n\n// Show current window status\nvar label windowLabel = na\nif barstate.islast\n    label.delete(windowLabel)\n    windowText = inTrade1 ? "TRADE 1 ACTIVE" : inTrade2 ? "TRADE 2 ACTIVE" : inDeathZone ? "DEATH ZONE - STAY CASH" : inMOC ? "MOC WINDOW ACTIVE" : "Outside Trading Windows"\n    windowColor = inTrade1 ? color.green : inTrade2 ? color.blue : inDeathZone ? color.red : inMOC ? color.purple : color.gray\n    windowLabel := label.new(bar_index, high, windowText, color=color.new(windowColor, 70), textcolor=color.white, style=label.style_label_down, size=size.normal)\n\n// Show trend status\nvar label trendLabel = na\nif barstate.islast\n    label.delete(trendLabel)\n    trendText = strongBullish ? "STRONG BULLISH ↑" : strongBearish ? "STRONG BEARISH ↓" : bullishNow ? "Bullish (Current TF)" : bearishNow ? "Bearish (Current TF)" : "Neutral/Choppy"\n    trendColor = strongBullish ? color.green : strongBearish ? color.red : color.orange\n    trendLabel := label.new(bar_index, low, trendText, color=color.new(trendColor, 70), textcolor=color.white, style=label.style_label_up, size=size.normal)\n\n// ============================================================================\n// ALERTS\n// ============================================================================\n\nif showAlerts\n    if buySignal or buySignalTrade2\n        alert("30-Day Sprint: BUY SIGNAL - Price above VWAP + 9EMA in active window", alert.freq_once_per_bar)\n    if sellSignal or sellSignalTrade2\n        alert("30-Day Sprint: SELL SIGNAL - Price below VWAP + 9EMA in active window", alert.freq_once_per_bar)\n    if inDeathZone and not inDeathZone[1]\n        alert("30-Day Sprint: DEATH ZONE ENTERED - Stay Cash, Avoid Trading", alert.freq_once_per_bar)\n    if inMOC and not inMOC[1]\n        alert("30-Day Sprint: MOC WINDOW OPEN - Check imbalance data", alert.freq_once_per_bar)\n\n// ============================================================================\n// TABLE DISPLAY (Optional Dashboard)\n// ============================================================================\n\nvar table dashboard = table.new(position.top_right, 2, 8, border_width=1)\n\nif barstate.islast\n    // Header\n    table.cell(dashboard, 0, 0, "30-Day Sprint Dashboard", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.normal)\n    table.merge_cells(dashboard, 0, 0, 1, 0)\n    \n    // Current Status\n    table.cell(dashboard, 0, 1, "Window:", text_color=color.rgb(25, 23, 23))\n    windowStatusText = inTrade1 ? "Trade 1" : inTrade2 ? "Trade 2" : inDeathZone ? "DEATH ZONE" : inMOC ? "MOC" : "Closed"\n    windowStatusColor = inTrade1 ? color.green : inTrade2 ? color.blue : inDeathZone ? color.red : inMOC ? color.purple : color.gray\n    table.cell(dashboard, 1, 1, windowStatusText, bgcolor=color.new(windowStatusColor, 70), text_color=color.white)\n    \n    // Trend Status\n    table.cell(dashboard, 0, 2, "5-Min Trend:", text_color=color.rgb(14, 12, 12))\n    trend5mText = bullishTrend5m ? "BULLISH ↑" : bearishTrend5m ? "BEARISH ↓" : "NEUTRAL"\n    trend5mColor = bullishTrend5m ? color.green : bearishTrend5m ? color.red : color.orange\n    table.cell(dashboard, 1, 2, trend5mText, bgcolor=color.new(trend5mColor, 70), text_color=color.white)\n    \n    // Current TF Trend\n    table.cell(dashboard, 0, 3, "Current TF:", text_color=color.rgb(39, 36, 36))\n    currentTrendText = bullishNow ? "Bullish ↑" : bearishNow ? "Bearish ↓" : "Neutral"\n    currentTrendColor = bullishNow ? color.green : bearishNow ? color.red : color.orange\n    table.cell(dashboard, 1, 3, currentTrendText, bgcolor=color.new(currentTrendColor, 70), text_color=color.white)\n    \n    // Price vs VWAP\n    table.cell(dashboard, 0, 4, "Price vs VWAP:", text_color=color.rgb(52, 48, 48))\n    vwapStatus = close > vwapValue ? "ABOVE ✓" : "BELOW ✗"\n    vwapStatusColor = close > vwapValue ? color.green : color.red\n    table.cell(dashboard, 1, 4, vwapStatus, bgcolor=color.new(vwapStatusColor, 70), text_color=color.white)\n    \n    // Price vs 9EMA\n    table.cell(dashboard, 0, 5, "Price vs 9EMA:", text_color=color.rgb(17, 15, 15))\n    emaStatus = close > ema9 ? "ABOVE ✓" : "BELOW ✗"\n    emaStatusColor = close > ema9 ? color.green : color.red\n    table.cell(dashboard, 1, 5, emaStatus, bgcolor=color.new(emaStatusColor, 70), text_color=color.white)\n    \n    // Alignment Status\n    table.cell(dashboard, 0, 6, "Alignment:", text_color=color.rgb(22, 20, 20))\n    alignmentText = strongBullish ? "STRONG BULL" : strongBearish ? "STRONG BEAR" : "Mixed"\n    alignmentColor = strongBullish ? color.green : strongBearish ? color.red : color.orange\n    table.cell(dashboard, 1, 6, alignmentText, bgcolor=color.new(alignmentColor, 70), text_color=color.white)\n    \n    // Action\n    table.cell(dashboard, 0, 7, "Action:", text_color=color.rgb(25, 23, 23))\n    actionText = inDeathZone ? "STAY CASH" : strongBullish and inActiveWindow ? "Watch for CALLS" : strongBearish and inActiveWindow ? "Watch for PUTS" : "Wait for Setup"\n    actionColor = inDeathZone ? color.red : strongBullish and inActiveWindow ? color.green : strongBearish and inActiveWindow ? color.red : color.gray\n    table.cell(dashboard, 1, 7, actionText, bgcolor=color.new(actionColor, 70), text_color=color.white)'
[CAPTURE 2] '//@version=5\nindicator("0DTE Strategy", overlay=true, max_labels_count=500, max_boxes_count=500)\n\n// ============================================================================\n// INPUT SETTINGS\n// ============================================================================\n\n// Timeframe Settings\ntrendTimeframe = input.timeframe("5", "Trend Timeframe (5-Min Chart)", group="Timeframes")\nentryTimeframe = input.timeframe("30S", "Entry Timeframe (30-Sec Chart)", group="Timeframes")\n\n// EMA Settings\nemaLength = input.int(9, "EMA Length", minval=1, group="Indicators")\nshowEMA = input.bool(true, "Show 9EMA", group="Indicators")\nemaColor = input.color(color.yellow, "9EMA Color", group="Indicators")\n\n// VWAP Settings\nshowVWAP = input.bool(true, "Show VWAP", group="Indicators")\nvwapColor = input.color(color.blue, "VWAP Color", group="Indicators")\n\n// Trading Window Settings\nshowTradingWindows = input.bool(true, "Show Trading Windows", group="Trading Windows")\ntrade1Start = input.int(935, "Trade 1 Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade1End = input.int(950, "Trade 1 End (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade2Start = input.int(1000, "Trade 2 Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ntrade2End = input.int(1020, "Trade 2 End (EST)", minval=0, maxval=2359, group="Trading Windows")\ndeathZoneStart = input.int(1100, "Death Zone Start (EST)", minval=0, maxval=2359, group="Trading Windows")\ndeathZoneEnd = input.int(1530, "Death Zone End (EST)", minval=0, maxval=2359, group="Trading Windows")\nmocStart = input.int(1545, "MOC Trade Start (EST)", minval=0, maxval=2359, group="Trading Windows")\nmocEnd = input.int(1600, "MOC Trade End (EST)", minval=0, maxval=2359, group="Trading Windows")\n\n// Signal Settings\nshowBuySignals = input.bool(true, "Show Buy Signals", group="Signals")\nshowSellSignals = input.bool(true, "Show Sell Signals", group="Signals")\nshowAlerts = input.bool(true, "Enable Alerts", group="Signals")\n\n// Pre-Market Levels\nshowPMH = input.bool(true, "Show Pre-Market High (PMH)", group="Pre-Market Levels")\nshowPML = input.bool(true, "Show Pre-Market Low (PML)", group="Pre-Market Levels")\nshowPDC = input.bool(true, "Show Previous Day Close (PDC)", group="Pre-Market Levels")\n\n// Visual Settings\ntrade1Color = input.color(color.new(color.green, 90), "Trade 1 Window Color", group="Visual")\ntrade2Color = input.color(color.new(color.blue, 90), "Trade 2 Window Color", group="Visual")\ndeathZoneColor = input.color(color.new(color.red, 90), "Death Zone Color", group="Visual")\nmocColor = input.color(color.new(color.purple, 90), "MOC Window Color", group="Visual")\n\n// ============================================================================\n// INDICATOR CALCULATIONS\n// ============================================================================\n\n// 9EMA Calculation\nema9 = ta.ema(close, emaLength)\n\n// VWAP Calculation\nvwapValue = ta.vwap(close)\n\n// Higher Timeframe EMA (5-Min for trend confirmation)\nhtfEMA = request.security(syminfo.tickerid, trendTimeframe, ta.ema(close, emaLength))\n\n// Higher Timeframe VWAP\nhtfVWAP = request.security(syminfo.tickerid, trendTimeframe, ta.vwap(close))\n\n// ============================================================================\n// TIME FUNCTIONS\n// ============================================================================\n\n// Convert time to minutes since midnight for easier comparison\ngetCurrentTimeEST() =>\n    currentHour = hour(time, "America/New_York")\n    currentMinute = minute(time, "America/New_York")\n    currentHour * 100 + currentMinute\n\ntimeNow = getCurrentTimeEST()\n\n// Check if in specific trading windows\ninTrade1 = timeNow >= trade1Start and timeNow <= trade1End\ninTrade2 = timeNow >= trade2Start and timeNow <= trade2End\ninDeathZone = timeNow >= deathZoneStart and timeNow <= deathZoneEnd\ninMOC = timeNow >= mocStart and timeNow <= mocEnd\ninActiveWindow = (inTrade1 or inTrade2 or inMOC) and not inDeathZone\n\n// ============================================================================\n// PRE-MARKET LEVELS\n// ============================================================================\n\n// Previous Day Close\nvar float pdcLevel = na\nif dayofweek != dayofweek[1]\n    pdcLevel := close[1]\n\n// Pre-Market High and Low (simplified - tracks session high/low before 9:30)\nvar float pmhLevel = na\nvar float pmlLevel = na\n\nisPreMarket = timeNow < 930\n\nif isPreMarket\n    if na(pmhLevel) or high > pmhLevel\n        pmhLevel := high\n    if na(pmlLevel) or low < pmlLevel\n        pmlLevel := low\nelse if timeNow >= 930 and timeNow < 935\n    // Lock in PM levels at market open\n    pmhLevel := pmhLevel\n    pmlLevel := pmlLevel\n\n// ============================================================================\n// TREND ANALYSIS\n// ============================================================================\n\n// 5-Min Trend Conditions\nbullishTrend5m = close > htfVWAP and close > htfEMA\nbearishTrend5m = close < htfVWAP and close < htfEMA\n\n// Current Timeframe Conditions\nbullishNow = close > vwapValue and close > ema9\nbearishNow = close < vwapValue and close < ema9\n\n// Combined Trend Alignment\nstrongBullish = bullishTrend5m and bullishNow\nstrongBearish = bearishTrend5m and bearishNow\n\n// ============================================================================\n// ENTRY SIGNALS\n// ============================================================================\n\n// Look for pullback to 9EMA then bounce\npullbackToBullEMA = low <= ema9 and close > ema9 and close > open\npullbackToBearEMA = high >= ema9 and close < ema9 and close < open\n\n// Higher Low Detection (for Trade 2)\nhigherLow = low > low[1] and low[1] > low[2]\nlowerHigh = high < high[1] and high[1] < high[2]\n\n// Buy Signal: Bullish trend + pullback + green candle + in active window\nbuySignal = strongBullish and pullbackToBullEMA and inActiveWindow\nbuySignalTrade2 = strongBullish and higherLow and inTrade2\n\n// Sell Signal: Bearish trend + pullback + red candle + in active window\nsellSignal = strongBearish and pullbackToBearEMA and inActiveWindow\nsellSignalTrade2 = strongBearish and lowerHigh and inTrade2\n\n// ============================================================================\n// PLOTTING\n// ============================================================================\n\n// Plot EMAs\nplot(showEMA ? ema9 : na, "9EMA (Current TF)", color=emaColor, linewidth=2)\nplot(showEMA ? htfEMA : na, "9EMA (5-Min)", color=color.new(emaColor, 50), linewidth=1, style=plot.style_circles)\n\n// Plot VWAP\nplot(showVWAP ? vwapValue : na, "VWAP (Current TF)", color=vwapColor, linewidth=2)\nplot(showVWAP ? htfVWAP : na, "VWAP (5-Min)", color=color.new(vwapColor, 50), linewidth=1, style=plot.style_circles)\n\n// Plot Pre-Market Levels\nplot(showPDC ? pdcLevel : na, "Previous Day Close", color=color.gray, linewidth=1, style=plot.style_cross)\nplot(showPMH ? pmhLevel : na, "Pre-Market High", color=color.green, linewidth=1, style=plot.style_stepline)\nplot(showPML ? pmlLevel : na, "Pre-Market Low", color=color.red, linewidth=1, style=plot.style_stepline)\n\n// ============================================================================\n// TRADING WINDOW BACKGROUNDS\n// ============================================================================\n\nbgcolor(showTradingWindows and inTrade1 ? trade1Color : na, title="Trade 1 Window")\nbgcolor(showTradingWindows and inTrade2 ? trade2Color : na, title="Trade 2 Window")\nbgcolor(showTradingWindows and inDeathZone ? deathZoneColor : na, title="Death Zone")\nbgcolor(showTradingWindows and inMOC ? mocColor : na, title="MOC Window")\n\n// ============================================================================\n// SIGNAL MARKERS\n// ============================================================================\n\n// Buy Signals\nplotshape(showBuySignals and (buySignal or buySignalTrade2), "Buy Signal", shape.triangleup, location.belowbar, color=color.new(color.green, 0), size=size.small)\n\n// Sell Signals\nplotshape(showSellSignals and (sellSignal or sellSignalTrade2), "Sell Signal", shape.triangledown, location.abovebar, color=color.new(color.red, 0), size=size.small)\n\n// ============================================================================\n// LABELS AND INFO\n// ============================================================================\n\n// Show current window status\nvar label windowLabel = na\nif barstate.islast\n    label.delete(windowLabel)\n    windowText = inTrade1 ? "TRADE 1 ACTIVE" : inTrade2 ? "TRADE 2 ACTIVE" : inDeathZone ? "DEATH ZONE - STAY CASH" : inMOC ? "MOC WINDOW ACTIVE" : "Outside Trading Windows"\n    windowColor = inTrade1 ? color.green : inTrade2 ? color.blue : inDeathZone ? color.red : inMOC ? color.purple : color.gray\n    windowLabel := label.new(bar_index, high, windowText, color=color.new(windowColor, 70), textcolor=color.white, style=label.style_label_down, size=size.normal)\n\n// Show trend status\nvar label trendLabel = na\nif barstate.islast\n    label.delete(trendLabel)\n    trendText = strongBullish ? "STRONG BULLISH ↑" : strongBearish ? "STRONG BEARISH ↓" : bullishNow ? "Bullish (Current TF)" : bearishNow ? "Bearish (Current TF)" : "Neutral/Choppy"\n    trendColor = strongBullish ? color.green : strongBearish ? color.red : color.orange\n    trendLabel := label.new(bar_index, low, trendText, color=color.new(trendColor, 70), textcolor=color.white, style=label.style_label_up, size=size.normal)\n\n// ============================================================================\n// ALERTS\n// ============================================================================\n\nif showAlerts\n    if buySignal or buySignalTrade2\n        alert("30-Day Sprint: BUY SIGNAL - Price above VWAP + 9EMA in active window", alert.freq_once_per_bar)\n    if sellSignal or sellSignalTrade2\n        alert("30-Day Sprint: SELL SIGNAL - Price below VWAP + 9EMA in active window", alert.freq_once_per_bar)\n    if inDeathZone and not inDeathZone[1]\n        alert("30-Day Sprint: DEATH ZONE ENTERED - Stay Cash, Avoid Trading", alert.freq_once_per_bar)\n    if inMOC and not inMOC[1]\n        alert("30-Day Sprint: MOC WINDOW OPEN - Check imbalance data", alert.freq_once_per_bar)\n\n// ============================================================================\n// TABLE DISPLAY (Optional Dashboard)\n// ============================================================================\n\nvar table dashboard = table.new(position.top_right, 2, 8, border_width=1)\n\nif barstate.islast\n    // Header\n    table.cell(dashboard, 0, 0, "30-Day Sprint Dashboard", bgcolor=color.new(color.gray, 50), text_color=color.white, text_size=size.normal)\n    table.merge_cells(dashboard, 0, 0, 1, 0)\n    \n    // Current Status\n    table.cell(dashboard, 0, 1, "Window:", text_color=color.rgb(25, 23, 23))\n    windowStatusText = inTrade1 ? "Trade 1" : inTrade2 ? "Trade 2" : inDeathZone ? "DEATH ZONE" : inMOC ? "MOC" : "Closed"\n    windowStatusColor = inTrade1 ? color.green : inTrade2 ? color.blue : inDeathZone ? color.red : inMOC ? color.purple : color.gray\n    table.cell(dashboard, 1, 1, windowStatusText, bgcolor=color.new(windowStatusColor, 70), text_color=color.white)\n    \n    // Trend Status\n    table.cell(dashboard, 0, 2, "5-Min Trend:", text_color=color.rgb(14, 12, 12))\n    trend5mText = bullishTrend5m ? "BULLISH ↑" : bearishTrend5m ? "BEARISH ↓" : "NEUTRAL"\n    trend5mColor = bullishTrend5m ? color.green : bearishTrend5m ? color.red : color.orange\n    table.cell(dashboard, 1, 2, trend5mText, bgcolor=color.new(trend5mColor, 70), text_color=color.white)\n    \n    // Current TF Trend\n    table.cell(dashboard, 0, 3, "Current TF:", text_color=color.rgb(39, 36, 36))\n    currentTrendText = bullishNow ? "Bullish ↑" : bearishNow ? "Bearish ↓" : "Neutral"\n    currentTrendColor = bullishNow ? color.green : bearishNow ? color.red : color.orange\n    table.cell(dashboard, 1, 3, currentTrendText, bgcolor=color.new(currentTrendColor, 70), text_color=color.white)\n    \n    // Price vs VWAP\n    table.cell(dashboard, 0, 4, "Price vs VWAP:", text_color=color.rgb(52, 48, 48))\n    vwapStatus = close > vwapValue ? "ABOVE ✓" : "BELOW ✗"\n    vwapStatusColor = close > vwapValue ? color.green : color.red\n    table.cell(dashboard, 1, 4, vwapStatus, bgcolor=color.new(vwapStatusColor, 70), text_color=color.white)\n    \n    // Price vs 9EMA\n    table.cell(dashboard, 0, 5, "Price vs 9EMA:", text_color=color.rgb(17, 15, 15))\n    emaStatus = close > ema9 ? "ABOVE ✓" : "BELOW ✗"\n    emaStatusColor = close > ema9 ? color.green : color.red\n    table.cell(dashboard, 1, 5, emaStatus, bgcolor=color.new(emaStatusColor, 70), text_color=color.white)\n    \n    // Alignment Status\n    table.cell(dashboard, 0, 6, "Alignment:", text_color=color.rgb(22, 20, 20))\n    alignmentText = strongBullish ? "STRONG BULL" : strongBearish ? "STRONG BEAR" : "Mixed"\n    alignmentColor = strongBullish ? color.green : strongBearish ? color.red : color.orange\n    table.cell(dashboard, 1, 6, alignmentText, bgcolor=color.new(alignmentColor, 70), text_color=color.white)\n    \n    // Action\n    table.cell(dashboard, 0, 7, "Action:", text_color=color.rgb(25, 23, 23))\n    actionText = inDeathZone ? "STAY CASH" : strongBullish and inActiveWindow ? "Watch for CALLS" : strongBearish and inActiveWindow ? "Watch for PUTS" : "Wait for Setup"\n    actionColor = inDeathZone ? color.red : strongBullish and inActiveWindow ? color.green : strongBearish and inActiveWindow ? color.red : color.gray\n    table.cell(dashboard, 1, 7, actionText, bgcolor=color.new(actionColor, 70), text_color=color.white)'
[DEBUG] save_script called: script_id=dPce50Ra title=0DTE Strategy category=dPce50Ra force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\dPce50Ra_0DTE_Strategy.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\dPce50Ra_0DTE_Strategy.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected
[cleanup] Removed diagnostic artifacts from: pinescript_downloads\indicators
[setup] launching browser; headless=False user_agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15
[setup] browser launched
[DEBUG] Raw pubtext extracted: 'Mon, 09 Feb 2026 01:50:49 GMT'
[DEBUG] Parsed RFC-2822 time 'Mon, 09 Feb 2026 01:50:49 GMT' as: 2026-02-09T01:50:49+00:00
[DEBUG] Exact published date for header: 2026-02-09T01:50:49+00:00
   [debug] Injected copy-capture init script
Diagnostics: visiting https://www.tradingview.com/script/pEv3L2VL-Mouchli-Zone-Projection-Tool/
   [debug] Clicked Source code tab for diagnostics
[BUTTON] [class*="copy"] idx=0 text= nearby_sample=1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=1 text=English

Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 F nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[BUTTON] [class*="copy"] idx=2 text=Select market data provided by ICE Data Services.
Select reference data provided by FactSet. Copyright © 2026 FactSet Re nearby_sample=
  [STRUCTURE SAMPLE]
    - DIV : Main content
    - SCRIPT : (()=>{"use strict";window.initData=window.initData||{},window.initData.block_widgetbar=function(i,t,n,a){function w(n){const w={resizerBridge:new t(window).allocate({areaName:"right"}),affectsLayout:(
    - SCRIPT : (()=>{"use strict";function n(){const n=parseFloat(document.body.style.paddingRight||"0");document.body.classList.toggle("is-widgetbar-expanded",n>45)}n(),function(n){let t=null;function e(){null===t&
    - DIV : Search
	
	
							


		
			Products
					
				
			
				
			Community
					
				
			
				
			Markets
					
				
			
				
			Brokers
					
				
			
				
			More
					
				
			
		

							
											



    - SCRIPT : window.fbAppId = "155037361239837";
    - SCRIPT : window.BLOG_LOCALIZED_URL = "https://www.tradingview.com/blog/en/";


			initData.idc_exchanges_list = ["nzx","bme","bme_stocks","shfe","szse","nag","tfx","twse","bcba","bvc","bvcv","bmv","bvmt","bvl"
    - LINK : 
    - LINK : 
[CAPTURE 0] '//@version=5\r\nindicator("Mouchli Zone Projectection Tool", overlay=true)\r\n\r\n// --- GLOBAL STYLES ---\r\ngrp_style = "Style Settings"\r\n\r\n// Daily Style\r\nc_d_zone = input.color(color.new(color.gray, 85), "Daily Zone Color", group=grp_style)\r\nc_d_line = input.color(color.new(color.purple, 80), "Daily Line Color", group=grp_style)\r\n\r\n// Weekly Style\r\nc_w_zone = input.color(color.new(color.white, 85), "Weekly Zone Color", group=grp_style)\r\nc_w_line = input.color(color.new(color.orange, 80), "Weekly Line Color", group=grp_style)\r\n\r\n// --- DRAWING FUNCTION ---\r\ndraw_grid(z1_t, z1_b, z2_t, z2_b, zone_col, line_col, p_up, p_down, show) =>\r\n    if show and z1_t > 0 and z2_t > 0\r\n        float z1_c = (z1_t + z1_b) / 2\r\n        float z2_c = (z2_t + z2_b) / 2\r\n        float dist = math.abs(z2_c - z1_c)\r\n        float avg_thick = (math.abs(z1_t - z1_b) + math.abs(z2_t - z2_b)) / 2\r\n        float half_thick = avg_thick / 2\r\n        float start_c = math.min(z1_c, z2_c)\r\n\r\n        for i = -p_down to (1 + p_up)\r\n            float cur_c = start_c + (dist * i)\r\n            // Draw Zone (No border)\r\n            box.new(bar_index - 500, cur_c + half_thick, bar_index + 10, cur_c - half_thick, border_color=na, bgcolor=zone_col, extend=extend.both)\r\n            // Draw Halfway Line\r\n            if i < (1 + p_up)\r\n                float hw = cur_c + (dist / 2)\r\n                line.new(bar_index - 500, hw, bar_index + 10, hw, style=line.style_dashed, color=line_col, extend=extend.both)\r\n\r\n// ==========================================\r\n// ASSET INPUTS\r\n// ==========================================\r\n\r\n// --- SLOT 1 ---\r\ngrp_s1 = "Asset 1"\r\ns1_name = input.string("QQQ", "Ticker", group=grp_s1)\r\n// New: Per-Asset Projectections\r\ns1_up   = input.int(5, "Project Up", inline="s1_p", group=grp_s1)\r\ns1_dn   = input.int(5, "Project Down", inline="s1_p", group=grp_s1)\r\n\r\n// Daily\r\ns1_d_show = input.bool(true, "Show Daily Zones", group=grp_s1) \r\ns1_d_z1_t = input.price(609.20, "Z1 Top", inline="s1_d1", group=grp_s1)\r\ns1_d_z1_b = input.price(609.0, "Z1 Bottom", inline="s1_d1", group=grp_s1)\r\ns1_d_z2_t = input.price(607.20, "Z2 Top", inline="s1_d2", group=grp_s1)\r\ns1_d_z2_b = input.price(607.0, "Z2 Bottom", inline="s1_d2", group=grp_s1)\r\n// Weekly\r\ns1_w_show = input.bool(true, "Show Weekly Zones", group=grp_s1)\r\ns1_w_z1_t = input.price(0.0, "Z1 Top", inline="s1_w1", group=grp_s1)\r\ns1_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s1_w1", group=grp_s1)\r\ns1_w_z2_t = input.price(0.0, "Z2 Top", inline="s1_w2", group=grp_s1)\r\ns1_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s1_w2", group=grp_s1)\r\n\r\n// --- SLOT 2 ---\r\ngrp_s2 = "Asset 2"\r\ns2_name = input.string("ES", "Ticker", group=grp_s2)\r\ns2_up   = input.int(5, "Project Up", inline="s2_p", group=grp_s2)\r\ns2_dn   = input.int(5, "Project Down", inline="s2_p", group=grp_s2)\r\n\r\n// Daily\r\ns2_d_show = input.bool(true, "Show Daily Zones", group=grp_s2)\r\ns2_d_z1_t = input.price(0.0, "Z1 Top", inline="s2_d1", group=grp_s2)\r\ns2_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s2_d1", group=grp_s2)\r\ns2_d_z2_t = input.price(0.0, "Z2 Top", inline="s2_d2", group=grp_s2)\r\ns2_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s2_d2", group=grp_s2)\r\n// Weekly\r\ns2_w_show = input.bool(true, "Show Weekly Zones", group=grp_s2)\r\ns2_w_z1_t = input.price(0.0, "Z1 Top", inline="s2_w1", group=grp_s2)\r\ns2_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s2_w1", group=grp_s2)\r\ns2_w_z2_t = input.price(0.0, "Z2 Top", inline="s2_w2", group=grp_s2)\r\ns2_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s2_w2", group=grp_s2)\r\n\r\n// --- SLOT 3 ---\r\ngrp_s3 = "Asset 3"\r\ns3_name = input.string("NVDA", "Ticker", group=grp_s3)\r\ns3_up   = input.int(5, "Project Up", inline="s3_p", group=grp_s3)\r\ns3_dn   = input.int(5, "Project Down", inline="s3_p", group=grp_s3)\r\n\r\n// Daily\r\ns3_d_show = input.bool(true, "Show Daily Zones", group=grp_s3)\r\ns3_d_z1_t = input.price(0.0, "Z1 Top", inline="s3_d1", group=grp_s3)\r\ns3_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s3_d1", group=grp_s3)\r\ns3_d_z2_t = input.price(0.0, "Z2 Top", inline="s3_d2", group=grp_s3)\r\ns3_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s3_d2", group=grp_s3)\r\n// Weekly\r\ns3_w_show = input.bool(true, "Show Weekly Zones", group=grp_s3)\r\ns3_w_z1_t = input.price(0.0, "Z1 Top", inline="s3_w1", group=grp_s3)\r\ns3_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s3_w1", group=grp_s3)\r\ns3_w_z2_t = input.price(0.0, "Z2 Top", inline="s3_w2", group=grp_s3)\r\ns3_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s3_w2", group=grp_s3)\r\n\r\n// --- SLOT 4 ---\r\ngrp_s4 = "Asset 4"\r\ns4_name = input.string("SPY", "Ticker", group=grp_s4)\r\ns4_up   = input.int(5, "Project Up", inline="s4_p", group=grp_s4)\r\ns4_dn   = input.int(5, "Project Down", inline="s4_p", group=grp_s4)\r\n\r\n// Daily\r\ns4_d_show = input.bool(true, "Show Daily Zones", group=grp_s4)\r\ns4_d_z1_t = input.price(0.0, "Z1 Top", inline="s4_d1", group=grp_s4)\r\ns4_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s4_d1", group=grp_s4)\r\ns4_d_z2_t = input.price(0.0, "Z2 Top", inline="s4_d2", group=grp_s4)\r\ns4_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s4_d2", group=grp_s4)\r\n// Weekly\r\ns4_w_show = input.bool(true, "Show Weekly Zones", group=grp_s4)\r\ns4_w_z1_t = input.price(0.0, "Z1 Top", inline="s4_w1", group=grp_s4)\r\ns4_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s4_w1", group=grp_s4)\r\ns4_w_z2_t = input.price(0.0, "Z2 Top", inline="s4_w2", group=grp_s4)\r\ns4_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s4_w2", group=grp_s4)\r\n\r\n// --- SLOT 5 ---\r\ngrp_s5 = "Asset 5"\r\ns5_name = input.string("META", "Ticker", group=grp_s5)\r\ns5_up   = input.int(5, "Project Up", inline="s5_p", group=grp_s5)\r\ns5_dn   = input.int(5, "Project Down", inline="s5_p", group=grp_s5)\r\n\r\n// Daily\r\ns5_d_show = input.bool(true, "Show Daily Zones", group=grp_s5)\r\ns5_d_z1_t = input.price(0.0, "Z1 Top", inline="s5_d1", group=grp_s5)\r\ns5_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s5_d1", group=grp_s5)\r\ns5_d_z2_t = input.price(0.0, "Z2 Top", inline="s5_d2", group=grp_s5)\r\ns5_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s5_d2", group=grp_s5)\r\n// Weekly\r\ns5_w_show = input.bool(true, "Show Weekly Zones", group=grp_s5)\r\ns5_w_z1_t = input.price(0.0, "Z1 Top", inline="s5_w1", group=grp_s5)\r\ns5_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s5_w1", group=grp_s5)\r\ns5_w_z2_t = input.price(0.0, "Z2 Top", inline="s5_w2", group=grp_s5)\r\ns5_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s5_w2", group=grp_s5)\r\n\r\n\r\n// --- MAIN LOGIC ---\r\nmatch(n) => n != "" and (str.contains(str.lower(syminfo.ticker), str.lower(n)) or str.contains(str.lower(syminfo.root), str.lower(n)))\r\n\r\nif match(s1_name)\r\n    draw_grid(s1_d_z1_t, s1_d_z1_b, s1_d_z2_t, s1_d_z2_b, c_d_zone, c_d_line, s1_up, s1_dn, s1_d_show)\r\n    draw_grid(s1_w_z1_t, s1_w_z1_b, s1_w_z2_t, s1_w_z2_b, c_w_zone, c_w_line, s1_up, s1_dn, s1_w_show)\r\n\r\nelse if match(s2_name)\r\n    draw_grid(s2_d_z1_t, s2_d_z1_b, s2_d_z2_t, s2_d_z2_b, c_d_zone, c_d_line, s2_up, s2_dn, s2_d_show)\r\n    draw_grid(s2_w_z1_t, s2_w_z1_b, s2_w_z2_t, s2_w_z2_b, c_w_zone, c_w_line, s2_up, s2_dn, s2_w_show)\r\n\r\nelse if match(s3_name)\r\n    draw_grid(s3_d_z1_t, s3_d_z1_b, s3_d_z2_t, s3_d_z2_b, c_d_zone, c_d_line, s3_up, s3_dn, s3_d_show)\r\n    draw_grid(s3_w_z1_t, s3_w_z1_b, s3_w_z2_t, s3_w_z2_b, c_w_zone, c_w_line, s3_up, s3_dn, s3_w_show)\r\n\r\nelse if match(s4_name)\r\n    draw_grid(s4_d_z1_t, s4_d_z1_b, s4_d_z2_t, s4_d_z2_b, c_d_zone, c_d_line, s4_up, s4_dn, s4_d_show)\r\n    draw_grid(s4_w_z1_t, s4_w_z1_b, s4_w_z2_t, s4_w_z2_b, c_w_zone, c_w_line, s4_up, s4_dn, s4_w_show)\r\n\r\nelse if match(s5_name)\r\n    draw_grid(s5_d_z1_t, s5_d_z1_b, s5_d_z2_t, s5_d_z2_b, c_d_zone, c_d_line, s5_up, s5_dn, s5_d_show)\r\n    draw_grid(s5_w_z1_t, s5_w_z1_b, s5_w_z2_t, s5_w_z2_b, c_w_zone, c_w_line, s5_up, s5_dn, s5_w_show)'
[CAPTURE 1] '//@version=5\r\nindicator("Mouchli Zone Projectection Tool", overlay=true)\r\n\r\n// --- GLOBAL STYLES ---\r\ngrp_style = "Style Settings"\r\n\r\n// Daily Style\r\nc_d_zone = input.color(color.new(color.gray, 85), "Daily Zone Color", group=grp_style)\r\nc_d_line = input.color(color.new(color.purple, 80), "Daily Line Color", group=grp_style)\r\n\r\n// Weekly Style\r\nc_w_zone = input.color(color.new(color.white, 85), "Weekly Zone Color", group=grp_style)\r\nc_w_line = input.color(color.new(color.orange, 80), "Weekly Line Color", group=grp_style)\r\n\r\n// --- DRAWING FUNCTION ---\r\ndraw_grid(z1_t, z1_b, z2_t, z2_b, zone_col, line_col, p_up, p_down, show) =>\r\n    if show and z1_t > 0 and z2_t > 0\r\n        float z1_c = (z1_t + z1_b) / 2\r\n        float z2_c = (z2_t + z2_b) / 2\r\n        float dist = math.abs(z2_c - z1_c)\r\n        float avg_thick = (math.abs(z1_t - z1_b) + math.abs(z2_t - z2_b)) / 2\r\n        float half_thick = avg_thick / 2\r\n        float start_c = math.min(z1_c, z2_c)\r\n\r\n        for i = -p_down to (1 + p_up)\r\n            float cur_c = start_c + (dist * i)\r\n            // Draw Zone (No border)\r\n            box.new(bar_index - 500, cur_c + half_thick, bar_index + 10, cur_c - half_thick, border_color=na, bgcolor=zone_col, extend=extend.both)\r\n            // Draw Halfway Line\r\n            if i < (1 + p_up)\r\n                float hw = cur_c + (dist / 2)\r\n                line.new(bar_index - 500, hw, bar_index + 10, hw, style=line.style_dashed, color=line_col, extend=extend.both)\r\n\r\n// ==========================================\r\n// ASSET INPUTS\r\n// ==========================================\r\n\r\n// --- SLOT 1 ---\r\ngrp_s1 = "Asset 1"\r\ns1_name = input.string("QQQ", "Ticker", group=grp_s1)\r\n// New: Per-Asset Projectections\r\ns1_up   = input.int(5, "Project Up", inline="s1_p", group=grp_s1)\r\ns1_dn   = input.int(5, "Project Down", inline="s1_p", group=grp_s1)\r\n\r\n// Daily\r\ns1_d_show = input.bool(true, "Show Daily Zones", group=grp_s1) \r\ns1_d_z1_t = input.price(609.20, "Z1 Top", inline="s1_d1", group=grp_s1)\r\ns1_d_z1_b = input.price(609.0, "Z1 Bottom", inline="s1_d1", group=grp_s1)\r\ns1_d_z2_t = input.price(607.20, "Z2 Top", inline="s1_d2", group=grp_s1)\r\ns1_d_z2_b = input.price(607.0, "Z2 Bottom", inline="s1_d2", group=grp_s1)\r\n// Weekly\r\ns1_w_show = input.bool(true, "Show Weekly Zones", group=grp_s1)\r\ns1_w_z1_t = input.price(0.0, "Z1 Top", inline="s1_w1", group=grp_s1)\r\ns1_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s1_w1", group=grp_s1)\r\ns1_w_z2_t = input.price(0.0, "Z2 Top", inline="s1_w2", group=grp_s1)\r\ns1_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s1_w2", group=grp_s1)\r\n\r\n// --- SLOT 2 ---\r\ngrp_s2 = "Asset 2"\r\ns2_name = input.string("ES", "Ticker", group=grp_s2)\r\ns2_up   = input.int(5, "Project Up", inline="s2_p", group=grp_s2)\r\ns2_dn   = input.int(5, "Project Down", inline="s2_p", group=grp_s2)\r\n\r\n// Daily\r\ns2_d_show = input.bool(true, "Show Daily Zones", group=grp_s2)\r\ns2_d_z1_t = input.price(0.0, "Z1 Top", inline="s2_d1", group=grp_s2)\r\ns2_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s2_d1", group=grp_s2)\r\ns2_d_z2_t = input.price(0.0, "Z2 Top", inline="s2_d2", group=grp_s2)\r\ns2_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s2_d2", group=grp_s2)\r\n// Weekly\r\ns2_w_show = input.bool(true, "Show Weekly Zones", group=grp_s2)\r\ns2_w_z1_t = input.price(0.0, "Z1 Top", inline="s2_w1", group=grp_s2)\r\ns2_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s2_w1", group=grp_s2)\r\ns2_w_z2_t = input.price(0.0, "Z2 Top", inline="s2_w2", group=grp_s2)\r\ns2_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s2_w2", group=grp_s2)\r\n\r\n// --- SLOT 3 ---\r\ngrp_s3 = "Asset 3"\r\ns3_name = input.string("NVDA", "Ticker", group=grp_s3)\r\ns3_up   = input.int(5, "Project Up", inline="s3_p", group=grp_s3)\r\ns3_dn   = input.int(5, "Project Down", inline="s3_p", group=grp_s3)\r\n\r\n// Daily\r\ns3_d_show = input.bool(true, "Show Daily Zones", group=grp_s3)\r\ns3_d_z1_t = input.price(0.0, "Z1 Top", inline="s3_d1", group=grp_s3)\r\ns3_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s3_d1", group=grp_s3)\r\ns3_d_z2_t = input.price(0.0, "Z2 Top", inline="s3_d2", group=grp_s3)\r\ns3_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s3_d2", group=grp_s3)\r\n// Weekly\r\ns3_w_show = input.bool(true, "Show Weekly Zones", group=grp_s3)\r\ns3_w_z1_t = input.price(0.0, "Z1 Top", inline="s3_w1", group=grp_s3)\r\ns3_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s3_w1", group=grp_s3)\r\ns3_w_z2_t = input.price(0.0, "Z2 Top", inline="s3_w2", group=grp_s3)\r\ns3_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s3_w2", group=grp_s3)\r\n\r\n// --- SLOT 4 ---\r\ngrp_s4 = "Asset 4"\r\ns4_name = input.string("SPY", "Ticker", group=grp_s4)\r\ns4_up   = input.int(5, "Project Up", inline="s4_p", group=grp_s4)\r\ns4_dn   = input.int(5, "Project Down", inline="s4_p", group=grp_s4)\r\n\r\n// Daily\r\ns4_d_show = input.bool(true, "Show Daily Zones", group=grp_s4)\r\ns4_d_z1_t = input.price(0.0, "Z1 Top", inline="s4_d1", group=grp_s4)\r\ns4_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s4_d1", group=grp_s4)\r\ns4_d_z2_t = input.price(0.0, "Z2 Top", inline="s4_d2", group=grp_s4)\r\ns4_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s4_d2", group=grp_s4)\r\n// Weekly\r\ns4_w_show = input.bool(true, "Show Weekly Zones", group=grp_s4)\r\ns4_w_z1_t = input.price(0.0, "Z1 Top", inline="s4_w1", group=grp_s4)\r\ns4_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s4_w1", group=grp_s4)\r\ns4_w_z2_t = input.price(0.0, "Z2 Top", inline="s4_w2", group=grp_s4)\r\ns4_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s4_w2", group=grp_s4)\r\n\r\n// --- SLOT 5 ---\r\ngrp_s5 = "Asset 5"\r\ns5_name = input.string("META", "Ticker", group=grp_s5)\r\ns5_up   = input.int(5, "Project Up", inline="s5_p", group=grp_s5)\r\ns5_dn   = input.int(5, "Project Down", inline="s5_p", group=grp_s5)\r\n\r\n// Daily\r\ns5_d_show = input.bool(true, "Show Daily Zones", group=grp_s5)\r\ns5_d_z1_t = input.price(0.0, "Z1 Top", inline="s5_d1", group=grp_s5)\r\ns5_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s5_d1", group=grp_s5)\r\ns5_d_z2_t = input.price(0.0, "Z2 Top", inline="s5_d2", group=grp_s5)\r\ns5_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s5_d2", group=grp_s5)\r\n// Weekly\r\ns5_w_show = input.bool(true, "Show Weekly Zones", group=grp_s5)\r\ns5_w_z1_t = input.price(0.0, "Z1 Top", inline="s5_w1", group=grp_s5)\r\ns5_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s5_w1", group=grp_s5)\r\ns5_w_z2_t = input.price(0.0, "Z2 Top", inline="s5_w2", group=grp_s5)\r\ns5_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s5_w2", group=grp_s5)\r\n\r\n\r\n// --- MAIN LOGIC ---\r\nmatch(n) => n != "" and (str.contains(str.lower(syminfo.ticker), str.lower(n)) or str.contains(str.lower(syminfo.root), str.lower(n)))\r\n\r\nif match(s1_name)\r\n    draw_grid(s1_d_z1_t, s1_d_z1_b, s1_d_z2_t, s1_d_z2_b, c_d_zone, c_d_line, s1_up, s1_dn, s1_d_show)\r\n    draw_grid(s1_w_z1_t, s1_w_z1_b, s1_w_z2_t, s1_w_z2_b, c_w_zone, c_w_line, s1_up, s1_dn, s1_w_show)\r\n\r\nelse if match(s2_name)\r\n    draw_grid(s2_d_z1_t, s2_d_z1_b, s2_d_z2_t, s2_d_z2_b, c_d_zone, c_d_line, s2_up, s2_dn, s2_d_show)\r\n    draw_grid(s2_w_z1_t, s2_w_z1_b, s2_w_z2_t, s2_w_z2_b, c_w_zone, c_w_line, s2_up, s2_dn, s2_w_show)\r\n\r\nelse if match(s3_name)\r\n    draw_grid(s3_d_z1_t, s3_d_z1_b, s3_d_z2_t, s3_d_z2_b, c_d_zone, c_d_line, s3_up, s3_dn, s3_d_show)\r\n    draw_grid(s3_w_z1_t, s3_w_z1_b, s3_w_z2_t, s3_w_z2_b, c_w_zone, c_w_line, s3_up, s3_dn, s3_w_show)\r\n\r\nelse if match(s4_name)\r\n    draw_grid(s4_d_z1_t, s4_d_z1_b, s4_d_z2_t, s4_d_z2_b, c_d_zone, c_d_line, s4_up, s4_dn, s4_d_show)\r\n    draw_grid(s4_w_z1_t, s4_w_z1_b, s4_w_z2_t, s4_w_z2_b, c_w_zone, c_w_line, s4_up, s4_dn, s4_w_show)\r\n\r\nelse if match(s5_name)\r\n    draw_grid(s5_d_z1_t, s5_d_z1_b, s5_d_z2_t, s5_d_z2_b, c_d_zone, c_d_line, s5_up, s5_dn, s5_d_show)\r\n    draw_grid(s5_w_z1_t, s5_w_z1_b, s5_w_z2_t, s5_w_z2_b, c_w_zone, c_w_line, s5_up, s5_dn, s5_w_show)'
[CAPTURE 2] '//@version=5\r\nindicator("Mouchli Zone Projectection Tool", overlay=true)\r\n\r\n// --- GLOBAL STYLES ---\r\ngrp_style = "Style Settings"\r\n\r\n// Daily Style\r\nc_d_zone = input.color(color.new(color.gray, 85), "Daily Zone Color", group=grp_style)\r\nc_d_line = input.color(color.new(color.purple, 80), "Daily Line Color", group=grp_style)\r\n\r\n// Weekly Style\r\nc_w_zone = input.color(color.new(color.white, 85), "Weekly Zone Color", group=grp_style)\r\nc_w_line = input.color(color.new(color.orange, 80), "Weekly Line Color", group=grp_style)\r\n\r\n// --- DRAWING FUNCTION ---\r\ndraw_grid(z1_t, z1_b, z2_t, z2_b, zone_col, line_col, p_up, p_down, show) =>\r\n    if show and z1_t > 0 and z2_t > 0\r\n        float z1_c = (z1_t + z1_b) / 2\r\n        float z2_c = (z2_t + z2_b) / 2\r\n        float dist = math.abs(z2_c - z1_c)\r\n        float avg_thick = (math.abs(z1_t - z1_b) + math.abs(z2_t - z2_b)) / 2\r\n        float half_thick = avg_thick / 2\r\n        float start_c = math.min(z1_c, z2_c)\r\n\r\n        for i = -p_down to (1 + p_up)\r\n            float cur_c = start_c + (dist * i)\r\n            // Draw Zone (No border)\r\n            box.new(bar_index - 500, cur_c + half_thick, bar_index + 10, cur_c - half_thick, border_color=na, bgcolor=zone_col, extend=extend.both)\r\n            // Draw Halfway Line\r\n            if i < (1 + p_up)\r\n                float hw = cur_c + (dist / 2)\r\n                line.new(bar_index - 500, hw, bar_index + 10, hw, style=line.style_dashed, color=line_col, extend=extend.both)\r\n\r\n// ==========================================\r\n// ASSET INPUTS\r\n// ==========================================\r\n\r\n// --- SLOT 1 ---\r\ngrp_s1 = "Asset 1"\r\ns1_name = input.string("QQQ", "Ticker", group=grp_s1)\r\n// New: Per-Asset Projectections\r\ns1_up   = input.int(5, "Project Up", inline="s1_p", group=grp_s1)\r\ns1_dn   = input.int(5, "Project Down", inline="s1_p", group=grp_s1)\r\n\r\n// Daily\r\ns1_d_show = input.bool(true, "Show Daily Zones", group=grp_s1) \r\ns1_d_z1_t = input.price(609.20, "Z1 Top", inline="s1_d1", group=grp_s1)\r\ns1_d_z1_b = input.price(609.0, "Z1 Bottom", inline="s1_d1", group=grp_s1)\r\ns1_d_z2_t = input.price(607.20, "Z2 Top", inline="s1_d2", group=grp_s1)\r\ns1_d_z2_b = input.price(607.0, "Z2 Bottom", inline="s1_d2", group=grp_s1)\r\n// Weekly\r\ns1_w_show = input.bool(true, "Show Weekly Zones", group=grp_s1)\r\ns1_w_z1_t = input.price(0.0, "Z1 Top", inline="s1_w1", group=grp_s1)\r\ns1_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s1_w1", group=grp_s1)\r\ns1_w_z2_t = input.price(0.0, "Z2 Top", inline="s1_w2", group=grp_s1)\r\ns1_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s1_w2", group=grp_s1)\r\n\r\n// --- SLOT 2 ---\r\ngrp_s2 = "Asset 2"\r\ns2_name = input.string("ES", "Ticker", group=grp_s2)\r\ns2_up   = input.int(5, "Project Up", inline="s2_p", group=grp_s2)\r\ns2_dn   = input.int(5, "Project Down", inline="s2_p", group=grp_s2)\r\n\r\n// Daily\r\ns2_d_show = input.bool(true, "Show Daily Zones", group=grp_s2)\r\ns2_d_z1_t = input.price(0.0, "Z1 Top", inline="s2_d1", group=grp_s2)\r\ns2_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s2_d1", group=grp_s2)\r\ns2_d_z2_t = input.price(0.0, "Z2 Top", inline="s2_d2", group=grp_s2)\r\ns2_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s2_d2", group=grp_s2)\r\n// Weekly\r\ns2_w_show = input.bool(true, "Show Weekly Zones", group=grp_s2)\r\ns2_w_z1_t = input.price(0.0, "Z1 Top", inline="s2_w1", group=grp_s2)\r\ns2_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s2_w1", group=grp_s2)\r\ns2_w_z2_t = input.price(0.0, "Z2 Top", inline="s2_w2", group=grp_s2)\r\ns2_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s2_w2", group=grp_s2)\r\n\r\n// --- SLOT 3 ---\r\ngrp_s3 = "Asset 3"\r\ns3_name = input.string("NVDA", "Ticker", group=grp_s3)\r\ns3_up   = input.int(5, "Project Up", inline="s3_p", group=grp_s3)\r\ns3_dn   = input.int(5, "Project Down", inline="s3_p", group=grp_s3)\r\n\r\n// Daily\r\ns3_d_show = input.bool(true, "Show Daily Zones", group=grp_s3)\r\ns3_d_z1_t = input.price(0.0, "Z1 Top", inline="s3_d1", group=grp_s3)\r\ns3_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s3_d1", group=grp_s3)\r\ns3_d_z2_t = input.price(0.0, "Z2 Top", inline="s3_d2", group=grp_s3)\r\ns3_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s3_d2", group=grp_s3)\r\n// Weekly\r\ns3_w_show = input.bool(true, "Show Weekly Zones", group=grp_s3)\r\ns3_w_z1_t = input.price(0.0, "Z1 Top", inline="s3_w1", group=grp_s3)\r\ns3_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s3_w1", group=grp_s3)\r\ns3_w_z2_t = input.price(0.0, "Z2 Top", inline="s3_w2", group=grp_s3)\r\ns3_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s3_w2", group=grp_s3)\r\n\r\n// --- SLOT 4 ---\r\ngrp_s4 = "Asset 4"\r\ns4_name = input.string("SPY", "Ticker", group=grp_s4)\r\ns4_up   = input.int(5, "Project Up", inline="s4_p", group=grp_s4)\r\ns4_dn   = input.int(5, "Project Down", inline="s4_p", group=grp_s4)\r\n\r\n// Daily\r\ns4_d_show = input.bool(true, "Show Daily Zones", group=grp_s4)\r\ns4_d_z1_t = input.price(0.0, "Z1 Top", inline="s4_d1", group=grp_s4)\r\ns4_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s4_d1", group=grp_s4)\r\ns4_d_z2_t = input.price(0.0, "Z2 Top", inline="s4_d2", group=grp_s4)\r\ns4_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s4_d2", group=grp_s4)\r\n// Weekly\r\ns4_w_show = input.bool(true, "Show Weekly Zones", group=grp_s4)\r\ns4_w_z1_t = input.price(0.0, "Z1 Top", inline="s4_w1", group=grp_s4)\r\ns4_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s4_w1", group=grp_s4)\r\ns4_w_z2_t = input.price(0.0, "Z2 Top", inline="s4_w2", group=grp_s4)\r\ns4_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s4_w2", group=grp_s4)\r\n\r\n// --- SLOT 5 ---\r\ngrp_s5 = "Asset 5"\r\ns5_name = input.string("META", "Ticker", group=grp_s5)\r\ns5_up   = input.int(5, "Project Up", inline="s5_p", group=grp_s5)\r\ns5_dn   = input.int(5, "Project Down", inline="s5_p", group=grp_s5)\r\n\r\n// Daily\r\ns5_d_show = input.bool(true, "Show Daily Zones", group=grp_s5)\r\ns5_d_z1_t = input.price(0.0, "Z1 Top", inline="s5_d1", group=grp_s5)\r\ns5_d_z1_b = input.price(0.0, "Z1 Bottom", inline="s5_d1", group=grp_s5)\r\ns5_d_z2_t = input.price(0.0, "Z2 Top", inline="s5_d2", group=grp_s5)\r\ns5_d_z2_b = input.price(0.0, "Z2 Bottom", inline="s5_d2", group=grp_s5)\r\n// Weekly\r\ns5_w_show = input.bool(true, "Show Weekly Zones", group=grp_s5)\r\ns5_w_z1_t = input.price(0.0, "Z1 Top", inline="s5_w1", group=grp_s5)\r\ns5_w_z1_b = input.price(0.0, "Z1 Bottom", inline="s5_w1", group=grp_s5)\r\ns5_w_z2_t = input.price(0.0, "Z2 Top", inline="s5_w2", group=grp_s5)\r\ns5_w_z2_b = input.price(0.0, "Z2 Bottom", inline="s5_w2", group=grp_s5)\r\n\r\n\r\n// --- MAIN LOGIC ---\r\nmatch(n) => n != "" and (str.contains(str.lower(syminfo.ticker), str.lower(n)) or str.contains(str.lower(syminfo.root), str.lower(n)))\r\n\r\nif match(s1_name)\r\n    draw_grid(s1_d_z1_t, s1_d_z1_b, s1_d_z2_t, s1_d_z2_b, c_d_zone, c_d_line, s1_up, s1_dn, s1_d_show)\r\n    draw_grid(s1_w_z1_t, s1_w_z1_b, s1_w_z2_t, s1_w_z2_b, c_w_zone, c_w_line, s1_up, s1_dn, s1_w_show)\r\n\r\nelse if match(s2_name)\r\n    draw_grid(s2_d_z1_t, s2_d_z1_b, s2_d_z2_t, s2_d_z2_b, c_d_zone, c_d_line, s2_up, s2_dn, s2_d_show)\r\n    draw_grid(s2_w_z1_t, s2_w_z1_b, s2_w_z2_t, s2_w_z2_b, c_w_zone, c_w_line, s2_up, s2_dn, s2_w_show)\r\n\r\nelse if match(s3_name)\r\n    draw_grid(s3_d_z1_t, s3_d_z1_b, s3_d_z2_t, s3_d_z2_b, c_d_zone, c_d_line, s3_up, s3_dn, s3_d_show)\r\n    draw_grid(s3_w_z1_t, s3_w_z1_b, s3_w_z2_t, s3_w_z2_b, c_w_zone, c_w_line, s3_up, s3_dn, s3_w_show)\r\n\r\nelse if match(s4_name)\r\n    draw_grid(s4_d_z1_t, s4_d_z1_b, s4_d_z2_t, s4_d_z2_b, c_d_zone, c_d_line, s4_up, s4_dn, s4_d_show)\r\n    draw_grid(s4_w_z1_t, s4_w_z1_b, s4_w_z2_t, s4_w_z2_b, c_w_zone, c_w_line, s4_up, s4_dn, s4_w_show)\r\n\r\nelse if match(s5_name)\r\n    draw_grid(s5_d_z1_t, s5_d_z1_b, s5_d_z2_t, s5_d_z2_b, c_d_zone, c_d_line, s5_up, s5_dn, s5_d_show)\r\n    draw_grid(s5_w_z1_t, s5_w_z1_b, s5_w_z2_t, s5_w_z2_b, c_w_zone, c_w_line, s5_up, s5_dn, s5_w_show)'
[DEBUG] save_script called: script_id=pEv3L2VL title=Mouchli Zone Projection Tool category=pEv3L2VL force_flat=True
[DEBUG] Writing script to: pinescript_downloads\indicators\pEv3L2VL_Mouchli_Zone_Projection_Tool.pine
[DEBUG] Marker written to: pinescript_downloads\indicators\.last_saved.txt
[DEBUG] Also saved via save_script: pinescript_downloads\indicators\pEv3L2VL_Mouchli_Zone_Projection_Tool.pine
[INJECTED CAPTURES] []
[INJECTED MUTATIONS] []
[setup] Page close event detected

[1/24] Downloading: https://www.tradingview.com/script/7bfbrEMT-TL5-Volume-Profile-Market-Structure-Volume-Distribution/
   ✓ Gedownload: https://www.tradingview.com/script/7bfbrEMT-TL5-Volume-Profile-Market-Structure-Volume-Distribution/

[2/24] Downloading: https://www.tradingview.com/script/LHtZc9og-Previous-Day-Levels-H-L-O-C/
   ✓ Gedownload: https://www.tradingview.com/script/LHtZc9og-Previous-Day-Levels-H-L-O-C/

[3/24] Downloading: https://www.tradingview.com/script/NIRVQjNO-15m-BOS-OTE-FVG-OB-Prop-Firm/
   ✓ Gedownload: https://www.tradingview.com/script/NIRVQjNO-15m-BOS-OTE-FVG-OB-Prop-Firm/

[4/24] Skipping (exists): https://www.tradingview.com/script/E59fOB4T-SMC-Strategy-Hub-Alerts/  - matched script id: E59fOB4T

[5/24] Downloading: https://www.tradingview.com/script/LSlKIAnd-Sector-Divergence-Dashboard/
   ✓ Gedownload: https://www.tradingview.com/script/LSlKIAnd-Sector-Divergence-Dashboard/

[6/24] Downloading: https://www.tradingview.com/script/UWH1xgpI-Volume-Range-Anomaly-Breakout-AlgoPoint/
   ✓ Gedownload: https://www.tradingview.com/script/UWH1xgpI-Volume-Range-Anomaly-Breakout-AlgoPoint/

[7/24] Downloading: https://www.tradingview.com/script/i3PggCBW-BTC-vs-M2-Global-Index-MIT/
   ✓ Gedownload: https://www.tradingview.com/script/i3PggCBW-BTC-vs-M2-Global-Index-MIT/

[8/24] Downloading: https://www.tradingview.com/script/izjSolIv-Stabilized-EFI-HMA-alejandromasari/
   ✓ Gedownload: https://www.tradingview.com/script/izjSolIv-Stabilized-EFI-HMA-alejandromasari/

[9/24] Downloading: https://www.tradingview.com/script/IwMWEik2-ahDirtCuhzzz-15m-NY-ORB/
   ✓ Gedownload: https://www.tradingview.com/script/IwMWEik2-ahDirtCuhzzz-15m-NY-ORB/

[10/24] Downloading: https://www.tradingview.com/script/66mGO32j-Expectancy-Reality-Check/
   ✓ Gedownload: https://www.tradingview.com/script/66mGO32j-Expectancy-Reality-Check/

[11/24] Downloading: https://www.tradingview.com/script/yf10v9sf-rsi-divergence-v6/
   ✓ Gedownload: https://www.tradingview.com/script/yf10v9sf-rsi-divergence-v6/

[12/24] Downloading: https://www.tradingview.com/script/jg9avsL7-Elliot-wave-labeling-layers/
   ✓ Gedownload: https://www.tradingview.com/script/jg9avsL7-Elliot-wave-labeling-layers/

[13/24] Downloading: https://www.tradingview.com/script/q6qYB7ZB-Bookmap-Footprint-Imbalance-Bubbles/
   ✓ Gedownload: https://www.tradingview.com/script/q6qYB7ZB-Bookmap-Footprint-Imbalance-Bubbles/

[14/24] Downloading: https://www.tradingview.com/script/eeIraeIq-MA-Labels-v8/
   ✓ Gedownload: https://www.tradingview.com/script/eeIraeIq-MA-Labels-v8/

[15/24] Downloading: https://www.tradingview.com/script/E3KHrN52/
   ✓ Gedownload: https://www.tradingview.com/script/E3KHrN52/

[16/24] Downloading: https://www.tradingview.com/script/WQkwVici-All-in-one-Dynamic-Trade-Sessions/
   ✓ Gedownload: https://www.tradingview.com/script/WQkwVici-All-in-one-Dynamic-Trade-Sessions/

[17/24] Downloading: https://www.tradingview.com/script/jwRpAgI4-mtf-structure-table-smart-money/
   ✓ Gedownload: https://www.tradingview.com/script/jwRpAgI4-mtf-structure-table-smart-money/

[18/24] Downloading: https://www.tradingview.com/script/r6MsEBET-stratbynick/
   ✓ Gedownload: https://www.tradingview.com/script/r6MsEBET-stratbynick/

[19/24] Downloading: https://www.tradingview.com/script/vlMD9hnc-Capital-Options-Gate/
   ✓ Gedownload: https://www.tradingview.com/script/vlMD9hnc-Capital-Options-Gate/

[20/24] Downloading: https://www.tradingview.com/script/I2nP7fQE-XAUUSD-Breakout-SL-Points-15-Minute-Strategy-By-Nitin-Soni/
   ✓ Gedownload: https://www.tradingview.com/script/I2nP7fQE-XAUUSD-Breakout-SL-Points-15-Minute-Strategy-By-Nitin-Soni/

[21/24] Downloading: https://www.tradingview.com/script/dPce50Ra-0DTE-Strategy/
   ✓ Gedownload: https://www.tradingview.com/script/dPce50Ra-0DTE-Strategy/

[22/24] Downloading: https://www.tradingview.com/script/pEv3L2VL-Mouchli-Zone-Projection-Tool/
   ✓ Gedownload: https://www.tradingview.com/script/pEv3L2VL-Mouchli-Zone-Projection-Tool/

[23/24] Skipping (exists): https://www.tradingview.com/script/2GrOhS6a/  - matched script id: 2GrOhS6a

[24/24] Skipping (exists): https://www.tradingview.com/script/oqXzY36v-Volume-Average-UkutaLabs/  - matched script id: oqXzY36v

Bulk run summary:
  Succeeded: 21
  Skipped  : 3
  Failed   : 0

[1/24] Skipping (exists): https://www.tradingview.com/script/9fb4GIa8/  - matched script id: 9fb4GIa8

[2/24] Skipping (exists): https://www.tradingview.com/script/gQqtShU3/  - matched script id: gQqtShU3

[3/24] Skipping (exists): https://www.tradingview.com/script/Qe1ozTEm-Jags-Lib/  - matched script id: Qe1ozTEm

[4/24] Skipping (exists): https://www.tradingview.com/script/BZwlOv97-sixpack-moon/  - matched script id: BZwlOv97

[5/24] Skipping (exists): https://www.tradingview.com/script/Hs3SNCWB-Vantage-News/  - matched script id: Hs3SNCWB

[6/24] Skipping (exists): https://www.tradingview.com/script/9alKFXlY-trinitycore1/  - matched script id: 9alKFXlY

[7/24] Skipping (exists): https://www.tradingview.com/script/qH25kRij-Vantage-NewsTypes/  - matched script id: qH25kRij

[8/24] Skipping (exists): https://www.tradingview.com/script/TRT4bDo8-HawkDoveScoreLib/  - matched script id: TRT4bDo8

[9/24] Skipping (exists): https://www.tradingview.com/script/HnzSLnfE-pubLibCandlestickPatterns/  - matched script id: HnzSLnfE

[10/24] Skipping (exists): https://www.tradingview.com/script/91p3WkfZ-NodialTreesLows2-ML-Random-Forest-Pivot-Lows-Part-2-of-2/  - matched script id: 91p3WkfZ

[11/24] Skipping (exists): https://www.tradingview.com/script/UdP9vs6w-NodialTreesLows1-ML-Random-Forest-Pivot-Lows-Part-1-of-2/  - matched script id: UdP9vs6w

[12/24] Skipping (exists): https://www.tradingview.com/script/QBIvW5kT-NodialTreesHighs2-ML-Random-Forest-Pivot-Highs-Part-2-of-2/  - matched script id: QBIvW5kT

[13/24] Skipping (exists): https://www.tradingview.com/script/m1ZXaAO5-NodialTreesHighs1-ML-Random-Forest-Pivot-Highs-Part-1-of-2/  - matched script id: m1ZXaAO5

[14/24] Skipping (exists): https://www.tradingview.com/script/pejUsEWt/  - matched script id: pejUsEWt

[15/24] Skipping (exists): https://www.tradingview.com/script/boe9XWq9-NormalizedVolume-HHHL/  - matched script id: boe9XWq9

[16/24] Skipping (exists): https://www.tradingview.com/script/MfjW07NV-lib-w2c-INDI/  - matched script id: MfjW07NV

[17/24] Skipping (exists): https://www.tradingview.com/script/IpbBxogL-lib-w2b-INDI/  - matched script id: IpbBxogL

[18/24] Skipping (exists): https://www.tradingview.com/script/LrPAYnlh-lib-w2a-INDI/  - matched script id: LrPAYnlh

[19/24] Skipping (exists): https://www.tradingview.com/script/2JzH1Saj-lib-w1c-INDI/  - matched script id: 2JzH1Saj

[20/24] Skipping (exists): https://www.tradingview.com/script/ezuo2RKB-lib-w1b-INDI/  - matched script id: ezuo2RKB

[21/24] Skipping (exists): https://www.tradingview.com/script/nYdDqw9M-lib-w1a-INDI/  - matched script id: nYdDqw9M

[22/24] Skipping (exists): https://www.tradingview.com/script/FR4UG44t-lib-b2-INDI/  - matched script id: FR4UG44t

[23/24] Skipping (exists): https://www.tradingview.com/script/Plkq74W1-lib-b1-INDI/  - matched script id: Plkq74W1

[24/24] Skipping (exists): https://www.tradingview.com/script/v1iaI2iv-TPOSmartMoneyLib/  - matched script id: v1iaI2iv

Bulk run summary:
  Succeeded: 0
  Skipped  : 24
  Failed   : 0

[1/24] Skipping (exists): https://www.tradingview.com/script/sBCX6f7A-KAPISH-Weekly-Open-Trailing-SL/  - matched script id: sBCX6f7A

[2/24] Skipping (exists): https://www.tradingview.com/script/DGHszjT7-March-May-Oct-Dec-bank-stocks-strategy/  - matched script id: DGHszjT7

[3/24] Skipping (exists): https://www.tradingview.com/script/ot1dU5ak-Vishall-ForcePRO-display/  - matched script id: ot1dU5ak

[4/24] Skipping (exists): https://www.tradingview.com/script/VvmyM9ec-High-Breakout-PRO-Huy-Hoang-Trader/  - matched script id: VvmyM9ec

[5/24] Skipping (exists): https://www.tradingview.com/script/Vkg2L9rD-Optimized-Range-RSI-MACD-Fibonacci-Risk-Mgmt/  - matched script id: Vkg2L9rD

[6/24] Skipping (exists): https://www.tradingview.com/script/pJ78II2w-Double-Bollinger-Bands-Strategy-investalot/  - matched script id: pJ78II2w

[7/24] Skipping (exists): https://www.tradingview.com/script/DV83PYxg-Advanced-Strategy-Template/  - matched script id: DV83PYxg

[8/24] Skipping (exists): https://www.tradingview.com/script/uouG11CT/  - matched script id: uouG11CT

[9/24] Skipping (exists): https://www.tradingview.com/script/1TrYDAvk-BN-90-Institutional-Alpha-Live/  - matched script id: 1TrYDAvk

[10/24] Skipping (exists): https://www.tradingview.com/script/jEK3yzzN/  - matched script id: jEK3yzzN

[11/24] Skipping (exists): https://www.tradingview.com/script/RnSXTJaz-LinReg-Slope-Momentum/  - matched script id: RnSXTJaz

[12/24] Skipping (exists): https://www.tradingview.com/script/XhztV83u-LinReg-Slope-Acceleration-Filter/  - matched script id: XhztV83u

[13/24] Skipping (exists): https://www.tradingview.com/script/p0ym48jw-Martingale-Grid-Bot/  - matched script id: p0ym48jw

[14/24] Skipping (exists): https://www.tradingview.com/script/re15NYVP-Ross-GPT-Momentum-Scalp-1m/  - matched script id: re15NYVP

[15/24] Skipping (exists): https://www.tradingview.com/script/qzhV1Uxt-High-Breakout-PRO-Huy-Hoang-Trader/  - matched script id: qzhV1Uxt

[16/24] Skipping (exists): https://www.tradingview.com/script/BLd7ZZYd/  - matched script id: BLd7ZZYd

[17/24] Skipping (exists): https://www.tradingview.com/script/SVAJ7jxW-JAMS-Intraday-Forex-EMA-Trend-Strategy-MTF-Sessions-DD/  - matched script id: SVAJ7jxW

[18/24] Skipping (exists): https://www.tradingview.com/script/UPU53NQj/  - matched script id: UPU53NQj

[19/24] Skipping (exists): https://www.tradingview.com/script/gsqiBuDh-JB-Trader-Scenario-B-Visual-Pro-Nifty-50/  - matched script id: gsqiBuDh

[20/24] Skipping (exists): https://www.tradingview.com/script/VnPYqCoF-Dstroy-V-1/  - matched script id: VnPYqCoF

[21/24] Skipping (exists): https://www.tradingview.com/script/cbUgg7hl-SPY-200SMA-4-Entry-3-Exit-TQQQ-QLD-GLDM-THREE-PHASE-STRATEGY/  - matched script id: cbUgg7hl

[22/24] Skipping (exists): https://www.tradingview.com/script/lFDe2OHE-Takashi-Kotegawa-Dip-Reversal-Strategy/  - matched script id: lFDe2OHE

[23/24] Skipping (exists): https://www.tradingview.com/script/VDvzVm3B-SPY-Quant-ML-Session-Filter-Strategy-CocoChoco/  - matched script id: VDvzVm3B

[24/24] Skipping (exists): https://www.tradingview.com/script/wG6NyOfe-US30-AsianRange-1900-0000-LIMIT-OCO-1pct-risk-120-fib-30-150/  - matched script id: wG6NyOfe

Bulk run summary:
  Succeeded: 0
  Skipped  : 24
  Failed   : 0

[1/24] Skipping (exists): https://www.tradingview.com/script/QhuJdlYk-visual-trading-zones/  - matched script id: QhuJdlYk

[2/24] Skipping (exists): https://www.tradingview.com/script/uCYd2nzZ-ICT-Daily-Wick-Quadrants/  - matched script id: uCYd2nzZ

[3/24] Skipping (exists): https://www.tradingview.com/script/2cqSdfoL-Candle-Type-The-Strat-F2U-F2D-Prev-Close-Rule-v6/  - matched script id: 2cqSdfoL

[4/24] Skipping (exists): https://www.tradingview.com/script/7oWvEHtg/  - matched script id: 7oWvEHtg

[5/24] Skipping (exists): https://www.tradingview.com/script/XtabDX0F-Paradigm-Shift-Delivery-State/  - matched script id: XtabDX0F

[6/24] Skipping (exists): https://www.tradingview.com/script/5AIDBO3Z-VWAP-Stoch-Macro-Panel-Dale-M-G-Edition/  - matched script id: 5AIDBO3Z

[7/24] Skipping (exists): https://www.tradingview.com/script/5X5urwwH-Jinzo-Prior-Month-Week-Current-Month-High-Low-POC/  - matched script id: 5X5urwwH

[8/24] Skipping (exists): https://www.tradingview.com/script/YS6kUllN-Session-Highs-Lows-TJR-style/  - matched script id: YS6kUllN

[9/24] Skipping (exists): https://www.tradingview.com/script/QSxjfO53-DeM-Indicator/  - matched script id: QSxjfO53

[10/24] Skipping (exists): https://www.tradingview.com/script/28ps0mqx-First-presented-ineficiency-indicator-10-sessions/  - matched script id: 28ps0mqx

[11/24] Skipping (exists): https://www.tradingview.com/script/gcQfnlRO-Forex-Renko-Leaderboard/  - matched script id: gcQfnlRO

[12/24] Skipping (exists): https://www.tradingview.com/script/538xLA2o-Lil-B-s-Sweep-IFVG-OK-Indicator-Asia-London-PD-Levels/  - matched script id: 538xLA2o

[13/24] Skipping (exists): https://www.tradingview.com/script/5hcCc6xr-Total-Futures-Volume-Open-Interest-Aggregated-Curve/  - matched script id: 5hcCc6xr

[14/24] Skipping (exists): https://www.tradingview.com/script/pNozTvW7-Half-BB-MACD-Divergence/  - matched script id: pNozTvW7

[15/24] Skipping (exists): https://www.tradingview.com/script/tprkD6eS-Pro-Grid-Dual-Asset-Momentum-Visualizer/  - matched script id: tprkD6eS

[16/24] Skipping (exists): https://www.tradingview.com/script/ETuOnV8U/  - matched script id: ETuOnV8U

[17/24] Skipping (exists): https://www.tradingview.com/script/RNdRE3hv-Triple-SMA-with-Trend-Confirmation-Signals/  - matched script id: RNdRE3hv

[18/24] Skipping (exists): https://www.tradingview.com/script/9XR0LViS-CT-Displacement-FVG-Toolkit/  - matched script id: 9XR0LViS

[19/24] Skipping (exists): https://www.tradingview.com/script/Y7d91w6e-CM-Bands/  - matched script id: Y7d91w6e

[20/24] Skipping (exists): https://www.tradingview.com/script/iharkYP0-Bernoulli-Process-Trend-Probability-Entropy-MarkitTick/  - matched script id: iharkYP0

[21/24] Skipping (exists): https://www.tradingview.com/script/Q97c3X9v-Decycler-Momentum-Regime-Filter-CharonQuant/  - matched script id: Q97c3X9v

[22/24] Skipping (exists): https://www.tradingview.com/script/w37OMITk-Paddy-siva-Signals/  - matched script id: w37OMITk

[23/24] Skipping (exists): https://www.tradingview.com/script/42k5y4gc-Market-Structure-HH-HL-LL-LH/  - matched script id: 42k5y4gc

[24/24] Skipping (exists): https://www.tradingview.com/script/5aq0yP9A-CVD-Aggression-Spikes/  - matched script id: 5aq0yP9A

Bulk run summary:
  Succeeded: 0
  Skipped  : 24
  Failed   : 0

[1/24] Skipping (exists): https://www.tradingview.com/script/9fBJuou0-RSMPatternLib/  - matched script id: 9fBJuou0

[2/24] Skipping (exists): https://www.tradingview.com/script/bT29oQwi-NateraCore/  - matched script id: bT29oQwi

[3/24] Skipping (exists): https://www.tradingview.com/script/7SosYXSJ-OverfittingMetrics/  - matched script id: 7SosYXSJ

[4/24] Skipping (exists): https://www.tradingview.com/script/Y54e3jZk-libhs-td6/  - matched script id: Y54e3jZk

[5/24] Skipping (exists): https://www.tradingview.com/script/iRuzhB6y-trinitycore/  - matched script id: iRuzhB6y

[6/24] Skipping (exists): https://www.tradingview.com/script/LntmXNJu-PineStats/  - matched script id: LntmXNJu

[7/24] Skipping (exists): https://www.tradingview.com/script/L4Yf5sOC-colors-library/  - matched script id: L4Yf5sOC

[8/24] Skipping (exists): https://www.tradingview.com/script/aua4BLgo-moving-averages/  - matched script id: aua4BLgo

[9/24] Skipping (exists): https://www.tradingview.com/script/v2ROKn9K-Table-Utils/  - matched script id: v2ROKn9K

[10/24] Skipping (exists): https://www.tradingview.com/script/bNF3KSAt-LibProf/  - matched script id: bNF3KSAt

[11/24] Skipping (exists): https://www.tradingview.com/script/UTtCYmnN-SimpleTable/  - matched script id: UTtCYmnN

[12/24] Skipping (exists): https://www.tradingview.com/script/ALFrhbRH-LO1-News2023H2/  - matched script id: ALFrhbRH

[13/24] Skipping (exists): https://www.tradingview.com/script/naIuMoi1-LO1-News2023H1/  - matched script id: naIuMoi1

[14/24] Skipping (exists): https://www.tradingview.com/script/5yvQy6az-AssetCorrelationUtils/  - matched script id: 5yvQy6az

[15/24] Skipping (exists): https://www.tradingview.com/script/pHfTJlS9/  - matched script id: pHfTJlS9

[16/24] Skipping (exists): https://www.tradingview.com/script/2OpKPJs7/  - matched script id: 2OpKPJs7

[17/24] Skipping (exists): https://www.tradingview.com/script/16mOsaOu/  - matched script id: 16mOsaOu

[18/24] Skipping (exists): https://www.tradingview.com/script/9Z2mnDzl/  - matched script id: 9Z2mnDzl

[19/24] Skipping (exists): https://www.tradingview.com/script/AdGgwfvQ/  - matched script id: AdGgwfvQ

[20/24] Skipping (exists): https://www.tradingview.com/script/0G6Lh0bK/  - matched script id: 0G6Lh0bK

[21/24] Skipping (exists): https://www.tradingview.com/script/LsTKbLVJ/  - matched script id: LsTKbLVJ

[22/24] Skipping (exists): https://www.tradingview.com/script/zicMaocX/  - matched script id: zicMaocX

[23/24] Skipping (exists): https://www.tradingview.com/script/S3UZT5Y6-QTCore/  - matched script id: S3UZT5Y6

[24/24] Skipping (exists): https://www.tradingview.com/script/xkdcApSJ/  - matched script id: xkdcApSJ

Bulk run summary:
  Succeeded: 0
  Skipped  : 24
  Failed   : 0

[1/24] Skipping (exists): https://www.tradingview.com/script/ygvB0qZv-EMA50-for-Gold-strategy-TF-15M/  - matched script id: ygvB0qZv

[2/24] Skipping (exists): https://www.tradingview.com/script/TMZZLypc-Shock-Gap-Bot-Enhanced/  - matched script id: TMZZLypc

[3/24] Skipping (exists): https://www.tradingview.com/script/Zs8f29gZ/  - matched script id: Zs8f29gZ

[4/24] Skipping (exists): https://www.tradingview.com/script/uHN2BQiV-Session-Liquidity-Reversion-Strategy-Asia-Range-False-Breakout/  - matched script id: uHN2BQiV

[5/24] Skipping (exists): https://www.tradingview.com/script/w9SHOgic-Money-Machine/  - matched script id: w9SHOgic

[6/24] Skipping (exists): https://www.tradingview.com/script/4BAH2F4z-SNIPER-EMA-9-21-MACD-Angle/  - matched script id: 4BAH2F4z

[7/24] Skipping (exists): https://www.tradingview.com/script/4u46vHxV-KELTNER-BREAKOUT-STRATEGY-FOR-CRYPTO-ASSETS/  - matched script id: 4u46vHxV

[8/24] Skipping (exists): https://www.tradingview.com/script/eppl0abL/  - matched script id: eppl0abL

[9/24] Skipping (exists): https://www.tradingview.com/script/QQcgQT51-Bullish-Divergent-Bar-DCA-Strategy-Skyrexio/  - matched script id: QQcgQT51

[10/24] Skipping (exists): https://www.tradingview.com/script/2AHCi8vx-GOLD-SILVER-FARMING/  - matched script id: 2AHCi8vx

[11/24] Skipping (exists): https://www.tradingview.com/script/x2KAvERJ-Buy-Sell-Signal-Strategy/  - matched script id: x2KAvERJ

[12/24] Skipping (exists): https://www.tradingview.com/script/KQlCorH0-DANI-MTF-Pullback-Strategy/  - matched script id: KQlCorH0

[13/24] Skipping (exists): https://www.tradingview.com/script/lkrcAZxN-Empyrean-Strat-1min/  - matched script id: lkrcAZxN

[14/24] Skipping (exists): https://www.tradingview.com/script/remy4Tvq-Fractal-Breakout-with-3-Point-Trend/  - matched script id: remy4Tvq

[15/24] Skipping (exists): https://www.tradingview.com/script/mSykaf87-HA-EMA50-Trend-Filter-No-Chop-Daily-Trade-Limits/  - matched script id: mSykaf87

[16/24] Skipping (exists): https://www.tradingview.com/script/pnG40L3w-TSM-RSI-Supertrend-ATR-SL-Partial-Booking-302026/  - matched script id: pnG40L3w

[17/24] Skipping (exists): https://www.tradingview.com/script/CxY7cvCw-TSM-RSI-Supertrend-Fixed-SL-1-2-RR-302026/  - matched script id: CxY7cvCw

[18/24] Skipping (exists): https://www.tradingview.com/script/QxHxXvgA-House-Rules-SuperTrend-Strategy-ATR-Based-Non-Repainting/  - matched script id: QxHxXvgA

[19/24] Skipping (exists): https://www.tradingview.com/script/KYmvNwbY-Bank-Nifty-RSI-Dynamic-v6/  - matched script id: KYmvNwbY

[20/24] Skipping (exists): https://www.tradingview.com/script/vTqLuiZn-ICT-Opening-Gap-Strategy-Momentum1/  - matched script id: vTqLuiZn

[21/24] Skipping (exists): https://www.tradingview.com/script/wyWbZMrL-ICT-Gap-Retest-Strategy-Custom-Exits/  - matched script id: wyWbZMrL

[22/24] Skipping (exists): https://www.tradingview.com/script/pau3Zzpz-ICT-Gap-Strategy-Swing-SL-Sessions/  - matched script id: pau3Zzpz

[23/24] Skipping (exists): https://www.tradingview.com/script/3bY7sEUv-ICT-Opening-Gap-Strategy-Midpoint-Entry/  - matched script id: 3bY7sEUv

[24/24] Skipping (exists): https://www.tradingview.com/script/xac1n5wc/  - matched script id: xac1n5wc

Bulk run summary:
  Succeeded: 0
  Skipped  : 24
  Failed   : 0

[01] Processing: pinescript_downloads\indicators\page-01-urls.json

[01] Processing: pinescript_downloads\libraries\page-01-urls.json

[01] Processing: pinescript_downloads\strategies\page-01-urls.json

[02] Processing: pinescript_downloads\indicators\page-02-urls.json

[02] Processing: pinescript_downloads\libraries\page-02-urls.json

[02] Processing: pinescript_downloads\strategies\page-02-urls.json

[03] Processing: pinescript_downloads\indicators\page-03-urls.json

[03] Processing: pinescript_downloads\libraries\page-03-urls.json

[03] Processing: pinescript_downloads\strategies\page-03-urls.json

Batch pages summary:
  Processed (succeeded): 9 -> indicators, libraries, strategies, indicators, libraries, strategies, indicators, libraries, strategies
  Missing: 0 -> -
  Failed: 0 -> -
